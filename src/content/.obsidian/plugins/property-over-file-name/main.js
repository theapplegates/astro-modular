/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var D=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var W=Object.prototype.hasOwnProperty;var R=(l,o)=>()=>(l&&(o=l(l=0)),o);var z=(l,o)=>{for(var t in o)D(l,t,{get:o[t],enumerable:!0})},H=(l,o,t,e)=>{if(o&&typeof o=="object"||typeof o=="function")for(let i of $(o))!W.call(l,i)&&i!==t&&D(l,i,{get:()=>o[i],enumerable:!(e=U(o,i))||e.enumerable});return l};var B=l=>H(D({},"__esModule",{value:!0}),l);function f(l,o){let t=0,e=l.toLowerCase(),i=o.toLowerCase();for(let n of i)if(t=e.indexOf(n,t)+1,t===0)return!1;return!0}function P(l,o,t,e){let i=0,n=l.toLowerCase(),s=t.toLowerCase(),a=o.toLowerCase();n===a?i+=1e3:s===a?i+=900:n.startsWith(a)?i+=100:e&&s.startsWith(a)?i+=80:n.includes(a)?i+=50:e&&s.includes(a)&&(i+=30);let r=new RegExp(`\\b${a}`,"i");r.test(n)&&(i+=20),e&&r.test(s)&&(i+=15);let c=Math.max(0,(l.length-o.length)*.1);return i-=c,Math.max(0,i)}function F(l,o,t){let e=new Map;return l.forEach(i=>{let n=o.getFileCache(i),s=n==null?void 0:n.frontmatter,a=i.basename,r=!1,c=[];if(s&&s[t]!==void 0&&s[t]!==null){let h=String(s[t]).trim();h!==""&&(a=h,r=!0)}s!=null&&s.aliases&&(c=Array.isArray(s.aliases)?s.aliases:[s.aliases],c=c.map(h=>String(h).trim()).filter(h=>h!=="")),e.set(i.path,{file:i,displayName:a,aliases:c,lastModified:i.stat.mtime,isCustomDisplay:r})}),e}var N=R(()=>{"use strict"});var L={};z(L,{QuickSwitchModal:()=>M});var p,M,O=R(()=>{"use strict";p=require("obsidian");N();M=class extends p.FuzzySuggestModal{constructor(t,e){super(t);this.fileCache=new Map;this.recentFiles=[];this.searchTimeout=null;this.matchReasons=new Map;this.plugin=e,this.limit=10,this.plugin.settings.enableForQuickSwitcher?this.setPlaceholder("Type to search notes by title or file name..."):this.setPlaceholder("Type to search files..."),this.buildFileCache(),this.updateRecentFiles(),this.addKeyboardNavigation(),this.addFooter(),this.plugin.settings.enableForQuickSwitcher&&this.containerEl.addClass("property-over-filename-modal")}addKeyboardNavigation(){this.inputEl.addEventListener("keydown",t=>{t.key==="Escape"&&(this.close(),t.preventDefault(),t.stopPropagation())})}addFooter(){let t=this.containerEl.querySelector(".prompt");if(t){let e=t.createDiv({cls:"prompt-instructions"});[{command:"\u2191\u2193",action:"to navigate"},{command:"\u21B5",action:"to open"},{command:"ctrl \u21B5",action:"to open in new tab"},{command:"ctrl alt \u21B5",action:"to open to the right"},{command:"shift \u21B5",action:"to create"},{command:"esc",action:"to dismiss"}].forEach(({command:n,action:s})=>{let a=e.createDiv({cls:"prompt-instruction"});a.createSpan({cls:"prompt-instruction-command",text:n}),a.createSpan({text:s})})}}buildFileCache(){this.fileCache=F(this.app.vault.getMarkdownFiles(),this.app.metadataCache,this.plugin.settings.propertyKey)}updateFileCache(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,n=t.basename,s=!1,a=[];if(i&&i[this.plugin.settings.propertyKey]!==void 0&&i[this.plugin.settings.propertyKey]!==null){let r=String(i[this.plugin.settings.propertyKey]).trim();r!==""&&(n=r,s=!0)}i!=null&&i.aliases&&(a=Array.isArray(i.aliases)?i.aliases:[i.aliases],a=a.map(r=>String(r).trim()).filter(r=>r!=="")),this.fileCache.set(t.path,{file:t,displayName:n,aliases:a,lastModified:t.stat.mtime,isCustomDisplay:s})}updateRecentFiles(){var i;let t=[],e=this.app.workspace;if((i=e.recentFileTracker)!=null&&i.getLastOpenFiles&&(t=e.recentFileTracker.getLastOpenFiles().map(s=>this.app.vault.getAbstractFileByPath(s)).filter(s=>s instanceof p.TFile).slice(0,10)),t.length===0){if(t=[...this.app.workspace.getLeavesOfType("markdown").map(s=>s.view).filter(s=>s instanceof p.MarkdownView).map(s=>s.file).filter(s=>s!==null).filter((s,a,r)=>r.indexOf(s)===a)],t.length<10){let s=this.app.vault.getMarkdownFiles(),a=10-t.length,r=s.filter(c=>!t.includes(c)).slice(0,a);t.push(...r)}t=t.slice(0,10)}this.recentFiles=t}getItems(){return this.app.vault.getMarkdownFiles()}getItemText(t){return"isNewNote"in t?t.newName:this.plugin.settings.enableForQuickSwitcher?this.getDisplayName(t):t.basename}getDisplayName(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,n=i==null?void 0:i[this.plugin.settings.propertyKey];if(n!=null){let s=String(n).trim();if(s!=="")return s}return t.basename}getSuggestions(t){var i;if(!this.plugin.settings.enableForQuickSwitcher){let n=t.trim();if(!n)return this.getRecentFilesResults();let s=this.app.vault.getMarkdownFiles(),a=(0,p.prepareFuzzySearch)(n),r=[];for(let c of s){let h=(i=a(c.basename))!=null?i:{score:0,matches:[]};h.matches.length>0&&r.push({item:c,match:h})}return r.sort((c,h)=>{let g=h.match.score-c.match.score;return g!==0?g:c.item instanceof p.TFile&&h.item instanceof p.TFile?c.item.basename.localeCompare(h.item.basename):0}),r.slice(0,this.limit)}let e=t.trim();return this.searchTimeout&&clearTimeout(this.searchTimeout),e?this.performSearch(e):this.getRecentFilesResults()}getRecentFilesResults(){return this.updateRecentFiles(),this.matchReasons.clear(),this.recentFiles.map(t=>({item:t,match:{score:1e3,matches:[]}}))}performSearch(t){var n;let e=(0,p.prepareFuzzySearch)(t),i=[];this.matchReasons.clear();for(let s of this.fileCache.values()){let{file:a,displayName:r,aliases:c}=s,h=this.getItemText(a),g=(n=e(h))!=null?n:{score:0,matches:[]},u={matchedInTitle:!1,matchedInFilename:!1,matchedInAlias:!1};g.matches.length>0&&(u.matchedInTitle=!0),this.plugin.settings.includeFilenameInSearch&&a.basename!==r&&f(a.basename,t)&&(u.matchedInFilename=!0);let d=!1;this.plugin.settings.includeAliasesInSearch&&c.length>0&&(d=c.some(w=>f(w,t)),d&&(u.matchedInAlias=!0)),(g.matches.length>0||d)&&(i.push({item:a,match:g.matches.length>0?g:{score:-.1,matches:[[0,t.length]]}}),this.matchReasons.set(a.path,u))}try{i.sort((a,r)=>{let c=r.match.score-a.match.score;return c!==0?c:this.getItemText(a.item).localeCompare(this.getItemText(r.item))});let s=t.toLowerCase();if(i.some(a=>{var r;return a.item instanceof p.TFile&&(this.getDisplayName(a.item).toLowerCase()===s||this.plugin.settings.includeFilenameInSearch&&a.item.basename.toLowerCase()===s||this.plugin.settings.includeAliasesInSearch&&((r=this.fileCache.get(a.item.path))==null?void 0:r.aliases.some(c=>c.toLowerCase()===s)))}),i.length===0){let a={isNewNote:!0,newName:t};i.push({item:a,match:{score:1e3,matches:[[0,t.length]]}})}return i.slice(0,this.limit)}catch(s){return console.error("Error generating suggestions:",s),new p.Notice("Error updating Quick Switcher suggestions. Please check console for details."),[]}}renderSuggestion(t,e){let{item:i}=t,n=this.getItemText(i);if("isNewNote"in i){e.empty(),e.addClass("mod-complex"),e.createDiv({cls:"suggestion-content"}).createDiv({cls:"suggestion-title"}).setText(n),e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-action"}).setText("Enter to create");return}if(!this.plugin.settings.enableForQuickSwitcher)i instanceof p.TFile?e.setText(i.path.replace(".md","")):e.setText(n);else{let s=this.matchReasons.get(i.path);if(s&&(s.matchedInTitle||s.matchedInFilename||s.matchedInAlias)){e.addClass("mod-complex");let r=e.createDiv({cls:"suggestion-content"});r.createDiv({cls:"suggestion-title"}).setText(n),i instanceof p.TFile&&r.createDiv({cls:"suggestion-note"}).setText(i.path.replace(".md",""));let g=e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":this.getIconLabel(s)}});s.matchedInTitle?this.createTypeIcon(g):s.matchedInFilename?this.createFileIcon(g):s.matchedInAlias&&this.createForwardIcon(g)}else{e.addClass("mod-complex");let r=e.createDiv({cls:"suggestion-content"});r.createDiv({cls:"suggestion-title"}).setText(n),i instanceof p.TFile&&r.createDiv({cls:"suggestion-note"}).setText(i.path.replace(".md",""));let g=e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":"Property-based title"}});i instanceof p.TFile&&this.getDisplayName(i)!==i.basename&&this.createTypeIcon(g)}}}getIconLabel(t){return t.matchedInTitle?"Title/Property Match":t.matchedInFilename?"File Name Match":t.matchedInAlias?"Alias Match":"Match"}createTypeIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-type");let i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i.setAttribute("points","4 7 4 4 20 4 20 7"),e.appendChild(i);let n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","9"),n.setAttribute("y1","20"),n.setAttribute("x2","15"),n.setAttribute("y2","20"),e.appendChild(n);let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1","12"),s.setAttribute("y1","4"),s.setAttribute("x2","12"),s.setAttribute("y2","20"),e.appendChild(s),t.appendChild(e)}createFileIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-file-text");let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"),e.appendChild(i);let n=document.createElementNS("http://www.w3.org/2000/svg","polyline");n.setAttribute("points","14,2 14,8 20,8"),e.appendChild(n);let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1","16"),s.setAttribute("y1","13"),s.setAttribute("x2","8"),s.setAttribute("y2","13"),e.appendChild(s);let a=document.createElementNS("http://www.w3.org/2000/svg","line");a.setAttribute("x1","16"),a.setAttribute("y1","17"),a.setAttribute("x2","8"),a.setAttribute("y2","17"),e.appendChild(a);let r=document.createElementNS("http://www.w3.org/2000/svg","polyline");r.setAttribute("points","10,9 9,9 8,9"),e.appendChild(r),t.appendChild(e)}createForwardIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-forward");let i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i.setAttribute("points","15 17 20 12 15 7"),e.appendChild(i);let n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M4 18v-2a4 4 0 0 1 4-4h12"),e.appendChild(n),t.appendChild(e)}isUsingCustomProperty(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,n=i==null?void 0:i[this.plugin.settings.propertyKey];return n!=null&&String(n).trim()!==""}isUsingAlias(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,n=i==null?void 0:i.aliases;return n?!this.isUsingCustomProperty(t)&&n:!1}onChooseItem(t,e){"isNewNote"in t?this.app.vault.create(`${t.newName}.md`,"").then(i=>{this.app.workspace.getLeaf().openFile(i)}).catch(i=>{new p.Notice(`Error creating note: ${i.message}`)}):e instanceof KeyboardEvent?e.ctrlKey&&e.altKey?this.app.workspace.getLeaf(!0).openFile(t):e.ctrlKey?this.app.workspace.getLeaf().openFile(t):e.shiftKey?this.app.workspace.getLeaf().openFile(t):this.app.workspace.getLeaf().openFile(t):this.app.workspace.getLeaf().openFile(t)}}});var q={};z(q,{default:()=>E});module.exports=B(q);var v=require("obsidian");var K={propertyKey:"title",enableForLinking:!0,enableForQuickSwitcher:!0,includeFilenameInSearch:!0,includeAliasesInSearch:!0,enableForDragDrop:!0};var S=require("obsidian");N();var C=class extends S.EditorSuggest{constructor(t){super(t.app);this.fileCache=new Map;this.searchTimeout=null;this.matchReasons=new Map;this.plugin=t,this.buildFileCache()}open(){super.open();let t=this.suggestEl;if(t&&(t.addClass("property-over-filename-suggestion"),!t.querySelector(".prompt-instructions"))){let e=t.createDiv({cls:"prompt-instructions"});e.createDiv({cls:"prompt-instruction"}).setText("Type # to link heading"),e.createDiv({cls:"prompt-instruction"}).setText("Type ^ to link blocks"),e.createDiv({cls:"prompt-instruction"}).setText("Type | to change display text")}this.addKeyboardNavigation()}addKeyboardNavigation(){let t=this.suggestEl;t&&t.addEventListener("keydown",e=>{e.key==="Escape"&&(this.close(),e.preventDefault(),e.stopPropagation())})}onTrigger(t,e,i){if(!this.plugin.settings.enableForLinking)return null;let n=e.getLine(t.line).substring(0,t.ch),s=/\[\[([^#^|\]]*)$/.exec(n);return s?{start:{line:t.line,ch:n.lastIndexOf("[[")},end:t,query:s[1]}:null}buildFileCache(){this.fileCache=F(this.app.vault.getMarkdownFiles(),this.app.metadataCache,this.plugin.settings.propertyKey)}updateFileCache(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,n=t.basename,s=!1,a=[];if(i&&i[this.plugin.settings.propertyKey]!==void 0&&i[this.plugin.settings.propertyKey]!==null){let r=String(i[this.plugin.settings.propertyKey]).trim();r!==""&&(n=r,s=!0)}i!=null&&i.aliases&&(a=Array.isArray(i.aliases)?i.aliases:[i.aliases],a=a.map(r=>String(r).trim()).filter(r=>r!=="")),this.fileCache.set(t.path,{file:t,displayName:n,aliases:a,lastModified:t.stat.mtime,isCustomDisplay:s})}getSuggestions(t){let e=t.query.trim();return this.performSearch(e)}performSearch(t){let e=[],i=new Set;this.matchReasons.clear();for(let n of this.fileCache.values()){let{file:s,displayName:a,aliases:r,isCustomDisplay:c}=n,h={matchedInTitle:!1,matchedInFilename:!1,matchedInAlias:!1},g=!1;(!t||f(a,t))&&(g=!0,h.matchedInTitle=!0),this.plugin.settings.includeFilenameInSearch&&s.basename!==a&&f(s.basename,t)&&(g=!0,h.matchedInFilename=!0),this.plugin.settings.includeAliasesInSearch&&r.length>0&&r.some(d=>f(d,t))&&(g=!0,h.matchedInAlias=!0),g&&(e.push({file:s,display:a,isCustomDisplay:c}),i.add(s.basename.toLowerCase()),this.matchReasons.set(s.path,h))}return e.length===0&&t&&e.push({display:"No match found",isCustomDisplay:!1,isNoMatch:!0}),this.sortSuggestions(e,t)}sortSuggestions(t,e){return t.sort((i,n)=>{var r,c,h,g;let s=P(i.display,e,(c=(r=i.file)==null?void 0:r.basename)!=null?c:"",this.plugin.settings.includeFilenameInSearch);return P(n.display,e,(g=(h=n.file)==null?void 0:h.basename)!=null?g:"",this.plugin.settings.includeFilenameInSearch)-s||i.display.localeCompare(n.display)})}renderSuggestion(t,e){if(e.empty(),t.isNoMatch){e.setText(t.display);return}if(t.file){let i=this.matchReasons.get(t.file.path);if(i&&(i.matchedInTitle||i.matchedInFilename||i.matchedInAlias)){e.addClass("mod-complex");let s=e.createDiv({cls:"suggestion-content"});s.createDiv({cls:"suggestion-title"}).setText(t.display),s.createDiv({cls:"suggestion-note"}).setText(t.file.path.replace(".md",""));let h=e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":this.getIconLabel(i)}});i.matchedInTitle?this.createTypeIcon(h):i.matchedInFilename?this.createFileIcon(h):i.matchedInAlias&&this.createForwardIcon(h)}else{let s=e.createDiv({cls:"suggestion-content"});s.createDiv({cls:"suggestion-title",text:t.display}),s.createDiv({cls:"suggestion-note",text:t.file.path.replace(".md","")})}}}getIconLabel(t){return t.matchedInTitle?"Title/Property Match":t.matchedInFilename?"File Name Match":t.matchedInAlias?"Alias Match":"Match"}createTypeIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-type");let i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i.setAttribute("points","4 7 4 4 20 4 20 7"),e.appendChild(i);let n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","9"),n.setAttribute("y1","20"),n.setAttribute("x2","15"),n.setAttribute("y2","20"),e.appendChild(n);let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1","12"),s.setAttribute("y1","4"),s.setAttribute("x2","12"),s.setAttribute("y2","20"),e.appendChild(s),t.appendChild(e)}createFileIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-file-text");let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"),e.appendChild(i);let n=document.createElementNS("http://www.w3.org/2000/svg","polyline");n.setAttribute("points","14,2 14,8 20,8"),e.appendChild(n);let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1","16"),s.setAttribute("y1","13"),s.setAttribute("x2","8"),s.setAttribute("y2","13"),e.appendChild(s);let a=document.createElementNS("http://www.w3.org/2000/svg","line");a.setAttribute("x1","16"),a.setAttribute("y1","17"),a.setAttribute("x2","8"),a.setAttribute("y2","17"),e.appendChild(a);let r=document.createElementNS("http://www.w3.org/2000/svg","polyline");r.setAttribute("points","10,9 9,9 8,9"),e.appendChild(r),t.appendChild(e)}createForwardIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-forward");let i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i.setAttribute("points","15 17 20 12 15 7"),e.appendChild(i);let n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M4 18v-2a4 4 0 0 1 4-4h12"),e.appendChild(n),t.appendChild(e)}isUsingCustomProperty(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,n=i==null?void 0:i[this.plugin.settings.propertyKey];return n!=null&&String(n).trim()!==""}isUsingAlias(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,n=i==null?void 0:i.aliases;return n?!this.isUsingCustomProperty(t)&&n:!1}selectSuggestion(t,e){var w,y;if(t.isNoMatch)return;let i=this.app.workspace.getActiveViewOfType(S.MarkdownView);if(!i||!this.context)return;let n=i.editor,{start:s,end:a}=this.context,r=n.getLine(s.line),c=a;r.slice(a.ch,a.ch+2)==="]]"&&(c={line:a.line,ch:a.ch+2});let h=this.app.vault,g=(y=(w=h.getConfig)==null?void 0:w.call(h,"useMarkdownLinks"))!=null?y:!1,u;g?u=`[${t.display}](${encodeURI(t.file.path)})`:u=`[[${t.file.path.replace(".md","")}|${t.display}]]`,n.replaceRange(u,{line:s.line,ch:s.ch},c);let d=s.ch+u.length;try{n.setCursor({line:s.line,ch:d})}catch(Q){console.error("Error setting cursor:",Q),new S.Notice("Error setting cursor position. Please check console for details.")}}};var m=require("obsidian"),A=class extends m.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.addClass("property-over-filename-settings"),new m.Setting(t).setName("Property key").setDesc("The property to use as the display title.").addText(e=>e.setPlaceholder("title").setValue(this.plugin.settings.propertyKey).onChange(async i=>{this.plugin.settings.propertyKey=i.trim()||"title",await this.plugin.saveData(this.plugin.settings),this.plugin.updateLinkSuggester()})),new m.Setting(t).setName("When linking notes").setDesc("Enable property-based titles in the link suggester.").addToggle(e=>e.setValue(this.plugin.settings.enableForLinking).onChange(async i=>{this.plugin.settings.enableForLinking=i,await this.plugin.saveData(this.plugin.settings),this.plugin.updateLinkSuggester()})),new m.Setting(t).setName("In quick switcher").setDesc("Enable property-based titles in the quick switcher.").addToggle(e=>e.setValue(this.plugin.settings.enableForQuickSwitcher).onChange(async i=>{let n=this.plugin.settings.enableForQuickSwitcher;this.plugin.settings.enableForQuickSwitcher=i,await this.plugin.saveSettings(n)})),new m.Setting(t).setName("Include file name in fuzzy searches").setDesc("Include note file names in fuzzy search results for link suggester and quick switcher.").addToggle(e=>e.setValue(this.plugin.settings.includeFilenameInSearch).onChange(async i=>{this.plugin.settings.includeFilenameInSearch=i,await this.plugin.saveData(this.plugin.settings)})),new m.Setting(t).setName("Include aliases in fuzzy searches").setDesc("Include property aliases in fuzzy search results for link suggester and quick switcher.").addToggle(e=>e.setValue(this.plugin.settings.includeAliasesInSearch).onChange(async i=>{this.plugin.settings.includeAliasesInSearch=i,await this.plugin.saveData(this.plugin.settings)})),new m.Setting(t).setName("When dragging notes").setDesc("Use property-based titles when dragging notes from the file explorer.").addToggle(e=>e.setValue(this.plugin.settings.enableForDragDrop).onChange(async i=>{this.plugin.settings.enableForDragDrop=i,await this.plugin.saveData(this.plugin.settings)}))}};var b=require("obsidian");function V(l){l.addCommand({id:"open-quick-switcher",name:"Open Quick Switcher (Property-based)",callback:()=>{Promise.resolve().then(()=>(O(),L)).then(({QuickSwitchModal:o})=>{new o(l.app,l).open()})}}),l.addCommand({id:"toggle-linking",name:"Toggle property-based linking",callback:async()=>{l.settings.enableForLinking=!l.settings.enableForLinking,await l.saveData(l.settings),l.updateLinkSuggester(),new b.Notice(`Property-based linking ${l.settings.enableForLinking?"enabled":"disabled"}`)}}),l.addCommand({id:"toggle-quick-switcher",name:"Toggle property-based Quick Switcher",callback:async()=>{let o=l.settings.enableForQuickSwitcher;l.settings.enableForQuickSwitcher=!l.settings.enableForQuickSwitcher,await l.saveSettings(o),new b.Notice(`Property-based Quick Switcher ${l.settings.enableForQuickSwitcher?"enabled":"disabled"}`)}}),l.addCommand({id:"rebuild-cache",name:"Rebuild file cache",callback:()=>{l.rebuildCache(),new b.Notice("File cache rebuilt")}}),l.addCommand({id:"toggle-drag-drop",name:"Toggle property-based drag and drop",callback:async()=>{l.settings.enableForDragDrop=!l.settings.enableForDragDrop,await l.saveData(l.settings),new b.Notice(`Property-based drag and drop ${l.settings.enableForDragDrop?"enabled":"disabled"}`)}})}var I=class{constructor(o){this.isCommandOverridden=!1;this.plugin=o}updateQuickSwitcher(){this.plugin.settings.enableForQuickSwitcher&&!this.isCommandOverridden?this.overrideQuickSwitcherCommand():!this.plugin.settings.enableForQuickSwitcher&&this.isCommandOverridden&&this.restoreOriginalCommand()}overrideQuickSwitcherCommand(){var e;let o=this.plugin.app.commands.commands;if(o["switcher:open"]&&!this.originalSwitcherCommand){let i=o["switcher:open"];this.originalSwitcherCommand={id:i.id||"switcher:open",name:i.name||"Quick Switcher",icon:i.icon,hotkeys:i.hotkeys?[...i.hotkeys]:[],callback:i.callback}}o["switcher:open"]&&delete o["switcher:open"];let t={id:"switcher:open",name:"Quick Switcher",icon:(e=this.originalSwitcherCommand)==null?void 0:e.icon,hotkeys:[{modifiers:["Mod"],key:"o"}],callback:()=>{let i=this.plugin.app.workspace;i.switcher&&typeof i.switcher.close=="function"&&i.switcher.close(),document.querySelectorAll(".modal").forEach(s=>{s instanceof HTMLElement&&!s.classList.contains("hidden")&&s.addClass("hidden")});try{Promise.resolve().then(()=>(O(),L)).then(({QuickSwitchModal:s})=>{new s(this.plugin.app,this.plugin).open()}).catch(s=>{console.error("Error loading QuickSwitchModal:",s),this.originalSwitcherCommand&&this.originalSwitcherCommand.callback&&this.originalSwitcherCommand.callback()})}catch(s){console.error("Error creating QuickSwitchModal:",s),this.originalSwitcherCommand&&this.originalSwitcherCommand.callback&&this.originalSwitcherCommand.callback()}}};o["switcher:open"]=t,this.isCommandOverridden=!0}restoreOriginalCommand(){if(!this.originalSwitcherCommand)return;let o=this.plugin.app.commands.commands;o["switcher:open"]&&delete o["switcher:open"],o["switcher:open"]={id:this.originalSwitcherCommand.id,name:this.originalSwitcherCommand.name,icon:this.originalSwitcherCommand.icon,hotkeys:this.originalSwitcherCommand.hotkeys,callback:this.originalSwitcherCommand.callback},this.isCommandOverridden=!1}};var k=require("obsidian"),x=class{constructor(o){this.plugin=o}handleDragDrop(o,t){if(!o.dataTransfer||!o.dataTransfer.files.length)return;let e=o.dataTransfer.getData("text/plain");if(!e||!e.endsWith(".md"))return;let i=this.plugin.app.vault.getAbstractFileByPath(e);if(!i||!(i instanceof k.TFile))return;let n=this.getDisplayName(i);setTimeout(()=>{this.replaceLastInsertedLink(i,n,t)},50)}handleDOMDrop(o){var a;let t=o.target;if(!t||!t.closest(".cm-editor"))return;let e=(a=o.dataTransfer)==null?void 0:a.getData("text/plain");if(!e)return;let i=e;if(e.startsWith("obsidian://open?")){let c=new URL(e).searchParams.get("file");if(c)i=decodeURIComponent(c)+".md";else return}else if(!e.endsWith(".md"))return;let n=this.plugin.app.vault.getAbstractFileByPath(i);if(!n||!(n instanceof k.TFile))return;let s=this.getDisplayName(n);setTimeout(()=>{let r=this.plugin.app.workspace.getActiveViewOfType(k.MarkdownView);r&&r.editor&&this.replaceLastInsertedLink(n,s,r.editor)},50)}getDisplayName(o){let t=this.plugin.app.metadataCache.getFileCache(o),e=t==null?void 0:t.frontmatter,i=o.basename;if(e&&e[this.plugin.settings.propertyKey]!==void 0&&e[this.plugin.settings.propertyKey]!==null){let n=String(e[this.plugin.settings.propertyKey]).trim();n!==""&&(i=n)}return i}replaceLastInsertedLink(o,t,e){let i=e.getValue(),n=e.getCursor(),a=i.split(`
`)[n.line],r=/\[\[([^\]]+)\]\]/g,c=/\[([^\]]+)\]\(([^)]+)\)/g,h,g=null;for(;(h=r.exec(a))!==null;)g=h;if(g){let d=`[[${g[1]}|${t}]]`,w={line:n.line,ch:g.index},y={line:n.line,ch:g.index+g[0].length};e.replaceRange(d,w,y);return}for(c.lastIndex=0;(h=c.exec(a))!==null;)g=h;if(g){let u=g[2],d=`[${t}](${u})`,w={line:n.line,ch:g.index},y={line:n.line,ch:g.index+g[0].length};e.replaceRange(d,w,y)}}};var T=class{constructor(o){this.plugin=o}setSuggest(o){this.suggest=o}invalidateCache(o){this.suggest&&this.suggest.updateFileCache(o)}rebuildCache(){this.suggest&&this.suggest.buildFileCache()}};var E=class extends v.Plugin{async onload(){await this.loadSettings(),this.quickSwitcherService=new I(this),this.dragDropService=new x(this),this.cacheService=new T(this),setTimeout(()=>{this.updateLinkSuggester(),this.updateQuickSwitcher()},1e3),this.registerEvent(this.app.vault.on("modify",t=>{t instanceof v.TFile&&t.extension==="md"&&this.cacheService.invalidateCache(t)})),this.registerEvent(this.app.vault.on("rename",(t,e)=>{t instanceof v.TFile&&t.extension==="md"&&this.cacheService.invalidateCache(t)})),this.registerEvent(this.app.vault.on("delete",t=>{t instanceof v.TFile&&t.extension==="md"&&this.cacheService.invalidateCache(t)})),this.registerEvent(this.app.metadataCache.on("changed",t=>{t instanceof v.TFile&&t.extension==="md"&&this.cacheService.rebuildCache()})),this.registerEvent(this.app.metadataCache.on("resolved",()=>{this.cacheService.rebuildCache()})),this.registerEvent(this.app.workspace.on("editor-drop",(t,e)=>{this.settings.enableForDragDrop&&this.dragDropService.handleDragDrop(t,e)})),this.registerDomEvent(document,"drop",t=>{this.settings.enableForDragDrop&&this.dragDropService.handleDOMDrop(t)}),V(this),this.addSettingTab(new A(this.app,this))}updateLinkSuggester(){let t=this.app.workspace.editorSuggest;t&&(this.suggest&&(t.suggests=t.suggests.filter(e=>e!==this.suggest),this.suggest=void 0),this.settings.enableForLinking&&(this.suggest=new C(this),this.registerEditorSuggest(this.suggest),this.cacheService.setSuggest(this.suggest),t.suggests=t.suggests.filter(e=>!e.constructor.name.includes("LinkSuggest")),t.suggests.unshift(this.suggest)))}updateQuickSwitcher(){this.quickSwitcherService.updateQuickSwitcher()}rebuildCache(){this.cacheService.rebuildCache()}onunload(){let t=this.app.workspace.editorSuggest;t&&this.suggest&&(t.suggests=t.suggests.filter(e=>e!==this.suggest)),this.quickSwitcherService.restoreOriginalCommand()}async loadSettings(){this.settings=Object.assign({},K,await this.loadData())}async saveSettings(t){await this.saveData(this.settings),t!==void 0&&t!==this.settings.enableForQuickSwitcher&&this.updateQuickSwitcher()}};
