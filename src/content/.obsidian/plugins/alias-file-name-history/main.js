/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var k=Object.create;var v=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var M=Object.getPrototypeOf,B=Object.prototype.hasOwnProperty;var H=(o,a)=>{for(var e in a)v(o,e,{get:a[e],enumerable:!0})},P=(o,a,e,t)=>{if(a&&typeof a=="object"||typeof a=="function")for(let s of D(a))!B.call(o,s)&&s!==e&&v(o,s,{get:()=>a[s],enumerable:!(t=L(a,s))||t.enumerable});return o};var V=(o,a,e)=>(e=o!=null?k(M(o)):{},P(a||!o||!o.__esModule?v(e,"default",{value:o,enumerable:!0}):e,o)),G=o=>P(v({},"__esModule",{value:!0}),o);var U={};H(U,{default:()=>w});module.exports=G(U);var C=require("obsidian");var R={ignoreRegexes:["^_","^Untitled$","^Untitled \\d+$"],timeoutSeconds:5,caseSensitive:!1,autoCreateFrontmatter:!0,includeFolders:[],excludeFolders:[],fileExtensions:["md"],trackFolderRenames:"",excludePropertyName:""};var E=require("obsidian");var y=require("obsidian"),N=V(require("obsidian"));function x(o,a){if((0,y.requireApiVersion)("1.11.0")){let e=N.SettingGroup,t=new e(o);return a&&t.setHeading(a),{addSetting(s){t.addSetting(s)}}}else{let e=o.createDiv("setting-group");return a&&e.createDiv("setting-group-heading").createEl("h3",{text:a}),{addSetting(t){let s=new y.Setting(e);t(s)}}}}var F=class extends E.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty();let t=x(e);t.addSetting(l=>l.setName("Timeout seconds").setDesc("Time in seconds the name must be stable before adding aliases.").addSlider(i=>i.setLimits(1,20,1).setValue(this.plugin.settings.timeoutSeconds).setDynamicTooltip().onChange(async n=>{this.plugin.settings.timeoutSeconds=n,await this.plugin.saveSettings()}))),t.addSetting(l=>l.setName("Case sensitive uniqueness").setDesc('If enabled, treat "Note" and "note" as different aliases.').addToggle(i=>i.setValue(this.plugin.settings.caseSensitive).onChange(async n=>{this.plugin.settings.caseSensitive=n,await this.plugin.saveSettings()}))),t.addSetting(l=>l.setName("Auto-create properties").setDesc("Automatically create properties with aliases if missing.").addToggle(i=>i.setValue(this.plugin.settings.autoCreateFrontmatter).onChange(async n=>{this.plugin.settings.autoCreateFrontmatter=n,await this.plugin.saveSettings()}))),t.addSetting(l=>l.setName("File extensions").setDesc("Comma-separated list of file extensions to track.").addText(i=>i.setPlaceholder("md").setValue(this.plugin.settings.fileExtensions.join(",")).onChange(async n=>{this.plugin.settings.fileExtensions=n.split(",").map(r=>r.trim()).filter(r=>r),await this.plugin.saveSettings()})));let s=x(e,"Filtering"),c=x(e,"Folders"),d=x(e,"Advanced");s.addSetting(l=>l.setName("Ignore regex patterns").setDesc("Comma-separated regex patterns for file names or immediate parent folder names to ignore (e.g., ^_ for underscore prefixes, ^Untitled$ for Untitled). Leave empty to disable.").addText(i=>i.setPlaceholder("^_,^Untitled$,^Untitled \\d+$").setValue(this.plugin.settings.ignoreRegexes.join(",")).onChange(async n=>{this.plugin.settings.ignoreRegexes=n.split(",").map(r=>r.trim()).filter(r=>r),await this.plugin.saveSettings()}))),s.addSetting(l=>l.setName("Exclude property name").setDesc("Name of a boolean property to check in files. Files with this property set to true will be excluded from tracking. Takes priority over folder filtering.").addText(i=>i.setPlaceholder("skipRenameTracking").setValue(this.plugin.settings.excludePropertyName).onChange(async n=>{this.plugin.settings.excludePropertyName=n,await this.plugin.saveSettings()}))),c.addSetting(l=>l.setName("Include folders").setDesc("Comma-separated list of folder paths to include. If empty, all folders are included. Use {vault} or {root} to include only files directly in the vault root (no subfolders).").addText(i=>i.setValue(this.plugin.settings.includeFolders.join(",")).onChange(async n=>{this.plugin.settings.includeFolders=n.split(",").map(r=>r.trim()).filter(r=>r),await this.plugin.saveSettings()}))),c.addSetting(l=>l.setName("Exclude folders").setDesc('Comma-separated list of folder paths to exclude. Supports wildcards: use "folder/*" to exclude direct children, "folder/**" to exclude all descendants. Use {vault} or {root} to exclude files directly in the vault root.').addText(i=>i.setValue(this.plugin.settings.excludeFolders.join(",")).onChange(async n=>{this.plugin.settings.excludeFolders=n.split(",").map(r=>r.trim()).filter(r=>r),await this.plugin.saveSettings()}))),d.addSetting(l=>l.setName("Track folder renames for specific file name").setDesc("If a markdown file matches this file name, store old immediate parent folder names as aliases when parent folders are renamed.").addText(i=>i.setPlaceholder("index").setValue(this.plugin.settings.trackFolderRenames).onChange(async n=>{this.plugin.settings.trackFolderRenames=n,await this.plugin.saveSettings()})))}};var b=class{constructor(a,e){this.app=a;this.settings=e}async processAliases(a,e){let t=this.app.vault.getFileByPath(a);if(!t)return;let s=[];for(let i of this.settings.ignoreRegexes)try{s.push(new RegExp(i))}catch(n){console.error(`Invalid ignore regex: ${i}`,n)}let c=[],d=t.basename,l=d.toLowerCase();for(let i of e){if(s.some(r=>r.test(i)))continue;let n=i.toLowerCase();this.settings.caseSensitive&&i===d||!this.settings.caseSensitive&&n===l||c.push(i)}c.length!==0&&await this.app.fileManager.processFrontMatter(t,i=>{let n=i.aliases;if(!Array.isArray(n)){if(Object.keys(i).length>0&&!this.settings.autoCreateFrontmatter)return;n=[],i.aliases=n}let r=new Set(this.settings.caseSensitive?n:n.map(u=>u.toLowerCase()));for(let u of c){let h=this.settings.caseSensitive?u:u.toLowerCase();r.has(h)||(n.push(u),r.add(h))}})}};function I(o){return(o.split("/").pop()||"").replace(/\.[^/.]+$/,"")}function T(o){let a=o.split("/");return a.pop(),a.pop()||""}var w=class extends C.Plugin{constructor(){super(...arguments);this.debounceMap=new Map}async onload(){await this.loadSettings(),this.aliasProcessor=new b(this.app,this.settings),this.addSettingTab(new F(this.app,this)),this.registerEvent(this.app.vault.on("rename",this.handleRename.bind(this)))}onunload(){for(let e of this.debounceMap.values())e.timeoutId!==0&&window.clearTimeout(e.timeoutId);this.debounceMap.clear()}async loadSettings(){this.settings=Object.assign({},R,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}isPathInFolder(e,t){if(t.includes("{vault}")||t.includes("{root}")){let s=t.replace(/\{vault\}|\{root\}/g,"");return s===""||s==="/"?!e.includes("/"):e.startsWith(s+"/")||e===s}return e.startsWith(t+"/")||e===t}isPathExcluded(e,t){if(t.includes("{vault}")||t.includes("{root}")){let s=t.replace(/\{vault\}|\{root\}/g,"");if(s===""||s==="/")return!e.includes("/");t=s}if(t.endsWith("/**")){let s=t.slice(0,-3);return e.startsWith(s+"/")||e===s}else if(t.endsWith("/*")){let s=t.slice(0,-2);return e.startsWith(s+"/")?e.slice(s.length+1).includes("/"):e===s}return e.startsWith(t+"/")||e===t}handleRename(e,t){if(!(e instanceof C.TFile)||!this.settings.fileExtensions.includes(e.extension))return;let s=I(t),c=e.basename,d=T(t),l=T(e.path),i=this.settings.caseSensitive?s!==c:s.toLowerCase()!==c.toLowerCase(),n=d!==l&&!i;if(!i&&!n)return;let r=e.path;if(this.settings.excludePropertyName&&this.settings.excludePropertyName.trim()!==""){let g=this.app.metadataCache.getFileCache(e),m=g==null?void 0:g.frontmatter;if(m&&m[this.settings.excludePropertyName]===!0)return}if(this.settings.includeFolders.length>0&&!this.settings.includeFolders.some(g=>this.isPathInFolder(r,g)))return;let u=n&&this.settings.trackFolderRenames&&this.settings.trackFolderRenames.trim()!==""&&(this.settings.caseSensitive?e.basename===this.settings.trackFolderRenames:e.basename.toLowerCase()===this.settings.trackFolderRenames.toLowerCase());for(let g of this.settings.excludeFolders)if(this.isPathExcluded(r,g)){if(u&&g.endsWith("/*")&&!g.endsWith("/**")){let m=g.slice(0,-2);if(r.startsWith(m+"/")&&r.slice(m.length+1).split("/").length===2)continue}return}let h=[];for(let g of this.settings.ignoreRegexes)try{h.push(new RegExp(g))}catch(m){console.error(`Invalid ignore regex: ${g}`,m)}let f=null;if(i){if(h.some(g=>g.test(s)||g.test(c)))return;f=s}else if(n&&this.settings.trackFolderRenames&&this.settings.trackFolderRenames.trim()!==""){let g=e.basename;if(!(this.settings.caseSensitive?g===this.settings.trackFolderRenames:g.toLowerCase()===this.settings.trackFolderRenames.toLowerCase())||d===""||l===""||h.some(A=>A.test(d)||A.test(l)))return;f=d}if(!f)return;let p=this.debounceMap.get(e.path);p||(p=this.debounceMap.get(t),p&&this.debounceMap.delete(t)),p&&(p.timeoutId!==0&&window.clearTimeout(p.timeoutId),f=Array.from(p.queue)[0]);let S={queue:new Set([f]),timeoutId:0,currentPath:e.path};S.timeoutId=window.setTimeout(()=>{(async()=>{try{await this.aliasProcessor.processAliases(S.currentPath,S.queue)}catch(g){console.error("Error processing aliases:",g)}this.debounceMap.delete(S.currentPath)})()},this.settings.timeoutSeconds*1e3),this.debounceMap.set(e.path,S)}};
