/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var k=Object.create;var v=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var M=Object.getPrototypeOf,B=Object.prototype.hasOwnProperty;var H=(a,r)=>{for(var e in r)v(a,e,{get:r[e],enumerable:!0})},P=(a,r,e,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of D(r))!B.call(a,s)&&s!==e&&v(a,s,{get:()=>r[s],enumerable:!(t=L(r,s))||t.enumerable});return a};var V=(a,r,e)=>(e=a!=null?k(M(a)):{},P(r||!a||!a.__esModule?v(e,"default",{value:a,enumerable:!0}):e,a)),G=a=>P(v({},"__esModule",{value:!0}),a);var U={};H(U,{default:()=>w});module.exports=G(U);var C=require("obsidian");var R={ignoreRegexes:["^_","^Untitled$","^Untitled \\d+$"],timeoutSeconds:5,caseSensitive:!1,autoCreateFrontmatter:!0,includeFolders:[],excludeFolders:[],fileExtensions:["md"],trackFolderRenames:"",excludePropertyName:""};var E=require("obsidian");var y=require("obsidian"),N=V(require("obsidian"));function x(a,r){if((0,y.requireApiVersion)("1.11.0")){let e=N.SettingGroup,t=new e(a);return r&&t.setHeading(r),{addSetting(s){t.addSetting(s)}}}else return r&&a.createDiv("setting-group-heading").createEl("h3",{text:r}),{addSetting(e){let t=new y.Setting(a);e(t)}}}var F=class extends E.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty();let t=x(e),s=x(e,"Filtering"),d=x(e,"Folders"),c=x(e,"Advanced");t.addSetting(l=>l.setName("Timeout seconds").setDesc("Time in seconds the name must be stable before adding aliases.").addSlider(i=>i.setLimits(1,20,1).setValue(this.plugin.settings.timeoutSeconds).setDynamicTooltip().onChange(async n=>{this.plugin.settings.timeoutSeconds=n,await this.plugin.saveSettings()}))),t.addSetting(l=>l.setName("Case sensitive uniqueness").setDesc('If enabled, treat "Note" and "note" as different aliases.').addToggle(i=>i.setValue(this.plugin.settings.caseSensitive).onChange(async n=>{this.plugin.settings.caseSensitive=n,await this.plugin.saveSettings()}))),t.addSetting(l=>l.setName("Auto-create properties").setDesc("Automatically create properties with aliases if missing.").addToggle(i=>i.setValue(this.plugin.settings.autoCreateFrontmatter).onChange(async n=>{this.plugin.settings.autoCreateFrontmatter=n,await this.plugin.saveSettings()}))),t.addSetting(l=>l.setName("File extensions").setDesc("Comma-separated list of file extensions to track.").addText(i=>i.setPlaceholder("md").setValue(this.plugin.settings.fileExtensions.join(",")).onChange(async n=>{this.plugin.settings.fileExtensions=n.split(",").map(o=>o.trim()).filter(o=>o),await this.plugin.saveSettings()}))),s.addSetting(l=>l.setName("Ignore regex patterns").setDesc("Comma-separated regex patterns for file names or immediate parent folder names to ignore (e.g., ^_ for underscore prefixes, ^Untitled$ for Untitled). Leave empty to disable.").addText(i=>i.setPlaceholder("^_,^Untitled$,^Untitled \\d+$").setValue(this.plugin.settings.ignoreRegexes.join(",")).onChange(async n=>{this.plugin.settings.ignoreRegexes=n.split(",").map(o=>o.trim()).filter(o=>o),await this.plugin.saveSettings()}))),s.addSetting(l=>l.setName("Exclude property name").setDesc("Name of a boolean property to check in files. Files with this property set to true will be excluded from tracking. Takes priority over folder filtering.").addText(i=>i.setPlaceholder("skipRenameTracking").setValue(this.plugin.settings.excludePropertyName).onChange(async n=>{this.plugin.settings.excludePropertyName=n,await this.plugin.saveSettings()}))),d.addSetting(l=>l.setName("Include folders").setDesc("Comma-separated list of folder paths to include. If empty, all folders are included. Use {vault} or {root} to include only files directly in the vault root (no subfolders).").addText(i=>i.setValue(this.plugin.settings.includeFolders.join(",")).onChange(async n=>{this.plugin.settings.includeFolders=n.split(",").map(o=>o.trim()).filter(o=>o),await this.plugin.saveSettings()}))),d.addSetting(l=>l.setName("Exclude folders").setDesc('Comma-separated list of folder paths to exclude. Supports wildcards: use "folder/*" to exclude direct children, "folder/**" to exclude all descendants. Use {vault} or {root} to exclude files directly in the vault root.').addText(i=>i.setValue(this.plugin.settings.excludeFolders.join(",")).onChange(async n=>{this.plugin.settings.excludeFolders=n.split(",").map(o=>o.trim()).filter(o=>o),await this.plugin.saveSettings()}))),c.addSetting(l=>l.setName("Track folder renames for specific file name").setDesc("If a markdown file matches this file name, store old immediate parent folder names as aliases when parent folders are renamed.").addText(i=>i.setPlaceholder("index").setValue(this.plugin.settings.trackFolderRenames).onChange(async n=>{this.plugin.settings.trackFolderRenames=n,await this.plugin.saveSettings()})))}};var b=class{constructor(r,e){this.app=r;this.settings=e}async processAliases(r,e){let t=this.app.vault.getFileByPath(r);if(!t)return;let s=[];for(let i of this.settings.ignoreRegexes)try{s.push(new RegExp(i))}catch(n){console.error(`Invalid ignore regex: ${i}`,n)}let d=[],c=t.basename,l=c.toLowerCase();for(let i of e){if(s.some(o=>o.test(i)))continue;let n=i.toLowerCase();this.settings.caseSensitive&&i===c||!this.settings.caseSensitive&&n===l||d.push(i)}d.length!==0&&await this.app.fileManager.processFrontMatter(t,i=>{let n=i.aliases;if(!Array.isArray(n)){if(Object.keys(i).length>0&&!this.settings.autoCreateFrontmatter)return;n=[],i.aliases=n}let o=new Set(this.settings.caseSensitive?n:n.map(u=>u.toLowerCase()));for(let u of d){let h=this.settings.caseSensitive?u:u.toLowerCase();o.has(h)||(n.push(u),o.add(h))}})}};function I(a){return(a.split("/").pop()||"").replace(/\.[^/.]+$/,"")}function T(a){let r=a.split("/");return r.pop(),r.pop()||""}var w=class extends C.Plugin{constructor(){super(...arguments);this.debounceMap=new Map}async onload(){await this.loadSettings(),this.aliasProcessor=new b(this.app,this.settings),this.addSettingTab(new F(this.app,this)),this.registerEvent(this.app.vault.on("rename",this.handleRename.bind(this)))}onunload(){for(let e of this.debounceMap.values())e.timeoutId!==0&&window.clearTimeout(e.timeoutId);this.debounceMap.clear()}async loadSettings(){this.settings=Object.assign({},R,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}isPathInFolder(e,t){if(t.includes("{vault}")||t.includes("{root}")){let s=t.replace(/\{vault\}|\{root\}/g,"");return s===""||s==="/"?!e.includes("/"):e.startsWith(s+"/")||e===s}return e.startsWith(t+"/")||e===t}isPathExcluded(e,t){if(t.includes("{vault}")||t.includes("{root}")){let s=t.replace(/\{vault\}|\{root\}/g,"");if(s===""||s==="/")return!e.includes("/");t=s}if(t.endsWith("/**")){let s=t.slice(0,-3);return e.startsWith(s+"/")||e===s}else if(t.endsWith("/*")){let s=t.slice(0,-2);return e.startsWith(s+"/")?e.slice(s.length+1).includes("/"):e===s}return e.startsWith(t+"/")||e===t}handleRename(e,t){if(!(e instanceof C.TFile)||!this.settings.fileExtensions.includes(e.extension))return;let s=I(t),d=e.basename,c=T(t),l=T(e.path),i=this.settings.caseSensitive?s!==d:s.toLowerCase()!==d.toLowerCase(),n=c!==l&&!i;if(!i&&!n)return;let o=e.path;if(this.settings.excludePropertyName&&this.settings.excludePropertyName.trim()!==""){let g=this.app.metadataCache.getFileCache(e),m=g==null?void 0:g.frontmatter;if(m&&m[this.settings.excludePropertyName]===!0)return}if(this.settings.includeFolders.length>0&&!this.settings.includeFolders.some(g=>this.isPathInFolder(o,g)))return;let u=n&&this.settings.trackFolderRenames&&this.settings.trackFolderRenames.trim()!==""&&(this.settings.caseSensitive?e.basename===this.settings.trackFolderRenames:e.basename.toLowerCase()===this.settings.trackFolderRenames.toLowerCase());for(let g of this.settings.excludeFolders)if(this.isPathExcluded(o,g)){if(u&&g.endsWith("/*")&&!g.endsWith("/**")){let m=g.slice(0,-2);if(o.startsWith(m+"/")&&o.slice(m.length+1).split("/").length===2)continue}return}let h=[];for(let g of this.settings.ignoreRegexes)try{h.push(new RegExp(g))}catch(m){console.error(`Invalid ignore regex: ${g}`,m)}let f=null;if(i){if(h.some(g=>g.test(s)||g.test(d)))return;f=s}else if(n&&this.settings.trackFolderRenames&&this.settings.trackFolderRenames.trim()!==""){let g=e.basename;if(!(this.settings.caseSensitive?g===this.settings.trackFolderRenames:g.toLowerCase()===this.settings.trackFolderRenames.toLowerCase())||c===""||l===""||h.some(A=>A.test(c)||A.test(l)))return;f=c}if(!f)return;let p=this.debounceMap.get(e.path);p||(p=this.debounceMap.get(t),p&&this.debounceMap.delete(t)),p&&(p.timeoutId!==0&&window.clearTimeout(p.timeoutId),f=Array.from(p.queue)[0]);let S={queue:new Set([f]),timeoutId:0,currentPath:e.path};S.timeoutId=window.setTimeout(()=>{(async()=>{try{await this.aliasProcessor.processAliases(S.currentPath,S.queue)}catch(g){console.error("Error processing aliases:",g)}this.debounceMap.delete(S.currentPath)})()},this.settings.timeoutSeconds*1e3),this.debounceMap.set(e.path,S)}};
