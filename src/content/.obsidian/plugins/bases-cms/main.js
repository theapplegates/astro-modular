/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var Ee=Object.defineProperty;var pt=Object.getOwnPropertyDescriptor;var ct=Object.getOwnPropertyNames;var dt=Object.prototype.hasOwnProperty;var Y=(n,s)=>()=>(n&&(s=n(n=0)),s);var ee=(n,s)=>{for(var e in s)Ee(n,e,{get:s[e],enumerable:!0})},ut=(n,s,e,i)=>{if(s&&typeof s=="object"||typeof s=="function")for(let t of ct(s))!dt.call(n,t)&&t!==e&&Ee(n,t,{get:()=>s[t],enumerable:!(i=pt(s,t))||i.enumerable});return n};var Ie=n=>ut(Ee({},"__esModule",{value:!0}),n);var Ue={};ee(Ue,{getCMSViewOptions:()=>ft,readCMSSettings:()=>F});function F(n,s){var i,t,r,o,a,l,p,c,d,h,w,g,u,m,b,S,y,f,E,T,v;let e=C=>{var P;return(P=n==null?void 0:n.get)==null?void 0:P.call(n,C)};return{titleProperty:e("titleProperty")||"",descriptionProperty:e("descriptionProperty")||"",imageProperty:e("imageProperty")||"",showTitle:!0,showDate:(i=e("showDate"))!=null?i:!1,dateProperty:e("dateProperty")||"",dateIncludeTime:(t=e("dateIncludeTime"))!=null?t:!1,showTextPreview:(r=e("showTextPreview"))!=null?r:!0,fallbackToContent:(o=e("fallbackToContent"))!=null?o:!0,truncatePreviewProperty:(a=e("truncatePreviewProperty"))!=null?a:!1,fallbackToEmbeds:(()=>{let C=e("fallbackToEmbeds");return C==="always"||C==="if-empty"||C==="never"?C:C===!1?"never":"if-empty"})(),propertyDisplay1:e("propertyDisplay1")||"",propertyDisplay2:e("propertyDisplay2")||"",propertyDisplay3:e("propertyDisplay3")||"",propertyDisplay4:e("propertyDisplay4")||"",propertyDisplay5:e("propertyDisplay5")||"",propertyDisplay6:e("propertyDisplay6")||"",propertyDisplay7:e("propertyDisplay7")||"",propertyDisplay8:e("propertyDisplay8")||"",propertyDisplay9:e("propertyDisplay9")||"",propertyDisplay10:e("propertyDisplay10")||"",propertyDisplay11:e("propertyDisplay11")||"",propertyDisplay12:e("propertyDisplay12")||"",propertyDisplay13:e("propertyDisplay13")||"",propertyDisplay14:e("propertyDisplay14")||"",propertyLayout12SideBySide:(l=e("propertyLayout12SideBySide"))!=null?l:!1,propertyLayout34SideBySide:(p=e("propertyLayout34SideBySide"))!=null?p:!1,propertyLayout56SideBySide:(c=e("propertyLayout56SideBySide"))!=null?c:!1,propertyLayout78SideBySide:(d=e("propertyLayout78SideBySide"))!=null?d:!1,propertyLayout910SideBySide:(h=e("propertyLayout910SideBySide"))!=null?h:!1,propertyLayout1112SideBySide:(w=e("propertyLayout1112SideBySide"))!=null?w:!1,propertyLayout1314SideBySide:(g=e("propertyLayout1314SideBySide"))!=null?g:!1,propertyGroup1Position:e("propertyGroup1Position")||"bottom",propertyGroup2Position:e("propertyGroup2Position")||"bottom",propertyGroup3Position:e("propertyGroup3Position")||"bottom",propertyGroup4Position:e("propertyGroup4Position")||"bottom",propertyGroup5Position:e("propertyGroup5Position")||"bottom",propertyGroup6Position:e("propertyGroup6Position")||"bottom",propertyGroup7Position:e("propertyGroup7Position")||"bottom",imageFormat:e("imageFormat")||"thumbnail",imagePosition:e("imagePosition")||"right",propertyLabels:e("propertyLabels")||"hide",showDraftStatus:(u=e("showDraftStatus"))!=null?u:!1,draftStatusProperty:e("draftStatusProperty")||"",draftStatusReverse:(m=e("draftStatusReverse"))!=null?m:!1,draftStatusUseFilenamePrefix:(b=e("draftStatusUseFilenamePrefix"))!=null?b:!1,showTags:(S=e("showTags"))!=null?S:!1,tagsProperty:e("tagsProperty")||"",maxTagsToShow:(y=e("maxTagsToShow"))!=null?y:3,customizeNewButton:(f=e("customizeNewButton"))!=null?f:!1,newNoteLocation:e("newNoteLocation")||"",hideQuickEditIcon:(E=e("hideQuickEditIcon"))!=null?E:!1,cardSize:(T=e("cardSize"))!=null?T:250,imageAspectRatio:(v=e("imageAspectRatio"))!=null?v:.55}}function ft(){return[{type:"slider",displayName:"Card size",key:"cardSize",min:50,max:800,step:10,default:250},{type:"group",displayName:"Title",items:[{type:"property",displayName:"Title property",key:"titleProperty",placeholder:"Select property",default:""}]},{type:"group",displayName:"Text preview",items:[{type:"toggle",displayName:"Show text preview",key:"showTextPreview",default:!0},{type:"property",displayName:"Text preview property",key:"descriptionProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Use note content if text preview property unavailable",key:"fallbackToContent",default:!0},{type:"toggle",displayName:"Truncate preview property",key:"truncatePreviewProperty",default:!1}]},{type:"group",displayName:"Image",items:[{type:"dropdown",displayName:"Image format",key:"imageFormat",options:{none:"No image",thumbnail:"Thumbnail",cover:"Cover"},default:"thumbnail"},{type:"property",displayName:"Image property",key:"imageProperty",placeholder:"Select property",default:""},{type:"dropdown",displayName:"Show image embeds",key:"fallbackToEmbeds",options:{always:"Always","if-empty":"If image property missing or empty",never:"Never"},default:"if-empty"},{type:"slider",displayName:"Image aspect ratio",key:"imageAspectRatio",min:.1,max:2,step:.05,default:.55,showWhen:{key:"imageFormat",value:"cover"}}]},{type:"group",displayName:"Date",items:[{type:"toggle",displayName:"Show date",key:"showDate",default:!1},{type:"property",displayName:"Date property",key:"dateProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Include time",description:"When enabled, displays both date and time using your system locale settings",key:"dateIncludeTime",default:!1}]},{type:"group",displayName:"Draft status",items:[{type:"toggle",displayName:"Show draft status",key:"showDraftStatus",default:!1},{type:"property",displayName:"Draft status property",key:"draftStatusProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Reverse logic",key:"draftStatusReverse",default:!1},{type:"toggle",displayName:"Filename underscore prefix as draft indicator",key:"draftStatusUseFilenamePrefix",default:!1}]},{type:"group",displayName:"Tags",items:[{type:"toggle",displayName:"Show tags",key:"showTags",default:!1},{type:"property",displayName:"Tags property",key:"tagsProperty",placeholder:"Select property",default:""},{type:"slider",displayName:"Maximum tags to show",key:"maxTagsToShow",min:1,max:50,step:1,default:3,showWhen:{key:"showTags",value:!0}}]},{type:"group",displayName:"Properties",items:[{type:"dropdown",displayName:"Show property labels",key:"propertyLabels",options:{hide:"Hide",inline:"Inline",above:"On top"},default:"hide"}]},{type:"group",displayName:"Property group 1",items:[{type:"property",displayName:"First property",key:"propertyDisplay1",placeholder:"Select property",default:""},{type:"property",displayName:"Second property",key:"propertyDisplay2",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show side-by-side",key:"propertyLayout12SideBySide",default:!1},{type:"dropdown",displayName:"Position",key:"propertyGroup1Position",options:{top:"Top",bottom:"Bottom"},default:"bottom"}]},{type:"group",displayName:"Property group 2",items:[{type:"property",displayName:"Third property",key:"propertyDisplay3",placeholder:"Select property",default:""},{type:"property",displayName:"Fourth property",key:"propertyDisplay4",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show side-by-side",key:"propertyLayout34SideBySide",default:!1},{type:"dropdown",displayName:"Position",key:"propertyGroup2Position",options:{top:"Top",bottom:"Bottom"},default:"bottom"}]},{type:"group",displayName:"Property group 3",items:[{type:"property",displayName:"First property",key:"propertyDisplay5",placeholder:"Select property",default:""},{type:"property",displayName:"Second property",key:"propertyDisplay6",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show side-by-side",key:"propertyLayout56SideBySide",default:!1},{type:"dropdown",displayName:"Position",key:"propertyGroup3Position",options:{top:"Top",bottom:"Bottom"},default:"bottom"}]},{type:"group",displayName:"Property group 4",items:[{type:"property",displayName:"First property",key:"propertyDisplay7",placeholder:"Select property",default:""},{type:"property",displayName:"Second property",key:"propertyDisplay8",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show side-by-side",key:"propertyLayout78SideBySide",default:!1},{type:"dropdown",displayName:"Position",key:"propertyGroup4Position",options:{top:"Top",bottom:"Bottom"},default:"bottom"}]},{type:"group",displayName:"Property group 5",items:[{type:"property",displayName:"First property",key:"propertyDisplay9",placeholder:"Select property",default:""},{type:"property",displayName:"Second property",key:"propertyDisplay10",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show side-by-side",key:"propertyLayout910SideBySide",default:!1},{type:"dropdown",displayName:"Position",key:"propertyGroup5Position",options:{top:"Top",bottom:"Bottom"},default:"bottom"}]},{type:"group",displayName:"Property group 6",items:[{type:"property",displayName:"First property",key:"propertyDisplay11",placeholder:"Select property",default:""},{type:"property",displayName:"Second property",key:"propertyDisplay12",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show side-by-side",key:"propertyLayout1112SideBySide",default:!1},{type:"dropdown",displayName:"Position",key:"propertyGroup6Position",options:{top:"Top",bottom:"Bottom"},default:"bottom"}]},{type:"group",displayName:"Property group 7",items:[{type:"property",displayName:"First property",key:"propertyDisplay13",placeholder:"Select property",default:""},{type:"property",displayName:"Second property",key:"propertyDisplay14",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show side-by-side",key:"propertyLayout1314SideBySide",default:!1},{type:"dropdown",displayName:"Position",key:"propertyGroup7Position",options:{top:"Top",bottom:"Bottom"},default:"bottom"}]},{type:"group",displayName:"Behavior",items:[{type:"toggle",displayName:"Open new notes directly",description:"Skip the Bases modal and create notes directly (like the file explorer). When disabled, uses normal Bases behavior with the property popup.",key:"customizeNewButton",default:!1},{type:"text",displayName:"Location for new notes",description:'Folder path where new notes will be created. Use / for vault root, or specify a folder path. Works independently of "Open new notes directly".',key:"newNoteLocation",placeholder:"Simply use / for vault folder",default:""},{type:"toggle",displayName:"Hide quick edit icon",key:"hideQuickEditIcon",default:!1}]}]}var H=Y(()=>{"use strict"});function Ze(n,s){var t;let e=[],i=n.vault.getAbstractFileByPath(s.path);if(i instanceof N.TFile){let r=n.metadataCache.getFileCache(i),o=(r==null?void 0:r.embeds)||[];for(let l of o){let p=n.metadataCache.getFirstLinkpathDest(l.link,s.path);p instanceof N.TFile&&e.push(p)}let a=r==null?void 0:r.frontmatter;if(a){let l=["image","imageOG","cover","thumbnail"],p=["avif","bmp","gif","jpeg","jpg","png","svg","webp"];for(let c of l){let d=a[c];if(!d)continue;let h=Array.isArray(d)?d:[d];for(let w of h){if(typeof w!="string")continue;let g=w.replace(/^!?\[\[([^\]]+)\]\]$/,"$1").trim();if(!g||g.startsWith("http://")||g.startsWith("https://"))continue;let u=n.metadataCache.getFirstLinkpathDest(g,s.path);if(!u&&g.startsWith("./")){let m=g.substring(2),b=(t=s.parent)!=null&&t.path?`${s.parent.path}/${m}`:m,S=n.vault.getAbstractFileByPath(b);S instanceof N.TFile&&(u=S)}if(!u){let m=n.vault.getAbstractFileByPath(g);m instanceof N.TFile&&(u=m)}u&&p.includes(u.extension)&&e.push(u)}}}}return e}function Xe(n,s){let e=[];for(let i of s.children)i instanceof N.TFile&&i.extension==="md"?e.push(...Ze(n,i)):i instanceof N.TFolder&&e.push(...Xe(n,i));return e}async function Lt(n,s,e,i){let t=n.vault.getMarkdownFiles().filter(l=>l.path!==e.path),r=s.path,o=s.name,a=s.basename;for(let l of t){if(i&&l.path.startsWith(i.path+"/"))continue;let p=await n.vault.read(l);if(p.includes(r)||p.includes(o)||p.includes(a)||p.includes(`![[${o}]]`)||p.includes(`[[${o}]]`)||p.includes(`(${o})`)||p.includes(`(${r})`))return!0}return!1}async function Ye(n,s,e){let i=[];i.push(...Ze(n,s)),e&&i.push(...Xe(n,e));let t=Array.from(new Set(i.map(o=>o.path))).map(o=>n.vault.getAbstractFileByPath(o)).filter(o=>o instanceof N.TFile),r=[];for(let o of t)await Lt(n,o,s,e)||r.push(o);return r}var N,et=Y(()=>{"use strict";N=require("obsidian")});var it={};ee(it,{executeSmartDeletion:()=>K,isFolderBasedContent:()=>tt,prepareDeletionPreview:()=>ue,shouldDeleteParentFolder:()=>Ae});function tt(n,s){let e=s.deleteParentFolderFilename||"index";return n.basename===e&&n.parent!==null}function Ae(n,s){return s.deleteParentFolder&&tt(n,s)}async function ue(n,s,e){let i=[],t=[],r=[];for(let l of s){let p=n.vault.getAbstractFileByPath(l);if(p instanceof R.TFile){if(Ae(p,e)){let c=p.parent;if(c&&!t.includes(c)){t.push(c);let d=c.children.filter(h=>h instanceof R.TFile);i.push(...d)}}else i.push(p);if(e.deleteUniqueAttachments){let c=Ae(p,e)&&p.parent||void 0,d=await Ye(n,p,c);r.push(...d)}}}let o=Array.from(new Set(i.map(l=>l.path))).map(l=>n.vault.getAbstractFileByPath(l)).filter(l=>l instanceof R.TFile),a=Array.from(new Set(r.map(l=>l.path))).map(l=>n.vault.getAbstractFileByPath(l)).filter(l=>l instanceof R.TFile);return{filesToDelete:o,foldersToDelete:Array.from(new Set(t)),attachmentsToDelete:a}}async function K(n,s){let e=0,i=0;for(let t of s.filesToDelete)try{await n.fileManager.trashFile(t),e++}catch(r){console.error(`Error deleting file ${t.path}:`,r),i++}for(let t of s.attachmentsToDelete)try{await n.fileManager.trashFile(t),e++}catch(r){console.error(`Error deleting attachment ${t.path}:`,r),i++}for(let t of s.foldersToDelete)try{await n.fileManager.trashFile(t),e++}catch(r){console.error(`Error deleting folder ${t.path}:`,r),i++}i>0?new R.Notice(`Deleted ${e} items, ${i} errors occurred`):new R.Notice(`Successfully deleted ${e} item${e!==1?"s":""}`)}var R,he=Y(()=>{"use strict";R=require("obsidian");et()});var st={};ee(st,{DeletionPreviewModal:()=>J});var me,J,Be=Y(()=>{"use strict";me=require("obsidian");he();J=class extends me.Modal{constructor(e,i,t){super(e);this.preview=i,this.onConfirm=t}onOpen(){let{contentEl:e}=this;if(e.empty(),new me.Setting(e).setName("Confirm deletion").setHeading(),e.createEl("p",{text:"The following items will be deleted:",cls:"bases-cms-deletion-warning"}),this.preview.filesToDelete.length>0){e.createEl("h3",{text:`Files (${this.preview.filesToDelete.length})`});let o=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let a of this.preview.filesToDelete.slice(0,20))o.createEl("li").setText(a.path);this.preview.filesToDelete.length>20&&o.createEl("li",{text:`... and ${this.preview.filesToDelete.length-20} more files`})}if(this.preview.foldersToDelete.length>0){e.createEl("h3",{text:`Folders (${this.preview.foldersToDelete.length})`});let o=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let a of this.preview.foldersToDelete)o.createEl("li").setText(a.path)}if(this.preview.attachmentsToDelete.length>0){e.createEl("h3",{text:`Attachments (${this.preview.attachmentsToDelete.length})`});let o=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let a of this.preview.attachmentsToDelete.slice(0,20))o.createEl("li").setText(a.path);this.preview.attachmentsToDelete.length>20&&o.createEl("li",{text:`... and ${this.preview.attachmentsToDelete.length-20} more attachments`})}e.createEl("p",{text:"This action cannot be undone.",cls:"bases-cms-deletion-warning"});let i=e.createDiv();i.addClass("bases-cms-modal-button-container");let t=i.createEl("button");t.setText("Cancel"),t.addEventListener("click",()=>this.close());let r=i.createEl("button");r.setText("Delete"),r.addClass("mod-cta"),r.addClass("destructive"),r.addEventListener("click",()=>{(async()=>(await K(this.app,this.preview),this.onConfirm(),this.close()))()})}onClose(){let{contentEl:e}=this;e.empty()}}});var It={};ee(It,{default:()=>ke});module.exports=Ie(It);var at=require("obsidian");var D=require("obsidian");var Ne=require("obsidian"),te=class extends Ne.FuzzySuggestModal{constructor(e,i){super(e);this.onSelect=i}getItems(){let e=this.app.commands,i=new Map;if(e&&typeof e.listCommands=="function")try{let r=e.listCommands();for(let o of r)o&&o.id&&o.name&&!i.has(o.id)&&i.set(o.id,{id:o.id,name:o.name})}catch(r){console.warn("[Bases CMS] Error getting commands via listCommands():",r)}try{let r=e==null?void 0:e.commands;if(r&&typeof r=="object"){let o=Object.values(r);for(let a of o)a&&a.id&&a.name&&!i.has(a.id)&&i.set(a.id,{id:a.id,name:a.name})}}catch(r){console.warn("[Bases CMS] Error getting commands via registry:",r)}try{let r=e==null?void 0:e.commandRegistry;if(r&&typeof r=="object"){let o=Object.values(r);for(let a of o)a&&a.id&&a.name&&!i.has(a.id)&&i.set(a.id,{id:a.id,name:a.name})}}catch(r){console.warn("[Bases CMS] Error getting commands via internal registry:",r)}let t=Array.from(i.values());return t.sort((r,o)=>r.name.localeCompare(o.name)),t}getItemText(e){return e.name}onChooseItem(e,i){this.onSelect(e.id)}renderSuggestion(e,i){let t=e.item;i.createDiv({cls:"suggestion-title",text:t.name})}};var B=require("obsidian"),ht=()=>{if(B.requireApiVersion&&(0,B.requireApiVersion)("1.7.3")&&B.getIconIds)try{return(0,B.getIconIds)()}catch(n){console.warn("[Bases CMS] Error getting icon IDs from Obsidian:",n)}return["settings-2","settings","help-circle","info","star","heart","bookmark","home","search","bell","mail","user","users","folder","file","file-text","image","video","music","calendar","clock","edit","pencil","trash","copy","cut","paste","download","upload","save","share","link","external-link","lock","unlock","eye","eye-off","key","shield","check","x","plus","minus","arrow-left","arrow-right","arrow-up","arrow-down","chevron-left","chevron-right","chevron-up","chevron-down","menu","more-horizontal","more-vertical","grid","list","layout","columns","rows","maximize","minimize","zoom-in","zoom-out","refresh-cw","play","pause","stop","sun","moon","cloud","zap","wand-2","wand","wand-sparkles","palette","brush","sliders","power","wifi","bluetooth","monitor","laptop","smartphone","camera","mic","headphones","code","terminal","terminal-square","github","gitlab","git-branch","git-commit","database","server","cloud-download","cloud-upload","tag","tags","flag","pin","map-pin","compass","globe","rocket","car","bike","robot","apple","windows","linux","chrome","firefox","safari","credit-card","wallet","coins","book","book-open","award","trophy","badge","wrench","tool","package","box","archive","send","reply","forward","mail-open","tag-plus","tag-minus","flag-off","pin-off","map-pin-off","navigation","map","earth","plane","ship","anchor","helicopter","drone","android","keyhole","keys","fingerprint","scan","qr-code","barcode","receipt","piggy-bank","banknote","pencil-line","edit-2","edit-3"]},mt=ht().map(n=>({id:n,name:n.replace(/^lucide-/,"").replace(/-/g," ").replace(/(^\w{1})|(\s+\w{1})/g,s=>s.toUpperCase())})).sort((n,s)=>n.name.localeCompare(s.name)),ie=class extends B.FuzzySuggestModal{constructor(e,i){super(e);this.onSelect=i}getItems(){return mt}getItemText(e){return e.name}onChooseItem(e,i){this.onSelect(e.id)}renderSuggestion(e,i){let t=e.item;i.addClass("mod-complex"),i.createDiv({cls:"suggestion-content"}).createDiv({cls:"suggestion-title",text:t.name});let o=i.createDiv({cls:"suggestion-aux"});(0,B.setIcon)(o.createSpan({cls:"suggestion-flair"}),t.id)}};var se=class extends D.PluginSettingTab{constructor(e,i){super(e,i);this.plugin=i}refreshActiveToolbars(){let e=this.plugin;e&&typeof e.refreshAllToolbars=="function"&&e.refreshAllToolbars()}display(){let{containerEl:e}=this;e.empty(),new D.Setting(e).setName("Confirm bulk operations").setDesc("Show confirmation dialogs before performing bulk operations.").addToggle(o=>o.setValue(this.plugin.settings.confirmBulkOperations).onChange(a=>{(async()=>(this.plugin.settings.confirmBulkOperations=a,await this.plugin.saveData(this.plugin.settings)))()})),new D.Setting(e).setName("Toolbar buttons").setHeading(),new D.Setting(e).setName("Show select all button").setDesc("Display the select all button in the CMS toolbar.").addToggle(o=>o.setValue(this.plugin.settings.showToolbarSelectAll).onChange(a=>{(async()=>(this.plugin.settings.showToolbarSelectAll=a,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new D.Setting(e).setName("Show clear button").setDesc("Display the clear selection button in the CMS toolbar.").addToggle(o=>o.setValue(this.plugin.settings.showToolbarClear).onChange(a=>{(async()=>(this.plugin.settings.showToolbarClear=a,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new D.Setting(e).setName("Show publish button").setDesc("Display the publish button in the CMS toolbar.").addToggle(o=>o.setValue(this.plugin.settings.showToolbarPublish).onChange(a=>{(async()=>(this.plugin.settings.showToolbarPublish=a,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new D.Setting(e).setName("Show draft button").setDesc("Display the draft button in the CMS toolbar.").addToggle(o=>o.setValue(this.plugin.settings.showToolbarDraft).onChange(a=>{(async()=>(this.plugin.settings.showToolbarDraft=a,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new D.Setting(e).setName("Show tags button").setDesc("Display the tags button in the CMS toolbar.").addToggle(o=>o.setValue(this.plugin.settings.showToolbarTags).onChange(a=>{(async()=>(this.plugin.settings.showToolbarTags=a,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new D.Setting(e).setName("Show set button").setDesc("Display the set property button in the CMS toolbar.").addToggle(o=>o.setValue(this.plugin.settings.showToolbarSet).onChange(a=>{(async()=>(this.plugin.settings.showToolbarSet=a,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new D.Setting(e).setName("Show remove button").setDesc("Display the remove property button in the CMS toolbar.").addToggle(o=>o.setValue(this.plugin.settings.showToolbarRemove).onChange(a=>{(async()=>(this.plugin.settings.showToolbarRemove=a,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new D.Setting(e).setName("Show delete button").setDesc("Display the delete button in the CMS toolbar.").addToggle(o=>o.setValue(this.plugin.settings.showToolbarDelete).onChange(a=>{(async()=>(this.plugin.settings.showToolbarDelete=a,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new D.Setting(e).setName("Deletions").setHeading(),new D.Setting(e).setName("Delete parent folder for specific file name").setDesc("When enabled, deleting a note will delete its parent folder and all its contents if the note file name matches the specified name.").addToggle(o=>o.setValue(this.plugin.settings.deleteParentFolder).onChange(a=>{(async()=>(this.plugin.settings.deleteParentFolder=a,await this.plugin.saveData(this.plugin.settings)))()})),new D.Setting(e).setName("Folder deletion file name").setDesc("File name that triggers parent folder deletion.").addText(o=>o.setPlaceholder("index").setValue(this.plugin.settings.deleteParentFolderFilename).onChange(a=>{(async()=>(this.plugin.settings.deleteParentFolderFilename=a,await this.plugin.saveData(this.plugin.settings)))()})).setDisabled(!this.plugin.settings.deleteParentFolder),new D.Setting(e).setName("Delete associated unique attachments").setDesc("When deleting a note, automatically delete attachments that are only used by that note. Attachments used by other notes will be preserved.").addToggle(o=>o.setValue(this.plugin.settings.deleteUniqueAttachments).onChange(a=>{(async()=>(this.plugin.settings.deleteUniqueAttachments=a,await this.plugin.saveData(this.plugin.settings)))()})),new D.Setting(e).setName("Confirm deletions").setDesc("Show confirmation dialog before deleting files.").addToggle(o=>o.setValue(this.plugin.settings.confirmDeletions).onChange(a=>{(async()=>(this.plugin.settings.confirmDeletions=a,await this.plugin.saveData(this.plugin.settings)))()})),new D.Setting(e).setName("Appearance").setHeading(),new D.Setting(e).setName("Use home icon for CMS view").setDesc("Use the home icon instead of blocks icon for the CMS view in the Bases view selector. Restart Obsidian for this change to take effect.").addToggle(o=>o.setValue(this.plugin.settings.useHomeIcon).onChange(a=>{(async()=>(this.plugin.settings.useHomeIcon=a,await this.plugin.saveData(this.plugin.settings)))()})),new D.Setting(e).setName("Force static image for animated GIFs").setDesc("When enabled, animated GIFs will display only the first frame when used as card covers or thumbnails.").addToggle(o=>o.setValue(this.plugin.settings.forceStaticGifImages).onChange(a=>{(async()=>{this.plugin.settings.forceStaticGifImages=a,await this.plugin.saveData(this.plugin.settings);let l=this.plugin;l.activeViews&&l.activeViews.forEach(p=>{p.onDataUpdated&&p.onDataUpdated()})})()})),new D.Setting(e).setName("Quick edit").setHeading();let i,t,r;new D.Setting(e).setName("Enable quick edit").setDesc("Show an icon on card titles that launches a command when clicked.").addToggle(o=>o.setValue(this.plugin.settings.enableQuickEdit).onChange(a=>{(async()=>(this.plugin.settings.enableQuickEdit=a,await this.plugin.saveData(this.plugin.settings),i&&i.settingEl.toggleClass("bases-cms-setting-hidden",!a),t&&t.settingEl.toggleClass("bases-cms-setting-hidden",!a),r&&r.settingEl.toggleClass("bases-cms-setting-hidden",!a)))()})),i=new D.Setting(e).setName("Quick edit command").setDesc("The command to execute when clicking the quick edit icon on a card title.").addButton(o=>{var l;let a=this.plugin.settings.quickEditCommandName||(this.plugin.settings.quickEditCommand?"Select command...":"No command selected");if(o.setButtonText(a).onClick(()=>{new te(this.app,c=>{(async()=>{let d=this.app.commands,h="";if(d){if(typeof d.listCommands=="function"){let g=d.listCommands().find(u=>u.id===c);g&&(h=g.name)}if(!h){let w=d.commands;w&&w[c]&&(h=w[c].name||"")}}this.plugin.settings.quickEditCommand=c,this.plugin.settings.quickEditCommandName=h,await this.plugin.saveData(this.plugin.settings),this.display()})()}).open()}),this.plugin.settings.quickEditCommand){let p=(l=o.buttonEl.parentElement)==null?void 0:l.createEl("button",{text:"Clear",attr:{style:"margin-left: 8px;"}});p==null||p.addEventListener("click",()=>{(async()=>(this.plugin.settings.quickEditCommand="",this.plugin.settings.quickEditCommandName="",await this.plugin.saveData(this.plugin.settings),this.display()))()})}}),i.settingEl.toggleClass("bases-cms-setting-hidden",!this.plugin.settings.enableQuickEdit),t=new D.Setting(e).setName("Quick edit icon").setDesc("Select the icon to display for the quick edit button on card titles.").addButton(o=>{let a=this.getIconName(this.plugin.settings.quickEditIcon||"pencil-line");o.setButtonText(a||"Select icon...").onClick(()=>{new ie(this.app,async p=>{this.plugin.settings.quickEditIcon=p,await this.plugin.saveData(this.plugin.settings),this.display()}).open()})}),t.settingEl.toggleClass("bases-cms-setting-hidden",!this.plugin.settings.enableQuickEdit),r=new D.Setting(e).setName("Attempt to open file and execute quick edit command").setDesc("For commands that don't have special handling, attempt to open the file and execute the command. Some commands may not work properly this way.").addToggle(o=>o.setValue(this.plugin.settings.quickEditOpenFile).onChange(a=>{(async()=>(this.plugin.settings.quickEditOpenFile=a,await this.plugin.saveData(this.plugin.settings)))()})),r.settingEl.toggleClass("bases-cms-setting-hidden",!this.plugin.settings.enableQuickEdit)}getIconName(e){return e?e.replace(/^lucide-/,"").split("-").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" "):""}};var Oe={confirmBulkOperations:!0,deleteParentFolder:!1,deleteParentFolderFilename:"index",deleteUniqueAttachments:!1,confirmDeletions:!0,useHomeIcon:!1,enableQuickEdit:!1,quickEditCommand:"",quickEditCommandName:"",quickEditIcon:"pencil-line",quickEditOpenFile:!1,showToolbarSelectAll:!0,showToolbarClear:!0,showToolbarDraft:!0,showToolbarPublish:!0,showToolbarTags:!0,showToolbarSet:!0,showToolbarRemove:!0,showToolbarDelete:!0,forceStaticGifImages:!1};var X=require("obsidian");function L(n,s){if(!s||!s.trim())return null;let e=s.split(",").map(i=>i.trim()).filter(i=>i);for(let i of e){let t=n.getValue(i),r=t;if(r&&("date"in r&&r.date instanceof Date||"data"in r))return t}return null}function Re(n,s){if(!s||!s.trim())return[];let e=s.split(",")[0].trim();if(!e)return[];let i=n.getValue(e);if(!i||!("data"in i))return[];let t=i.data,r=[];if(Array.isArray(t)){for(let o of t)if(typeof o=="string"||typeof o=="number"){let a=String(o);if(a&&a.trim()){r.push(a);break}}}else if(t!=null&&t!==""&&(typeof t=="string"||typeof t=="number")){let o=String(t);o.trim()&&r.push(o)}return r}function $e(n,s,e,i){if(!n||n==="")return"";if(e){let t=e;if(typeof t.getDisplayName=="function")try{let r=t.getDisplayName(n);if(r&&typeof r=="string"&&r.trim()!=="")return r}catch(r){}}return n}function W(n){return document.body.classList.contains(n)}function Ve(){let n=getComputedStyle(document.body).getPropertyValue("--bases-cms-list-separator");return(n.startsWith('"')&&n.endsWith('"')||n.startsWith("'")&&n.endsWith("'"))&&(n=n.slice(1,-1)),n||", "}function Ce(){let n=getComputedStyle(document.body).getPropertyValue("--bases-cms-empty-value-marker");return(n.startsWith('"')&&n.endsWith('"')||n.startsWith("'")&&n.endsWith("'"))&&(n=n.slice(1,-1)),n||"\u2014"}function Pe(){return W("bases-cms-hide-missing-properties")}function oe(){return!!W("bases-cms-hide-empty-properties")}function U(){return W("bases-cms-tag-style-minimal")?"minimal":W("bases-cms-tag-style-theme")?"theme":"plain"}function q(){return W("bases-cms-show-tag-hash")}function De(n){if(n.length===0)return n;for(let s=1;s<=Math.floor(n.length/2);s++){let e=n.substring(0,s),i=Math.floor(n.length/s);if(i<2)continue;let t=!0;for(let o=1;o<i;o++)if(n.substring(o*s,(o+1)*s)!==e){t=!1;break}let r=n.length%s;if(r>0&&n.substring(i*s)!==e.substring(0,r)&&(t=!1),t)return e}return n}function gt(n,s,e,i,t,r,o){let a=n.file.basename||n.file.name,l=L(n,s.titleProperty),p=l==null?void 0:l.data,c=p!=null&&p!==""&&(typeof p=="string"||typeof p=="number")?String(p):a,d=n.file.path,h=d.split("/").slice(0,-1).join("/"),w=n.getValue("note.tags"),g=[];if(w&&w.data!=null){let C=w.data;g=(Array.isArray(C)?C.map(k=>k&&typeof k=="object"&&"data"in k?String(k.data):typeof k=="string"||typeof k=="number"?String(k):"").filter(k=>k):typeof C=="string"||typeof C=="number"?[String(C)]:[]).map(k=>k.replace(/^#/,""))}let u=n.getValue("file.tags"),m=[];if(u&&u.data!=null){let C=u.data;m=(Array.isArray(C)?C.map(k=>k&&typeof k=="object"&&k!==null&&"data"in k?String(k.data):typeof k=="string"||typeof k=="number"?String(k):"").filter(k=>typeof k=="string"&&k.length>0):typeof C=="string"||typeof C=="number"?[String(C)]:[]).map(k=>k.replace(/^#/,""))}let b=n.file.stat.ctime,S=n.file.stat.mtime,y=[];if(s.showTags&&s.tagsProperty){let C=L(n,s.tagsProperty);if(C&&C.data!=null){let P=C.data;Array.isArray(P)?y=P.map(k=>k&&typeof k=="object"&&"data"in k?String(k.data):typeof k=="string"||typeof k=="number"?String(k):"").filter(k=>typeof k=="string"&&k.length>0):(typeof P=="string"||typeof P=="number")&&(y=[String(P)])}}let f={path:d,name:a,title:c,tags:m,yamlTags:g,ctime:b,mtime:S,folderPath:h,snippet:t,imageUrl:r,hasImageAvailable:o||!1,displayTags:y.length>0?y:void 0},E=[s.propertyDisplay1,s.propertyDisplay2,s.propertyDisplay3,s.propertyDisplay4,s.propertyDisplay5,s.propertyDisplay6,s.propertyDisplay7,s.propertyDisplay8,s.propertyDisplay9,s.propertyDisplay10,s.propertyDisplay11,s.propertyDisplay12,s.propertyDisplay13,s.propertyDisplay14],T=new Set,v=E.map(C=>!C||C===""||T.has(C)?"":(T.add(C),C));return f.propertyName1=v[0]||void 0,f.propertyName2=v[1]||void 0,f.propertyName3=v[2]||void 0,f.propertyName4=v[3]||void 0,f.propertyName5=v[4]||void 0,f.propertyName6=v[5]||void 0,f.propertyName7=v[6]||void 0,f.propertyName8=v[7]||void 0,f.propertyName9=v[8]||void 0,f.propertyName10=v[9]||void 0,f.propertyName11=v[10]||void 0,f.propertyName12=v[11]||void 0,f.propertyName13=v[12]||void 0,f.propertyName14=v[13]||void 0,f.property1=v[0]?x(v[0],n,f,s):null,f.property2=v[1]?x(v[1],n,f,s):null,f.property3=v[2]?x(v[2],n,f,s):null,f.property4=v[3]?x(v[3],n,f,s):null,f.property5=v[4]?x(v[4],n,f,s):null,f.property6=v[5]?x(v[5],n,f,s):null,f.property7=v[6]?x(v[6],n,f,s):null,f.property8=v[7]?x(v[7],n,f,s):null,f.property9=v[8]?x(v[8],n,f,s):null,f.property10=v[9]?x(v[9],n,f,s):null,f.property11=v[10]?x(v[10],n,f,s):null,f.property12=v[11]?x(v[11],n,f,s):null,f.property13=v[12]?x(v[12],n,f,s):null,f.property14=v[13]?x(v[13],n,f,s):null,f}function _e(n,s,e,i,t,r,o){return n.map(a=>gt(a,s,e,i,t[a.file.path],r[a.file.path],o[a.file.path]))}function x(n,s,e,i){if(!n||n==="")return null;if(n==="file.path"||n==="file path")return e.folderPath||null;if(n==="tags"||n==="note.tags")return e.yamlTags.length>0?"tags":null;if(n==="file.tags"||n==="file tags")return e.tags.length>0?"tags":null;if(n==="file.ctime"||n==="created time")return new Date(e.ctime).toLocaleDateString();if(n==="file.mtime"||n==="modified time")return new Date(e.mtime).toLocaleDateString();let t=L(s,n);if(!t)return null;let r=t;if(!r)return null;if("date"in r&&r.date instanceof Date)return r.date.toLocaleDateString();let o=r.data;if(o==null)return null;if(o==="")return"";if(typeof o=="string"){let a=o.trim();return a.length===0?"":De(a)}if(Array.isArray(o)){if(o.length===0)return"";let a=new Set,l=[];for(let p of o){let c;if(p&&typeof p=="object"&&"data"in p){let h=p.data;h&&typeof h=="object"&&!Array.isArray(h)&&"data"in h?c=String(h.data):c=String(h)}else c=String(p);let d=c.trim();if(d&&d!==""){let h=De(d);h&&h!==""&&!a.has(h)&&(a.add(h),l.push(h))}}return l.length>0?l.join(Ve()):null}if(typeof o=="string"){let a=o.trim();return a.length===0?null:De(a)}return typeof o=="number"||typeof o=="boolean"?String(o):null}H();var xe=require("obsidian");function re(n){return/^https?:\/\//i.test(n)}function G(n){return/\.(avif|bmp|gif|jpe?g|png|svg|webp)$/i.test(n)}function qe(n){return new Promise(s=>{let e=new Image;e.onload=()=>s(!0),e.onerror=()=>s(!1),setTimeout(()=>s(!1),5e3),e.src=n})}function yt(n){let s=n.match(/^!?\[\[([^\]|]+)(?:\|[^\]]*)?\]\]$/);return s?s[1].trim():n}async function He(n){let s=[],e=[];for(let o of n){let a=yt(o);a.length!==0&&(re(a)?(G(a)||!a.includes("."))&&e.push(a):G(a)&&s.push(a))}let i=e.map(o=>qe(o).then(a=>a?o:null)),r=(await Promise.all(i)).filter(o=>o!==null);return{internalPaths:s,externalUrls:r}}function ze(n,s,e){let i=["avif","bmp","gif","jpeg","jpg","png","svg","webp"],t=[];for(let r of n){let o=e.metadataCache.getFirstLinkpathDest(r,s);if(!o&&r.startsWith("./")){let a=e.vault.getAbstractFileByPath(s);if(a&&a.parent){let l=r.substring(2),p=a.parent.path?`${a.parent.path}/${l}`:l,c=e.vault.getAbstractFileByPath(p);c instanceof xe.TFile&&(o=c)}}if(!o){let a=e.vault.getAbstractFileByPath(r);a instanceof xe.TFile&&(o=a)}if(o&&i.includes(o.extension)){let a=e.vault.getResourcePath(o);t.push(a)}}return t}async function We(n,s){let e=["avif","bmp","gif","jpeg","jpg","png","svg","webp"],i=s.metadataCache.getFileCache(n),t=[],r=new Set;if(i!=null&&i.embeds)for(let c of i.embeds){let d=c.link;if(re(d))(G(d)||!d.includes("."))&&r.add(d);else{let h=s.metadataCache.getFirstLinkpathDest(d,n.path);if(h&&e.includes(h.extension)){let w=s.vault.getResourcePath(h);t.push(w)}}}if(n.extension==="md")try{let c=await s.vault.cachedRead(n),d=/!\[([^\]]*)\]\((https?:\/\/[^\s\)]+)/gi,h;for(;(h=d.exec(c))!==null;){let u=h[2].trim().replace(/["')\s]+$/,"");re(u)&&(G(u)||!u.includes("."))&&r.add(u)}let w=/<img[^>]+src\s*=\s*["']?(https?:\/\/[^\s"'<>]+)/gi;for(;(h=w.exec(c))!==null;){let u=h[1].trim().replace(/["'\s>]+$/,"");re(u)&&(G(u)||!u.includes("."))&&r.add(u)}}catch(c){console.warn(`Failed to read file content for image extraction: ${n.path}`,c)}let a=Array.from(r).map(c=>qe(c).then(d=>d?c:null)),p=(await Promise.all(a)).filter(c=>c!==null);return[...t,...p]}function bt(n){return/\.gif(\?|#|$)/i.test(n)||/\.gif$/i.test(n)}async function j(n,s){return!s||!bt(n)?n:new Promise(e=>{let i=new Image;i.crossOrigin="anonymous",i.onload=()=>{try{let t=document.createElement("canvas");t.width=i.width,t.height=i.height;let r=t.getContext("2d");if(r){r.drawImage(i,0,0);let o=t.toDataURL("image/png");e(o)}else e(n)}catch(t){console.warn("Failed to convert GIF to static image:",t),e(n)}},i.onerror=()=>{e(n)},setTimeout(()=>{e(n)},5e3),i.src=n})}var vt=[/`([^`]+)`/g,/\*\*\*((?:(?!\*\*\*).)+)\*\*\*/g,/___((?:(?!___).)+)___/g,/\*\*((?:(?!\*\*).)+)\*\*/g,/__((?:(?!__).)+)__/g,/\*((?:(?!\*).)+)\*/g,/_((?:(?!_).)+)_/g,/~~((?:(?!~~).)+)~~/g,/==((?:(?!==).)+)==/g,/\[([^\]]+)\]\([^)]+\)/g,/!\[\[[^\]]+\]\]/g,/\[\[[^\]|]+\|[^\]]+\]\]/g,/\[\[[^\]]+\]\]/g,/#[a-zA-Z0-9_\-/]+/g,/^[-*+]\s*\[[ xX]\]\s+/gm,/^(\d+\.\s*)\[[ xX]\]\s+/gm,/^(\d+\)\s*)\[[ xX]\]\s+/gm,/^[-*+]\s+/gm,/^#{1,6}\s+.+$/gm,/^\s*(?:[-_*])\s*(?:[-_*])\s*(?:[-_*])[\s\-_*]*$/gm,/^\s*\|.*\|.*$/gm,/\^\[[^\]]*?]/g,/\[\^[^\]]+]/g,/^\s*\[\^[^\]]+]:.*$/gm,/<([a-z][a-z0-9]*)\b[^>]*>(.*?)<\/\1>/gi,/<[^>]+>/g];function wt(n){let s=new Map,e=0;return{text:n.replace(/\\(.)/g,(t,r)=>{let o=`\xA7\xA7ESCAPED${e}\xA7\xA7`;return s.set(o,r),e++,o}),map:s}}function St(n,s){let e=n;return s.forEach((i,t)=>{e=e.split(t).join(i)}),e}function kt(n){let s=n,e=!0;for(;e;){e=!1;let i=s.match(/^([`~]{3,})/m);if(!i)break;let t=i[1][0],r=i[1].length,o=i.index,a=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),l=new RegExp(`^${a}{${r}}\\s*$`,"m"),c=s.substring(o+i[1].length).match(l);if(c){let h=o+i[1].length+c.index+c[0].length;s=s.substring(0,o)+s.substring(h),e=!0}else{let d=s.indexOf(`
`,o);d===-1?s=s.substring(0,o):s=s.substring(0,o)+s.substring(d+1),e=!0}}return s}function Tt(n){if(!n||n.trim().length===0)return"";n=n.replace(/^>\s*\[![\w-]+\][+-]?.*$/gm,""),n=n.replace(/^>\s?/gm,"");let{text:s,map:e}=wt(n),i=kt(s);return vt.forEach(t=>{i=i.replace(t,(r,...o)=>{if(r.match(/<[a-z][a-z0-9]*\b[^>]*>.*?<\//i))return o[1]||"";if(o.length>0&&o[0]!==void 0){for(let a=0;a<o.length-2;a++)if(typeof o[a]=="string")return o[a]}return""})}),i=St(i,e),i}function Et(n,s=!1,e,i){let t=n.replace(/^---[\s\S]*?---/,"").trim(),r=Tt(t),o=r.indexOf(`
`),a=(o!==-1?r.substring(0,o):r).trim();(s||e&&a===e||i&&a===i)&&(r=o!==-1?r.substring(o+1).trim():"");let l=r.replace(/\^[a-zA-Z0-9-]+/g,"").split(/\s+/).filter(d=>d).join(" ").trim().replace(/\.{2,}/g,d=>d.replace(/\./g,"\u2024")),p=l.length>500,c=l.substring(0,500);return p&&(c+="\u2026"),c}async function Ge(n,s,e,i,t,r){if(e!=null&&(typeof e=="string"||typeof e=="number")&&String(e).trim().length>0){let a=String(e).trim();if(i.truncatePreviewProperty){let l=a.length>500;a=a.substring(0,500),l&&(a+="\u2026")}return a}if(i.fallbackToContent){let a=await s.vault.cachedRead(n);return Et(a,i.omitFirstLine,t,r)}return""}async function Ct(n,s,e,i,t,r,o){let a=i&&Array.isArray(i)&&i.length>0,l=t===!0||t==="always"||t==="if-empty"&&!a;if(!l&&n in r&&(delete r[n],delete o[n]),!(n in r&&!a&&l))try{let{internalPaths:p,externalUrls:c}=await He(i),d=[...ze(p,n,e),...c];d.length===0&&!a&&l&&(d=await We(s,e)),d.length>0?(r[n]=d.length>1?d:d[0],o[n]=!0):a?(delete r[n],o[n]=!0):l||(delete r[n],delete o[n])}catch(p){console.error(`Failed to load image for ${n}:`,p)}}async function je(n,s,e,i,t){let r=n.filter(a=>{let l=a.imagePropertyValues&&Array.isArray(a.imagePropertyValues)&&a.imagePropertyValues.length>0;return!(a.path in i)||l}),o=50;for(let a=0;a<r.length;a+=o){let l=r.slice(a,a+o);await Promise.all(l.map(async p=>{await Ct(p.path,p.file,e,p.imagePropertyValues,s,i,t)}))}}async function Qe(n,s,e,i,t,r){await Promise.all(n.map(async o=>{if(!(o.path in t))try{o.file.extension==="md"?t[o.path]=await Ge(o.file,i,o.descriptionData,{fallbackToContent:s,omitFirstLine:e,truncatePreviewProperty:r},o.fileName,o.titleString):t[o.path]=""}catch(a){console.error(`Failed to load snippet for ${o.path}:`,a),t[o.path]=""}}))}var le=require("obsidian");function Pt(n,s){let e=null,i=!1;if(s.draftStatusUseFilenamePrefix&&n.file&&n.file.name)e=n.file.name.startsWith("_"),i=s.draftStatusReverse?!e:e;else if(s.draftStatusProperty){let t=L(n,s.draftStatusProperty);if(t){let r=t;r&&"data"in r&&typeof r.data=="boolean"&&(e=r.data,i=s.draftStatusReverse?!e:e)}}return{booleanValue:e,isDraft:i}}function Q(n,s,e,i,t){if(!i.showDraftStatus)return;let{booleanValue:r,isDraft:o}=Pt(s,i);if(r!==null){let a=n.createDiv("card-status-badge");o?(a.addClass("status-draft"),a.appendText("Draft")):(a.addClass("status-published"),a.appendText("Published")),t&&(a.addClass("bases-cms-cursor-pointer"),a.addEventListener("click",l=>{l.stopPropagation(),t(e,"draft",!r)}))}}var A=require("obsidian");function Dt(n,s){let e=new A.Modal(n);e.titleEl.setText("Rename file");let i=e.contentEl.createDiv();i.style.width="100%";let t=new A.TextComponent(i);t.setValue(s.basename),t.inputEl.style.width="100%",t.inputEl.style.boxSizing="border-box",t.inputEl.focus(),t.inputEl.select();let r=e.contentEl.createDiv({cls:"modal-button-container"});r.createEl("button",{text:"Cancel"}).addEventListener("click",()=>e.close());let a=r.createEl("button",{text:"Rename",cls:"mod-cta"}),l=async()=>{let p=t.getValue().trim();if(!p||p===s.basename){e.close();return}let c=s.path.split("/");c[c.length-1]=p+(s.extension?`.${s.extension}`:"");let d=c.join("/");try{await n.fileManager.renameFile(s,d),e.close()}catch(h){console.error("[Bases CMS] Error renaming file:",h),e.close()}};a.addEventListener("click",()=>{l()}),t.inputEl.addEventListener("keydown",p=>{p.key==="Enter"?(p.preventDefault(),l()):p.key==="Escape"&&(p.preventDefault(),e.close())}),e.open()}function xt(n){let s=n.toLowerCase();return n==="file-explorer:rename-file"||n==="rename-file"||n==="file:rename-file"||s.includes("rename")&&s.includes("file")&&!s.includes(":")}function Ft(n,s){let e=n.toLowerCase(),i=s.toLowerCase();return["add tag","add-tag","insert-template","insert-template","editor:","markdown:"].some(r=>e.includes(r)||i.includes(r))}function Ke(n,s,e,i,t,r){if(!s.settings.enableQuickEdit||!s.settings.quickEditCommand||s.settings.quickEditCommand===""||r.hideQuickEditIcon)return;let o=e.createSpan("bases-cms-quick-edit-icon");o.addClass("bases-cms-cursor-default"),(0,A.setIcon)(o,s.settings.quickEditIcon||"pencil-line"),e.addEventListener("click",a=>{o.contains(a.target)&&(a.stopPropagation(),a.stopImmediatePropagation())},!0),i.addEventListener("click",a=>{(async()=>{var c,d,h,w;let l=a.target;if(!o.contains(l)&&!l.closest(".bases-cms-quick-edit-icon"))return;a.stopPropagation(),a.stopImmediatePropagation(),a.preventDefault();let p=n.vault.getAbstractFileByPath(t);if(p instanceof A.TFile){let g=s.settings.quickEditCommand,u=n.commands,m=(c=u==null?void 0:u.commands)==null?void 0:c[g],b=(m==null?void 0:m.name)||"",S=b.toLowerCase();if(xt(g)||S.includes("rename")&&S.includes("file")){Dt(n,p);return}if(Ft(g,b)&&!s.settings.quickEditOpenFile){new A.Notice(`The "${b}" command requires the file to be open in an editor. Enable "Attempt to open file and execute quick edit command" in settings to try anyway.`,5e3);return}let y=!1;try{let f=null,E=g;if(g.includes(":")){let T=g.split(":");f=T[0],E=T.slice(1).join(":")}else{let v=n.commands,C=(d=v==null?void 0:v.commands)==null?void 0:d[g];if(C){let P=C.plugin||C.sourcePlugin;P&&(f=((h=P.manifest)==null?void 0:h.id)||P.pluginId||null)}}if(f){let T=n.plugins,v=(w=T==null?void 0:T.plugins)==null?void 0:w[f];if(v){let C=E.split("-").map((P,k)=>k===0?P:P.charAt(0).toUpperCase()+P.slice(1)).join("")+"ByPath";if(v&&typeof v[C]=="function"){await v[C](t),y=!0;return}}}}catch(f){}if(!y){if(!s.settings.quickEditOpenFile){new A.Notice(`This command doesn't have special handling. Enable "Attempt to open file and execute quick edit command" in settings to try executing it.`,5e3);return}let f=n.workspace.getLeaf(!1);await f.openFile(p),n.workspace.setActiveLeaf(f,{focus:!0});let E=0,T=30,v=()=>{n.workspace.getActiveFile()===p&&(async()=>{var k,$;try{await(($=(k=n.commands)==null?void 0:k.executeCommandById)==null?void 0:$.call(k,s.settings.quickEditCommand))}catch(z){}})()},C=()=>{let P=f.view,k=P,$=n.workspace.getActiveFile();P&&"editor"in P&&k.editor&&$===p?requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{v()},200)})}):E<T&&(E++,setTimeout(C,50))};C()}}})()},!0),o.addEventListener("mousedown",a=>{a.stopPropagation(),a.stopImmediatePropagation(),a.preventDefault()},!0)}var ne=class{constructor(s,e,i){this.app=s;this.getBasesConfig=e;this.getBasesController=i}renderProperties(s,e,i,t,r,o){let a=[t.propertyDisplay1,t.propertyDisplay2,t.propertyDisplay3,t.propertyDisplay4,t.propertyDisplay5,t.propertyDisplay6,t.propertyDisplay7,t.propertyDisplay8,t.propertyDisplay9,t.propertyDisplay10,t.propertyDisplay11,t.propertyDisplay12,t.propertyDisplay13,t.propertyDisplay14],l=new Set,p=a.map(u=>!u||u===""||l.has(u)?"":(l.add(u),u)),c=p.map(u=>u?x(u,i,e,t):null),d=[{props:[p[0],p[1]],values:[c[0],c[1]],sideBySide:t.propertyLayout12SideBySide,position:t.propertyGroup1Position},{props:[p[2],p[3]],values:[c[2],c[3]],sideBySide:t.propertyLayout34SideBySide,position:t.propertyGroup2Position},{props:[p[4],p[5]],values:[c[4],c[5]],sideBySide:t.propertyLayout56SideBySide,position:t.propertyGroup3Position},{props:[p[6],p[7]],values:[c[6],c[7]],sideBySide:t.propertyLayout78SideBySide,position:t.propertyGroup4Position},{props:[p[8],p[9]],values:[c[8],c[9]],sideBySide:t.propertyLayout910SideBySide,position:t.propertyGroup5Position},{props:[p[10],p[11]],values:[c[10],c[11]],sideBySide:t.propertyLayout1112SideBySide,position:t.propertyGroup6Position},{props:[p[12],p[13]],values:[c[12],c[13]],sideBySide:t.propertyLayout1314SideBySide,position:t.propertyGroup7Position}],h=[],w=[];d.forEach((u,m)=>{(u.props[0]!==""||u.props[1]!=="")&&(u.position==="top"?h.push(u):w.push(u))});let g=(u,m)=>{if(!u||u==="")return!0;let b=m===null||m===""||typeof m=="string"&&m.trim()==="",S=!1;try{let y=i.file;if(y){let f=this.app.metadataCache.getFileCache(y);if(f&&f.frontmatter){let E=u.split(",").map(T=>T.trim()).filter(T=>T);for(let T of E)if(T.replace(/^(note|formula|file)\./,"")in f.frontmatter){S=!0;break}}}}catch(y){}return!!(Pe()&&!S||oe()&&S&&b||oe()&&b)};if((o==="top"||o===void 0)&&h.length>0){let u=s.createDiv("card-properties properties-top");h.forEach((m,b)=>{let S=m.props[0]&&!g(m.props[0],m.values[0]),y=m.props[1]&&!g(m.props[1],m.values[1]);if(!S&&!y)return;let f=u.createDiv(`property-row property-row-group-${b+1}`);m.sideBySide&&f.addClass("property-row-side-by-side");let E=f.createDiv("property-field property-field-1");S&&this.renderPropertyContent(E,m.props[0],m.values[0],e,i,t,r);let T=f.createDiv("property-field property-field-2");y&&this.renderPropertyContent(T,m.props[1],m.values[1],e,i,t,r)})}if((o==="bottom"||o===void 0)&&w.length>0){let u=s.createDiv("card-properties properties-bottom");w.forEach((m,b)=>{let S=m.props[0]&&!g(m.props[0],m.values[0]),y=m.props[1]&&!g(m.props[1],m.values[1]);if(!S&&!y)return;let f=u.createDiv(`property-row property-row-group-${b+1}`);m.sideBySide&&f.addClass("property-row-side-by-side");let E=f.createDiv("property-field property-field-1");S&&this.renderPropertyContent(E,m.props[0],m.values[0],e,i,t,r);let T=f.createDiv("property-field property-field-2");y&&this.renderPropertyContent(T,m.props[1],m.values[1],e,i,t,r)})}}renderPropertyContent(s,e,i,t,r,o,a){if(e===""||i===null&&Pe()||i===""&&oe()||!i&&o.propertyLabels==="hide"||o.propertyLabels==="hide"&&((e==="tags"||e==="note.tags")&&t.yamlTags.length===0||(e==="file.tags"||e==="file tags")&&t.tags.length===0))return;let l=this.getBasesConfig?this.getBasesConfig():void 0,p=this.getBasesController?this.getBasesController():void 0,c=$e(e,this.app,l,p),d=c.toLowerCase()!==e.toLowerCase();if(o.propertyLabels==="above"){let g=s.createDiv("property-label");d&&g.addClass("property-label-custom"),g.textContent=c}let h=s.createDiv("property-content");if(o.propertyLabels==="inline"&&h.addClass("property-content-inline"),o.propertyLabels==="inline"){let g=h.createSpan("property-label-inline");g.textContent=c+": "}if(!i){let g=h.createSpan("property-empty-marker");g.textContent=Ce();return}if(e==="file.mtime"||e==="file.ctime"||e==="modified time"||e==="created time")h.createSpan().appendText(i);else if((e==="tags"||e==="note.tags")&&t.yamlTags.length>0){let g=h.createDiv("tags-wrapper"),u=U();u!=="plain"&&g.addClass(`tag-style-${u}`),t.yamlTags.forEach(m=>{g.createEl("a",{cls:"tag",text:q()?`#${m}`:m,href:"#"}).addEventListener("click",S=>{var f,E,T;S.preventDefault();let y=(E=(f=this.app.internalPlugins)==null?void 0:f.plugins)==null?void 0:E["global-search"];(T=y==null?void 0:y.instance)!=null&&T.openGlobalSearch&&y.instance.openGlobalSearch("tag:"+m)})})}else if((e==="file.tags"||e==="file tags")&&t.tags.length>0){let g=h.createDiv("tags-wrapper"),u=U();u!=="plain"&&g.addClass(`tag-style-${u}`),t.tags.forEach(m=>{g.createEl("a",{cls:"tag",text:q()?`#${m}`:m,href:"#"}).addEventListener("click",S=>{var f,E,T;S.preventDefault();let y=(E=(f=this.app.internalPlugins)==null?void 0:f.plugins)==null?void 0:E["global-search"];(T=y==null?void 0:y.instance)!=null&&T.openGlobalSearch&&y.instance.openGlobalSearch("tag:"+m)})})}else{let g=this.app.metadataCache,m=(typeof g.getAllPropertyInfos=="function"?g.getAllPropertyInfos():{})[e.toLowerCase()],b=r.getValue(e);if(((m==null?void 0:m.widget)==="checkbox"||b&&"data"in b&&typeof b.data=="boolean")&&a){let y=h.createEl("input",{type:"checkbox"});y.checked=b&&"data"in b?Boolean(b.data):!1,h.createSpan({text:c}),y.addEventListener("change",async f=>{f.stopPropagation();let E=y.checked;try{let T=e.startsWith("note.")?e.substring(5):e;await a(t.path,T,E)}catch(T){console.error("Error toggling property:",T),y.checked=!E}}),y.addEventListener("click",f=>{f.stopPropagation()})}else{let y=h.createDiv("text-wrapper");this.renderPropertyValueWithLinks(y,i,t.path,e)}}(!h.textContent||h.textContent.trim().length===0)&&h.remove()}renderPropertyValueWithLinks(s,e,i,t){if(!e){s.appendText(Ce());return}let r=e.trim();if((r.startsWith("http://")||r.startsWith("https://"))&&!r.includes(" ")){let d=s.createEl("a",{cls:"external-link",href:r});d.textContent=r,d.setAttr("target","_blank"),d.setAttr("rel","noopener"),d.addEventListener("click",h=>{h.stopPropagation()});return}if(t&&(t.toLowerCase().includes("image")||t.toLowerCase()==="cover"||t.toLowerCase()==="thumbnail")&&!r.includes(" ")&&!r.startsWith("http://")&&!r.startsWith("https://")&&(r.includes("/")||r.includes("\\")||r.match(/\.(png|jpg|jpeg|gif|svg|webp|mp4|mov|avi)$/i))){let d=s.createEl("a",{cls:"internal-link",href:r});d.textContent=r,d.addEventListener("click",h=>{h.stopPropagation(),h.preventDefault();let w=h.metaKey||h.ctrlKey;this.app.workspace.openLinkText(r,i,w)});return}let a=/\[\[([^\]]+)\]\]/g,l=/\[([^\]]+)\]\(([^)]+)\)/g,p=[];for(let d of e.matchAll(a))d.index!==void 0&&p.push({index:d.index,type:"wikilink",match:d});for(let d of e.matchAll(l))d.index!==void 0&&p.push({index:d.index,type:"markdown",match:d});p.sort((d,h)=>d.index-h.index);let c=0;for(let{index:d,type:h,match:w}of p){if(d>c&&s.appendText(e.substring(c,d)),h==="wikilink"){let u=w[1].split("|"),m=u[0].trim(),b=u.length>1?u[1].trim():m,S=s.createEl("a",{cls:"internal-link",href:m});S.textContent=b,S.addEventListener("click",y=>{y.stopPropagation(),y.preventDefault();let f=y.metaKey||y.ctrlKey;this.app.workspace.openLinkText(m,i,f)})}else if(h==="markdown"){let g=w[1],u=w[2];if(u.startsWith("http://")||u.startsWith("https://")){let m=s.createEl("a",{cls:"external-link",href:u});m.textContent=g,m.setAttr("target","_blank"),m.setAttr("rel","noopener"),m.addEventListener("click",b=>{b.stopPropagation()})}else{let m=s.createEl("a",{cls:"internal-link",href:u});m.textContent=g,m.addEventListener("click",b=>{b.stopPropagation(),b.preventDefault();let S=b.metaKey||b.ctrlKey;this.app.workspace.openLinkText(u,i,S)})}}c=d+w[0].length}c<e.length?s.appendText(e.substring(c)):p.length===0&&s.appendText(e)}};var ae=class{constructor(s,e,i,t,r,o){this.app=s;this.plugin=e;this.propertyObservers=i;this.updateLayoutRef=t;this.basesConfig=r,this.basesController=o,this.propertyRenderer=new ne(this.app,()=>this.basesConfig,()=>this.basesController)}renderCard(s,e,i,t,r,o,a,l,p){let c=s.createDiv("card bases-cms-card");c.style.display="block",c.style.position="relative",t.imageFormat==="cover"?c.classList.add("image-format-cover"):t.imageFormat==="thumbnail"&&(c.classList.add("image-format-thumbnail"),c.classList.add(`thumbnail-${t.imagePosition}`)),c.setAttribute("data-path",e.path),c.setAttribute("data-href",e.path),c.addClass("bases-cms-cursor-pointer");let d=c.createDiv("bases-cms-select-checkbox"),h=d.createEl("input",{type:"checkbox",cls:"selection-checkbox"});h.checked=o,h.addEventListener("change",g=>{g.stopPropagation(),g.stopImmediatePropagation(),a(e.path,h.checked)}),h.addEventListener("click",g=>{g.stopPropagation(),g.stopImmediatePropagation()}),t.showDraftStatus&&t.imageFormat!=="cover"&&Q(c,i,e.path,t,l),c.addEventListener("click",g=>{let u=g.target;if(u.closest(".bases-cms-quick-edit-icon")){g.stopPropagation(),g.stopImmediatePropagation(),g.preventDefault();return}if(d.contains(u)||u.tagName==="INPUT"||u.closest("input")||u.closest(".bases-cms-property")||u.closest(".card-status-badge"))return;let b=g.metaKey||g.ctrlKey;this.app.workspace.openLinkText(e.path,"",b)}),c.addEventListener("contextmenu",g=>{let u=g.target;if(d.contains(u)||u.tagName==="INPUT"||u.closest("input")||u.closest(".bases-cms-property")||u.closest(".card-status-badge")||u.closest(".bases-cms-quick-edit-icon"))return;let m=this.app.vault.getAbstractFileByPath(e.path);if(m&&m instanceof le.TFile){g.stopPropagation();let b=new le.Menu;h.checked?b.addItem(y=>{y.setTitle("Unselect"),y.setIcon("square"),y.onClick(()=>{a(e.path,!1)})}):b.addItem(y=>{y.setTitle("Select"),y.setIcon("copy-check"),y.onClick(()=>{a(e.path,!0)})}),b.addSeparator(),this.app.workspace.trigger("file-menu",b,m,"bases"),b.addSeparator(),b.addItem(y=>{y.setTitle("Delete"),y.setIcon("trash-2"),y.onClick(async()=>{p&&await p.handleDelete()})}),b.showAtMouseEvent(g),setTimeout(()=>{let y=document.querySelector(".menu");if(!y)return;let E=Array.from(y.querySelectorAll(".menu-item")).find(T=>{var C;return((C=T.textContent)==null?void 0:C.trim())==="Delete"});if(E){E.addClass("is-danger");let T=E.querySelector("svg");T&&(T.style.color="var(--text-error)",T.style.stroke="var(--text-error)");let v=E.querySelector(".menu-item-title");v&&(v.style.color="var(--text-error)")}},0)}});let w=c.createDiv("card-title");if(w.appendText(e.title),Ke(this.app,this.plugin,w,c,e.path,t),t.showDate&&t.dateProperty){let g=L(i,t.dateProperty);if(g){let u=g,m=null;if(u&&"date"in u&&u.date instanceof Date)m=u.date;else if(u&&"data"in u&&u.data){let b=u.data;if(b instanceof Date)m=b;else if(typeof b=="string"||typeof b=="number"){let S=new Date(b);isNaN(S.getTime())||(m=S)}}if(m){let b;if(t.dateIncludeTime){let y=m.toLocaleDateString(),f=m.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0});b=`${y}, ${f}`}else b=m.toLocaleDateString();c.createDiv("card-date").appendText(b)}}}if(this.propertyRenderer.renderProperties(c,e,i,t,l,"top"),t.showTextPreview||t.showTags&&e.displayTags&&e.displayTags.length>0||t.imageFormat==="thumbnail"||t.imageFormat==="cover"||t.imageFormat!=="none"&&(e.imageUrl||e.hasImageAvailable)){let g=c.createDiv("card-content");if(t.imageFormat==="thumbnail"&&e.imageUrl){let m=(Array.isArray(e.imageUrl)?e.imageUrl:[e.imageUrl]).filter(b=>b&&typeof b=="string"&&b.trim().length>0);if(m.length>0){let S=g.createDiv("card-thumbnail").createDiv("image-embed"),y=m[0];(async()=>{let f=await j(y,this.plugin.settings.forceStaticGifImages);S.style.backgroundImage=`url("${f}")`})(),S.style.backgroundImage=`url("${y}")`,S.style.backgroundSize="cover",S.style.backgroundPosition="center center",S.style.backgroundRepeat="no-repeat"}}if(t.imageFormat==="thumbnail"){let u=g.createDiv("card-text-wrapper");if(t.showTextPreview){let m=u.createDiv("card-text-preview");e.snippet&&m.setText(e.snippet),c.__textPreviewEl=m,c.__cardPath=e.path}if(t.showTags&&e.displayTags&&e.displayTags.length>0){let m=u.createDiv("card-tags"),b=U();b!=="plain"&&m.addClass(`tag-style-${b}`);let S=t.maxTagsToShow,y=e.displayTags.slice(0,S),f=e.displayTags.length-S;y.forEach(E=>{m.createSpan("card-tag").appendText(q()?`#${E}`:E)}),f>0&&m.createSpan("card-tag-more").appendText(`+${f} more`)}}else{if(t.showTextPreview){let u=g.createDiv("card-text-preview");e.snippet&&u.setText(e.snippet),c.__textPreviewEl=u,c.__cardPath=e.path}if(t.showTags&&e.displayTags&&e.displayTags.length>0){let u=g.createDiv("card-tags"),m=U();m!=="plain"&&u.addClass(`tag-style-${m}`);let b=t.maxTagsToShow,S=e.displayTags.slice(0,b),y=e.displayTags.length-b;S.forEach(f=>{u.createSpan("card-tag").appendText(q()?`#${f}`:f)}),y>0&&u.createSpan("card-tag-more").appendText(`+${y} more`)}}if(t.imageFormat==="cover"){if(e.imageUrl){let m=(Array.isArray(e.imageUrl)?e.imageUrl:[e.imageUrl]).filter(b=>b&&typeof b=="string"&&b.trim().length>0);if(m.length>0){let b=g.createDiv("card-cover"),S=b.createDiv("image-embed"),y=m[0];(async()=>{let f=await j(y,this.plugin.settings.forceStaticGifImages);S.style.backgroundImage=`url("${f}")`})(),S.style.backgroundImage=`url("${y}")`,S.style.backgroundSize="cover",S.style.backgroundPosition="center center",S.style.backgroundRepeat="no-repeat",t.showDraftStatus&&Q(b,i,e.path,t,l),this.propertyRenderer.renderProperties(c,e,i,t,l,"bottom");return}}if(e.hasImageAvailable&&!e.imageUrl){let u=g.createDiv("card-cover-placeholder");Q(u,i,e.path,t,l)}else if(!e.imageUrl){let u=g.createDiv("card-cover-placeholder");Q(u,i,e.path,t,l)}}}this.propertyRenderer.renderProperties(c,e,i,t,l,"bottom")}};var ot=require("obsidian");var I=require("obsidian");async function Fe(n,s,e,i){await n.fileManager.processFrontMatter(s,t=>{for(let[r,o]of e){if(r==="tags"&&!Object.prototype.hasOwnProperty.call(t,"tags")&&!Array.isArray(o.data)){t[r]=[o.data];continue}if(!t[r]||i){t[r]=o.data;continue}let a=o.type,l=t[r],p=Array.isArray(l)?"list":typeof l=="number"?"number":typeof l=="boolean"?"checkbox":"text";if(At(a,p)){if(t[r]===o.data||!o.data)continue;let c=Bt(t[r],o.data);t[r]=c;continue}else{t[r]=o.data;continue}}})}async function Je(n,s,e){await n.fileManager.processFrontMatter(s,i=>{for(let t of e)i[t]=void 0})}function At(n,s){let e=["number","date","datetime","checkbox"];return!(e.includes(n)||e.includes(s))}function Bt(...n){let e=n.map(t=>Array.isArray(t)?t:[t]).flat();return[...new Set(e)]}var M=class{constructor(s){this.app=s}async setDraft(s,e,i){await this.batchProcessFiles(s,async t=>{if(i)if(i.draftStatusUseFilenamePrefix){let r=t.basename,o=r.startsWith("_"),l=t.path.split("/"),p=e;if(i.draftStatusReverse&&(p=!e),p===!0){if(!o){let c=`_${r}${t.extension?`.${t.extension}`:""}`;l[l.length-1]=c;let d=l.join("/");await this.app.fileManager.renameFile(t,d)}}else if(o){let c=r.substring(1)+(t.extension?`.${t.extension}`:"");l[l.length-1]=c;let d=l.join("/");await this.app.fileManager.renameFile(t,d)}}else{let r=i.draftStatusProperty&&i.draftStatusProperty.trim()?i.draftStatusProperty.startsWith("note.")?i.draftStatusProperty.substring(5):i.draftStatusProperty:"draft",o=e;i.draftStatusReverse&&(o=!e),await this.app.fileManager.processFrontMatter(t,a=>{a[r]=o})}else await this.app.fileManager.processFrontMatter(t,r=>{r.draft=e})}),new I.Notice(`Set ${s.length} file${s.length!==1?"s":""} to ${e?"draft":"published"}`)}async addTags(s,e){let i=new Map;i.set("tags",{type:"tags",data:e,overwrite:!1,delimiter:","}),await this.batchProcessFiles(s,async t=>{await Fe(this.app,t,i,!1)}),new I.Notice(`Added tags to ${s.length} file${s.length!==1?"s":""}`)}async removeTags(s,e){await this.batchProcessFiles(s,async i=>{let t=this.app.metadataCache.getFileCache(i),r=t==null?void 0:t.frontmatter;if(r!=null&&r.tags){let a=(Array.isArray(r.tags)?r.tags:[r.tags]).filter(l=>!e.includes(l));await this.app.fileManager.processFrontMatter(i,l=>{a.length>0?l.tags=a:l.tags=void 0})}}),new I.Notice(`Removed tags from ${s.length} file${s.length!==1?"s":""}`)}async setProperty(s,e,i,t="text"){let r=e.startsWith("note.")?e.substring(5):e,o=new Map;o.set(r,{type:t,data:i,overwrite:!0,delimiter:","}),await this.batchProcessFiles(s,async a=>{await Fe(this.app,a,o,!0)}),new I.Notice(`Set ${r} on ${s.length} file${s.length!==1?"s":""}`)}async removeProperty(s,e){let i=e.startsWith("note.")?e.substring(5):e;await this.batchProcessFiles(s,async t=>{await Je(this.app,t,[i])}),new I.Notice(`Removed ${i} from ${s.length} file${s.length!==1?"s":""}`)}async batchProcessFiles(s,e){let i=0,t=s.length;for(let r of s){let o=this.app.vault.getAbstractFileByPath(r);if(o instanceof I.TFile)try{await e(o),i++}catch(a){console.error(`Error processing ${r}:`,a)}}i<t&&new I.Notice(`Processed ${i} of ${t} files`)}};var O=require("obsidian");var pe=class extends O.Modal{constructor(e,i){super(e);this.tagsToAdd="";this.tagsToRemove=new Set;this.files=i,this.bulkOps=new M(e)}onOpen(){let{contentEl:e}=this;e.empty(),new O.Setting(e).setName("Manage tags").setHeading(),e.createEl("p",{text:`Managing tags for ${this.files.length} file${this.files.length!==1?"s":""}`}),new O.Setting(e).setName("Add tags").setDesc("Enter tags to add (comma-separated).").addText(l=>{l.setPlaceholder("tag1, tag2, tag3").onChange(p=>{this.tagsToAdd=p})}),e.createEl("h3",{text:"Remove tags"});let i=e.createDiv(),t=new Set;for(let l of this.files){let p=this.app.vault.getAbstractFileByPath(l);if(p instanceof O.TFile){let c=this.app.metadataCache.getFileCache(p),d=c==null?void 0:c.frontmatter;d!=null&&d.tags&&(Array.isArray(d.tags)?d.tags:[d.tags]).forEach(w=>t.add(w))}}for(let l of Array.from(t).sort())new O.Setting(i).setName(l).addToggle(p=>{p.setValue(this.tagsToRemove.has(l)).onChange(c=>{c?this.tagsToRemove.add(l):this.tagsToRemove.delete(l)})});let r=e.createDiv();r.addClass("bases-cms-modal-button-container");let o=r.createEl("button");o.setText("Cancel"),o.addEventListener("click",()=>this.close());let a=r.createEl("button");a.setText("Apply"),a.addClass("mod-cta"),a.addEventListener("click",()=>{(async()=>(await this.applyChanges(),this.close()))()})}async applyChanges(){if(this.tagsToAdd.trim()){let e=this.tagsToAdd.split(",").map(i=>i.trim()).filter(i=>i.length>0);e.length>0&&await this.bulkOps.addTags(this.files,e)}this.tagsToRemove.size>0&&await this.bulkOps.removeTags(this.files,Array.from(this.tagsToRemove))}onClose(){let{contentEl:e}=this;e.empty()}};var V=require("obsidian");var ce=class extends V.Modal{constructor(e,i){super(e);this.propertyName="";this.propertyValue="";this.propertyType="text";this.files=i,this.bulkOps=new M(e)}onOpen(){let{contentEl:e}=this;e.empty(),new V.Setting(e).setName("Set property").setHeading(),e.createEl("p",{text:`Setting property on ${this.files.length} file${this.files.length!==1?"s":""}`}),new V.Setting(e).setName("Property name").setDesc("Enter the property name to set.").addText(o=>{o.setPlaceholder("Enter name").onChange(a=>{this.propertyName=a})}),new V.Setting(e).setName("Property type").setDesc("Select the property type.").addDropdown(o=>{o.addOption("text","Text").addOption("number","Number").addOption("checkbox","Checkbox").addOption("date","Date").setValue(this.propertyType).onChange(a=>{this.propertyType=a})}),new V.Setting(e).setName("Property value").setDesc("Enter the property value.").addText(o=>{o.setPlaceholder("Enter value").onChange(a=>{this.propertyValue=a})});let i=e.createDiv();i.addClass("bases-cms-modal-button-container");let t=i.createEl("button");t.setText("Cancel"),t.addEventListener("click",()=>this.close());let r=i.createEl("button");r.setText("Apply"),r.addClass("mod-cta"),r.addEventListener("click",()=>{(async()=>this.propertyName&&this.propertyValue&&(await this.applyChanges(),this.close()))()})}async applyChanges(){let e=this.propertyValue;this.propertyType==="number"?e=Number(this.propertyValue):this.propertyType==="checkbox"?e=this.propertyValue.toLowerCase()==="true"||this.propertyValue==="1":this.propertyType==="date"&&(e=this.propertyValue),await this.bulkOps.setProperty(this.files,this.propertyName,e,this.propertyType)}onClose(){let{contentEl:e}=this;e.empty()}};var _=require("obsidian");var de=class extends _.Modal{constructor(e,i){super(e);this.propertiesToRemove=new Set;this.files=i,this.bulkOps=new M(e)}onOpen(){let{contentEl:e}=this;e.empty(),new _.Setting(e).setName("Remove property").setHeading(),e.createEl("p",{text:`Removing properties from ${this.files.length} file${this.files.length!==1?"s":""}`});let i=new Set;for(let l of this.files){let p=this.app.vault.getAbstractFileByPath(l);if(p instanceof _.TFile){let c=this.app.metadataCache.getFileCache(p),d=c==null?void 0:c.frontmatter;if(d)for(let h in d)h!=="tags"&&h!=="title"&&i.add(h)}}let t=e.createDiv();for(let l of Array.from(i).sort())new _.Setting(t).setName(l).addToggle(p=>{p.setValue(this.propertiesToRemove.has(l)).onChange(c=>{c?this.propertiesToRemove.add(l):this.propertiesToRemove.delete(l)})});i.size===0&&e.createEl("p",{text:"No properties found in selected files."});let r=e.createDiv();r.addClass("bases-cms-modal-button-container");let o=r.createEl("button");o.setText("Cancel"),o.addEventListener("click",()=>this.close());let a=r.createEl("button");a.setText("Apply"),a.addClass("mod-cta"),a.addEventListener("click",()=>{(async()=>this.propertiesToRemove.size>0&&(await this.applyChanges(),this.close()))()})}async applyChanges(){for(let e of this.propertiesToRemove)await this.bulkOps.removeProperty(this.files,e)}onClose(){let{contentEl:e}=this;e.empty()}};Be();var ge=require("obsidian"),Z=class extends ge.Modal{constructor(e,i,t,r){super(e);this.files=i,this.operation=t,this.onConfirm=r}onOpen(){let{contentEl:e}=this;e.empty();let i=this.operation==="draft"?"mark as draft":"mark as published",t=i.charAt(0).toUpperCase()+i.slice(1);if(new ge.Setting(e).setName(`Confirm ${t}`).setHeading(),e.createEl("p",{text:`Are you sure you want to ${i} ${this.files.length} file${this.files.length!==1?"s":""}?`}),this.files.length>0){let l=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let p of this.files.slice(0,20))l.createEl("li").setText(p);this.files.length>20&&l.createEl("li",{text:`... and ${this.files.length-20} more file${this.files.length-20!==1?"s":""}`})}let r=e.createDiv();r.addClass("bases-cms-modal-button-container");let o=r.createEl("button");o.setText("Cancel"),o.addEventListener("click",()=>this.close());let a=r.createEl("button");a.setText("Confirm"),a.addClass("mod-cta"),a.addEventListener("click",()=>{this.onConfirm(),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};he();var fe=class{constructor(s,e,i,t,r,o){this.app=s;this.plugin=e;this.getSelectedFiles=i;this.clearSelection=t;this.refreshView=r;this.showToolbar=o;this.bulkOps=new M(s)}async handleSetDraft(s){let e=this.getSelectedFiles();e.length!==0&&(this.plugin.settings.confirmBulkOperations?new Z(this.app,e,"draft",()=>{(async()=>(await this.bulkOps.setDraft(e,!0,s),this.refreshView()))()}).open():(await this.bulkOps.setDraft(e,!0,s),this.refreshView()))}async handlePublish(s){let e=this.getSelectedFiles();e.length!==0&&(this.plugin.settings.confirmBulkOperations?new Z(this.app,e,"publish",()=>{(async()=>(await this.bulkOps.setDraft(e,!1,s),this.refreshView()))()}).open():(await this.bulkOps.setDraft(e,!1,s),this.refreshView()))}handleManageTags(){let s=this.getSelectedFiles();if(s.length===0)return;let e=new pe(this.app,s);e.onClose=()=>{this.showToolbar(),this.refreshView()},e.open()}handleSetProperty(){let s=this.getSelectedFiles();if(s.length===0)return;let e=new ce(this.app,s);e.onClose=()=>{this.showToolbar(),this.refreshView()},e.open()}handleRemoveProperty(){let s=this.getSelectedFiles();if(s.length===0)return;let e=new de(this.app,s);e.onClose=()=>{this.showToolbar(),this.refreshView()},e.open()}async handleDelete(){let s=this.getSelectedFiles();if(s.length!==0)if(this.plugin.settings.confirmDeletions){let e=await ue(this.app,s,this.plugin.settings);new J(this.app,e,()=>{this.clearSelection(),this.refreshView()}).open()}else{let e=await ue(this.app,s,this.plugin.settings);await K(this.app,e),this.clearSelection(),this.refreshView()}}};var ye=class{constructor(s,e,i,t,r,o,a,l){this.app=s;this.plugin=e;this.container=i;this.getSelectedFiles=t;this.clearSelection=r;this.refreshView=o;this.toolbarEl=null;this.countEl=null;this.resizeObserver=null;this.timeoutIds=[];this.selectAllCallback=a,this.settings=l,this.actions=new fe(this.app,this.plugin,this.getSelectedFiles,this.clearSelection,this.refreshView,()=>this.show()),this.createToolbar()}updateSettings(s){this.settings=s}getActions(){return this.actions}createToolbar(){this.toolbarEl=document.createElement("div"),this.toolbarEl.className="bases-toolbar bases-cms-bulk-toolbar bases-cms-bulk-toolbar-hidden",this.toolbarEl.__bulkToolbarInstance=this,this.createToolbarContent(),this.positionToolbar();let s=window.setTimeout(()=>this.positionToolbar(),100);this.timeoutIds.push(s)}positionToolbar(){if(!this.toolbarEl)return;let s=this.container.closest(".bases-header");if(!s){let i=this.container.parentElement;for(;i&&!s;){if(i.classList.contains("bases-header")){s=i;break}i=i.parentElement}}if(!s){let i=Array.from(document.querySelectorAll(".bases-header"));for(let t of i)if(t.contains(this.container)){s=t;break}}let e=this.container.closest(".view-content");if(e)this.toolbarEl.parentElement!==e?(this.toolbarEl.parentElement&&this.toolbarEl.remove(),e.insertBefore(this.toolbarEl,this.container)):this.toolbarEl.nextSibling!==this.container&&(this.toolbarEl.parentElement&&this.toolbarEl.remove(),e.insertBefore(this.toolbarEl,this.container));else if(s&&s.parentElement)this.toolbarEl.parentElement!==s.parentElement&&(this.toolbarEl.parentElement&&this.toolbarEl.remove(),s.parentElement.insertBefore(this.toolbarEl,s.nextSibling));else{let i=this.container.parentElement;i&&(this.toolbarEl.parentElement!==i||this.toolbarEl.nextSibling!==this.container)&&(this.toolbarEl.parentElement&&this.toolbarEl.remove(),i.insertBefore(this.toolbarEl,this.container))}}createToolbarContent(){if(!this.toolbarEl)return;let s=this.toolbarEl.createDiv("bases-cms-bulk-toolbar-left"),e=(r,o,a,l,p=!1)=>{let d=l.createDiv("bases-toolbar-item").createDiv("text-icon-button");p&&d.addClass("destructive"),d.setAttribute("tabindex","0");let h=d.createSpan("text-button-icon");return(0,ot.setIcon)(h,r),d.createSpan("text-button-label").setText(o),d.addEventListener("click",a),d};this.plugin.settings.showToolbarSelectAll&&e("copy-check","Select all",()=>this.handleSelectAll(),s),this.plugin.settings.showToolbarClear&&e("square-x","Clear",()=>this.clearSelection(),s);let i=s.createDiv("bases-toolbar-item bases-cms-selected-count");this.countEl=i.createSpan("text-button-label"),this.countEl.setText("0 selected");let t=this.toolbarEl.createDiv("bases-cms-bulk-toolbar-right");this.plugin.settings.showToolbarPublish&&e("book-check","Publish",()=>{this.actions.handlePublish(this.settings)},t),this.plugin.settings.showToolbarDraft&&e("book-dashed","Draft",()=>{this.actions.handleSetDraft(this.settings)},t),this.plugin.settings.showToolbarTags&&e("tags","Tags",()=>this.actions.handleManageTags(),t),this.plugin.settings.showToolbarSet&&e("list-check","Set",()=>this.actions.handleSetProperty(),t),this.plugin.settings.showToolbarRemove&&e("list-x","Remove",()=>this.actions.handleRemoveProperty(),t),this.plugin.settings.showToolbarDelete&&e("trash-2","Delete",()=>{this.actions.handleDelete()},t,!0),this.setupResponsiveBehavior()}setupResponsiveBehavior(){if(!this.toolbarEl)return;let s=window.setTimeout(()=>{this.updateCollapsedState()},100);this.timeoutIds.push(s),this.toolbarEl&&(this.resizeObserver=new ResizeObserver(()=>{this.updateCollapsedState()}),this.resizeObserver.observe(this.toolbarEl));let e=this.container;if(e){let i=new ResizeObserver(()=>{let t=window.setTimeout(()=>{this.updateCollapsedState()},10);this.timeoutIds.push(t)});i.observe(e),this.containerObserver=i}}updateCollapsedState(){if(!this.toolbarEl)return;this.toolbarEl.offsetWidth<680?this.toolbarEl.addClass("collapsed"):this.toolbarEl.removeClass("collapsed")}updateCount(s){this.countEl&&this.countEl.setText(`${s} selected`)}handleSelectAll(){this.selectAllCallback&&this.selectAllCallback()}show(){if(this.toolbarEl||(console.warn("[Bases CMS] Toolbar element not found, recreating..."),this.createToolbar()),this.toolbarEl){this.positionToolbar(),this.toolbarEl.parentElement||(console.warn("[Bases CMS] Toolbar not in DOM, repositioning..."),this.positionToolbar()),this.toolbarEl.removeClass("bases-cms-bulk-toolbar-hidden"),this.toolbarEl.addClass("bases-cms-bulk-toolbar-visible"),this.toolbarEl.offsetHeight;let s=window.setTimeout(()=>{this.toolbarEl&&(this.toolbarEl.removeClass("bases-cms-bulk-toolbar-animating-out"),this.toolbarEl.addClass("bases-cms-bulk-toolbar-animating-in"))},10);this.timeoutIds.push(s)}else console.error("[Bases CMS] Failed to show toolbar - element is null")}hide(){if(this.toolbarEl){this.toolbarEl.removeClass("bases-cms-bulk-toolbar-animating-in"),this.toolbarEl.addClass("bases-cms-bulk-toolbar-animating-out");let s=window.setTimeout(()=>{this.toolbarEl&&(this.toolbarEl.removeClass("bases-cms-bulk-toolbar-visible"),this.toolbarEl.addClass("bases-cms-bulk-toolbar-hidden"))},200);this.timeoutIds.push(s)}}recreate(){let s=this.toolbarEl&&!this.toolbarEl.hasClass("bases-cms-bulk-toolbar-hidden"),e=0;if(this.countEl&&this.countEl.textContent){let i=this.countEl.textContent.match(/\d+/);i&&(e=parseInt(i[0],10))}this.destroy(),this.createToolbar(),s&&this.toolbarEl&&e>0&&(this.updateCount(e),this.show())}destroy(){this.timeoutIds.forEach(e=>window.clearTimeout(e)),this.timeoutIds=[],this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null);let s=this.containerObserver;s&&(s.disconnect(),this.containerObserver=void 0),this.toolbarEl&&(this.toolbarEl.remove(),this.toolbarEl=null)}};H();function rt(n,s,e,i,t){let r=l=>{let p=l.target;if(!p.closest('.bases-toolbar-new-item-menu, .bases-toolbar-new-item-menu .text-icon-button, [data-action="new-item"], button[aria-label*="new"], button[aria-label*="New"], .bases-toolbar button')||p.closest(".bases-cms-bulk-toolbar, .bases-cms-container .card"))return;let d=n.workspace.activeLeaf,h=d==null?void 0:d.view,w=h==null?void 0:h.containerEl;if(!((h==null?void 0:h.type)==="bases-cms"||(w==null?void 0:w.querySelector(".bases-cms-container"))!==null)||!(w&&(w===s||w.contains(s)||s.contains(w))))return;let m=s,b=m.__cmsView,S=(b==null?void 0:b.config)||m.__cmsConfig||e,y=F(S,i),f=y.newNoteLocation&&y.newNoteLocation.trim()!=="";(y.customizeNewButton||f)&&(l.preventDefault(),l.stopPropagation(),l.stopImmediatePropagation(),(async()=>{var C;let E=((C=y.newNoteLocation)==null?void 0:C.trim())||"";if(E===""&&!y.customizeNewButton){let P=n.vault.config,k=(P==null?void 0:P.newFileLocation)||"folder",$=(P==null?void 0:P.newFileFolderPath)||"",z="Untitled.md";if(k==="folder"&&$)z=`${$}/Untitled.md`;else if(k==="current"){let Te=n.workspace.getActiveFile();Te&&Te.parent&&(z=`${Te.parent.path}/Untitled.md`)}else k==="root"&&(z="Untitled.md");let lt=await n.vault.create(z,"");y.customizeNewButton&&await n.workspace.openLinkText(lt.path,"",!1);return}if(E==="/"||E.replace(/\//g,"")===""){let P=await n.vault.create("Untitled.md","");y.customizeNewButton&&await n.workspace.openLinkText(P.path,"",!1);return}let T=E.replace(/^\/+|\/+$/g,""),v=n.vault.getAbstractFileByPath(T);if((!v||!("children"in v))&&(await n.vault.createFolder(T),v=n.vault.getAbstractFileByPath(T)),v&&"children"in v){let P=await n.vault.create(`${T}/Untitled.md`,"");y.customizeNewButton&&await n.workspace.openLinkText(P.path,"",!1)}})().catch(E=>{console.error("[CMS] Error creating new note:",E)}))};document.addEventListener("click",r,!0);let o=new MutationObserver(()=>{document.querySelectorAll('.bases-toolbar-new-item-menu, .bases-toolbar-new-item-menu .text-icon-button, [data-action="new-item"]').forEach(p=>{let c=p;c.__cmsIntercepted||(c.__cmsIntercepted=!0,p.addEventListener("click",r,!0))})});o.observe(document.body,{childList:!0,subtree:!0}),document.querySelectorAll('.bases-toolbar-new-item-menu, .bases-toolbar-new-item-menu .text-icon-button, [data-action="new-item"]').forEach(l=>{let p=l;p.__cmsIntercepted||(p.__cmsIntercepted=!0,l.addEventListener("click",r,!0))}),t(()=>{document.removeEventListener("click",r,!0),o.disconnect()})}var nt=require("obsidian");H();var be=class{constructor(s,e,i,t){this.app=s;this.config=e;this.pluginSettings=i;this.onRefresh=t}async handlePropertyToggle(s,e,i){try{let t=this.app.vault.getAbstractFileByPath(s);if(!(t instanceof nt.TFile))return;let r=e.startsWith("note.")?e.substring(5):e,o=F(this.config,this.pluginSettings),a=o.showDraftStatus&&r==="draft",l=!1;if(a)if(o.draftStatusUseFilenamePrefix){let p=t.basename,c=p.startsWith("_"),h=t.path.split("/");if(i===!0){if(!c){let w=`_${p}${t.extension?`.${t.extension}`:""}`;h[h.length-1]=w;let g=h.join("/");await this.app.fileManager.renameFile(t,g),l=!0}}else if(c){let w=p.substring(1)+(t.extension?`.${t.extension}`:"");h[h.length-1]=w;let g=h.join("/");await this.app.fileManager.renameFile(t,g),l=!0}}else{let p=o.draftStatusProperty&&o.draftStatusProperty.trim()?o.draftStatusProperty.startsWith("note.")?o.draftStatusProperty.substring(5):o.draftStatusProperty:"draft";await this.app.fileManager.processFrontMatter(t,c=>{c[p]=i}),l=!0}else await this.app.fileManager.processFrontMatter(t,p=>{p[r]=i}),l=!0;l&&requestAnimationFrame(()=>{window.setTimeout(()=>{try{this.onRefresh()}catch(p){console.error("Error refreshing view after property toggle:",p)}},100)})}catch(t){console.error("Error toggling property:",t)}}};H();var ve=class{constructor(s,e,i,t,r,o){this.containerEl=s;this.app=e;this.config=i;this.pluginSettings=t;this.onLoadMore=r;this.registerCleanup=o;this.scrollListener=null;this.scrollThrottleTimeout=null;this.resizeObserver=null;this.windowResizeHandler=null;this.isLoading=!1;this.displayedCount=50;this.totalEntries=0;var l;let a=(l=this.app.isMobile)!=null?l:!1;this.displayedCount=a?25:50}setDisplayedCount(s){this.displayedCount=s}getDisplayedCount(){return this.displayedCount}setIsLoading(s){this.isLoading=s}setupInfiniteScroll(s){this.totalEntries=s,this.scrollListener&&(this.containerEl.removeEventListener("scroll",this.scrollListener),this.scrollListener=null),!(this.displayedCount>=s)&&(this.scrollListener=()=>{var p;if(this.scrollThrottleTimeout!==null||this.isLoading)return;let e=this.containerEl.scrollTop,i=this.containerEl.scrollHeight,t=this.containerEl.clientHeight,r=i-(e+t),a=((p=this.app.isMobile)!=null?p:!1)?1:2,l=t*a;if(r<l&&this.displayedCount<s){this.isLoading=!0;let c=50;this.displayedCount=Math.min(this.displayedCount+c,s),this.onLoadMore()}this.scrollThrottleTimeout=window.setTimeout(()=>{this.scrollThrottleTimeout=null},100)},this.containerEl.addEventListener("scroll",this.scrollListener),this.registerCleanup(()=>{this.scrollListener&&this.containerEl.removeEventListener("scroll",this.scrollListener),this.scrollThrottleTimeout!==null&&window.clearTimeout(this.scrollThrottleTimeout)}))}setupResizeObserver(){if(this.resizeObserver)return;let s=()=>{if(!this.config||typeof this.config.get!="function")return;let e=F(this.config,this.pluginSettings),i=e.cardSize;this.containerEl.style.setProperty("--card-min-width",`${i}px`),this.containerEl.style.setProperty("--dynamic-views-image-aspect-ratio",String(e.imageAspectRatio))};this.resizeObserver=new ResizeObserver(s),this.resizeObserver.observe(this.containerEl),s()}updateGridLayout(s){this.containerEl.style.setProperty("--card-min-width",`${s.cardSize}px`),this.containerEl.style.setProperty("--dynamic-views-image-aspect-ratio",String(s.imageAspectRatio))}cleanup(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.windowResizeHandler&&(window.removeEventListener("resize",this.windowResizeHandler),this.windowResizeHandler=null),this.scrollListener&&(this.containerEl.removeEventListener("scroll",this.scrollListener),this.scrollListener=null),this.scrollThrottleTimeout!==null&&(window.clearTimeout(this.scrollThrottleTimeout),this.scrollThrottleTimeout=null)}};var we=class{constructor(s,e,i,t,r,o,a,l){this.containerEl=s;this.plugin=e;this.config=i;this.controller=t;this.data=r;this.selectedFiles=o;this.onSelectionCleared=a;this.registerCleanup=l;this.mutationObserver=null;this.backupInterval=null;this.currentBaseIdentifier=null}setup(s){let e=()=>{this.mutationObserver||(this.mutationObserver=new MutationObserver(l=>{if(this.selectedFiles.size!==0){for(let p of l)if(p.type==="childList"&&p.removedNodes.length>0){let c=!1;for(let h of this.selectedFiles)if(this.containerEl.querySelector(`[data-path="${h}"]`)){c=!0;break}let d=this.containerEl.querySelectorAll(".card[data-path]");if(!c||d.length===0){this.selectedFiles.clear(),this.onSelectionCleared();break}}}}),this.containerEl&&this.mutationObserver.observe(this.containerEl,{childList:!0,subtree:!0}))},i=()=>{this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null,this.selectedFiles.size>0&&this.selectedFiles.clear(),this.onSelectionCleared())},t=()=>{var l,p,c,d;try{if((l=this.config)!=null&&l.getName)return this.config.getName();if((p=this.config)!=null&&p.name)return String(this.config.name);if(this.controller){if((c=this.controller)!=null&&c.getBaseName)return this.controller.getBaseName();if((d=this.controller)!=null&&d.baseName)return String(this.controller.baseName)}if(this.data&&this.data.baseName)return String(this.data.baseName)}catch(h){}return null},r=()=>{if(this.selectedFiles.size===0){this.backupInterval!==null&&(window.clearInterval(this.backupInterval),this.backupInterval=null);return}let l=t();if(this.currentBaseIdentifier!==null&&l!==null&&this.currentBaseIdentifier!==l){this.selectedFiles.clear(),this.onSelectionCleared(),i(),this.backupInterval!==null&&(window.clearInterval(this.backupInterval),this.backupInterval=null);return}this.containerEl.querySelectorAll(".card[data-path]").length===0&&(this.selectedFiles.clear(),this.onSelectionCleared())},o=s.bind(this),a=(l,p)=>{o(l,p),this.selectedFiles.size>0?(this.currentBaseIdentifier===null&&(this.currentBaseIdentifier=t()),e(),this.backupInterval===null&&(this.backupInterval=this.plugin.registerInterval(window.setInterval(r,500)))):(this.currentBaseIdentifier=null,i(),this.backupInterval!==null&&(window.clearInterval(this.backupInterval),this.backupInterval=null))};return this.registerCleanup(()=>{i(),this.backupInterval!==null&&(window.clearInterval(this.backupInterval),this.backupInterval=null)}),a}cleanup(){this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null),this.backupInterval!==null&&(window.clearInterval(this.backupInterval),this.backupInterval=null)}};var Le="bases-cms",Se=class extends X.BasesView{constructor(e,i,t){super(e);this.type=Le;this.selectedFiles=new Set;this.snippets={};this.images={};this.hasImageAvailable={};this.updateLayoutRef={current:null};this.propertyObservers=[];this.bulkToolbar=null;this.isRefreshingWithSelection=!1;this.propertyToggleHandler=null;this.viewSwitchListener=null;this.containerEl=i,this.plugin=t,this.cardRenderer=new ae(this.app,this.plugin,this.propertyObservers,this.updateLayoutRef,void 0,e),this.containerEl.addClass("bases-cms"),this.containerEl.addClass("bases-cms-container");try{this.propertyToggleHandler=new be(this.app,this.config,this.plugin.settings,()=>this.onDataUpdated())}catch(r){this.propertyToggleHandler=null}try{this.scrollLayoutManager=new ve(this.containerEl,this.app,this.config,this.plugin.settings,()=>this.onDataUpdated(),r=>this.register(r))}catch(r){throw r}try{this.viewSwitchListener=new we(this.containerEl,this.plugin,this.config,this.controller,this.data,this.selectedFiles,()=>this.updateSelectionUI(),r=>this.register(r))}catch(r){this.viewSwitchListener=null}if(this.viewSwitchListener){let r=this.handleSelectionChange.bind(this);this.handleSelectionChange=this.viewSwitchListener.setup(r)}}onDataUpdated(){(async()=>{var e;try{if(!this.data)return;let i=this.data.groupedData,t=this.data.data,r=F(this.config,this.plugin.settings);this.scrollLayoutManager.updateGridLayout(r);let o=this.containerEl.scrollTop,a=this.getSortMethod(),l=i.map(g=>({group:g,entries:[...g.entries]})),p=[],c=this.scrollLayoutManager.getDisplayedCount();for(let g of l){if(c<=0)break;let u=Math.min(g.entries.length,c);p.push(...g.entries.slice(0,u)),c-=u}if(await this.loadContentForEntries(p,r),this.config&&!this.containerEl.__cmsInterceptorSetup)try{this.containerEl.__cmsInterceptorSetup=!0;let g=this.containerEl;g.__cmsConfig=this.config,g.__cmsView=this,rt(this.app,this.containerEl,this.config,this.plugin.settings,u=>this.register(u))}catch(g){this.containerEl.__cmsInterceptorSetup=!0}this.cardRenderer.basesConfig=this.config,this.containerEl.empty(),this.propertyObservers.forEach(g=>g.disconnect()),this.propertyObservers=[];let d=this.containerEl.createDiv("bases-cms-grid"),h=0,w=0;for(let g of l){if(h>=this.scrollLayoutManager.getDisplayedCount())break;let u=Math.min(g.entries.length,this.scrollLayoutManager.getDisplayedCount()-h);if(u===0)continue;let m=g.entries.slice(0,u),b=d.createDiv("bases-cms-group");if(g.group.hasKey()){let f=b.createDiv("bases-cms-group-heading").createDiv("bases-cms-group-value"),E=((e=g.group.key)==null?void 0:e.toString())||"";f.setText(E)}let S=_e(m,r,a,!1,this.snippets,this.images,this.hasImageAvailable);for(let y=0;y<S.length;y++){let f=S[y],E=m[y];this.renderCard(b,f,E,h+y,r),w++}h+=u}o>0&&(this.containerEl.scrollTop=o),this.scrollLayoutManager.setupInfiniteScroll(t.length),this.scrollLayoutManager.setupResizeObserver(),this.updateSelectionUI(),this.scrollLayoutManager.setIsLoading(!1)}catch(i){try{this.scrollLayoutManager.setIsLoading(!1)}catch(t){}if(this.containerEl&&this.containerEl.isConnected){this.containerEl.empty();let t=this.containerEl.createDiv("bases-cms-error");t.setText("Error loading view. Check console for details."),t.style.padding="20px",t.style.textAlign="center",t.style.color="var(--text-error)",t.style.margin="20px"}}})()}async loadContentForEntries(e,i){try{if(i.showTextPreview){let t=e.filter(r=>!(r.file.path in this.snippets)).map(r=>{let o=this.app.vault.getAbstractFileByPath(r.file.path);if(!(o instanceof X.TFile))return null;let a=L(r,i.descriptionProperty);return{path:r.file.path,file:o,descriptionData:a==null?void 0:a.data}}).filter(r=>r!==null);t.length>0&&await Qe(t,i.fallbackToContent,!1,this.app,this.snippets,i.truncatePreviewProperty)}if(i.imageFormat!=="none"){let t=e.filter(r=>!(r.file.path in this.images)).map(r=>{let o=this.app.vault.getAbstractFileByPath(r.file.path);if(!(o instanceof X.TFile))return null;let a=Re(r,i.imageProperty);return{path:r.file.path,file:o,imagePropertyValues:a}}).filter(r=>r!==null);t.length>0&&await je(t,i.fallbackToEmbeds,this.app,this.images,this.hasImageAvailable)}}catch(t){throw t}}getDirectDeleteHandler(e){return async()=>{let{prepareDeletionPreview:i,executeSmartDeletion:t}=await Promise.resolve().then(()=>(he(),it)),{DeletionPreviewModal:r}=await Promise.resolve().then(()=>(Be(),st));if(this.plugin.settings.confirmDeletions){let o=await i(this.app,[e],this.plugin.settings);new r(this.app,o,()=>{this.onDataUpdated()}).open()}else{let o=await i(this.app,[e],this.plugin.settings);await t(this.app,o),this.onDataUpdated()}}}renderCard(e,i,t,r,o){let a=this.selectedFiles.has(i.path);return this.cardRenderer.renderCard(e,i,t,o,this,a,(l,p)=>{this.handleSelectionChange(l,p)},(l,p,c)=>{this.handlePropertyToggle(l,p,c)},{handleDelete:this.getDirectDeleteHandler(i.path)})}updateCardImage(e,i){var a;let t=this.containerEl.querySelector(`.card[data-path="${e}"]`);if(!t)return;let r=Array.isArray(i)?i[0]:i;if(!r)return;let o=t.querySelector(".image-embed");if(!o){let l=t.querySelector(".card-cover-placeholder, .card-thumbnail-placeholder"),p=t.classList.contains("image-format-thumbnail"),c=t.classList.contains("image-format-cover");if(l){let d=l.querySelector(".card-status-badge"),h=l.classList.contains("card-cover-placeholder")?"card-cover":"card-thumbnail",w=(a=l.parentElement)==null?void 0:a.createDiv(h);w&&(o=w.createDiv("image-embed"),d&&w.appendChild(d),l.remove())}else if(p){let d=t.querySelector(".card-content");if(d){let h=d.querySelector(".card-text-wrapper");o=(h?d.insertBefore(d.createDiv("card-thumbnail"),h):d.createDiv("card-thumbnail")).createDiv("image-embed")}}else if(c){let d=t.querySelector(".card-content");d&&(o=d.createDiv("card-cover").createDiv("image-embed"))}}o&&((async()=>{let l=await j(r,this.plugin.settings.forceStaticGifImages);o.style.backgroundImage=`url("${l}")`})(),o.style.backgroundImage=`url("${r}")`,o.style.backgroundSize="cover",o.style.backgroundPosition="center center",o.style.backgroundRepeat="no-repeat")}getSortMethod(){let e=this.config.getSort();if(e&&e.length>0){let i=e[0],t=i.property,r=i.direction.toLowerCase();if(t.includes("ctime"))return`ctime-${r}`;if(t.includes("mtime"))return`mtime-${r}`}return"mtime-desc"}handleSelectionChange(e,i){if(i?this.selectedFiles.add(e):this.selectedFiles.delete(e),this.updateSelectionUI(),this.selectedFiles.size===0&&this.bulkToolbar){this.bulkToolbar.hide();let t=this.containerEl.querySelector(".bases-cms-bulk-toolbar");t instanceof HTMLElement&&(t.removeClass("bases-cms-bulk-toolbar-visible"),t.addClass("bases-cms-bulk-toolbar-hidden"))}}async handlePropertyToggle(e,i,t){this.propertyToggleHandler&&await this.propertyToggleHandler.handlePropertyToggle(e,i,t)}selectAll(){this.containerEl.querySelectorAll(".bases-cms-card").forEach(i=>{let t=i.getAttribute("data-path");t&&this.selectedFiles.add(t)}),this.updateSelectionUI()}deselectAll(){this.selectedFiles.clear(),this.updateSelectionUI()}refreshToolbar(){if(this.bulkToolbar){let e=this.selectedFiles.size;this.bulkToolbar.recreate(),e>0&&this.bulkToolbar.updateCount(e)}}updateSelectionUI(){if(this.containerEl.querySelectorAll(".card").forEach(i=>{let t=i.getAttribute("data-path"),r=i.querySelector('input[type="checkbox"].selection-checkbox');if(t){let o=this.selectedFiles.has(t);o?i.addClass("selected"):i.removeClass("selected"),r&&(r.checked=o)}}),this.selectedFiles.size>0){if(document.querySelectorAll(".bases-cms-bulk-toolbar").forEach(t=>{let r=t.__bulkToolbarInstance;(!r||r!==this.bulkToolbar)&&t.remove()}),this.bulkToolbar){let t=F(this.config,this.plugin.settings);this.bulkToolbar.updateSettings(t)}else{let t=F(this.config,this.plugin.settings);this.bulkToolbar=new ye(this.app,this.plugin,this.containerEl,()=>Array.from(this.selectedFiles),()=>{this.selectedFiles.clear(),this.updateSelectionUI()},()=>{let r=Array.from(this.selectedFiles);this.isRefreshingWithSelection=!0,this.bulkToolbar&&r.length>0&&this.bulkToolbar.show(),this.onDataUpdated(),window.setTimeout(()=>{r.forEach(o=>{this.app.vault.getAbstractFileByPath(o)&&this.selectedFiles.add(o)}),this.isRefreshingWithSelection=!1,this.updateSelectionUI(),this.selectedFiles.size>0&&this.bulkToolbar&&(this.bulkToolbar.show(),this.bulkToolbar.updateCount(this.selectedFiles.size)),window.setTimeout(()=>{this.selectedFiles.size>0&&this.bulkToolbar&&(this.bulkToolbar.show(),this.bulkToolbar.updateCount(this.selectedFiles.size))},100)},250)},()=>{this.selectAll()},t)}this.bulkToolbar.updateCount(this.selectedFiles.size),this.bulkToolbar.show()}else if(this.bulkToolbar&&!this.isRefreshingWithSelection){this.bulkToolbar.hide();let i=this.containerEl.querySelector(".bases-cms-bulk-toolbar");i instanceof HTMLElement&&(i.removeClass("bases-cms-bulk-toolbar-visible"),i.addClass("bases-cms-bulk-toolbar-hidden"))}}onClose(){this.scrollLayoutManager.cleanup(),this.viewSwitchListener&&this.viewSwitchListener.cleanup(),this.propertyObservers.forEach(t=>t.disconnect()),this.propertyObservers=[],this.bulkToolbar&&this.bulkToolbar.destroy(),this.selectedFiles.clear(),document.querySelectorAll(".bases-cms-bulk-toolbar").forEach(t=>t.remove());let i=this.plugin;i&&typeof i.removeView=="function"&&i.removeView(this)}async onNew(){var i;let e=F(this.config,this.plugin.settings);if(e.customizeNewButton)try{let t=((i=e.newNoteLocation)==null?void 0:i.trim())||"";if(t===""){let a=this.app.vault.config,l=(a==null?void 0:a.newFileLocation)||"folder",p=(a==null?void 0:a.newFileFolderPath)||"",c="Untitled.md";if(l==="folder"&&p)c=`${p}/Untitled.md`;else if(l==="current"){let h=this.app.workspace.getActiveFile();h&&h.parent&&(c=`${h.parent.path}/Untitled.md`)}else l==="root"&&(c="Untitled.md");let d=await this.app.vault.create(c,"");return await this.app.workspace.openLinkText(d.path,"",!1),!0}if(t==="/"||t.replace(/\//g,"")===""){let a=await this.app.vault.create("Untitled.md","");return await this.app.workspace.openLinkText(a.path,"",!1),!0}let r=t.replace(/^\/+|\/+$/g,""),o=this.app.vault.getAbstractFileByPath(r);if((!o||!("children"in o))&&(await this.app.vault.createFolder(r),o=this.app.vault.getAbstractFileByPath(r)),o&&"children"in o){let a=await this.app.vault.create(`${r}/Untitled.md`,"");return await this.app.workspace.openLinkText(a.path,"",!1),!0}}catch(t){}return!1}};function Me(n,s=5){try{let e=n;if(typeof e.registerBasesView=="function")e.registerBasesView(Le,{name:"CMS",icon:n.settings.useHomeIcon?"lucide-home":"lucide-blocks",factory:(i,t)=>{let r=new Se(i,t,n),o=n;return o.activeViews&&o.activeViews.add(r),r},options:Mt()});else if(s>0){let i=n,t=i.registrationTimeout;t!=null&&window.clearTimeout(t),i.registrationTimeout=window.setTimeout(()=>{i.registrationTimeout=null,Me(n,s-1)},200)}else console.warn("Bases CMS: registerBasesView not available. Is Bases plugin installed?")}catch(e){console.error("Bases CMS: Error registering view:",e)}}function Mt(){let{getCMSViewOptions:n}=(H(),Ie(Ue));return n}var ke=class extends at.Plugin{constructor(){super(...arguments);this.activeViews=new Set;this.registrationTimeout=null}async onload(){await this.loadSettings(),this.addSettingTab(new se(this.app,this)),Me(this)}onunload(){this.registrationTimeout!==null&&(window.clearTimeout(this.registrationTimeout),this.registrationTimeout=null),this.activeViews.clear()}async loadSettings(){this.settings=Object.assign({},Oe,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}refreshAllToolbars(){let e=[];this.activeViews.forEach(i=>{let t=i.containerEl;(!t||!t.parentElement)&&e.push(i)}),e.forEach(i=>this.activeViews.delete(i)),this.activeViews.forEach(i=>{i&&typeof i.refreshToolbar=="function"&&i.refreshToolbar()})}removeView(e){this.activeViews.delete(e)}};
