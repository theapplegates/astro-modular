/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var re=Object.defineProperty;var He=Object.getOwnPropertyDescriptor;var We=Object.getOwnPropertyNames;var _e=Object.prototype.hasOwnProperty;var je=(o,n)=>()=>(o&&(n=o(o=0)),n);var me=(o,n)=>{for(var e in n)re(o,e,{get:n[e],enumerable:!0})},Qe=(o,n,e,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let t of We(n))!_e.call(o,t)&&t!==e&&re(o,t,{get:()=>n[t],enumerable:!(s=He(n,t))||s.enumerable});return o};var fe=o=>Qe(re({},"__esModule",{value:!0}),o);var Te={};me(Te,{getCMSViewOptions:()=>Ye,readCMSSettings:()=>V});function V(o,n){var e,s,t,a,i,r,l,c,h,m,u,p,d,g,b,y;return{titleProperty:o.get("titleProperty")||"",descriptionProperty:o.get("descriptionProperty")||"",imageProperty:o.get("imageProperty")||"",showTitle:(e=o.get("showTitle"))!=null?e:!0,showDate:(s=o.get("showDate"))!=null?s:!1,dateProperty:o.get("dateProperty")||"",showTextPreview:(t=o.get("showTextPreview"))!=null?t:!0,fallbackToContent:(a=o.get("fallbackToContent"))!=null?a:!0,fallbackToEmbeds:(i=o.get("fallbackToEmbeds"))!=null?i:!1,propertyDisplay1:o.get("propertyDisplay1")||"",propertyDisplay2:o.get("propertyDisplay2")||"",propertyDisplay3:o.get("propertyDisplay3")||"",propertyDisplay4:o.get("propertyDisplay4")||"",propertyLayout12SideBySide:(r=o.get("propertyLayout12SideBySide"))!=null?r:!1,propertyLayout34SideBySide:(l=o.get("propertyLayout34SideBySide"))!=null?l:!1,imageFormat:o.get("imageFormat")||"thumbnail",propertyLabels:o.get("propertyLabels")||"hide",showDraftStatus:(c=o.get("showDraftStatus"))!=null?c:!1,draftStatusProperty:o.get("draftStatusProperty")||"",draftStatusReverse:(h=o.get("draftStatusReverse"))!=null?h:!1,draftStatusUseFilenamePrefix:(m=o.get("draftStatusUseFilenamePrefix"))!=null?m:!1,showTags:(u=o.get("showTags"))!=null?u:!1,tagsProperty:o.get("tagsProperty")||"",maxTagsToShow:(p=o.get("maxTagsToShow"))!=null?p:3,customizeNewButton:(d=o.get("customizeNewButton"))!=null?d:!1,newNoteLocation:o.get("newNoteLocation")||"",hideQuickEditIcon:(g=o.get("hideQuickEditIcon"))!=null?g:!1,thumbnailCacheSize:n.thumbnailCacheSize,cardSize:(b=o.get("cardSize"))!=null?b:250,imageAspectRatio:(y=o.get("imageAspectRatio"))!=null?y:.55}}function Ye(){return[{type:"slider",displayName:"Card size",key:"cardSize",min:50,max:800,step:10,default:250},{type:"dropdown",displayName:"Card image",key:"imageFormat",options:{none:"No image",thumbnail:"Thumbnail",cover:"Cover"},default:"thumbnail"},{type:"slider",displayName:"Image aspect ratio",key:"imageAspectRatio",min:.1,max:2,step:.05,default:.55,showWhen:{key:"imageFormat",value:"cover"}},{type:"property",displayName:"Image property",key:"imageProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Use in-note images if image property unavailable",key:"fallbackToEmbeds",default:!1},{type:"toggle",displayName:"Show title",key:"showTitle",default:!0},{type:"property",displayName:"Title property",key:"titleProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show date",key:"showDate",default:!1},{type:"property",displayName:"Date property",key:"dateProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show draft status",key:"showDraftStatus",default:!1},{type:"property",displayName:"Draft status property",key:"draftStatusProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Reverse logic",key:"draftStatusReverse",default:!1},{type:"toggle",displayName:"Filename underscore prefix as draft indicator",key:"draftStatusUseFilenamePrefix",default:!1},{type:"toggle",displayName:"Show text preview",key:"showTextPreview",default:!0},{type:"property",displayName:"Text preview property",key:"descriptionProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Use note content if text preview property unavailable",key:"fallbackToContent",default:!0},{type:"toggle",displayName:"Show tags",key:"showTags",default:!1},{type:"property",displayName:"Tags property",key:"tagsProperty",placeholder:"Select property",default:""},{type:"slider",displayName:"Maximum tags to show",key:"maxTagsToShow",min:1,max:50,step:1,default:3,showWhen:{key:"showTags",value:!0}},{type:"property",displayName:"First property",key:"propertyDisplay1",placeholder:"Select property",default:""},{type:"property",displayName:"Second property",key:"propertyDisplay2",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show first and second properties side by side",key:"propertyLayout12SideBySide",default:!1},{type:"property",displayName:"Third property",key:"propertyDisplay3",placeholder:"Select property",default:""},{type:"property",displayName:"Fourth property",key:"propertyDisplay4",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show third and fourth properties side by side",key:"propertyLayout34SideBySide",default:!1},{type:"dropdown",displayName:"Show property labels",key:"propertyLabels",options:{hide:"Hide",inline:"Inline",above:"On top"},default:"hide"},{type:"toggle",displayName:"Customize new button behavior",key:"customizeNewButton",default:!1},{type:"text",displayName:"Default location for new notes",key:"newNoteLocation",placeholder:"Simply use / for vault folder",default:""},{type:"toggle",displayName:"Hide quick edit icon",key:"hideQuickEditIcon",default:!1}]}var le=je(()=>{"use strict"});var lt={};me(lt,{default:()=>oe});module.exports=fe(lt);var $e=require("obsidian");var x=require("obsidian");var be=require("obsidian"),G=class extends be.FuzzySuggestModal{constructor(e,s){super(e);this.onSelect=s}getItems(){let e=this.app.commands,s=new Map;if(e&&typeof e.listCommands=="function")try{let a=e.listCommands();for(let i of a)i&&i.id&&i.name&&!s.has(i.id)&&s.set(i.id,{id:i.id,name:i.name})}catch(a){console.warn("[Bases CMS] Error getting commands via listCommands():",a)}try{let a=e.commands;if(a&&typeof a=="object"){let i=Object.values(a);for(let r of i)r&&r.id&&r.name&&!s.has(r.id)&&s.set(r.id,{id:r.id,name:r.name})}}catch(a){console.warn("[Bases CMS] Error getting commands via registry:",a)}try{let a=e.commandRegistry;if(a&&typeof a=="object"){let i=Object.values(a);for(let r of i)r&&r.id&&r.name&&!s.has(r.id)&&s.set(r.id,{id:r.id,name:r.name})}}catch(a){console.warn("[Bases CMS] Error getting commands via internal registry:",a)}let t=Array.from(s.values());return t.sort((a,i)=>a.name.localeCompare(i.name)),t}getItemText(e){return e.name}onChooseItem(e,s){this.onSelect(e.id)}renderSuggestion(e,s){let t=e.item;s.createDiv({cls:"suggestion-title",text:t.name})}};var Y=class extends x.PluginSettingTab{constructor(e,s){super(e,s);this.plugin=s}refreshActiveToolbars(){this.plugin&&typeof this.plugin.refreshAllToolbars=="function"&&this.plugin.refreshAllToolbars()}display(){let{containerEl:e}=this;e.empty(),new x.Setting(e).setName("Confirm bulk operations").setDesc("Show confirmation dialogs before performing bulk operations").addToggle(a=>a.setValue(this.plugin.settings.confirmBulkOperations).onChange(async i=>{this.plugin.settings.confirmBulkOperations=i,await this.plugin.saveData(this.plugin.settings)})),e.createEl("h3",{text:"Toolbar buttons"}),new x.Setting(e).setName("Show select all button").setDesc("Display the select all button in the CMS toolbar").addToggle(a=>a.setValue(this.plugin.settings.showToolbarSelectAll).onChange(async i=>{this.plugin.settings.showToolbarSelectAll=i,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()})),new x.Setting(e).setName("Show clear button").setDesc("Display the clear selection button in the CMS toolbar").addToggle(a=>a.setValue(this.plugin.settings.showToolbarClear).onChange(async i=>{this.plugin.settings.showToolbarClear=i,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()})),new x.Setting(e).setName("Show publish button").setDesc("Display the publish button in the CMS toolbar").addToggle(a=>a.setValue(this.plugin.settings.showToolbarPublish).onChange(async i=>{this.plugin.settings.showToolbarPublish=i,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()})),new x.Setting(e).setName("Show draft button").setDesc("Display the draft button in the CMS toolbar").addToggle(a=>a.setValue(this.plugin.settings.showToolbarDraft).onChange(async i=>{this.plugin.settings.showToolbarDraft=i,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()})),new x.Setting(e).setName("Show tags button").setDesc("Display the tags button in the CMS toolbar").addToggle(a=>a.setValue(this.plugin.settings.showToolbarTags).onChange(async i=>{this.plugin.settings.showToolbarTags=i,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()})),new x.Setting(e).setName("Show set button").setDesc("Display the set property button in the CMS toolbar").addToggle(a=>a.setValue(this.plugin.settings.showToolbarSet).onChange(async i=>{this.plugin.settings.showToolbarSet=i,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()})),new x.Setting(e).setName("Show remove button").setDesc("Display the remove property button in the CMS toolbar").addToggle(a=>a.setValue(this.plugin.settings.showToolbarRemove).onChange(async i=>{this.plugin.settings.showToolbarRemove=i,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()})),new x.Setting(e).setName("Show delete button").setDesc("Display the delete button in the CMS toolbar").addToggle(a=>a.setValue(this.plugin.settings.showToolbarDelete).onChange(async i=>{this.plugin.settings.showToolbarDelete=i,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()})),e.createEl("h3",{text:"Deletions"}),new x.Setting(e).setName("Delete parent folder for specific file name").setDesc("When enabled, deleting a note will delete its parent folder and all its contents if the note filename matches the specified name").addToggle(a=>a.setValue(this.plugin.settings.deleteParentFolder).onChange(async i=>{this.plugin.settings.deleteParentFolder=i,await this.plugin.saveData(this.plugin.settings)})),new x.Setting(e).setName("Folder deletion filename").setDesc('Filename that triggers parent folder deletion (e.g., "index")').addText(a=>a.setPlaceholder("index").setValue(this.plugin.settings.deleteParentFolderFilename).onChange(async i=>{this.plugin.settings.deleteParentFolderFilename=i,await this.plugin.saveData(this.plugin.settings)})).setDisabled(!this.plugin.settings.deleteParentFolder),new x.Setting(e).setName("Delete associated unique attachments").setDesc("When deleting a note, automatically delete attachments that are only used by that note. Attachments used by other notes will be preserved.").addToggle(a=>a.setValue(this.plugin.settings.deleteUniqueAttachments).onChange(async i=>{this.plugin.settings.deleteUniqueAttachments=i,await this.plugin.saveData(this.plugin.settings)})),new x.Setting(e).setName("Confirm deletions").setDesc("Show confirmation dialog before deleting files").addToggle(a=>a.setValue(this.plugin.settings.confirmDeletions).onChange(async i=>{this.plugin.settings.confirmDeletions=i,await this.plugin.saveData(this.plugin.settings)})),e.createEl("h3",{text:"Appearance"}),new x.Setting(e).setName("Use home icon for CMS view").setDesc("Use the home icon instead of blocks icon for the CMS view in the Bases view selector. Restart Obsidian for this change to take effect.").addToggle(a=>a.setValue(this.plugin.settings.useHomeIcon).onChange(async i=>{this.plugin.settings.useHomeIcon=i,await this.plugin.saveData(this.plugin.settings)})),e.createEl("h3",{text:"Quick edit"});let s=new x.Setting(e).setName("Enable quick edit").setDesc("Show a pencil icon on card titles that launches a command when clicked").addToggle(a=>a.setValue(this.plugin.settings.enableQuickEdit).onChange(async i=>{this.plugin.settings.enableQuickEdit=i,await this.plugin.saveData(this.plugin.settings),t.settingEl.style.display=i?"":"none"})),t=new x.Setting(e).setName("Quick edit command").setDesc("The Obsidian command to execute when clicking the quick edit icon on a card title").addButton(a=>{var r;let i=this.plugin.settings.quickEditCommandName||(this.plugin.settings.quickEditCommand?"Select command...":"No command selected");if(a.setButtonText(i).onClick(()=>{new G(this.app,async c=>{let h=this.app.commands,m="";if(h){if(typeof h.listCommands=="function"){let p=h.listCommands().find(d=>d.id===c);p&&(m=p.name)}if(!m){let u=h.commands;u&&u[c]&&(m=u[c].name||"")}}this.plugin.settings.quickEditCommand=c,this.plugin.settings.quickEditCommandName=m,await this.plugin.saveData(this.plugin.settings),this.display()}).open()}),this.plugin.settings.quickEditCommand){let l=(r=a.buttonEl.parentElement)==null?void 0:r.createEl("button",{text:"Clear",attr:{style:"margin-left: 8px;"}});l==null||l.addEventListener("click",async()=>{this.plugin.settings.quickEditCommand="",this.plugin.settings.quickEditCommandName="",await this.plugin.saveData(this.plugin.settings),this.display()})}});t.settingEl.style.display=this.plugin.settings.enableQuickEdit?"":"none",e.createEl("h3",{text:"Performance"}),new x.Setting(e).setName("Thumbnail cache size").setDesc("Maximum size for generated thumbnails. Larger sizes provide better quality but use more memory. This setting caps the thumbnail size regardless of card size.").addDropdown(a=>a.addOption("minimal","Minimal (100x100, fastest)").addOption("small","Small (200x200)").addOption("balanced","Balanced (400x400, recommended)").addOption("large","Large (800x800)").addOption("unlimited","Unlimited (full resolution)").setValue(this.plugin.settings.thumbnailCacheSize).onChange(async i=>{this.plugin.settings.thumbnailCacheSize=i,await this.plugin.saveData(this.plugin.settings)}))}};var _=require("obsidian");function A(o,n){if(!n||!n.trim())return null;let e=n.split(",").map(s=>s.trim()).filter(s=>s);for(let s of e){let t=o.getValue(s),a=t;if(a&&("date"in a&&a.date instanceof Date||"data"in a))return t}return null}function ye(o,n){if(!n||!n.trim())return[];let e=n.split(",")[0].trim();if(!e)return[];let s=o.getValue(e);if(!s||!("data"in s))return[];let t=s.data,a=[];if(Array.isArray(t)){for(let i of t)if(typeof i=="string"||typeof i=="number"){let r=String(i);if(r&&r.trim()){a.push(r);break}}}else if(t!=null&&t!==""&&(typeof t=="string"||typeof t=="number")){let i=String(t);i.trim()&&a.push(i)}return a}function ve(o,n,e,s){if(!o||o==="")return"";if(e&&typeof e.getDisplayName=="function")try{let t=e.getDisplayName(o);if(t&&typeof t=="string"&&t.trim()!=="")return t}catch(t){}return o}function Ge(o,n,e,s,t,a,i){let r=o.file.basename||o.file.name,l=A(o,n.titleProperty),c=l==null?void 0:l.data,h=c!=null&&c!==""&&(typeof c=="string"||typeof c=="number")?String(c):r,m=o.file.path,u=m.split("/").slice(0,-1).join("/"),p=o.getValue("note.tags"),d=[];if(p&&p.data!=null){let v=p.data;d=(Array.isArray(v)?v.map(f=>f&&typeof f=="object"&&"data"in f?String(f.data):typeof f=="string"||typeof f=="number"?String(f):"").filter(f=>f):typeof v=="string"||typeof v=="number"?[String(v)]:[]).map(f=>f.replace(/^#/,""))}let g=o.getValue("file.tags"),b=[];if(g&&g.data!=null){let v=g.data;b=(Array.isArray(v)?v.map(f=>f&&typeof f=="object"&&f!==null&&"data"in f?String(f.data):typeof f=="string"||typeof f=="number"?String(f):"").filter(f=>typeof f=="string"&&f.length>0):typeof v=="string"||typeof v=="number"?[String(v)]:[]).map(f=>f.replace(/^#/,""))}let y=o.file.stat.ctime,w=o.file.stat.mtime,S=[];if(n.showTags&&n.tagsProperty){let v=A(o,n.tagsProperty);if(v&&v.data!=null){let C=v.data;Array.isArray(C)?S=C.map(f=>f&&typeof f=="object"&&"data"in f?String(f.data):typeof f=="string"||typeof f=="number"?String(f):"").filter(f=>typeof f=="string"&&f.length>0):(typeof C=="string"||typeof C=="number")&&(S=[String(C)])}}let E={path:m,name:r,title:h,tags:b,yamlTags:d,ctime:y,mtime:w,folderPath:u,snippet:t,imageUrl:a,hasImageAvailable:i||!1,displayTags:S.length>0?S:void 0},P=[n.propertyDisplay1,n.propertyDisplay2,n.propertyDisplay3,n.propertyDisplay4],F=new Set,T=P.map(v=>!v||v===""||F.has(v)?"":(F.add(v),v));return E.propertyName1=T[0]||void 0,E.propertyName2=T[1]||void 0,E.propertyName3=T[2]||void 0,E.propertyName4=T[3]||void 0,E.property1=T[0]?q(T[0],o,E,n):null,E.property2=T[1]?q(T[1],o,E,n):null,E.property3=T[2]?q(T[2],o,E,n):null,E.property4=T[3]?q(T[3],o,E,n):null,E}function we(o,n,e,s,t,a,i){return o.map(r=>Ge(r,n,e,s,t[r.file.path],a[r.file.path],i[r.file.path]))}function q(o,n,e,s){if(!o||o==="")return null;if(o==="file.path"||o==="file path")return e.folderPath||null;if(o==="tags"||o==="note.tags")return e.yamlTags.length>0?"tags":null;if(o==="file.tags"||o==="file tags")return e.tags.length>0?"tags":null;if(o==="file.ctime"||o==="created time")return new Date(e.ctime).toLocaleDateString();if(o==="file.mtime"||o==="modified time")return new Date(e.mtime).toLocaleDateString();let t=A(n,o);if(!t)return null;let a=t;if(!a)return null;if("date"in a&&a.date instanceof Date)return a.date.toLocaleDateString();let i=a.data;return i==null||i===""?null:Array.isArray(i)?i.length===0?null:i.map(r=>r&&typeof r=="object"&&"data"in r?String(r.data):String(r)).filter(r=>r&&r.trim()!=="").join(", "):typeof i=="string"||typeof i=="number"||typeof i=="boolean"?String(i):null}le();function Ee(o){return/^https?:\/\//i.test(o)}function ce(o){return/\.(avif|bmp|gif|jpe?g|png|svg|webp)$/i.test(o)}function Ze(o){let n=o.match(/^!?\[\[([^\]|]+)(?:\|[^\]]*)?\]\]$/);return n?n[1].trim():o}function Se(o){let n=[],e=[];for(let s of o){let t=Ze(s);t.length!==0&&(Ee(t)?(ce(t)||!t.includes("."))&&e.push(t):ce(t)&&n.push(t))}return{internalPaths:n,externalUrls:e}}async function Ce(o,n){let e=["avif","bmp","gif","jpeg","jpg","png","svg","webp"],s=n.metadataCache.getFileCache(o);if(!(s!=null&&s.embeds))return[];let t=[],a=[];for(let i of s.embeds){let r=i.link;if(Ee(r))(ce(r)||!r.includes("."))&&a.push(r);else{let l=n.metadataCache.getFirstLinkpathDest(r,o.path);if(l&&e.includes(l.extension)){let c=n.vault.getResourcePath(l);t.push(c)}}}return[...t,...a]}var Ke=[/`([^`]+)`/g,/\*\*\*((?:(?!\*\*\*).)+)\*\*\*/g,/___((?:(?!___).)+)___/g,/\*\*((?:(?!\*\*).)+)\*\*/g,/__((?:(?!__).)+)__/g,/\*((?:(?!\*).)+)\*/g,/_((?:(?!_).)+)_/g,/~~((?:(?!~~).)+)~~/g,/==((?:(?!==).)+)==/g,/\[([^\]]+)\]\([^)]+\)/g,/!\[\[[^\]]+\]\]/g,/\[\[[^\]|]+\|[^\]]+\]\]/g,/\[\[[^\]]+\]\]/g,/#[a-zA-Z0-9_\-/]+/g,/^[-*+]\s*\[[ xX]\]\s+/gm,/^(\d+\.\s*)\[[ xX]\]\s+/gm,/^(\d+\)\s*)\[[ xX]\]\s+/gm,/^[-*+]\s+/gm,/^#{1,6}\s+.+$/gm,/^\s*(?:[-_*])\s*(?:[-_*])\s*(?:[-_*])[\s\-_*]*$/gm,/^\s*\|.*\|.*$/gm,/\^\[[^\]]*?]/g,/\[\^[^\]]+]/g,/^\s*\[\^[^\]]+]:.*$/gm,/<([a-z][a-z0-9]*)\b[^>]*>(.*?)<\/\1>/gi,/<[^>]+>/g];function Xe(o){let n=new Map,e=0;return{text:o.replace(/\\(.)/g,(t,a)=>{let i=`\xA7\xA7ESCAPED${e}\xA7\xA7`;return n.set(i,a),e++,i}),map:n}}function Je(o,n){let e=o;return n.forEach((s,t)=>{e=e.split(t).join(s)}),e}function et(o){let n=o,e=!0;for(;e;){e=!1;let s=n.match(/^([`~]{3,})/m);if(!s)break;let t=s[1][0],a=s[1].length,i=s.index,r=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),l=new RegExp(`^${r}{${a}}\\s*$`,"m"),h=n.substring(i+s[1].length).match(l);if(h){let u=i+s[1].length+h.index+h[0].length;n=n.substring(0,i)+n.substring(u),e=!0}else{let m=n.indexOf(`
`,i);m===-1?n=n.substring(0,i):n=n.substring(0,i)+n.substring(m+1),e=!0}}return n}function tt(o){if(!o||o.trim().length===0)return"";o=o.replace(/^>\s*\[![\w-]+\][+-]?.*$/gm,""),o=o.replace(/^>\s?/gm,"");let{text:n,map:e}=Xe(o),s=et(n);return Ke.forEach(t=>{s=s.replace(t,(a,...i)=>{if(a.match(/<[a-z][a-z0-9]*\b[^>]*>.*?<\//i))return i[1]||"";if(i.length>0&&i[0]!==void 0){for(let r=0;r<i.length-2;r++)if(typeof i[r]=="string")return i[r]}return""})}),s=Je(s,e),s}function st(o,n=!1,e,s){let t=o.replace(/^---[\s\S]*?---/,"").trim(),a=tt(t),i=a.indexOf(`
`),r=(i!==-1?a.substring(0,i):a).trim();(n||e&&r===e||s&&r===s)&&(a=i!==-1?a.substring(i+1).trim():"");let l=a.replace(/\^[a-zA-Z0-9-]+/g,"").split(/\s+/).filter(m=>m).join(" ").trim().replace(/\.{2,}/g,m=>m.replace(/\./g,"\u2024")),c=l.length>500,h=l.substring(0,500);return c&&(h+="\u2026"),h}async function ke(o,n,e,s,t,a){if(e!=null&&(typeof e=="string"||typeof e=="number")&&String(e).trim().length>0)return String(e).trim();if(s.fallbackToContent){let r=await n.vault.cachedRead(o);return st(r,s.omitFirstLine,t,a)}return""}var Z={minimal:{maxWidth:100,maxHeight:100,quality:.6},small:{maxWidth:200,maxHeight:200,quality:.7},balanced:{maxWidth:400,maxHeight:400,quality:.8},large:{maxWidth:800,maxHeight:800,quality:.9},unlimited:{maxWidth:1/0,maxHeight:1/0,quality:1}};function xe(o,n,e){if(e==="unlimited")return Z.unlimited;let s=Z[e];if(n==="cover"){let t=Math.ceil(o*2);return{maxWidth:Math.min(t,s.maxWidth),maxHeight:Math.min(t,s.maxHeight),quality:s.quality}}if(n==="thumbnail"){let a=o/250,i=Math.ceil(80*a*2);return{maxWidth:Math.min(i,s.maxWidth),maxHeight:Math.min(i,s.maxHeight),quality:s.quality}}return s}async function Pe(o,n,e,s){try{if(e==="unlimited"&&!s)return n.vault.getResourcePath(o);let t=s||Z[e],a=await n.vault.readBinary(o),i=new Blob([a]),r=URL.createObjectURL(i);return new Promise((l,c)=>{let h=new Image;h.onload=()=>{try{let m=h.width,u=h.height;if(m>t.maxWidth||u>t.maxHeight){let b=m/u;m>u?(m=Math.min(m,t.maxWidth),u=m/b):(u=Math.min(u,t.maxHeight),m=u*b)}let p=document.createElement("canvas");p.width=m,p.height=u;let d=p.getContext("2d");if(!d){URL.revokeObjectURL(r),l(null);return}d.drawImage(h,0,0,m,u);let g=p.toDataURL("image/jpeg",t.quality);URL.revokeObjectURL(r),l(g)}catch(m){URL.revokeObjectURL(r),c(m)}},h.onerror=()=>{URL.revokeObjectURL(r),l(null)},h.src=r})}catch(t){return console.error(`Failed to generate thumbnail for ${o.path}:`,t),null}}async function De(o,n,e){try{if(n==="unlimited"&&!e)return o;let s=e||Z[n];return new Promise((t,a)=>{let i=new Image;i.crossOrigin="anonymous",i.onload=()=>{try{let r=i.width,l=i.height;if(r>s.maxWidth||l>s.maxHeight){let u=r/l;r>l?(r=Math.min(r,s.maxWidth),l=r/u):(l=Math.min(l,s.maxHeight),r=l*u)}let c=document.createElement("canvas");c.width=r,c.height=l;let h=c.getContext("2d");if(!h){t(null);return}h.drawImage(i,0,0,r,l);let m=c.toDataURL("image/jpeg",s.quality);t(m)}catch(r){a(r)}},i.onerror=()=>{t(null)},i.src=o})}catch(s){return console.error(`Failed to generate thumbnail from URL ${o}:`,s),null}}async function pe(o,n,e,s,t,a="balanced",i,r){for(let l of o)if(!(l.path in s))try{let{internalPaths:c,externalUrls:h}=Se(l.imagePropertyValues),m=[],u=["avif","bmp","gif","jpeg","jpg","png","svg","webp"];for(let y of c){let w=e.metadataCache.getFirstLinkpathDest(y,l.path);w&&u.includes(w.extension)&&m.push(w)}let p=[],d=i!==void 0&&r!==void 0?xe(i,r,a):void 0;for(let y of m)p.push(Pe(y,e,a,d));for(let y of h)p.push(De(y,a,d));let b=(await Promise.all(p)).filter(y=>y!==null);b.length>0?(s[l.path]=b.length>1?b:b[0],t[l.path]=!0):n&&(t[l.path]=!1)}catch(c){console.error(`Failed to load image for ${l.path}:`,c)}}async function Fe(o,n,e,s){await Promise.all(o.map(async t=>{if(!(t.path in e||s[t.path]))try{let a=await Ce(t.file,n);a.length>0&&(e[t.path]=a.length>1?a:a[0],s[t.path]=!0)}catch(a){console.error(`Failed to load embed images for ${t.path}:`,a)}}))}async function Ae(o,n,e,s,t){await Promise.all(o.map(async a=>{if(!(a.path in t))try{a.file.extension==="md"?t[a.path]=await ke(a.file,s,a.descriptionData,{fallbackToContent:n,omitFirstLine:e},a.fileName,a.titleString):t[a.path]=""}catch(i){console.error(`Failed to load snippet for ${a.path}:`,i),t[a.path]=""}}))}var N=require("obsidian");var K=class{constructor(n,e,s,t,a,i){this.app=n;this.plugin=e;this.propertyObservers=s;this.updateLayoutRef=t;this.basesConfig=a,this.basesController=i}renderCard(n,e,s,t,a,i,r,l){let c=n.createDiv("card bases-cms-card");t.imageFormat==="cover"?c.classList.add("image-format-cover"):t.imageFormat==="thumbnail"&&c.classList.add("image-format-thumbnail"),c.setAttribute("data-path",e.path),c.setAttribute("data-href",e.path),c.style.cursor="pointer";let h=c.createDiv("bases-cms-select-checkbox"),m=h.createEl("input",{type:"checkbox",cls:"selection-checkbox"});if(m.checked=i,m.addEventListener("change",u=>{u.stopPropagation(),u.stopImmediatePropagation(),r(e.path,m.checked)}),m.addEventListener("click",u=>{u.stopPropagation(),u.stopImmediatePropagation()}),t.showDraftStatus&&t.imageFormat!=="cover"){let u=null,p=!1;if(t.draftStatusUseFilenamePrefix)u=s.file.name.startsWith("_"),p=t.draftStatusReverse?!u:u;else if(t.draftStatusProperty){let d=A(s,t.draftStatusProperty);if(d){let g=d;g&&"data"in g&&typeof g.data=="boolean"&&(u=g.data,p=t.draftStatusReverse?!u:u)}}if(u!==null){let d=c.createDiv("card-status-badge");p?(d.addClass("status-draft"),d.appendText("Draft")):(d.addClass("status-published"),d.appendText("Published")),l&&(d.style.cursor="pointer",d.addEventListener("click",async g=>{g.stopPropagation();let b=!u;await l(e.path,"draft",b)}))}}if(c.addEventListener("click",u=>{let p=u.target;if(p.closest(".bases-cms-quick-edit-icon")){u.stopPropagation(),u.stopImmediatePropagation(),u.preventDefault();return}if(h.contains(p)||p.tagName==="INPUT"||p.closest("input")||p.closest(".bases-cms-property")||p.closest(".card-status-badge"))return;let g=u.metaKey||u.ctrlKey;this.app.workspace.openLinkText(e.path,"",g)}),c.addEventListener("contextmenu",u=>{let p=u.target;if(h.contains(p)||p.tagName==="INPUT"||p.closest("input")||p.closest(".bases-cms-property")||p.closest(".card-status-badge")||p.closest(".bases-cms-quick-edit-icon"))return;let d=this.app.vault.getAbstractFileByPath(e.path);if(d&&d instanceof N.TFile){u.stopPropagation();let g=new N.Menu;this.app.workspace.trigger("file-menu",g,d,"bases"),g.showAtMouseEvent(u)}}),t.showTitle){let u=c.createDiv("card-title");if(u.appendText(e.title),this.plugin.settings.enableQuickEdit&&this.plugin.settings.quickEditCommand&&this.plugin.settings.quickEditCommand!==""&&!t.hideQuickEditIcon){let p=u.createSpan("bases-cms-quick-edit-icon");p.style.cursor="default",(0,N.setIcon)(p,"pencil-line"),u.addEventListener("click",d=>{p.contains(d.target)&&(d.stopPropagation(),d.stopImmediatePropagation())},!0),c.addEventListener("click",async d=>{var y,w,S;let g=d.target;if(!p.contains(g)&&!g.closest(".bases-cms-quick-edit-icon"))return;d.stopPropagation(),d.stopImmediatePropagation(),d.preventDefault();let b=this.app.vault.getAbstractFileByPath(e.path);if(b instanceof N.TFile){let E=this.plugin.settings.quickEditCommand,P=!1;try{let F=null,T=E;if(E.includes(":")){let v=E.split(":");F=v[0],T=v.slice(1).join(":")}else{let v=this.app.commands,C=(y=v==null?void 0:v.commands)==null?void 0:y[E];if(C){let f=C.plugin||C.sourcePlugin;f&&(F=((w=f.manifest)==null?void 0:w.id)||f.pluginId)}}if(F){let v=this.app.plugins,C=(S=v==null?void 0:v.plugins)==null?void 0:S[F];if(C){let f=T.split("-").map((k,D)=>D===0?k:k.charAt(0).toUpperCase()+k.slice(1)).join("")+"ByPath";if(typeof C[f]=="function"){await C[f](e.path),P=!0;return}}}}catch(F){}if(!P)try{await this.app.commands.executeCommandById(this.plugin.settings.quickEditCommand);return}catch(F){let T=this.app.workspace.getLeaf(!1);await T.openFile(b);let v=()=>{let C=T.view;C&&"editor"in C&&C.editor?setTimeout(async()=>{try{await this.app.commands.executeCommandById(this.plugin.settings.quickEditCommand)}catch(f){}},100):setTimeout(v,50)};v()}}},!0),p.addEventListener("mousedown",d=>{d.stopPropagation(),d.stopImmediatePropagation(),d.preventDefault()},!0)}}if(t.showDate&&t.dateProperty){let u=A(s,t.dateProperty);if(u){let p=u,d="";if(p&&"date"in p&&p.date instanceof Date)d=p.date.toLocaleDateString();else if(p&&"data"in p&&p.data){let g=p.data;if(g instanceof Date)d=g.toLocaleDateString();else if(typeof g=="string"||typeof g=="number"){let b=new Date(g);isNaN(b.getTime())?d=String(g):d=b.toLocaleDateString()}}d&&c.createDiv("card-date").appendText(d)}}if(t.showTextPreview||t.showTags&&e.displayTags&&e.displayTags.length>0||t.imageFormat!=="none"&&(e.imageUrl||e.hasImageAvailable)||t.imageFormat==="cover"){let u=c.createDiv("card-content");if(t.imageFormat==="thumbnail"){let p=u.createDiv("card-text-wrapper");if(t.showTextPreview){let d=p.createDiv("card-text-preview");e.snippet&&d.setText(e.snippet),c.__textPreviewEl=d,c.__cardPath=e.path}if(t.showTags&&e.displayTags&&e.displayTags.length>0){let d=p.createDiv("card-tags"),g=t.maxTagsToShow,b=e.displayTags.slice(0,g),y=e.displayTags.length-g;b.forEach(w=>{d.createSpan("card-tag").appendText(w)}),y>0&&d.createSpan("card-tag-more").appendText(`+${y} more`)}}else{if(t.showTextPreview){let p=u.createDiv("card-text-preview");e.snippet&&p.setText(e.snippet),c.__textPreviewEl=p,c.__cardPath=e.path}if(t.showTags&&e.displayTags&&e.displayTags.length>0){let p=u.createDiv("card-tags"),d=t.maxTagsToShow,g=e.displayTags.slice(0,d),b=e.displayTags.length-d;g.forEach(y=>{p.createSpan("card-tag").appendText(y)}),b>0&&p.createSpan("card-tag-more").appendText(`+${b} more`)}}if(t.imageFormat!=="none"&&e.imageUrl){let d=(Array.isArray(e.imageUrl)?e.imageUrl:[e.imageUrl]).filter(y=>y&&typeof y=="string"&&y.trim().length>0),g=t.imageFormat==="cover"?"card-cover":"card-thumbnail",b=u.createDiv(g);if(t.showDraftStatus&&t.imageFormat==="cover"){let y=null,w=!1;if(t.draftStatusUseFilenamePrefix)y=s.file.name.startsWith("_"),w=t.draftStatusReverse?!y:y;else if(t.draftStatusProperty){let S=A(s,t.draftStatusProperty);if(S){let E=S;E&&"data"in E&&typeof E.data=="boolean"&&(y=E.data,w=t.draftStatusReverse?!y:y)}}if(y!==null){let S=b.createDiv("card-status-badge");w?(S.addClass("status-draft"),S.appendText("Draft")):(S.addClass("status-published"),S.appendText("Published")),l&&(S.style.cursor="pointer",S.addEventListener("click",async E=>{E.stopPropagation();let P=!y;await l(e.path,"draft",P)}))}}if(d.length>0){let y=b.createDiv("image-embed"),w=y.createEl("img",{attr:{alt:"",decoding:"async",sizes:t.imageFormat==="cover"?"100vw":"80px"}});return y.style.setProperty("--cover-image-url",`url("${d[0]}")`),this.renderProperties(c,e,s,t,l),{img:w,src:d[0]}}}else if(t.imageFormat==="cover"){let p=u.createDiv("card-cover-placeholder");if(t.showDraftStatus){let d=null,g=!1;if(t.draftStatusUseFilenamePrefix)d=s.file.name.startsWith("_"),g=t.draftStatusReverse?!d:d;else if(t.draftStatusProperty){let b=A(s,t.draftStatusProperty);if(b){let y=b;y&&"data"in y&&typeof y.data=="boolean"&&(d=y.data,g=t.draftStatusReverse?!d:d)}}if(d!==null){let b=p.createDiv("card-status-badge");g?(b.addClass("status-draft"),b.appendText("Draft")):(b.addClass("status-published"),b.appendText("Published")),l&&(b.style.cursor="pointer",b.addEventListener("click",async y=>{y.stopPropagation();let w=!d;await l(e.path,"draft",w)}))}}}}return this.renderProperties(c,e,s,t,l),null}renderProperties(n,e,s,t,a){let i=[t.propertyDisplay1,t.propertyDisplay2,t.propertyDisplay3,t.propertyDisplay4],r=new Set,l=i.map(p=>!p||p===""||r.has(p)?"":(r.add(p),p)),c=l.map(p=>p?q(p,s,e,t):null),h=l[0]!==""||l[1]!=="",m=l[2]!==""||l[3]!=="";if(!h&&!m)return;let u=n.createDiv("card-properties properties-4field");if(h){let p=u.createDiv("property-row property-row-1");t.propertyLayout12SideBySide&&p.addClass("property-row-side-by-side");let d=p.createDiv("property-field property-field-1");l[0]&&this.renderPropertyContent(d,l[0],c[0],e,s,t,a);let g=p.createDiv("property-field property-field-2");l[1]&&this.renderPropertyContent(g,l[1],c[1],e,s,t,a)}if(m){let p=u.createDiv("property-row property-row-2");t.propertyLayout34SideBySide&&p.addClass("property-row-side-by-side");let d=p.createDiv("property-field property-field-3");l[2]&&this.renderPropertyContent(d,l[2],c[2],e,s,t,a);let g=p.createDiv("property-field property-field-4");l[3]&&this.renderPropertyContent(g,l[3],c[3],e,s,t,a)}}renderPropertyContent(n,e,s,t,a,i,r){if(e===""||!s&&i.propertyLabels==="hide"||i.propertyLabels==="hide"&&((e==="tags"||e==="note.tags")&&t.yamlTags.length===0||(e==="file.tags"||e==="file tags")&&t.tags.length===0||(e==="file.path"||e==="path"||e==="file path")&&t.folderPath.length===0))return;let l=ve(e,this.app,this.basesConfig,this.basesController),c=l.toLowerCase()!==e.toLowerCase();if(i.propertyLabels==="above"){let u=n.createDiv("property-label");c&&u.addClass("property-label-custom"),u.textContent=l}let h=n.createDiv("property-content");if(i.propertyLabels==="inline"){let u=h.createSpan("property-label-inline");u.textContent=l+": "}if(!s){h.appendText("\u2026");return}if(e==="file.mtime"||e==="file.ctime"||e==="modified time"||e==="created time")h.createSpan().appendText(s);else if((e==="tags"||e==="note.tags")&&t.yamlTags.length>0){let u=h.createDiv("tags-wrapper");t.yamlTags.forEach(p=>{u.createEl("a",{cls:"tag",text:p,href:"#"}).addEventListener("click",g=>{var y,w,S;g.preventDefault();let b=(w=(y=this.app.internalPlugins)==null?void 0:y.plugins)==null?void 0:w["global-search"];(S=b==null?void 0:b.instance)!=null&&S.openGlobalSearch&&b.instance.openGlobalSearch("tag:"+p)})})}else if((e==="file.tags"||e==="file tags")&&t.tags.length>0){let u=h.createDiv("tags-wrapper");t.tags.forEach(p=>{u.createEl("a",{cls:"tag",text:p,href:"#"}).addEventListener("click",g=>{var y,w,S;g.preventDefault();let b=(w=(y=this.app.internalPlugins)==null?void 0:y.plugins)==null?void 0:w["global-search"];(S=b==null?void 0:b.instance)!=null&&S.openGlobalSearch&&b.instance.openGlobalSearch("tag:"+p)})})}else if((e==="file.path"||e==="path"||e==="file path")&&t.path.length>0){let u=h.createDiv("path-wrapper"),p=t.path.split("/").filter(d=>d);p.forEach((d,g)=>{let b=u.createSpan(),y=g===p.length-1,w=y?"path-segment filename-segment":"path-segment file-path-segment";b.createSpan({cls:w,text:d}).addEventListener("click",E=>{if(E.stopPropagation(),y){let P=this.app.vault.getAbstractFileByPath(t.path);P instanceof N.TFile&&this.app.workspace.getLeaf(!1).openFile(P)}}),g<p.length-1&&b.createSpan({cls:"path-separator",text:"/"})})}else{let u=this.app.metadataCache,d=((typeof u.getAllPropertyInfos=="function"?u.getAllPropertyInfos():{})||{})[e.toLowerCase()],g=a.getValue(e);if(((d==null?void 0:d.widget)==="checkbox"||g&&"data"in g&&typeof g.data=="boolean")&&r){let y=h.createEl("input",{type:"checkbox",cls:"checkbox-input"});y.checked=g&&"data"in g?Boolean(g.data):!1;let w=e.startsWith("note.")?e.substring(5):e;h.createSpan({cls:"checkbox-label",text:w}),y.addEventListener("click",S=>{S.stopPropagation()}),y.addEventListener("change",async S=>{S.stopPropagation();try{let E=e.startsWith("note.")?e.substring(5):e;await r(t.path,E,y.checked)}catch(E){console.error("Error toggling property:",E),y.checked=!y.checked}})}else h.createDiv("text-wrapper").appendText(s)}(!h.textContent||h.textContent.trim().length===0)&&h.remove()}};var Re=require("obsidian");var I=require("obsidian");async function he(o,n,e,s){await o.fileManager.processFrontMatter(n,t=>{for(let[a,i]of e){if(a==="tags"&&!t.hasOwnProperty("tags")&&!Array.isArray(i.data)){t[a]=[i.data];continue}if(!t[a]||s){t[a]=i.data;continue}let r=i.type,l=t[a],c=Array.isArray(l)?"list":typeof l=="number"?"number":typeof l=="boolean"?"checkbox":"text";if(it(r,c)){if(t[a]===i.data||!i.data)continue;let h=at(t[a],i.data);t[a]=h;continue}else{t[a]=i.data;continue}}})}async function Le(o,n,e){await o.fileManager.processFrontMatter(n,s=>{for(let t of e)s[t]=void 0})}function it(o,n){let e=["number","date","datetime","checkbox"];return!(e.includes(o)||e.includes(n))}function at(...o){let e=o.map(t=>Array.isArray(t)?t:[t]).flat();return[...new Set(e)]}var L=class{constructor(n){this.app=n}async setDraft(n,e){await this.batchProcessFiles(n,async s=>{await this.app.fileManager.processFrontMatter(s,t=>{t.draft=e})}),new I.Notice(`Set ${n.length} file${n.length!==1?"s":""} to ${e?"draft":"published"}`)}async addTags(n,e){let s=new Map;s.set("tags",{type:"tags",data:e,overwrite:!1,delimiter:","}),await this.batchProcessFiles(n,async t=>{await he(this.app,t,s,!1)}),new I.Notice(`Added tags to ${n.length} file${n.length!==1?"s":""}`)}async removeTags(n,e){await this.batchProcessFiles(n,async s=>{let t=this.app.metadataCache.getFileCache(s),a=t==null?void 0:t.frontmatter;if(a!=null&&a.tags){let r=(Array.isArray(a.tags)?a.tags:[a.tags]).filter(l=>!e.includes(l));await this.app.fileManager.processFrontMatter(s,l=>{r.length>0?l.tags=r:l.tags=void 0})}}),new I.Notice(`Removed tags from ${n.length} file${n.length!==1?"s":""}`)}async setProperty(n,e,s,t="text"){let a=e.startsWith("note.")?e.substring(5):e,i=new Map;i.set(a,{type:t,data:s,overwrite:!0,delimiter:","}),await this.batchProcessFiles(n,async r=>{await he(this.app,r,i,!0)}),new I.Notice(`Set ${a} on ${n.length} file${n.length!==1?"s":""}`)}async removeProperty(n,e){let s=e.startsWith("note.")?e.substring(5):e;await this.batchProcessFiles(n,async t=>{await Le(this.app,t,[s])}),new I.Notice(`Removed ${s} from ${n.length} file${n.length!==1?"s":""}`)}async batchProcessFiles(n,e){let s=0,t=n.length;for(let a of n){let i=this.app.vault.getAbstractFileByPath(a);if(i instanceof I.TFile)try{await e(i),s++}catch(r){console.error(`Error processing ${a}:`,r)}}s<t&&new I.Notice(`Processed ${s} of ${t} files`)}};var z=require("obsidian");var X=class extends z.Modal{constructor(e,s){super(e);this.tagsToAdd="";this.tagsToRemove=new Set;this.files=s,this.bulkOps=new L(e)}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Manage Tags"}),e.createEl("p",{text:`Managing tags for ${this.files.length} file${this.files.length!==1?"s":""}`}),new z.Setting(e).setName("Add tags").setDesc("Enter tags to add (comma-separated)").addText(l=>{l.setPlaceholder("tag1, tag2, tag3").onChange(c=>{this.tagsToAdd=c})}),e.createEl("h3",{text:"Remove tags"});let s=e.createDiv(),t=new Set;for(let l of this.files){let c=this.app.vault.getAbstractFileByPath(l);if(c instanceof z.TFile){let h=this.app.metadataCache.getFileCache(c),m=h==null?void 0:h.frontmatter;m!=null&&m.tags&&(Array.isArray(m.tags)?m.tags:[m.tags]).forEach(p=>t.add(p))}}for(let l of Array.from(t).sort())new z.Setting(s).setName(l).addToggle(c=>{c.setValue(this.tagsToRemove.has(l)).onChange(h=>{h?this.tagsToRemove.add(l):this.tagsToRemove.delete(l)})});let a=e.createDiv();a.style.display="flex",a.style.gap="0.5rem",a.style.justifyContent="flex-end",a.style.marginTop="1rem";let i=a.createEl("button");i.setText("Cancel"),i.addEventListener("click",()=>this.close());let r=a.createEl("button");r.setText("Apply"),r.addClass("mod-cta"),r.addEventListener("click",async()=>{await this.applyChanges(),this.close()})}async applyChanges(){if(this.tagsToAdd.trim()){let e=this.tagsToAdd.split(",").map(s=>s.trim()).filter(s=>s.length>0);e.length>0&&await this.bulkOps.addTags(this.files,e)}this.tagsToRemove.size>0&&await this.bulkOps.removeTags(this.files,Array.from(this.tagsToRemove))}onClose(){let{contentEl:e}=this;e.empty()}};var H=require("obsidian");var J=class extends H.Modal{constructor(e,s){super(e);this.propertyName="";this.propertyValue="";this.propertyType="text";this.files=s,this.bulkOps=new L(e)}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Set Property"}),e.createEl("p",{text:`Setting property on ${this.files.length} file${this.files.length!==1?"s":""}`}),new H.Setting(e).setName("Property name").setDesc("Enter the property name to set").addText(i=>{i.setPlaceholder("e.g., status, category, priority").onChange(r=>{this.propertyName=r})}),new H.Setting(e).setName("Property type").setDesc("Select the property type").addDropdown(i=>{i.addOption("text","Text").addOption("number","Number").addOption("checkbox","Checkbox").addOption("date","Date").setValue(this.propertyType).onChange(r=>{this.propertyType=r})}),new H.Setting(e).setName("Property value").setDesc("Enter the property value").addText(i=>{i.setPlaceholder("Enter value").onChange(r=>{this.propertyValue=r})});let s=e.createDiv();s.style.display="flex",s.style.gap="0.5rem",s.style.justifyContent="flex-end",s.style.marginTop="1rem";let t=s.createEl("button");t.setText("Cancel"),t.addEventListener("click",()=>this.close());let a=s.createEl("button");a.setText("Apply"),a.addClass("mod-cta"),a.addEventListener("click",async()=>{this.propertyName&&this.propertyValue&&(await this.applyChanges(),this.close())})}async applyChanges(){let e=this.propertyValue;this.propertyType==="number"?e=Number(this.propertyValue):this.propertyType==="checkbox"?e=this.propertyValue.toLowerCase()==="true"||this.propertyValue==="1":this.propertyType==="date"&&(e=this.propertyValue),await this.bulkOps.setProperty(this.files,this.propertyName,e,this.propertyType)}onClose(){let{contentEl:e}=this;e.empty()}};var W=require("obsidian");var ee=class extends W.Modal{constructor(e,s){super(e);this.propertiesToRemove=new Set;this.files=s,this.bulkOps=new L(e)}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Remove Property"}),e.createEl("p",{text:`Removing properties from ${this.files.length} file${this.files.length!==1?"s":""}`});let s=new Set;for(let l of this.files){let c=this.app.vault.getAbstractFileByPath(l);if(c instanceof W.TFile){let h=this.app.metadataCache.getFileCache(c),m=h==null?void 0:h.frontmatter;if(m)for(let u in m)u!=="tags"&&u!=="title"&&s.add(u)}}let t=e.createDiv();for(let l of Array.from(s).sort())new W.Setting(t).setName(l).addToggle(c=>{c.setValue(this.propertiesToRemove.has(l)).onChange(h=>{h?this.propertiesToRemove.add(l):this.propertiesToRemove.delete(l)})});s.size===0&&e.createEl("p",{text:"No properties found in selected files."});let a=e.createDiv();a.style.display="flex",a.style.gap="0.5rem",a.style.justifyContent="flex-end",a.style.marginTop="1rem";let i=a.createEl("button");i.setText("Cancel"),i.addEventListener("click",()=>this.close());let r=a.createEl("button");r.setText("Apply"),r.addClass("mod-cta"),r.addEventListener("click",async()=>{this.propertiesToRemove.size>0&&(await this.applyChanges(),this.close())})}async applyChanges(){for(let e of this.propertiesToRemove)await this.bulkOps.removeProperty(this.files,e)}onClose(){let{contentEl:e}=this;e.empty()}};var Ve=require("obsidian");var R=require("obsidian");var $=require("obsidian");function Me(o,n){let e=[],s=o.vault.getAbstractFileByPath(n.path);if(s instanceof $.TFile){let t=o.metadataCache.getFileCache(s),a=(t==null?void 0:t.embeds)||[];for(let i of a){let r=o.metadataCache.getFirstLinkpathDest(i.link,n.path);r instanceof $.TFile&&e.push(r)}}return e}function Be(o,n){let e=[];for(let s of n.children)s instanceof $.TFile&&s.extension==="md"?e.push(...Me(o,s)):s instanceof $.TFolder&&e.push(...Be(o,s));return e}async function nt(o,n,e,s){let t=o.vault.getMarkdownFiles().filter(l=>l.path!==e.path),a=n.path,i=n.name,r=n.basename;for(let l of t){if(s&&l.path.startsWith(s.path+"/"))continue;let c=await o.vault.read(l);if(c.includes(a)||c.includes(i)||c.includes(r)||c.includes(`![[${i}]]`)||c.includes(`[[${i}]]`)||c.includes(`(${i})`)||c.includes(`(${a})`))return!0}return!1}async function Ie(o,n,e){let s=[];s.push(...Me(o,n)),e&&s.push(...Be(o,e));let t=Array.from(new Set(s.map(i=>i.path))).map(i=>o.vault.getAbstractFileByPath(i)).filter(i=>i instanceof $.TFile),a=[];for(let i of t)await nt(o,i,n,e)||a.push(i);return a}function ot(o,n){let e=n.deleteParentFolderFilename||"index";return o.basename===e&&o.parent!==null}function Oe(o,n){return n.deleteParentFolder&&ot(o,n)}async function de(o,n,e){let s=[],t=[],a=[];for(let l of n){let c=o.vault.getAbstractFileByPath(l);if(c instanceof R.TFile){if(Oe(c,e)){let h=c.parent;if(h&&!t.includes(h)){t.push(h);let m=h.children.filter(u=>u instanceof R.TFile);s.push(...m)}}else s.push(c);if(e.deleteUniqueAttachments){let h=Oe(c,e)&&c.parent||void 0,m=await Ie(o,c,h);a.push(...m)}}}let i=Array.from(new Set(s.map(l=>l.path))).map(l=>o.vault.getAbstractFileByPath(l)).filter(l=>l instanceof R.TFile),r=Array.from(new Set(a.map(l=>l.path))).map(l=>o.vault.getAbstractFileByPath(l)).filter(l=>l instanceof R.TFile);return{filesToDelete:i,foldersToDelete:Array.from(new Set(t)),attachmentsToDelete:r}}async function te(o,n){let e=0,s=0;for(let t of n.filesToDelete)try{await o.vault.delete(t),e++}catch(a){console.error(`Error deleting file ${t.path}:`,a),s++}for(let t of n.attachmentsToDelete)try{await o.vault.delete(t),e++}catch(a){console.error(`Error deleting attachment ${t.path}:`,a),s++}for(let t of n.foldersToDelete)try{await o.vault.delete(t,!0),e++}catch(a){console.error(`Error deleting folder ${t.path}:`,a),s++}s>0?new R.Notice(`Deleted ${e} items, ${s} errors occurred`):new R.Notice(`Successfully deleted ${e} item${e!==1?"s":""}`)}var se=class extends Ve.Modal{constructor(e,s,t){super(e);this.preview=s,this.onConfirm=t}onOpen(){let{contentEl:e}=this;if(e.empty(),e.createEl("h2",{text:"Confirm Deletion"}),e.createEl("p",{text:"The following items will be deleted:",cls:"bases-cms-deletion-warning"}),this.preview.filesToDelete.length>0){e.createEl("h3",{text:`Files (${this.preview.filesToDelete.length})`});let i=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let r of this.preview.filesToDelete.slice(0,20))i.createEl("li").setText(r.path);this.preview.filesToDelete.length>20&&i.createEl("li",{text:`... and ${this.preview.filesToDelete.length-20} more files`})}if(this.preview.foldersToDelete.length>0){e.createEl("h3",{text:`Folders (${this.preview.foldersToDelete.length})`});let i=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let r of this.preview.foldersToDelete)i.createEl("li").setText(r.path)}if(this.preview.attachmentsToDelete.length>0){e.createEl("h3",{text:`Attachments (${this.preview.attachmentsToDelete.length})`});let i=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let r of this.preview.attachmentsToDelete.slice(0,20))i.createEl("li").setText(r.path);this.preview.attachmentsToDelete.length>20&&i.createEl("li",{text:`... and ${this.preview.attachmentsToDelete.length-20} more attachments`})}e.createEl("p",{text:"\u26A0\uFE0F This action cannot be undone!",cls:"bases-cms-deletion-warning"});let s=e.createDiv();s.style.display="flex",s.style.gap="0.5rem",s.style.justifyContent="flex-end",s.style.marginTop="1rem";let t=s.createEl("button");t.setText("Cancel"),t.addEventListener("click",()=>this.close());let a=s.createEl("button");a.setText("Delete"),a.addClass("mod-cta"),a.addClass("destructive"),a.addEventListener("click",async()=>{await te(this.app,this.preview),this.onConfirm(),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};var Ne=require("obsidian"),Q=class extends Ne.Modal{constructor(e,s,t,a){super(e);this.files=s,this.operation=t,this.onConfirm=a}onOpen(){let{contentEl:e}=this;e.empty();let s=this.operation==="draft"?"mark as draft":"mark as published";if(e.createEl("h2",{text:`Confirm ${s.charAt(0).toUpperCase()+s.slice(1)}`}),e.createEl("p",{text:`Are you sure you want to ${s} ${this.files.length} file${this.files.length!==1?"s":""}?`}),this.files.length>0){let r=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let l of this.files.slice(0,20))r.createEl("li").setText(l);this.files.length>20&&r.createEl("li",{text:`... and ${this.files.length-20} more file${this.files.length-20!==1?"s":""}`})}let t=e.createDiv();t.style.display="flex",t.style.gap="0.5rem",t.style.justifyContent="flex-end",t.style.marginTop="1rem";let a=t.createEl("button");a.setText("Cancel"),a.addEventListener("click",()=>this.close());let i=t.createEl("button");i.setText("Confirm"),i.addClass("mod-cta"),i.addEventListener("click",()=>{this.onConfirm(),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};var ie=class{constructor(n,e,s,t,a,i,r){this.app=n;this.plugin=e;this.container=s;this.getSelectedFiles=t;this.clearSelection=a;this.refreshView=i;this.toolbarEl=null;this.countEl=null;this.resizeObserver=null;this.bulkOps=new L(n),this.selectAllCallback=r,this.createToolbar()}createToolbar(){this.toolbarEl=document.createElement("div"),this.toolbarEl.className="bases-toolbar bases-cms-bulk-toolbar",this.toolbarEl.style.display="none",this.toolbarEl.style.opacity="0",this.toolbarEl.style.transform="translateY(-10px)",this.toolbarEl.style.transition="opacity 0.2s ease, transform 0.2s ease",this.toolbarEl.__bulkToolbarInstance=this,this.createToolbarContent(),this.positionToolbar(),setTimeout(()=>this.positionToolbar(),100)}positionToolbar(){if(!this.toolbarEl)return;let n=this.container.closest(".bases-header");if(!n){let s=this.container.parentElement;for(;s&&!n;){if(s.classList.contains("bases-header")){n=s;break}s=s.parentElement}}if(!n){let s=Array.from(document.querySelectorAll(".bases-header"));for(let t of s)if(t.contains(this.container)){n=t;break}}let e=this.container.closest(".view-content");if(e)this.toolbarEl.parentElement!==e?(this.toolbarEl.parentElement&&this.toolbarEl.remove(),e.insertBefore(this.toolbarEl,this.container)):this.toolbarEl.nextSibling!==this.container&&(this.toolbarEl.parentElement&&this.toolbarEl.remove(),e.insertBefore(this.toolbarEl,this.container));else if(n&&n.parentElement)this.toolbarEl.parentElement!==n.parentElement&&(this.toolbarEl.parentElement&&this.toolbarEl.remove(),n.parentElement.insertBefore(this.toolbarEl,n.nextSibling));else{let s=this.container.parentElement;s&&(this.toolbarEl.parentElement!==s||this.toolbarEl.nextSibling!==this.container)&&(this.toolbarEl.parentElement&&this.toolbarEl.remove(),s.insertBefore(this.toolbarEl,this.container))}}createToolbarContent(){if(!this.toolbarEl)return;let n=this.toolbarEl.createDiv("bases-cms-bulk-toolbar-left"),e=(a,i,r,l,c=!1)=>{let m=l.createDiv("bases-toolbar-item").createDiv("text-icon-button");c&&m.addClass("destructive"),m.setAttribute("tabindex","0");let u=m.createSpan("text-button-icon");return(0,Re.setIcon)(u,a),m.createSpan("text-button-label").setText(i),m.addEventListener("click",r),m};this.plugin.settings.showToolbarSelectAll&&e("copy-check","Select all",()=>this.handleSelectAll(),n),this.plugin.settings.showToolbarClear&&e("square-x","Clear",()=>this.clearSelection(),n);let s=n.createDiv("bases-toolbar-item bases-cms-selected-count");this.countEl=s.createSpan("text-button-label"),this.countEl.setText("0 items selected");let t=this.toolbarEl.createDiv("bases-cms-bulk-toolbar-right");this.plugin.settings.showToolbarPublish&&e("book-check","Publish",()=>this.handlePublish(),t),this.plugin.settings.showToolbarDraft&&e("book-dashed","Draft",()=>this.handleSetDraft(),t),this.plugin.settings.showToolbarTags&&e("tags","Tags",()=>this.handleManageTags(),t),this.plugin.settings.showToolbarSet&&e("list-check","Set",()=>this.handleSetProperty(),t),this.plugin.settings.showToolbarRemove&&e("list-x","Remove",()=>this.handleRemoveProperty(),t),this.plugin.settings.showToolbarDelete&&e("trash-2","Delete",()=>this.handleDelete(),t,!0),this.setupResponsiveBehavior()}setupResponsiveBehavior(){if(!this.toolbarEl)return;setTimeout(()=>{this.updateCollapsedState()},100),this.toolbarEl&&(this.resizeObserver=new ResizeObserver(()=>{this.updateCollapsedState()}),this.resizeObserver.observe(this.toolbarEl));let n=this.container;if(n){let e=new ResizeObserver(()=>{setTimeout(()=>{this.updateCollapsedState()},10)});e.observe(n),this.containerObserver=e}}updateCollapsedState(){if(!this.toolbarEl)return;this.toolbarEl.offsetWidth<680?this.toolbarEl.addClass("collapsed"):this.toolbarEl.removeClass("collapsed")}updateCount(n){this.countEl&&this.countEl.setText(`${n} item${n!==1?"s":""} selected`)}handleSelectAll(){this.selectAllCallback&&this.selectAllCallback()}show(){this.toolbarEl||(console.warn("[Bases CMS] Toolbar element not found, recreating..."),this.createToolbar()),this.toolbarEl?(this.positionToolbar(),this.toolbarEl.parentElement||(console.warn("[Bases CMS] Toolbar not in DOM, repositioning..."),this.positionToolbar()),this.toolbarEl.style.display="flex",this.toolbarEl.style.visibility="visible",this.toolbarEl.offsetHeight,setTimeout(()=>{this.toolbarEl&&(this.toolbarEl.style.opacity="1",this.toolbarEl.style.transform="translateY(0)")},10)):console.error("[Bases CMS] Failed to show toolbar - element is null")}hide(){this.toolbarEl&&(this.toolbarEl.style.opacity="0",this.toolbarEl.style.transform="translateY(-10px)",setTimeout(()=>{this.toolbarEl&&(this.toolbarEl.style.display="none")},200))}async handleSetDraft(){let n=this.getSelectedFiles();n.length!==0&&(this.plugin.settings.confirmBulkOperations?new Q(this.app,n,"draft",async()=>{await this.bulkOps.setDraft(n,!0),this.refreshView()}).open():(await this.bulkOps.setDraft(n,!0),this.refreshView()))}async handlePublish(){let n=this.getSelectedFiles();n.length!==0&&(this.plugin.settings.confirmBulkOperations?new Q(this.app,n,"publish",async()=>{await this.bulkOps.setDraft(n,!1),this.refreshView()}).open():(await this.bulkOps.setDraft(n,!1),this.refreshView()))}async handleManageTags(){let n=this.getSelectedFiles();if(n.length===0)return;let e=new X(this.app,n);e.onClose=()=>{this.show(),this.refreshView()},e.open()}async handleSetProperty(){let n=this.getSelectedFiles();if(n.length===0)return;let e=new J(this.app,n);e.onClose=()=>{this.show(),this.refreshView()},e.open()}async handleRemoveProperty(){let n=this.getSelectedFiles();if(n.length===0)return;let e=new ee(this.app,n);e.onClose=()=>{this.show(),this.refreshView()},e.open()}async handleDelete(){let n=this.getSelectedFiles();if(n.length!==0)if(this.plugin.settings.confirmDeletions){let e=await de(this.app,n,this.plugin.settings);new se(this.app,e,()=>{this.clearSelection(),this.refreshView()}).open()}else{let e=await de(this.app,n,this.plugin.settings);await te(this.app,e),this.clearSelection(),this.refreshView()}}recreate(){let n=this.toolbarEl&&this.toolbarEl.style.display!=="none"&&this.toolbarEl.style.opacity!=="0",e=0;if(this.countEl&&this.countEl.textContent){let s=this.countEl.textContent.match(/\d+/);s&&(e=parseInt(s[0],10))}this.destroy(),this.createToolbar(),n&&this.toolbarEl&&e>0&&(this.updateCount(e),this.show())}destroy(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null);let n=this.containerObserver;n&&(n.disconnect(),this.containerObserver=null),this.toolbarEl&&(this.toolbarEl.remove(),this.toolbarEl=null)}};var ae="bases-cms",ne=class extends _.BasesView{constructor(e,s,t){super(e);this.type=ae;this.selectedFiles=new Set;this.snippets={};this.images={};this.hasImageAvailable={};this.updateLayoutRef={current:null};this.displayedCount=50;this.isLoading=!1;this.scrollListener=null;this.scrollThrottleTimeout=null;this.resizeObserver=null;this.propertyObservers=[];this.bulkToolbar=null;this.isRefreshingWithSelection=!1;this.currentBaseIdentifier=null;this.containerEl=s,this.plugin=t,this.cardRenderer=new K(this.app,this.plugin,this.propertyObservers,this.updateLayoutRef,void 0,e),this.containerEl.addClass("bases-cms"),this.containerEl.addClass("bases-cms-container"),this.containerEl.style.overflowY="auto",this.containerEl.style.overflowX="hidden",this.containerEl.style.height="100%";let a=this.app.isMobile;this.displayedCount=a?25:50,this.setupNewNoteInterceptor(),this.setupViewSwitchListener()}setupViewSwitchListener(){let e=null,s=()=>{e||(e=new MutationObserver(c=>{if(this.selectedFiles.size!==0){for(let h of c)if(h.type==="childList"&&h.removedNodes.length>0){let m=!1;for(let p of this.selectedFiles)if(this.containerEl.querySelector(`[data-path="${p}"]`)){m=!0;break}let u=this.containerEl.querySelectorAll(".card[data-path]");if(!m||u.length===0){this.selectedFiles.clear(),this.updateSelectionUI();break}}}}),this.containerEl&&e.observe(this.containerEl,{childList:!0,subtree:!0}))},t=()=>{if(e){e.disconnect(),e=null,this.selectedFiles.size>0&&this.selectedFiles.clear(),this.updateSelectionUI(),this.bulkToolbar&&this.bulkToolbar.hide();let c=this.containerEl.querySelector(".bases-cms-bulk-toolbar");c&&(c.style.display="none",c.style.opacity="0")}},a=()=>{try{let c=this.config;if(c!=null&&c.getName)return c.getName();if(c!=null&&c.name)return String(c.name);let h=this;if(h.controller){let m=h.controller;if(m!=null&&m.getBaseName)return m.getBaseName();if(m!=null&&m.baseName)return String(m.baseName)}if(this.data){let m=this.data;if(m.baseName)return String(m.baseName)}}catch(c){}return null},i=null,r=()=>{if(this.selectedFiles.size===0){i!==null&&(window.clearInterval(i),i=null);return}let c=a();if(this.currentBaseIdentifier!==null&&c!==null&&this.currentBaseIdentifier!==c){this.selectedFiles.clear(),this.updateSelectionUI(),t(),i!==null&&(window.clearInterval(i),i=null);return}this.containerEl.querySelectorAll(".card[data-path]").length===0&&(this.selectedFiles.clear(),this.updateSelectionUI())},l=this.handleSelectionChange.bind(this);this.handleSelectionChange=(c,h)=>{if(l(c,h),this.selectedFiles.size>0)this.currentBaseIdentifier===null&&(this.currentBaseIdentifier=a()),s(),i===null&&(i=window.setInterval(r,500));else{this.currentBaseIdentifier=null,t(),i!==null&&(window.clearInterval(i),i=null),this.bulkToolbar&&this.bulkToolbar.hide();let m=this.containerEl.querySelector(".bases-cms-bulk-toolbar");m&&(m.style.display="none",m.style.opacity="0")}},this.register(()=>{t(),i!==null&&window.clearInterval(i)})}setupNewNoteInterceptor(){let e=async i=>{var p;let r=i.target,l=r.closest(".bases-toolbar-new-item-menu .text-icon-button, .bases-toolbar-new-item-menu");if(!l||r.closest(".bases-cms-bulk-toolbar, .bases-cms-container .card"))return;console.log("[CMS View] New button clicked!",l);let c=this.app.workspace.getLeavesOfType(ae).find(d=>{let g=d.view;return g&&g.containerEl===this.containerEl}),h=this.app.workspace.activeLeaf;if(!(c&&h&&c===h)){console.log("[CMS View] Not our active view, skipping. Active leaf:",h,"Our leaf:",c);return}let u=V(this.config,this.plugin.settings);if(console.log("[CMS View] Settings:",{customizeNewButton:u.customizeNewButton,newNoteLocation:u.newNoteLocation}),u.customizeNewButton){i.preventDefault(),i.stopPropagation(),i.stopImmediatePropagation();let d=((p=u.newNoteLocation)==null?void 0:p.trim())||"";if(d===""){console.log("[CMS View] Using Obsidian default new note location");let g=this.app.vault.config,b=(g==null?void 0:g.newFileLocation)||"folder",y=(g==null?void 0:g.newFileFolderPath)||"";console.log("[CMS View] Obsidian config:",{newFileLocation:b,newFileFolderPath:y});let w="Untitled.md";if(b==="folder"&&y)w=`${y}/Untitled.md`;else if(b==="current"){let E=this.app.workspace.getActiveFile();E&&E.parent&&(w=`${E.parent.path}/Untitled.md`)}else b==="root"&&(w="Untitled.md");console.log("[CMS View] Creating file at:",w);let S=await this.app.vault.create(w,"");await this.app.workspace.openLinkText(S.path,"",!1);return}if(d==="/"||d.replace(/\//g,"")===""){console.log("[CMS View] Creating note in vault root");try{let g=await this.app.vault.create("Untitled.md","");await this.app.workspace.openLinkText(g.path,"",!1)}catch(g){console.error("[CMS View] Error creating new note:",g)}return}console.log("[CMS View] Intercepting and creating note in:",d);try{let g=d.replace(/^\/+|\/+$/g,"");console.log("[CMS View] Folder path:",g);let b=this.app.vault.getAbstractFileByPath(g);if((!b||!("children"in b))&&(console.log("[CMS View] Folder does not exist, creating:",g),await this.app.vault.createFolder(g),b=this.app.vault.getAbstractFileByPath(g)),b&&"children"in b){let y=await this.app.vault.create(`${g}/Untitled.md`,"");console.log("[CMS View] Created new file:",y.path),await this.app.workspace.openLinkText(y.path,"",!1)}else console.error("[CMS View] Failed to create or access folder:",g)}catch(g){console.error("[CMS View] Error creating new note:",g)}}else console.log("[CMS View] Custom new button not enabled")},s=i=>{let r=i.target,l=r.closest(".bases-toolbar-new-item-menu .text-icon-button, .bases-toolbar-new-item-menu");if(!l||r.closest(".bases-cms-bulk-toolbar, .bases-cms-container .card"))return;let c=this.app.workspace.activeLeaf,h=c==null?void 0:c.view,m=c==null?void 0:c.containerEl;if(!(h&&(h.containerEl===this.containerEl||h===this||l.closest(".workspace-leaf")===m)))return;let p=V(this.config,this.plugin.settings);p.customizeNewButton&&(i.preventDefault(),i.stopPropagation(),i.stopImmediatePropagation(),(async()=>{var y;let d=((y=p.newNoteLocation)==null?void 0:y.trim())||"";if(d===""){let w=this.app.vault.config,S=(w==null?void 0:w.newFileLocation)||"folder",E=(w==null?void 0:w.newFileFolderPath)||"";console.log("[CMS View] Obsidian config:",{newFileLocation:S,newFileFolderPath:E});let P="Untitled.md";if(S==="folder"&&E)P=`${E}/Untitled.md`;else if(S==="current"){let T=this.app.workspace.getActiveFile();T&&T.parent&&(P=`${T.parent.path}/Untitled.md`)}else S==="root"&&(P="Untitled.md");console.log("[CMS View] Creating file at:",P);let F=await this.app.vault.create(P,"");await this.app.workspace.openLinkText(F.path,"",!1);return}if(d==="/"||d.replace(/\//g,"")===""){let w=await this.app.vault.create("Untitled.md","");await this.app.workspace.openLinkText(w.path,"",!1);return}let g=d.replace(/^\/+|\/+$/g,""),b=this.app.vault.getAbstractFileByPath(g);if((!b||!("children"in b))&&(await this.app.vault.createFolder(g),b=this.app.vault.getAbstractFileByPath(g)),b&&"children"in b){let w=await this.app.vault.create(`${g}/Untitled.md`,"");await this.app.workspace.openLinkText(w.path,"",!1)}})())};document.addEventListener("click",s,!0);let t=new MutationObserver(()=>{document.querySelectorAll(".bases-toolbar-new-item-menu .text-icon-button, .bases-toolbar-new-item-menu").forEach(r=>{r.__cmsIntercepted||(r.__cmsIntercepted=!0,r.addEventListener("click",s,!0))})});t.observe(document.body,{childList:!0,subtree:!0}),document.querySelectorAll(".bases-toolbar-new-item-menu .text-icon-button, .bases-toolbar-new-item-menu").forEach(i=>{i.__cmsIntercepted||(i.__cmsIntercepted=!0,i.addEventListener("click",s,!0))}),this.register(()=>{document.removeEventListener("click",s,!0),t.disconnect()})}onDataUpdated(){let e=this.app.workspace.activeLeaf;if(e&&this.selectedFiles.size>0){let t=e.view;if(t&&t!==this){if(!(this.containerEl&&this.containerEl.isConnected&&this.containerEl.offsetParent!==null)){this.selectedFiles.clear(),this.updateSelectionUI();return}let i=t.containerEl;if(!i||!i.contains(this.containerEl)){this.selectedFiles.clear(),this.updateSelectionUI();return}}}if(!(this.containerEl&&this.containerEl.isConnected&&this.containerEl.offsetParent!==null)&&this.selectedFiles.size>0){this.selectedFiles.clear(),this.updateSelectionUI();return}(async()=>{var F;let t=this.data.groupedData,a=this.data.data;this.cardRenderer.basesConfig=this.config;let i=V(this.config,this.plugin.settings),r=this.containerEl.clientWidth,l=i.cardSize,c=1,h=8,m=Math.max(c,Math.floor((r+h)/(l+h))),u=(r-h*(m-1))/m;this.containerEl.style.setProperty("--card-min-width",`${u}px`),this.containerEl.style.setProperty("--grid-columns",String(m)),this.containerEl.style.setProperty("--dynamic-views-image-aspect-ratio",String(i.imageAspectRatio));let p=this.containerEl.scrollTop,d=this.getSortMethod(),g=t.map(T=>({group:T,entries:[...T.entries]})),b=[],y=this.displayedCount;for(let T of g){if(y<=0)break;let v=Math.min(T.entries.length,y);b.push(...T.entries.slice(0,v)),y-=v}if(i.imageFormat!=="none"){let T=a.filter(f=>!(f.file.path in this.images)).map(f=>{let k=this.app.vault.getAbstractFileByPath(f.file.path);if(!(k instanceof _.TFile))return null;let D=ye(f,i.imageProperty);return{path:f.file.path,file:k,imagePropertyValues:D}}).filter(f=>f!==null),v=T.filter(f=>b.some(k=>k.file.path===f.path)),C=T.filter(f=>!b.some(k=>k.file.path===f.path));if(v.length>0&&await pe(v,i.fallbackToEmbeds,this.app,this.images,this.hasImageAvailable,i.thumbnailCacheSize,i.cardSize,i.imageFormat),C.length>0&&pe(C,i.fallbackToEmbeds,this.app,this.images,this.hasImageAvailable,i.thumbnailCacheSize,i.cardSize,i.imageFormat),i.fallbackToEmbeds){let f=T.filter(k=>!(k.path in this.images)&&!this.hasImageAvailable[k.path]);f.length>0&&Fe(f,this.app,this.images,this.hasImageAvailable).then(()=>{f.forEach(k=>{var D;if(k.path in this.images){let M=this.containerEl.querySelector(`.card[data-path="${k.path}"]`);if(M){let U=this.images[k.path],B=Array.isArray(U)?U[0]:U;if(B){let j=M.querySelector("img");if(j){if(j.src!==B){j.src=B;let O=j.parentElement;O&&O.classList.contains("image-embed")&&O.style.setProperty("--cover-image-url",`url("${B}")`)}}else{let O=M.querySelector(".card-cover-placeholder, .card-thumbnail-placeholder");if(O){let qe=O.classList.contains("card-cover-placeholder")?"card-cover":"card-thumbnail",ue=(D=O.parentElement)==null?void 0:D.createDiv(qe);if(ue){let ge=ue.createDiv("image-embed");j=ge.createEl("img",{attr:{src:B,alt:"",decoding:"async"}}),ge.style.setProperty("--cover-image-url",`url("${B}")`),O.remove()}}}}}}})})}}if(i.showTextPreview){let T=b.filter(v=>!(v.file.path in this.snippets)).map(v=>{let C=this.app.vault.getAbstractFileByPath(v.file.path);if(!(C instanceof _.TFile))return null;let f=A(v,i.descriptionProperty);return{path:v.file.path,file:C,descriptionData:f==null?void 0:f.data}}).filter(v=>v!==null);Ae(T,i.fallbackToContent,!1,this.app,this.snippets).then(()=>{T.forEach(v=>{if(v.path in this.snippets&&this.snippets[v.path]){let C=this.containerEl.querySelector(`[data-path="${v.path}"]`);if(C){let f=C.__textPreviewEl;f&&(!f.textContent||f.textContent.trim().length===0)&&f.setText(this.snippets[v.path])}}})})}let w=null;if(this.isRefreshingWithSelection&&this.bulkToolbar){let T=this.containerEl.querySelector(".bases-cms-bulk-toolbar");T&&(w=T,w.remove())}this.containerEl.empty(),this.propertyObservers.forEach(T=>T.disconnect()),this.propertyObservers=[];let S=this.containerEl.createDiv("bases-cms-grid"),E=0,P=[];for(let T of g){if(E>=this.displayedCount)break;let v=Math.min(T.entries.length,this.displayedCount-E);if(v===0)continue;let C=T.entries.slice(0,v),f=S.createDiv("bases-cms-group");if(T.group.hasKey()){let M=f.createDiv("bases-cms-group-heading").createDiv("bases-cms-group-value"),U=((F=T.group.key)==null?void 0:F.toString())||"";M.setText(U)}let k=we(C,i,d,!1,this.snippets,this.images,this.hasImageAvailable);for(let D=0;D<k.length;D++){let M=k[D],U=C[D],B=this.renderCard(f,M,U,E+D,i);B&&P.push(B)}E+=v}P.length>0&&requestAnimationFrame(()=>{for(let{img:T,src:v}of P)T.src=v}),p>0&&(this.containerEl.scrollTop=p),this.setupInfiniteScroll(a.length),this.resizeObserver||(this.resizeObserver=new ResizeObserver(()=>{let T=this.containerEl.clientWidth,v=V(this.config,this.plugin.settings),C=v.cardSize,f=1,k=8,D=Math.max(f,Math.floor((T+k)/(C+k))),M=(T-k*(D-1))/D;this.containerEl.style.setProperty("--card-min-width",`${M}px`),this.containerEl.style.setProperty("--grid-columns",String(D)),this.containerEl.style.setProperty("--dynamic-views-image-aspect-ratio",String(v.imageAspectRatio))}),this.resizeObserver.observe(this.containerEl)),w&&this.bulkToolbar&&(this.containerEl.appendChild(w),this.bulkToolbar.toolbarEl=w),this.isRefreshingWithSelection?(this.containerEl.querySelectorAll(".card").forEach(v=>{let C=v.getAttribute("data-path"),f=v.querySelector('input[type="checkbox"].selection-checkbox');if(C){let k=this.selectedFiles.has(C);k?v.addClass("selected"):v.removeClass("selected"),f&&(f.checked=k)}}),w&&this.bulkToolbar&&(this.bulkToolbar.show(),this.bulkToolbar.updateCount(this.selectedFiles.size))):this.updateSelectionUI(),this.isLoading=!1})()}renderCard(e,s,t,a,i){let r=this.selectedFiles.has(s.path);return this.cardRenderer.renderCard(e,s,t,i,this,r,(l,c)=>{this.handleSelectionChange(l,c)},(l,c,h)=>{this.handlePropertyToggle(l,c,h)})}getSortMethod(){let e=this.config.getSort();if(e&&e.length>0){let s=e[0],t=s.property,a=s.direction.toLowerCase();if(t.includes("ctime"))return`ctime-${a}`;if(t.includes("mtime"))return`mtime-${a}`}return"mtime-desc"}setupInfiniteScroll(e){this.scrollListener&&(this.containerEl.removeEventListener("scroll",this.scrollListener),this.scrollListener=null),!(this.displayedCount>=e)&&(this.scrollListener=()=>{if(this.scrollThrottleTimeout!==null||this.isLoading)return;let s=this.containerEl.scrollTop,t=this.containerEl.scrollHeight,a=this.containerEl.clientHeight,i=t-(s+a),l=this.app.isMobile?1:2,c=a*l;if(i<c&&this.displayedCount<e){this.isLoading=!0;let h=50;this.displayedCount=Math.min(this.displayedCount+h,e),this.onDataUpdated()}this.scrollThrottleTimeout=window.setTimeout(()=>{this.scrollThrottleTimeout=null},100)},this.containerEl.addEventListener("scroll",this.scrollListener),this.register(()=>{this.scrollListener&&this.containerEl.removeEventListener("scroll",this.scrollListener),this.scrollThrottleTimeout!==null&&window.clearTimeout(this.scrollThrottleTimeout)}))}handleSelectionChange(e,s){if(s?this.selectedFiles.add(e):this.selectedFiles.delete(e),this.updateSelectionUI(),this.selectedFiles.size===0&&this.bulkToolbar){this.bulkToolbar.hide();let t=this.containerEl.querySelector(".bases-cms-bulk-toolbar");t&&(t.style.display="none",t.style.opacity="0")}}async handlePropertyToggle(e,s,t){try{let a=this.app.vault.getAbstractFileByPath(e);if(!(a instanceof _.TFile))return;let i=s.startsWith("note.")?s.substring(5):s,r=V(this.config,this.plugin.settings),l=r.showDraftStatus&&i==="draft",c=!1;if(l)if(r.draftStatusUseFilenamePrefix){let h=a.basename,m=h.startsWith("_"),p=a.path.split("/");if(t===!0){if(!m){let d=`_${h}${a.extension?`.${a.extension}`:""}`;p[p.length-1]=d;let g=p.join("/");await this.app.fileManager.renameFile(a,g),c=!0}}else if(m){let d=h.substring(1)+(a.extension?`.${a.extension}`:"");p[p.length-1]=d;let g=p.join("/");await this.app.fileManager.renameFile(a,g),c=!0}}else{let h=r.draftStatusProperty&&r.draftStatusProperty.trim()?r.draftStatusProperty.startsWith("note.")?r.draftStatusProperty.substring(5):r.draftStatusProperty:"draft";await this.app.fileManager.processFrontMatter(a,m=>{m[h]=t}),c=!0}else await this.app.fileManager.processFrontMatter(a,h=>{h[i]=t}),c=!0;c&&requestAnimationFrame(()=>{setTimeout(()=>{try{this.onDataUpdated()}catch(h){console.error("Error refreshing view after property toggle:",h)}},100)})}catch(a){console.error("Error toggling property:",a)}}selectAll(){this.containerEl.querySelectorAll(".bases-cms-card").forEach(s=>{let t=s.getAttribute("data-path");t&&this.selectedFiles.add(t)}),this.updateSelectionUI()}deselectAll(){this.selectedFiles.clear(),this.updateSelectionUI()}refreshToolbar(){if(this.bulkToolbar){let e=this.selectedFiles.size;this.bulkToolbar.recreate(),e>0&&this.bulkToolbar.updateCount(e)}}updateSelectionUI(){if(this.containerEl.querySelectorAll(".card").forEach(s=>{let t=s.getAttribute("data-path"),a=s.querySelector('input[type="checkbox"].selection-checkbox');if(t){let i=this.selectedFiles.has(t);i?s.addClass("selected"):s.removeClass("selected"),a&&(a.checked=i)}}),this.selectedFiles.size>0)document.querySelectorAll(".bases-cms-bulk-toolbar").forEach(t=>{let a=t.__bulkToolbarInstance;(!a||a!==this.bulkToolbar)&&t.remove()}),this.bulkToolbar||(this.bulkToolbar=new ie(this.app,this.plugin,this.containerEl,()=>Array.from(this.selectedFiles),()=>{this.selectedFiles.clear(),this.updateSelectionUI()},()=>{let t=Array.from(this.selectedFiles);this.isRefreshingWithSelection=!0,this.bulkToolbar&&t.length>0&&this.bulkToolbar.show(),this.onDataUpdated(),setTimeout(()=>{t.forEach(a=>{this.app.vault.getAbstractFileByPath(a)&&this.selectedFiles.add(a)}),this.isRefreshingWithSelection=!1,this.updateSelectionUI(),this.selectedFiles.size>0&&this.bulkToolbar&&(this.bulkToolbar.show(),this.bulkToolbar.updateCount(this.selectedFiles.size)),setTimeout(()=>{this.selectedFiles.size>0&&this.bulkToolbar&&(this.bulkToolbar.show(),this.bulkToolbar.updateCount(this.selectedFiles.size))},100)},250)},()=>{this.selectAll()})),this.bulkToolbar.updateCount(this.selectedFiles.size),this.bulkToolbar.show();else if(this.bulkToolbar&&!this.isRefreshingWithSelection){this.bulkToolbar.hide();let s=this.containerEl.querySelector(".bases-cms-bulk-toolbar");s&&(s.style.display="none",s.style.opacity="0")}}onClose(){this.resizeObserver&&this.resizeObserver.disconnect(),this.propertyObservers.forEach(s=>s.disconnect()),this.propertyObservers=[],this.bulkToolbar&&this.bulkToolbar.destroy(),this.selectedFiles.clear(),document.querySelectorAll(".bases-cms-bulk-toolbar").forEach(s=>s.remove()),this.plugin&&typeof this.plugin.removeView=="function"&&this.plugin.removeView(this)}async onNew(){let e=V(this.config,this.plugin.settings);if(e.customizeNewButton&&e.newNoteLocation&&e.newNoteLocation.trim()!=="")try{let s=e.newNoteLocation.trim().replace(/^\/+|\/+$/g,""),t=this.app.vault.getAbstractFileByPath(s);if((!t||!("children"in t))&&(await this.app.vault.createFolder(s),t=this.app.vault.getAbstractFileByPath(s)),t&&"children"in t){let a=await this.app.vault.create(`${s}/Untitled.md`,"");return await this.app.workspace.openLinkText(a.path,"",!1),!0}}catch(s){console.error("[CMS View] Error creating new note:",s)}return!1}};var ze={confirmBulkOperations:!0,deleteParentFolder:!1,deleteParentFolderFilename:"index",deleteUniqueAttachments:!1,confirmDeletions:!0,useHomeIcon:!1,thumbnailCacheSize:"balanced",enableQuickEdit:!1,quickEditCommand:"",quickEditCommandName:"",showToolbarSelectAll:!0,showToolbarClear:!0,showToolbarDraft:!0,showToolbarPublish:!0,showToolbarTags:!0,showToolbarSet:!0,showToolbarRemove:!0,showToolbarDelete:!0};var oe=class extends $e.Plugin{constructor(){super(...arguments);this.activeViews=new Set}async onload(){await this.loadSettings(),this.addSettingTab(new Y(this.app,this));try{this.registerBasesView(ae,{name:"CMS",icon:this.settings.useHomeIcon?"lucide-home":"lucide-blocks",factory:(e,s)=>{let t=new ne(e,s,this);return this.activeViews.add(t),t},options:this.getCMSViewOptions()})}catch(e){console.log("Bases CMS: Base plugin not available")}}onunload(){}async loadSettings(){this.settings=Object.assign({},ze,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}refreshAllToolbars(){let e=[];this.activeViews.forEach(s=>{let t=s.containerEl;(!t||!t.parentElement)&&e.push(s)}),e.forEach(s=>this.activeViews.delete(s)),this.activeViews.forEach(s=>{s&&typeof s.refreshToolbar=="function"&&s.refreshToolbar()})}removeView(e){this.activeViews.delete(e)}getCMSViewOptions(){let{getCMSViewOptions:e}=(le(),fe(Te));return e}};
