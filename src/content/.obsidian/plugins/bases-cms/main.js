/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var ve=Object.defineProperty;var it=Object.getOwnPropertyDescriptor;var nt=Object.getOwnPropertyNames;var at=Object.prototype.hasOwnProperty;var G=(o,i)=>()=>(o&&(i=o(o=0)),i);var Q=(o,i)=>{for(var e in i)ve(o,e,{get:i[e],enumerable:!0})},ot=(o,i,e,t)=>{if(i&&typeof i=="object"||typeof i=="function")for(let s of nt(i))!at.call(o,s)&&s!==e&&ve(o,s,{get:()=>i[s],enumerable:!(t=it(i,s))||t.enumerable});return o};var Fe=o=>ot(ve({},"__esModule",{value:!0}),o);var Le={};Q(Le,{getCMSViewOptions:()=>pt,readCMSSettings:()=>D});function D(o,i){var e,t,s,a,n,r,l,c,p,d,f,h,u,v,w,C;return{titleProperty:o.get("titleProperty")||"",descriptionProperty:o.get("descriptionProperty")||"",imageProperty:o.get("imageProperty")||"",showTitle:(e=o.get("showTitle"))!=null?e:!0,showDate:(t=o.get("showDate"))!=null?t:!1,dateProperty:o.get("dateProperty")||"",showTextPreview:(s=o.get("showTextPreview"))!=null?s:!0,fallbackToContent:(a=o.get("fallbackToContent"))!=null?a:!0,fallbackToEmbeds:(n=o.get("fallbackToEmbeds"))!=null?n:!1,propertyDisplay1:o.get("propertyDisplay1")||"",propertyDisplay2:o.get("propertyDisplay2")||"",propertyDisplay3:o.get("propertyDisplay3")||"",propertyDisplay4:o.get("propertyDisplay4")||"",propertyLayout12SideBySide:(r=o.get("propertyLayout12SideBySide"))!=null?r:!1,propertyLayout34SideBySide:(l=o.get("propertyLayout34SideBySide"))!=null?l:!1,imageFormat:o.get("imageFormat")||"thumbnail",propertyLabels:o.get("propertyLabels")||"hide",showDraftStatus:(c=o.get("showDraftStatus"))!=null?c:!1,draftStatusProperty:o.get("draftStatusProperty")||"",draftStatusReverse:(p=o.get("draftStatusReverse"))!=null?p:!1,draftStatusUseFilenamePrefix:(d=o.get("draftStatusUseFilenamePrefix"))!=null?d:!1,showTags:(f=o.get("showTags"))!=null?f:!1,tagsProperty:o.get("tagsProperty")||"",maxTagsToShow:(h=o.get("maxTagsToShow"))!=null?h:3,customizeNewButton:(u=o.get("customizeNewButton"))!=null?u:!1,newNoteLocation:o.get("newNoteLocation")||"",hideQuickEditIcon:(v=o.get("hideQuickEditIcon"))!=null?v:!1,cardSize:(w=o.get("cardSize"))!=null?w:250,imageAspectRatio:(C=o.get("imageAspectRatio"))!=null?C:.55}}function pt(){return[{type:"slider",displayName:"Card size",key:"cardSize",min:50,max:800,step:10,default:250},{type:"dropdown",displayName:"Card image",key:"imageFormat",options:{none:"No image",thumbnail:"Thumbnail",cover:"Cover"},default:"thumbnail"},{type:"slider",displayName:"Image aspect ratio",key:"imageAspectRatio",min:.1,max:2,step:.05,default:.55,showWhen:{key:"imageFormat",value:"cover"}},{type:"property",displayName:"Image property",key:"imageProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Use in-note images if image property unavailable",key:"fallbackToEmbeds",default:!1},{type:"toggle",displayName:"Show title",key:"showTitle",default:!0},{type:"property",displayName:"Title property",key:"titleProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show date",key:"showDate",default:!1},{type:"property",displayName:"Date property",key:"dateProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show draft status",key:"showDraftStatus",default:!1},{type:"property",displayName:"Draft status property",key:"draftStatusProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Reverse logic",key:"draftStatusReverse",default:!1},{type:"toggle",displayName:"Filename underscore prefix as draft indicator",key:"draftStatusUseFilenamePrefix",default:!1},{type:"toggle",displayName:"Show text preview",key:"showTextPreview",default:!0},{type:"property",displayName:"Text preview property",key:"descriptionProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Use note content if text preview property unavailable",key:"fallbackToContent",default:!0},{type:"toggle",displayName:"Show tags",key:"showTags",default:!1},{type:"property",displayName:"Tags property",key:"tagsProperty",placeholder:"Select property",default:""},{type:"slider",displayName:"Maximum tags to show",key:"maxTagsToShow",min:1,max:50,step:1,default:3,showWhen:{key:"showTags",value:!0}},{type:"property",displayName:"First property",key:"propertyDisplay1",placeholder:"Select property",default:""},{type:"property",displayName:"Second property",key:"propertyDisplay2",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show first and second properties side by side",key:"propertyLayout12SideBySide",default:!1},{type:"property",displayName:"Third property",key:"propertyDisplay3",placeholder:"Select property",default:""},{type:"property",displayName:"Fourth property",key:"propertyDisplay4",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show third and fourth properties side by side",key:"propertyLayout34SideBySide",default:!1},{type:"dropdown",displayName:"Show property labels",key:"propertyLabels",options:{hide:"Hide",inline:"Inline",above:"On top"},default:"hide"},{type:"toggle",displayName:"Customize new button behavior",key:"customizeNewButton",default:!1},{type:"text",displayName:"Default location for new notes",key:"newNoteLocation",placeholder:"Simply use / for vault folder",default:""},{type:"toggle",displayName:"Hide quick edit icon",key:"hideQuickEditIcon",default:!1}]}var $=G(()=>{"use strict"});function We(o,i){var s;let e=[],t=o.vault.getAbstractFileByPath(i.path);if(t instanceof L.TFile){let a=o.metadataCache.getFileCache(t),n=(a==null?void 0:a.embeds)||[];for(let l of n){let c=o.metadataCache.getFirstLinkpathDest(l.link,i.path);c instanceof L.TFile&&e.push(c)}let r=a==null?void 0:a.frontmatter;if(r){let l=["image","imageOG","cover","thumbnail"],c=["avif","bmp","gif","jpeg","jpg","png","svg","webp"];for(let p of l){let d=r[p];if(!d)continue;let f=Array.isArray(d)?d:[d];for(let h of f){if(typeof h!="string")continue;let u=h.replace(/^!?\[\[([^\]]+)\]\]$/,"$1").trim();if(!u||u.startsWith("http://")||u.startsWith("https://"))continue;let v=o.metadataCache.getFirstLinkpathDest(u,i.path);if(!v&&u.startsWith("./")){let w=u.substring(2),C=(s=i.parent)!=null&&s.path?`${i.parent.path}/${w}`:w,g=o.vault.getAbstractFileByPath(C);g instanceof L.TFile&&(v=g)}if(!v){let w=o.vault.getAbstractFileByPath(u);w instanceof L.TFile&&(v=w)}v&&c.includes(v.extension)&&e.push(v)}}}}return e}function je(o,i){let e=[];for(let t of i.children)t instanceof L.TFile&&t.extension==="md"?e.push(...We(o,t)):t instanceof L.TFolder&&e.push(...je(o,t));return e}async function Pt(o,i,e,t){let s=o.vault.getMarkdownFiles().filter(l=>l.path!==e.path),a=i.path,n=i.name,r=i.basename;for(let l of s){if(t&&l.path.startsWith(t.path+"/"))continue;let c=await o.vault.read(l);if(c.includes(a)||c.includes(n)||c.includes(r)||c.includes(`![[${n}]]`)||c.includes(`[[${n}]]`)||c.includes(`(${n})`)||c.includes(`(${a})`))return!0}return!1}async function Ge(o,i,e){let t=[];t.push(...We(o,i)),e&&t.push(...je(o,e));let s=Array.from(new Set(t.map(n=>n.path))).map(n=>o.vault.getAbstractFileByPath(n)).filter(n=>n instanceof L.TFile),a=[];for(let n of s)await Pt(o,n,i,e)||a.push(n);return a}var L,Qe=G(()=>{"use strict";L=require("obsidian")});var Je={};Q(Je,{executeSmartDeletion:()=>H,isFolderBasedContent:()=>Ke,prepareDeletionPreview:()=>oe,shouldDeleteParentFolder:()=>ke});function Ke(o,i){let e=i.deleteParentFolderFilename||"index";return o.basename===e&&o.parent!==null}function ke(o,i){return i.deleteParentFolder&&Ke(o,i)}async function oe(o,i,e){let t=[],s=[],a=[];for(let l of i){let c=o.vault.getAbstractFileByPath(l);if(c instanceof N.TFile){if(ke(c,e)){let p=c.parent;if(p&&!s.includes(p)){s.push(p);let d=p.children.filter(f=>f instanceof N.TFile);t.push(...d)}}else t.push(c);if(e.deleteUniqueAttachments){let p=ke(c,e)&&c.parent||void 0,d=await Ge(o,c,p);a.push(...d)}}}let n=Array.from(new Set(t.map(l=>l.path))).map(l=>o.vault.getAbstractFileByPath(l)).filter(l=>l instanceof N.TFile),r=Array.from(new Set(a.map(l=>l.path))).map(l=>o.vault.getAbstractFileByPath(l)).filter(l=>l instanceof N.TFile);return{filesToDelete:n,foldersToDelete:Array.from(new Set(s)),attachmentsToDelete:r}}async function H(o,i){let e=0,t=0;for(let s of i.filesToDelete)try{await o.fileManager.trashFile(s),e++}catch(a){console.error(`Error deleting file ${s.path}:`,a),t++}for(let s of i.attachmentsToDelete)try{await o.fileManager.trashFile(s),e++}catch(a){console.error(`Error deleting attachment ${s.path}:`,a),t++}for(let s of i.foldersToDelete)try{await o.fileManager.trashFile(s),e++}catch(a){console.error(`Error deleting folder ${s.path}:`,a),t++}t>0?new N.Notice(`Deleted ${e} items, ${t} errors occurred`):new N.Notice(`Successfully deleted ${e} item${e!==1?"s":""}`)}var N,re=G(()=>{"use strict";N=require("obsidian");Qe()});var Ze={};Q(Ze,{DeletionPreviewModal:()=>U});var le,U,Pe=G(()=>{"use strict";le=require("obsidian");re();U=class extends le.Modal{constructor(e,t,s){super(e);this.preview=t,this.onConfirm=s}onOpen(){let{contentEl:e}=this;if(e.empty(),new le.Setting(e).setName("Confirm deletion").setHeading(),e.createEl("p",{text:"The following items will be deleted:",cls:"bases-cms-deletion-warning"}),this.preview.filesToDelete.length>0){e.createEl("h3",{text:`Files (${this.preview.filesToDelete.length})`});let n=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let r of this.preview.filesToDelete.slice(0,20))n.createEl("li").setText(r.path);this.preview.filesToDelete.length>20&&n.createEl("li",{text:`... and ${this.preview.filesToDelete.length-20} more files`})}if(this.preview.foldersToDelete.length>0){e.createEl("h3",{text:`Folders (${this.preview.foldersToDelete.length})`});let n=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let r of this.preview.foldersToDelete)n.createEl("li").setText(r.path)}if(this.preview.attachmentsToDelete.length>0){e.createEl("h3",{text:`Attachments (${this.preview.attachmentsToDelete.length})`});let n=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let r of this.preview.attachmentsToDelete.slice(0,20))n.createEl("li").setText(r.path);this.preview.attachmentsToDelete.length>20&&n.createEl("li",{text:`... and ${this.preview.attachmentsToDelete.length-20} more attachments`})}e.createEl("p",{text:"This action cannot be undone.",cls:"bases-cms-deletion-warning"});let t=e.createDiv();t.addClass("bases-cms-modal-button-container");let s=t.createEl("button");s.setText("Cancel"),s.addEventListener("click",()=>this.close());let a=t.createEl("button");a.setText("Delete"),a.addClass("mod-cta"),a.addClass("destructive"),a.addEventListener("click",()=>{(async()=>(await H(this.app,this.preview),this.onConfirm(),this.close()))()})}onClose(){let{contentEl:e}=this;e.empty()}}});var Dt={};Q(Dt,{default:()=>be});module.exports=Fe(Dt);var st=require("obsidian");var x=require("obsidian");var Ae=require("obsidian"),K=class extends Ae.FuzzySuggestModal{constructor(e,t){super(e);this.onSelect=t}getItems(){let e=this.app.commands,t=new Map;if(e&&typeof e.listCommands=="function")try{let a=e.listCommands();for(let n of a)n&&n.id&&n.name&&!t.has(n.id)&&t.set(n.id,{id:n.id,name:n.name})}catch(a){console.warn("[Bases CMS] Error getting commands via listCommands():",a)}try{let a=e==null?void 0:e.commands;if(a&&typeof a=="object"){let n=Object.values(a);for(let r of n)r&&r.id&&r.name&&!t.has(r.id)&&t.set(r.id,{id:r.id,name:r.name})}}catch(a){console.warn("[Bases CMS] Error getting commands via registry:",a)}try{let a=e==null?void 0:e.commandRegistry;if(a&&typeof a=="object"){let n=Object.values(a);for(let r of n)r&&r.id&&r.name&&!t.has(r.id)&&t.set(r.id,{id:r.id,name:r.name})}}catch(a){console.warn("[Bases CMS] Error getting commands via internal registry:",a)}let s=Array.from(t.values());return s.sort((a,n)=>a.name.localeCompare(n.name)),s}getItemText(e){return e.name}onChooseItem(e,t){this.onSelect(e.id)}renderSuggestion(e,t){let s=e.item;t.createDiv({cls:"suggestion-title",text:s.name})}};var A=require("obsidian"),rt=()=>{if(A.requireApiVersion&&(0,A.requireApiVersion)("1.7.3")&&A.getIconIds)try{return(0,A.getIconIds)()}catch(o){console.warn("[Bases CMS] Error getting icon IDs from Obsidian:",o)}return["settings-2","settings","help-circle","info","star","heart","bookmark","home","search","bell","mail","user","users","folder","file","file-text","image","video","music","calendar","clock","edit","pencil","trash","copy","cut","paste","download","upload","save","share","link","external-link","lock","unlock","eye","eye-off","key","shield","check","x","plus","minus","arrow-left","arrow-right","arrow-up","arrow-down","chevron-left","chevron-right","chevron-up","chevron-down","menu","more-horizontal","more-vertical","grid","list","layout","columns","rows","maximize","minimize","zoom-in","zoom-out","refresh-cw","play","pause","stop","sun","moon","cloud","zap","wand-2","wand","wand-sparkles","palette","brush","sliders","power","wifi","bluetooth","monitor","laptop","smartphone","camera","mic","headphones","code","terminal","terminal-square","github","gitlab","git-branch","git-commit","database","server","cloud-download","cloud-upload","tag","tags","flag","pin","map-pin","compass","globe","rocket","car","bike","robot","apple","windows","linux","chrome","firefox","safari","credit-card","wallet","coins","book","book-open","award","trophy","badge","wrench","tool","package","box","archive","send","reply","forward","mail-open","tag-plus","tag-minus","flag-off","pin-off","map-pin-off","navigation","map","earth","plane","ship","anchor","helicopter","drone","android","keyhole","keys","fingerprint","scan","qr-code","barcode","receipt","piggy-bank","banknote","pencil-line","edit-2","edit-3"]},lt=rt().map(o=>({id:o,name:o.replace(/^lucide-/,"").replace(/-/g," ").replace(/(^\w{1})|(\s+\w{1})/g,i=>i.toUpperCase())})).sort((o,i)=>o.name.localeCompare(i.name)),J=class extends A.FuzzySuggestModal{constructor(e,t){super(e);this.onSelect=t}getItems(){return lt}getItemText(e){return e.name}onChooseItem(e,t){this.onSelect(e.id)}renderSuggestion(e,t){let s=e.item;t.addClass("mod-complex"),t.createDiv({cls:"suggestion-content"}).createDiv({cls:"suggestion-title",text:s.name});let n=t.createDiv({cls:"suggestion-aux"});(0,A.setIcon)(n.createSpan({cls:"suggestion-flair"}),s.id)}};var Z=class extends x.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}refreshActiveToolbars(){let e=this.plugin;e&&typeof e.refreshAllToolbars=="function"&&e.refreshAllToolbars()}display(){let{containerEl:e}=this;e.empty(),new x.Setting(e).setName("Confirm bulk operations").setDesc("Show confirmation dialogs before performing bulk operations.").addToggle(n=>n.setValue(this.plugin.settings.confirmBulkOperations).onChange(r=>{(async()=>(this.plugin.settings.confirmBulkOperations=r,await this.plugin.saveData(this.plugin.settings)))()})),new x.Setting(e).setName("Toolbar buttons").setHeading(),new x.Setting(e).setName("Show select all button").setDesc("Display the select all button in the CMS toolbar.").addToggle(n=>n.setValue(this.plugin.settings.showToolbarSelectAll).onChange(r=>{(async()=>(this.plugin.settings.showToolbarSelectAll=r,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new x.Setting(e).setName("Show clear button").setDesc("Display the clear selection button in the CMS toolbar.").addToggle(n=>n.setValue(this.plugin.settings.showToolbarClear).onChange(r=>{(async()=>(this.plugin.settings.showToolbarClear=r,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new x.Setting(e).setName("Show publish button").setDesc("Display the publish button in the CMS toolbar.").addToggle(n=>n.setValue(this.plugin.settings.showToolbarPublish).onChange(r=>{(async()=>(this.plugin.settings.showToolbarPublish=r,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new x.Setting(e).setName("Show draft button").setDesc("Display the draft button in the CMS toolbar.").addToggle(n=>n.setValue(this.plugin.settings.showToolbarDraft).onChange(r=>{(async()=>(this.plugin.settings.showToolbarDraft=r,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new x.Setting(e).setName("Show tags button").setDesc("Display the tags button in the CMS toolbar.").addToggle(n=>n.setValue(this.plugin.settings.showToolbarTags).onChange(r=>{(async()=>(this.plugin.settings.showToolbarTags=r,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new x.Setting(e).setName("Show set button").setDesc("Display the set property button in the CMS toolbar.").addToggle(n=>n.setValue(this.plugin.settings.showToolbarSet).onChange(r=>{(async()=>(this.plugin.settings.showToolbarSet=r,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new x.Setting(e).setName("Show remove button").setDesc("Display the remove property button in the CMS toolbar.").addToggle(n=>n.setValue(this.plugin.settings.showToolbarRemove).onChange(r=>{(async()=>(this.plugin.settings.showToolbarRemove=r,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new x.Setting(e).setName("Show delete button").setDesc("Display the delete button in the CMS toolbar.").addToggle(n=>n.setValue(this.plugin.settings.showToolbarDelete).onChange(r=>{(async()=>(this.plugin.settings.showToolbarDelete=r,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new x.Setting(e).setName("Deletions").setHeading(),new x.Setting(e).setName("Delete parent folder for specific file name").setDesc("When enabled, deleting a note will delete its parent folder and all its contents if the note file name matches the specified name.").addToggle(n=>n.setValue(this.plugin.settings.deleteParentFolder).onChange(r=>{(async()=>(this.plugin.settings.deleteParentFolder=r,await this.plugin.saveData(this.plugin.settings)))()})),new x.Setting(e).setName("Folder deletion file name").setDesc("File name that triggers parent folder deletion.").addText(n=>n.setPlaceholder("index").setValue(this.plugin.settings.deleteParentFolderFilename).onChange(r=>{(async()=>(this.plugin.settings.deleteParentFolderFilename=r,await this.plugin.saveData(this.plugin.settings)))()})).setDisabled(!this.plugin.settings.deleteParentFolder),new x.Setting(e).setName("Delete associated unique attachments").setDesc("When deleting a note, automatically delete attachments that are only used by that note. Attachments used by other notes will be preserved.").addToggle(n=>n.setValue(this.plugin.settings.deleteUniqueAttachments).onChange(r=>{(async()=>(this.plugin.settings.deleteUniqueAttachments=r,await this.plugin.saveData(this.plugin.settings)))()})),new x.Setting(e).setName("Confirm deletions").setDesc("Show confirmation dialog before deleting files.").addToggle(n=>n.setValue(this.plugin.settings.confirmDeletions).onChange(r=>{(async()=>(this.plugin.settings.confirmDeletions=r,await this.plugin.saveData(this.plugin.settings)))()})),new x.Setting(e).setName("Appearance").setHeading(),new x.Setting(e).setName("Use home icon for CMS view").setDesc("Use the home icon instead of blocks icon for the CMS view in the Bases view selector. Restart Obsidian for this change to take effect.").addToggle(n=>n.setValue(this.plugin.settings.useHomeIcon).onChange(r=>{(async()=>(this.plugin.settings.useHomeIcon=r,await this.plugin.saveData(this.plugin.settings)))()})),new x.Setting(e).setName("Force static image for animated GIFs").setDesc("When enabled, animated GIFs will display only the first frame when used as card covers or thumbnails.").addToggle(n=>n.setValue(this.plugin.settings.forceStaticGifImages).onChange(r=>{(async()=>{this.plugin.settings.forceStaticGifImages=r,await this.plugin.saveData(this.plugin.settings);let l=this.plugin;l.activeViews&&l.activeViews.forEach(c=>{c.onDataUpdated&&c.onDataUpdated()})})()})),new x.Setting(e).setName("Show properties info modal").setDesc("Show an informational modal when clicking the properties button in CMS views. This explains how properties work differently in CMS views compared to standard Bases views.").addToggle(n=>n.setValue(this.plugin.settings.showPropertiesInfoModal).onChange(r=>{(async()=>(this.plugin.settings.showPropertiesInfoModal=r,await this.plugin.saveData(this.plugin.settings)))()})),new x.Setting(e).setName("Quick edit").setHeading();let t,s,a;new x.Setting(e).setName("Enable quick edit").setDesc("Show an icon on card titles that launches a command when clicked.").addToggle(n=>n.setValue(this.plugin.settings.enableQuickEdit).onChange(r=>{(async()=>(this.plugin.settings.enableQuickEdit=r,await this.plugin.saveData(this.plugin.settings),t&&t.settingEl.toggleClass("bases-cms-setting-hidden",!r),s&&s.settingEl.toggleClass("bases-cms-setting-hidden",!r),a&&a.settingEl.toggleClass("bases-cms-setting-hidden",!r)))()})),t=new x.Setting(e).setName("Quick edit command").setDesc("The command to execute when clicking the quick edit icon on a card title.").addButton(n=>{var l;let r=this.plugin.settings.quickEditCommandName||(this.plugin.settings.quickEditCommand?"Select command...":"No command selected");if(n.setButtonText(r).onClick(()=>{new K(this.app,p=>{(async()=>{let d=this.app.commands,f="";if(d){if(typeof d.listCommands=="function"){let u=d.listCommands().find(v=>v.id===p);u&&(f=u.name)}if(!f){let h=d.commands;h&&h[p]&&(f=h[p].name||"")}}this.plugin.settings.quickEditCommand=p,this.plugin.settings.quickEditCommandName=f,await this.plugin.saveData(this.plugin.settings),this.display()})()}).open()}),this.plugin.settings.quickEditCommand){let c=(l=n.buttonEl.parentElement)==null?void 0:l.createEl("button",{text:"Clear",attr:{style:"margin-left: 8px;"}});c==null||c.addEventListener("click",()=>{(async()=>(this.plugin.settings.quickEditCommand="",this.plugin.settings.quickEditCommandName="",await this.plugin.saveData(this.plugin.settings),this.display()))()})}}),t.settingEl.toggleClass("bases-cms-setting-hidden",!this.plugin.settings.enableQuickEdit),s=new x.Setting(e).setName("Quick edit icon").setDesc("Select the icon to display for the quick edit button on card titles.").addButton(n=>{let r=this.getIconName(this.plugin.settings.quickEditIcon||"pencil-line");n.setButtonText(r||"Select icon...").onClick(()=>{new J(this.app,async c=>{this.plugin.settings.quickEditIcon=c,await this.plugin.saveData(this.plugin.settings),this.display()}).open()})}),s.settingEl.toggleClass("bases-cms-setting-hidden",!this.plugin.settings.enableQuickEdit),a=new x.Setting(e).setName("Attempt to open file and execute quick edit command").setDesc("For commands that don't have special handling, attempt to open the file and execute the command. Some commands may not work properly this way.").addToggle(n=>n.setValue(this.plugin.settings.quickEditOpenFile).onChange(r=>{(async()=>(this.plugin.settings.quickEditOpenFile=r,await this.plugin.saveData(this.plugin.settings)))()})),a.settingEl.toggleClass("bases-cms-setting-hidden",!this.plugin.settings.enableQuickEdit)}getIconName(e){return e?e.replace(/^lucide-/,"").split("-").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "):""}};var Me={confirmBulkOperations:!0,deleteParentFolder:!1,deleteParentFolderFilename:"index",deleteUniqueAttachments:!1,confirmDeletions:!0,useHomeIcon:!1,enableQuickEdit:!1,quickEditCommand:"",quickEditCommandName:"",quickEditIcon:"pencil-line",quickEditOpenFile:!1,showToolbarSelectAll:!0,showToolbarClear:!0,showToolbarDraft:!0,showToolbarPublish:!0,showToolbarTags:!0,showToolbarSet:!0,showToolbarRemove:!0,showToolbarDelete:!0,forceStaticGifImages:!1,showPropertiesInfoModal:!0};var q=require("obsidian");function M(o,i){if(!i||!i.trim())return null;let e=i.split(",").map(t=>t.trim()).filter(t=>t);for(let t of e){let s=o.getValue(t),a=s;if(a&&("date"in a&&a.date instanceof Date||"data"in a))return s}return null}function ye(o,i){if(!i||!i.trim())return[];let e=i.split(",")[0].trim();if(!e)return[];let t=o.getValue(e);if(!t||!("data"in t))return[];let s=t.data,a=[];if(Array.isArray(s)){for(let n of s)if(typeof n=="string"||typeof n=="number"){let r=String(n);if(r&&r.trim()){a.push(r);break}}}else if(s!=null&&s!==""&&(typeof s=="string"||typeof s=="number")){let n=String(s);n.trim()&&a.push(n)}return a}function Ie(o,i,e,t){if(!o||o==="")return"";if(e){let s=e;if(typeof s.getDisplayName=="function")try{let a=s.getDisplayName(o);if(a&&typeof a=="string"&&a.trim()!=="")return a}catch(a){}}return o}function ct(o,i,e,t,s,a,n){let r=o.file.basename||o.file.name,l=M(o,i.titleProperty),c=l==null?void 0:l.data,p=c!=null&&c!==""&&(typeof c=="string"||typeof c=="number")?String(c):r,d=o.file.path,f=d.split("/").slice(0,-1).join("/"),h=o.getValue("note.tags"),u=[];if(h&&h.data!=null){let k=h.data;u=(Array.isArray(k)?k.map(T=>T&&typeof T=="object"&&"data"in T?String(T.data):typeof T=="string"||typeof T=="number"?String(T):"").filter(T=>T):typeof k=="string"||typeof k=="number"?[String(k)]:[]).map(T=>T.replace(/^#/,""))}let v=o.getValue("file.tags"),w=[];if(v&&v.data!=null){let k=v.data;w=(Array.isArray(k)?k.map(T=>T&&typeof T=="object"&&T!==null&&"data"in T?String(T.data):typeof T=="string"||typeof T=="number"?String(T):"").filter(T=>typeof T=="string"&&T.length>0):typeof k=="string"||typeof k=="number"?[String(k)]:[]).map(T=>T.replace(/^#/,""))}let C=o.file.stat.ctime,g=o.file.stat.mtime,b=[];if(i.showTags&&i.tagsProperty){let k=M(o,i.tagsProperty);if(k&&k.data!=null){let P=k.data;Array.isArray(P)?b=P.map(T=>T&&typeof T=="object"&&"data"in T?String(T.data):typeof T=="string"||typeof T=="number"?String(T):"").filter(T=>typeof T=="string"&&T.length>0):(typeof P=="string"||typeof P=="number")&&(b=[String(P)])}}let m={path:d,name:r,title:p,tags:w,yamlTags:u,ctime:C,mtime:g,folderPath:f,snippet:s,imageUrl:a,hasImageAvailable:n||!1,displayTags:b.length>0?b:void 0},y=[i.propertyDisplay1,i.propertyDisplay2,i.propertyDisplay3,i.propertyDisplay4],S=new Set,E=y.map(k=>!k||k===""||S.has(k)?"":(S.add(k),k));return m.propertyName1=E[0]||void 0,m.propertyName2=E[1]||void 0,m.propertyName3=E[2]||void 0,m.propertyName4=E[3]||void 0,m.property1=E[0]?_(E[0],o,m,i):null,m.property2=E[1]?_(E[1],o,m,i):null,m.property3=E[2]?_(E[2],o,m,i):null,m.property4=E[3]?_(E[3],o,m,i):null,m}function Be(o,i,e,t,s,a,n){return o.map(r=>ct(r,i,e,t,s[r.file.path],a[r.file.path],n[r.file.path]))}function _(o,i,e,t){if(!o||o==="")return null;if(o==="file.path"||o==="file path")return e.folderPath||null;if(o==="tags"||o==="note.tags")return e.yamlTags.length>0?"tags":null;if(o==="file.tags"||o==="file tags")return e.tags.length>0?"tags":null;if(o==="file.ctime"||o==="created time")return new Date(e.ctime).toLocaleDateString();if(o==="file.mtime"||o==="modified time")return new Date(e.mtime).toLocaleDateString();let s=M(i,o);if(!s)return null;let a=s;if(!a)return null;if("date"in a&&a.date instanceof Date)return a.date.toLocaleDateString();let n=a.data;return n==null||n===""?null:Array.isArray(n)?n.length===0?null:n.map(r=>r&&typeof r=="object"&&"data"in r?String(r.data):String(r)).filter(r=>r&&r.trim()!=="").join(", "):typeof n=="string"||typeof n=="number"||typeof n=="boolean"?String(n):null}$();var we=require("obsidian");function Oe(o){return/^https?:\/\//i.test(o)}function Se(o){return/\.(avif|bmp|gif|jpe?g|png|svg|webp)$/i.test(o)}function Ne(o){return new Promise(i=>{let e=new Image;e.onload=()=>i(!0),e.onerror=()=>i(!1),setTimeout(()=>i(!1),5e3),e.src=o})}function dt(o){let i=o.match(/^!?\[\[([^\]|]+)(?:\|[^\]]*)?\]\]$/);return i?i[1].trim():o}async function Ve(o){let i=[],e=[];for(let n of o){let r=dt(n);r.length!==0&&(Oe(r)?(Se(r)||!r.includes("."))&&e.push(r):Se(r)&&i.push(r))}let t=e.map(n=>Ne(n).then(r=>r?n:null)),a=(await Promise.all(t)).filter(n=>n!==null);return{internalPaths:i,externalUrls:a}}function Re(o,i,e){let t=["avif","bmp","gif","jpeg","jpg","png","svg","webp"],s=[];for(let a of o){let n=e.metadataCache.getFirstLinkpathDest(a,i);if(!n&&a.startsWith("./")){let r=e.vault.getAbstractFileByPath(i);if(r&&r.parent){let l=a.substring(2),c=r.parent.path?`${r.parent.path}/${l}`:l,p=e.vault.getAbstractFileByPath(c);p instanceof we.TFile&&(n=p)}}if(!n){let r=e.vault.getAbstractFileByPath(a);r instanceof we.TFile&&(n=r)}if(n&&t.includes(n.extension)){let r=e.vault.getResourcePath(n);s.push(r)}}return s}async function Ee(o,i){let e=["avif","bmp","gif","jpeg","jpg","png","svg","webp"],t=i.metadataCache.getFileCache(o);if(!(t!=null&&t.embeds))return[];let s=[],a=[];for(let c of t.embeds){let p=c.link;if(Oe(p))(Se(p)||!p.includes("."))&&a.push(p);else{let d=i.metadataCache.getFirstLinkpathDest(p,o.path);if(d&&e.includes(d.extension)){let f=i.vault.getResourcePath(d);s.push(f)}}}let n=a.map(c=>Ne(c).then(p=>p?c:null)),l=(await Promise.all(n)).filter(c=>c!==null);return[...s,...l]}function ut(o){return/\.gif(\?|#|$)/i.test(o)||/\.gif$/i.test(o)}async function X(o,i){return!i||!ut(o)?o:new Promise(e=>{let t=new Image;t.crossOrigin="anonymous",t.onload=()=>{try{let s=document.createElement("canvas");s.width=t.width,s.height=t.height;let a=s.getContext("2d");if(a){a.drawImage(t,0,0);let n=s.toDataURL("image/png");e(n)}else e(o)}catch(s){console.warn("Failed to convert GIF to static image:",s),e(o)}},t.onerror=()=>{e(o)},setTimeout(()=>{e(o)},5e3),t.src=o})}var ht=[/`([^`]+)`/g,/\*\*\*((?:(?!\*\*\*).)+)\*\*\*/g,/___((?:(?!___).)+)___/g,/\*\*((?:(?!\*\*).)+)\*\*/g,/__((?:(?!__).)+)__/g,/\*((?:(?!\*).)+)\*/g,/_((?:(?!_).)+)_/g,/~~((?:(?!~~).)+)~~/g,/==((?:(?!==).)+)==/g,/\[([^\]]+)\]\([^)]+\)/g,/!\[\[[^\]]+\]\]/g,/\[\[[^\]|]+\|[^\]]+\]\]/g,/\[\[[^\]]+\]\]/g,/#[a-zA-Z0-9_\-/]+/g,/^[-*+]\s*\[[ xX]\]\s+/gm,/^(\d+\.\s*)\[[ xX]\]\s+/gm,/^(\d+\)\s*)\[[ xX]\]\s+/gm,/^[-*+]\s+/gm,/^#{1,6}\s+.+$/gm,/^\s*(?:[-_*])\s*(?:[-_*])\s*(?:[-_*])[\s\-_*]*$/gm,/^\s*\|.*\|.*$/gm,/\^\[[^\]]*?]/g,/\[\^[^\]]+]/g,/^\s*\[\^[^\]]+]:.*$/gm,/<([a-z][a-z0-9]*)\b[^>]*>(.*?)<\/\1>/gi,/<[^>]+>/g];function gt(o){let i=new Map,e=0;return{text:o.replace(/\\(.)/g,(s,a)=>{let n=`\xA7\xA7ESCAPED${e}\xA7\xA7`;return i.set(n,a),e++,n}),map:i}}function mt(o,i){let e=o;return i.forEach((t,s)=>{e=e.split(s).join(t)}),e}function ft(o){let i=o,e=!0;for(;e;){e=!1;let t=i.match(/^([`~]{3,})/m);if(!t)break;let s=t[1][0],a=t[1].length,n=t.index,r=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),l=new RegExp(`^${r}{${a}}\\s*$`,"m"),p=i.substring(n+t[1].length).match(l);if(p){let f=n+t[1].length+p.index+p[0].length;i=i.substring(0,n)+i.substring(f),e=!0}else{let d=i.indexOf(`
`,n);d===-1?i=i.substring(0,n):i=i.substring(0,n)+i.substring(d+1),e=!0}}return i}function bt(o){if(!o||o.trim().length===0)return"";o=o.replace(/^>\s*\[![\w-]+\][+-]?.*$/gm,""),o=o.replace(/^>\s?/gm,"");let{text:i,map:e}=gt(o),t=ft(i);return ht.forEach(s=>{t=t.replace(s,(a,...n)=>{if(a.match(/<[a-z][a-z0-9]*\b[^>]*>.*?<\//i))return n[1]||"";if(n.length>0&&n[0]!==void 0){for(let r=0;r<n.length-2;r++)if(typeof n[r]=="string")return n[r]}return""})}),t=mt(t,e),t}function vt(o,i=!1,e,t){let s=o.replace(/^---[\s\S]*?---/,"").trim(),a=bt(s),n=a.indexOf(`
`),r=(n!==-1?a.substring(0,n):a).trim();(i||e&&r===e||t&&r===t)&&(a=n!==-1?a.substring(n+1).trim():"");let l=a.replace(/\^[a-zA-Z0-9-]+/g,"").split(/\s+/).filter(d=>d).join(" ").trim().replace(/\.{2,}/g,d=>d.replace(/\./g,"\u2024")),c=l.length>500,p=l.substring(0,500);return c&&(p+="\u2026"),p}async function _e(o,i,e,t,s,a){if(e!=null&&(typeof e=="string"||typeof e=="number")&&String(e).trim().length>0)return String(e).trim();if(t.fallbackToContent){let r=await i.vault.cachedRead(o);return vt(r,t.omitFirstLine,s,a)}return""}async function yt(o,i,e,t,s,a,n){let r=t&&Array.isArray(t)&&t.length>0;if(!s&&o in a&&(delete a[o],delete n[o]),!(o in a&&!r&&s))try{let{internalPaths:l,externalUrls:c}=await Ve(t),p=[...Re(l,o,e),...c];p.length===0&&!r&&s&&(p=await Ee(i,e)),p.length>0?(a[o]=p.length>1?p:p[0],n[o]=!0):r?(delete a[o],n[o]=!0):s||(delete a[o],delete n[o])}catch(l){console.error(`Failed to load image for ${o}:`,l)}}async function Te(o,i,e,t,s){let a=o.filter(r=>{let l=r.imagePropertyValues&&Array.isArray(r.imagePropertyValues)&&r.imagePropertyValues.length>0;return!(r.path in t)||l}),n=50;for(let r=0;r<a.length;r+=n){let l=a.slice(r,r+n);await Promise.all(l.map(async c=>{await yt(c.path,c.file,e,c.imagePropertyValues,i,t,s)}))}}async function $e(o,i,e,t){await Promise.all(o.map(async s=>{if(!(s.path in e||t[s.path]))try{let a=await Ee(s.file,i);a.length>0&&(e[s.path]=a.length>1?a:a[0],t[s.path]=!0)}catch(a){console.error(`Failed to load embed images for ${s.path}:`,a)}}))}async function qe(o,i,e,t,s){await Promise.all(o.map(async a=>{if(!(a.path in s))try{a.file.extension==="md"?s[a.path]=await _e(a.file,t,a.descriptionData,{fallbackToContent:i,omitFirstLine:e},a.fileName,a.titleString):s[a.path]=""}catch(n){console.error(`Failed to load snippet for ${a.path}:`,n),s[a.path]=""}}))}var se=require("obsidian");function wt(o,i){let e=null,t=!1;if(i.draftStatusUseFilenamePrefix&&o.file&&o.file.name)e=o.file.name.startsWith("_"),t=i.draftStatusReverse?!e:e;else if(i.draftStatusProperty){let s=M(o,i.draftStatusProperty);if(s){let a=s;a&&"data"in a&&typeof a.data=="boolean"&&(e=a.data,t=i.draftStatusReverse?!e:e)}}return{booleanValue:e,isDraft:t}}function Y(o,i,e,t,s){if(!t.showDraftStatus)return;let{booleanValue:a,isDraft:n}=wt(i,t);if(a!==null){let r=o.createDiv("card-status-badge");n?(r.addClass("status-draft"),r.appendText("Draft")):(r.addClass("status-published"),r.appendText("Published")),s&&(r.addClass("bases-cms-cursor-pointer"),r.addEventListener("click",l=>{l.stopPropagation(),s(e,"draft",!a)}))}}var F=require("obsidian");function St(o,i){let e=new F.Modal(o);e.titleEl.setText("Rename file");let t=e.contentEl.createDiv();t.style.width="100%";let s=new F.TextComponent(t);s.setValue(i.basename),s.inputEl.style.width="100%",s.inputEl.style.boxSizing="border-box",s.inputEl.focus(),s.inputEl.select();let a=e.contentEl.createDiv({cls:"modal-button-container"});a.createEl("button",{text:"Cancel"}).addEventListener("click",()=>e.close());let r=a.createEl("button",{text:"Rename",cls:"mod-cta"}),l=async()=>{let c=s.getValue().trim();if(!c||c===i.basename){e.close();return}let p=i.path.split("/");p[p.length-1]=c+(i.extension?`.${i.extension}`:"");let d=p.join("/");try{await o.fileManager.renameFile(i,d),e.close()}catch(f){console.error("[Bases CMS] Error renaming file:",f),e.close()}};r.addEventListener("click",()=>{l()}),s.inputEl.addEventListener("keydown",c=>{c.key==="Enter"?(c.preventDefault(),l()):c.key==="Escape"&&(c.preventDefault(),e.close())}),e.open()}function Et(o){let i=o.toLowerCase();return o==="file-explorer:rename-file"||o==="rename-file"||o==="file:rename-file"||i.includes("rename")&&i.includes("file")&&!i.includes(":")}function Tt(o,i){let e=o.toLowerCase(),t=i.toLowerCase();return["add tag","add-tag","insert-template","insert-template","editor:","markdown:"].some(a=>e.includes(a)||t.includes(a))}function He(o,i,e,t,s,a){if(!i.settings.enableQuickEdit||!i.settings.quickEditCommand||i.settings.quickEditCommand===""||a.hideQuickEditIcon)return;let n=e.createSpan("bases-cms-quick-edit-icon");n.addClass("bases-cms-cursor-default"),(0,F.setIcon)(n,i.settings.quickEditIcon||"pencil-line"),e.addEventListener("click",r=>{n.contains(r.target)&&(r.stopPropagation(),r.stopImmediatePropagation())},!0),t.addEventListener("click",r=>{(async()=>{var p,d,f,h;let l=r.target;if(!n.contains(l)&&!l.closest(".bases-cms-quick-edit-icon"))return;r.stopPropagation(),r.stopImmediatePropagation(),r.preventDefault();let c=o.vault.getAbstractFileByPath(s);if(c instanceof F.TFile){let u=i.settings.quickEditCommand,v=o.commands,w=(p=v==null?void 0:v.commands)==null?void 0:p[u],C=(w==null?void 0:w.name)||"",g=C.toLowerCase();if(Et(u)||g.includes("rename")&&g.includes("file")){St(o,c);return}if(Tt(u,C)&&!i.settings.quickEditOpenFile){new F.Notice(`The "${C}" command requires the file to be open in an editor. Enable "Attempt to open file and execute quick edit command" in settings to try anyway.`,5e3);return}let b=!1;try{let m=null,y=u;if(u.includes(":")){let S=u.split(":");m=S[0],y=S.slice(1).join(":")}else{let E=o.commands,k=(d=E==null?void 0:E.commands)==null?void 0:d[u];if(k){let P=k.plugin||k.sourcePlugin;P&&(m=((f=P.manifest)==null?void 0:f.id)||P.pluginId||null)}}if(m){let S=o.plugins,E=(h=S==null?void 0:S.plugins)==null?void 0:h[m];if(E){let k=y.split("-").map((P,T)=>T===0?P:P.charAt(0).toUpperCase()+P.slice(1)).join("")+"ByPath";if(E&&typeof E[k]=="function"){await E[k](s),b=!0;return}}}}catch(m){}if(!b){if(!i.settings.quickEditOpenFile){new F.Notice(`This command doesn't have special handling. Enable "Attempt to open file and execute quick edit command" in settings to try executing it.`,5e3);return}let m=o.workspace.getLeaf(!1);await m.openFile(c),o.workspace.setActiveLeaf(m,{focus:!0});let y=0,S=30,E=()=>{o.workspace.getActiveFile()===c&&(async()=>{var T,j;try{await((j=(T=o.commands)==null?void 0:T.executeCommandById)==null?void 0:j.call(T,i.settings.quickEditCommand))}catch(Ft){}})()},k=()=>{let P=m.view,T=P,j=o.workspace.getActiveFile();P&&"editor"in P&&T.editor&&j===c?requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{E()},200)})}):y<S&&(y++,setTimeout(k,50))};k()}}})()},!0),n.addEventListener("mousedown",r=>{r.stopPropagation(),r.stopImmediatePropagation(),r.preventDefault()},!0)}var Ue=require("obsidian");var ee=class{constructor(i,e,t){this.app=i;this.getBasesConfig=e;this.getBasesController=t}renderProperties(i,e,t,s,a){let n=[s.propertyDisplay1,s.propertyDisplay2,s.propertyDisplay3,s.propertyDisplay4],r=new Set,l=n.map(h=>!h||h===""||r.has(h)?"":(r.add(h),h)),c=l.map(h=>h?_(h,t,e,s):null),p=l[0]!==""||l[1]!=="",d=l[2]!==""||l[3]!=="";if(!p&&!d)return;let f=i.createDiv("card-properties properties-4field");if(p){let h=f.createDiv("property-row property-row-1");s.propertyLayout12SideBySide&&h.addClass("property-row-side-by-side");let u=h.createDiv("property-field property-field-1");l[0]&&this.renderPropertyContent(u,l[0],c[0],e,t,s,a);let v=h.createDiv("property-field property-field-2");l[1]&&this.renderPropertyContent(v,l[1],c[1],e,t,s,a)}if(d){let h=f.createDiv("property-row property-row-2");s.propertyLayout34SideBySide&&h.addClass("property-row-side-by-side");let u=h.createDiv("property-field property-field-3");l[2]&&this.renderPropertyContent(u,l[2],c[2],e,t,s,a);let v=h.createDiv("property-field property-field-4");l[3]&&this.renderPropertyContent(v,l[3],c[3],e,t,s,a)}}renderPropertyContent(i,e,t,s,a,n,r){if(e===""||!t&&n.propertyLabels==="hide"||n.propertyLabels==="hide"&&((e==="tags"||e==="note.tags")&&s.yamlTags.length===0||(e==="file.tags"||e==="file tags")&&s.tags.length===0||(e==="file.path"||e==="path"||e==="file path")&&s.folderPath.length===0))return;let l=this.getBasesConfig?this.getBasesConfig():void 0,c=this.getBasesController?this.getBasesController():void 0,p=Ie(e,this.app,l,c),d=p.toLowerCase()!==e.toLowerCase();if(n.propertyLabels==="above"){let u=i.createDiv("property-label");d&&u.addClass("property-label-custom"),u.textContent=p}let f=i.createDiv("property-content");if(n.propertyLabels==="inline"){let u=f.createSpan("property-label-inline");u.textContent=p+": "}if(!t){f.appendText("\u2026");return}if(e==="file.mtime"||e==="file.ctime"||e==="modified time"||e==="created time")f.createSpan().appendText(t);else if((e==="tags"||e==="note.tags")&&s.yamlTags.length>0){let u=f.createDiv("tags-wrapper");s.yamlTags.forEach(v=>{u.createEl("a",{cls:"tag",text:v,href:"#"}).addEventListener("click",C=>{var b,m,y;C.preventDefault();let g=(m=(b=this.app.internalPlugins)==null?void 0:b.plugins)==null?void 0:m["global-search"];(y=g==null?void 0:g.instance)!=null&&y.openGlobalSearch&&g.instance.openGlobalSearch("tag:"+v)})})}else if((e==="file.tags"||e==="file tags")&&s.tags.length>0){let u=f.createDiv("tags-wrapper");s.tags.forEach(v=>{u.createEl("a",{cls:"tag",text:v,href:"#"}).addEventListener("click",C=>{var b,m,y;C.preventDefault();let g=(m=(b=this.app.internalPlugins)==null?void 0:b.plugins)==null?void 0:m["global-search"];(y=g==null?void 0:g.instance)!=null&&y.openGlobalSearch&&g.instance.openGlobalSearch("tag:"+v)})})}else if((e==="file.path"||e==="path"||e==="file path")&&s.path.length>0){let u=f.createDiv("path-wrapper"),v=s.path.split("/").filter(w=>w);v.forEach((w,C)=>{let g=u.createSpan(),b=C===v.length-1,m=b?"path-segment filename-segment":"path-segment file-path-segment";g.createSpan({cls:m,text:w}).addEventListener("click",S=>{if(S.stopPropagation(),b){let E=this.app.vault.getAbstractFileByPath(s.path);E instanceof Ue.TFile&&this.app.workspace.getLeaf(!1).openFile(E)}}),C<v.length-1&&g.createSpan({cls:"path-separator",text:"/"})})}else{let u=this.app.metadataCache,w=(typeof u.getAllPropertyInfos=="function"?u.getAllPropertyInfos():{})[e.toLowerCase()],C=a.getValue(e);if(((w==null?void 0:w.widget)==="checkbox"||C&&"data"in C&&typeof C.data=="boolean")&&r){let b=f.createEl("input",{type:"checkbox"});b.checked=C&&"data"in C?Boolean(C.data):!1,f.createSpan({text:p}),b.addEventListener("change",async m=>{m.stopPropagation();let y=b.checked;try{let S=e.startsWith("note.")?e.substring(5):e;await r(s.path,S,y)}catch(S){console.error("Error toggling property:",S),b.checked=!y}}),b.addEventListener("click",m=>{m.stopPropagation()})}else f.createDiv("text-wrapper").appendText(t)}(!f.textContent||f.textContent.trim().length===0)&&f.remove()}};var te=class{constructor(i,e,t,s,a,n){this.app=i;this.plugin=e;this.propertyObservers=t;this.updateLayoutRef=s;this.basesConfig=a,this.basesController=n,this.propertyRenderer=new ee(this.app,()=>this.basesConfig,()=>this.basesController)}renderCard(i,e,t,s,a,n,r,l,c){let p=i.createDiv("card bases-cms-card");s.imageFormat==="cover"?p.classList.add("image-format-cover"):s.imageFormat==="thumbnail"&&p.classList.add("image-format-thumbnail"),p.setAttribute("data-path",e.path),p.setAttribute("data-href",e.path),p.addClass("bases-cms-cursor-pointer");let d=p.createDiv("bases-cms-select-checkbox"),f=d.createEl("input",{type:"checkbox",cls:"selection-checkbox"});if(f.checked=n,f.addEventListener("change",h=>{h.stopPropagation(),h.stopImmediatePropagation(),r(e.path,f.checked)}),f.addEventListener("click",h=>{h.stopPropagation(),h.stopImmediatePropagation()}),s.showDraftStatus&&s.imageFormat!=="cover"&&Y(p,t,e.path,s,l),p.addEventListener("click",h=>{let u=h.target;if(u.closest(".bases-cms-quick-edit-icon")){h.stopPropagation(),h.stopImmediatePropagation(),h.preventDefault();return}if(d.contains(u)||u.tagName==="INPUT"||u.closest("input")||u.closest(".bases-cms-property")||u.closest(".card-status-badge"))return;let w=h.metaKey||h.ctrlKey;this.app.workspace.openLinkText(e.path,"",w)}),p.addEventListener("contextmenu",h=>{let u=h.target;if(d.contains(u)||u.tagName==="INPUT"||u.closest("input")||u.closest(".bases-cms-property")||u.closest(".card-status-badge")||u.closest(".bases-cms-quick-edit-icon"))return;let v=this.app.vault.getAbstractFileByPath(e.path);if(v&&v instanceof se.TFile){h.stopPropagation();let w=new se.Menu;f.checked?w.addItem(g=>{g.setTitle("Unselect"),g.setIcon("square"),g.onClick(()=>{r(e.path,!1)})}):w.addItem(g=>{g.setTitle("Select"),g.setIcon("copy-check"),g.onClick(()=>{r(e.path,!0)})}),w.addSeparator(),this.app.workspace.trigger("file-menu",w,v,"bases"),w.addSeparator(),w.addItem(g=>{g.setTitle("Delete"),g.setIcon("trash-2"),g.onClick(async()=>{c&&await c.handleDelete()})}),w.showAtMouseEvent(h),setTimeout(()=>{let g=document.querySelector(".menu");if(!g)return;let m=Array.from(g.querySelectorAll(".menu-item")).find(y=>{var E;return((E=y.textContent)==null?void 0:E.trim())==="Delete"});if(m){m.addClass("is-danger");let y=m.querySelector("svg");y&&(y.style.color="var(--text-error)",y.style.stroke="var(--text-error)");let S=m.querySelector(".menu-item-title");S&&(S.style.color="var(--text-error)")}},0)}}),s.showTitle){let h=p.createDiv("card-title");h.appendText(e.title),He(this.app,this.plugin,h,p,e.path,s)}if(s.showDate&&s.dateProperty){let h=M(t,s.dateProperty);if(h){let u=h,v="";if(u&&"date"in u&&u.date instanceof Date)v=u.date.toLocaleDateString();else if(u&&"data"in u&&u.data){let w=u.data;if(w instanceof Date)v=w.toLocaleDateString();else if(typeof w=="string"||typeof w=="number"){let C=new Date(w);isNaN(C.getTime())?v=String(w):v=C.toLocaleDateString()}}v&&p.createDiv("card-date").appendText(v)}}if(s.showTextPreview||s.showTags&&e.displayTags&&e.displayTags.length>0||s.imageFormat!=="none"&&(e.imageUrl||e.hasImageAvailable)||s.imageFormat==="cover"){let h=p.createDiv("card-content");if(s.imageFormat==="thumbnail"){let u=h.createDiv("card-text-wrapper");if(s.showTextPreview){let v=u.createDiv("card-text-preview");e.snippet&&v.setText(e.snippet),p.__textPreviewEl=v,p.__cardPath=e.path}if(s.showTags&&e.displayTags&&e.displayTags.length>0){let v=u.createDiv("card-tags"),w=s.maxTagsToShow,C=e.displayTags.slice(0,w),g=e.displayTags.length-w;C.forEach(b=>{v.createSpan("card-tag").appendText(b)}),g>0&&v.createSpan("card-tag-more").appendText(`+${g} more`)}}else{if(s.showTextPreview){let u=h.createDiv("card-text-preview");e.snippet&&u.setText(e.snippet),p.__textPreviewEl=u,p.__cardPath=e.path}if(s.showTags&&e.displayTags&&e.displayTags.length>0){let u=h.createDiv("card-tags"),v=s.maxTagsToShow,w=e.displayTags.slice(0,v),C=e.displayTags.length-v;w.forEach(g=>{u.createSpan("card-tag").appendText(g)}),C>0&&u.createSpan("card-tag-more").appendText(`+${C} more`)}}if(s.imageFormat!=="none"&&e.imageUrl){let v=(Array.isArray(e.imageUrl)?e.imageUrl:[e.imageUrl]).filter(g=>g&&typeof g=="string"&&g.trim().length>0),w=s.imageFormat==="cover"?"card-cover":"card-thumbnail",C=h.createDiv(w);if(v.length>0){let g=C.createDiv("image-embed"),b=v[0];(async()=>{let m=await X(b,this.plugin.settings.forceStaticGifImages);g.style.backgroundImage=`url("${m}")`})(),g.style.backgroundImage=`url("${b}")`,g.style.backgroundSize="cover",g.style.backgroundPosition="center center",g.style.backgroundRepeat="no-repeat",s.showDraftStatus&&s.imageFormat==="cover"&&Y(C,t,e.path,s,l),this.propertyRenderer.renderProperties(p,e,t,s,l);return}}else if(s.imageFormat==="cover"){let u=h.createDiv("card-cover-placeholder");Y(u,t,e.path,s,l)}}this.propertyRenderer.renderProperties(p,e,t,s,l)}};var Xe=require("obsidian");var B=require("obsidian");async function Ce(o,i,e,t){await o.fileManager.processFrontMatter(i,s=>{for(let[a,n]of e){if(a==="tags"&&!Object.prototype.hasOwnProperty.call(s,"tags")&&!Array.isArray(n.data)){s[a]=[n.data];continue}if(!s[a]||t){s[a]=n.data;continue}let r=n.type,l=s[a],c=Array.isArray(l)?"list":typeof l=="number"?"number":typeof l=="boolean"?"checkbox":"text";if(Ct(r,c)){if(s[a]===n.data||!n.data)continue;let p=kt(s[a],n.data);s[a]=p;continue}else{s[a]=n.data;continue}}})}async function ze(o,i,e){await o.fileManager.processFrontMatter(i,t=>{for(let s of e)t[s]=void 0})}function Ct(o,i){let e=["number","date","datetime","checkbox"];return!(e.includes(o)||e.includes(i))}function kt(...o){let e=o.map(s=>Array.isArray(s)?s:[s]).flat();return[...new Set(e)]}var I=class{constructor(i){this.app=i}async setDraft(i,e,t){await this.batchProcessFiles(i,async s=>{if(t)if(t.draftStatusUseFilenamePrefix){let a=s.basename,n=a.startsWith("_"),l=s.path.split("/"),c=e;if(t.draftStatusReverse&&(c=!e),c===!0){if(!n){let p=`_${a}${s.extension?`.${s.extension}`:""}`;l[l.length-1]=p;let d=l.join("/");await this.app.fileManager.renameFile(s,d)}}else if(n){let p=a.substring(1)+(s.extension?`.${s.extension}`:"");l[l.length-1]=p;let d=l.join("/");await this.app.fileManager.renameFile(s,d)}}else{let a=t.draftStatusProperty&&t.draftStatusProperty.trim()?t.draftStatusProperty.startsWith("note.")?t.draftStatusProperty.substring(5):t.draftStatusProperty:"draft",n=e;t.draftStatusReverse&&(n=!e),await this.app.fileManager.processFrontMatter(s,r=>{r[a]=n})}else await this.app.fileManager.processFrontMatter(s,a=>{a.draft=e})}),new B.Notice(`Set ${i.length} file${i.length!==1?"s":""} to ${e?"draft":"published"}`)}async addTags(i,e){let t=new Map;t.set("tags",{type:"tags",data:e,overwrite:!1,delimiter:","}),await this.batchProcessFiles(i,async s=>{await Ce(this.app,s,t,!1)}),new B.Notice(`Added tags to ${i.length} file${i.length!==1?"s":""}`)}async removeTags(i,e){await this.batchProcessFiles(i,async t=>{let s=this.app.metadataCache.getFileCache(t),a=s==null?void 0:s.frontmatter;if(a!=null&&a.tags){let r=(Array.isArray(a.tags)?a.tags:[a.tags]).filter(l=>!e.includes(l));await this.app.fileManager.processFrontMatter(t,l=>{r.length>0?l.tags=r:l.tags=void 0})}}),new B.Notice(`Removed tags from ${i.length} file${i.length!==1?"s":""}`)}async setProperty(i,e,t,s="text"){let a=e.startsWith("note.")?e.substring(5):e,n=new Map;n.set(a,{type:s,data:t,overwrite:!0,delimiter:","}),await this.batchProcessFiles(i,async r=>{await Ce(this.app,r,n,!0)}),new B.Notice(`Set ${a} on ${i.length} file${i.length!==1?"s":""}`)}async removeProperty(i,e){let t=e.startsWith("note.")?e.substring(5):e;await this.batchProcessFiles(i,async s=>{await ze(this.app,s,[t])}),new B.Notice(`Removed ${t} from ${i.length} file${i.length!==1?"s":""}`)}async batchProcessFiles(i,e){let t=0,s=i.length;for(let a of i){let n=this.app.vault.getAbstractFileByPath(a);if(n instanceof B.TFile)try{await e(n),t++}catch(r){console.error(`Error processing ${a}:`,r)}}t<s&&new B.Notice(`Processed ${t} of ${s} files`)}};var O=require("obsidian");var ie=class extends O.Modal{constructor(e,t){super(e);this.tagsToAdd="";this.tagsToRemove=new Set;this.files=t,this.bulkOps=new I(e)}onOpen(){let{contentEl:e}=this;e.empty(),new O.Setting(e).setName("Manage tags").setHeading(),e.createEl("p",{text:`Managing tags for ${this.files.length} file${this.files.length!==1?"s":""}`}),new O.Setting(e).setName("Add tags").setDesc("Enter tags to add (comma-separated).").addText(l=>{l.setPlaceholder("tag1, tag2, tag3").onChange(c=>{this.tagsToAdd=c})}),e.createEl("h3",{text:"Remove tags"});let t=e.createDiv(),s=new Set;for(let l of this.files){let c=this.app.vault.getAbstractFileByPath(l);if(c instanceof O.TFile){let p=this.app.metadataCache.getFileCache(c),d=p==null?void 0:p.frontmatter;d!=null&&d.tags&&(Array.isArray(d.tags)?d.tags:[d.tags]).forEach(h=>s.add(h))}}for(let l of Array.from(s).sort())new O.Setting(t).setName(l).addToggle(c=>{c.setValue(this.tagsToRemove.has(l)).onChange(p=>{p?this.tagsToRemove.add(l):this.tagsToRemove.delete(l)})});let a=e.createDiv();a.addClass("bases-cms-modal-button-container");let n=a.createEl("button");n.setText("Cancel"),n.addEventListener("click",()=>this.close());let r=a.createEl("button");r.setText("Apply"),r.addClass("mod-cta"),r.addEventListener("click",()=>{(async()=>(await this.applyChanges(),this.close()))()})}async applyChanges(){if(this.tagsToAdd.trim()){let e=this.tagsToAdd.split(",").map(t=>t.trim()).filter(t=>t.length>0);e.length>0&&await this.bulkOps.addTags(this.files,e)}this.tagsToRemove.size>0&&await this.bulkOps.removeTags(this.files,Array.from(this.tagsToRemove))}onClose(){let{contentEl:e}=this;e.empty()}};var V=require("obsidian");var ne=class extends V.Modal{constructor(e,t){super(e);this.propertyName="";this.propertyValue="";this.propertyType="text";this.files=t,this.bulkOps=new I(e)}onOpen(){let{contentEl:e}=this;e.empty(),new V.Setting(e).setName("Set property").setHeading(),e.createEl("p",{text:`Setting property on ${this.files.length} file${this.files.length!==1?"s":""}`}),new V.Setting(e).setName("Property name").setDesc("Enter the property name to set.").addText(n=>{n.setPlaceholder("Enter name").onChange(r=>{this.propertyName=r})}),new V.Setting(e).setName("Property type").setDesc("Select the property type.").addDropdown(n=>{n.addOption("text","Text").addOption("number","Number").addOption("checkbox","Checkbox").addOption("date","Date").setValue(this.propertyType).onChange(r=>{this.propertyType=r})}),new V.Setting(e).setName("Property value").setDesc("Enter the property value.").addText(n=>{n.setPlaceholder("Enter value").onChange(r=>{this.propertyValue=r})});let t=e.createDiv();t.addClass("bases-cms-modal-button-container");let s=t.createEl("button");s.setText("Cancel"),s.addEventListener("click",()=>this.close());let a=t.createEl("button");a.setText("Apply"),a.addClass("mod-cta"),a.addEventListener("click",()=>{(async()=>this.propertyName&&this.propertyValue&&(await this.applyChanges(),this.close()))()})}async applyChanges(){let e=this.propertyValue;this.propertyType==="number"?e=Number(this.propertyValue):this.propertyType==="checkbox"?e=this.propertyValue.toLowerCase()==="true"||this.propertyValue==="1":this.propertyType==="date"&&(e=this.propertyValue),await this.bulkOps.setProperty(this.files,this.propertyName,e,this.propertyType)}onClose(){let{contentEl:e}=this;e.empty()}};var R=require("obsidian");var ae=class extends R.Modal{constructor(e,t){super(e);this.propertiesToRemove=new Set;this.files=t,this.bulkOps=new I(e)}onOpen(){let{contentEl:e}=this;e.empty(),new R.Setting(e).setName("Remove property").setHeading(),e.createEl("p",{text:`Removing properties from ${this.files.length} file${this.files.length!==1?"s":""}`});let t=new Set;for(let l of this.files){let c=this.app.vault.getAbstractFileByPath(l);if(c instanceof R.TFile){let p=this.app.metadataCache.getFileCache(c),d=p==null?void 0:p.frontmatter;if(d)for(let f in d)f!=="tags"&&f!=="title"&&t.add(f)}}let s=e.createDiv();for(let l of Array.from(t).sort())new R.Setting(s).setName(l).addToggle(c=>{c.setValue(this.propertiesToRemove.has(l)).onChange(p=>{p?this.propertiesToRemove.add(l):this.propertiesToRemove.delete(l)})});t.size===0&&e.createEl("p",{text:"No properties found in selected files."});let a=e.createDiv();a.addClass("bases-cms-modal-button-container");let n=a.createEl("button");n.setText("Cancel"),n.addEventListener("click",()=>this.close());let r=a.createEl("button");r.setText("Apply"),r.addClass("mod-cta"),r.addEventListener("click",()=>{(async()=>this.propertiesToRemove.size>0&&(await this.applyChanges(),this.close()))()})}async applyChanges(){for(let e of this.propertiesToRemove)await this.bulkOps.removeProperty(this.files,e)}onClose(){let{contentEl:e}=this;e.empty()}};Pe();var ce=require("obsidian"),z=class extends ce.Modal{constructor(e,t,s,a){super(e);this.files=t,this.operation=s,this.onConfirm=a}onOpen(){let{contentEl:e}=this;e.empty();let t=this.operation==="draft"?"mark as draft":"mark as published",s=t.charAt(0).toUpperCase()+t.slice(1);if(new ce.Setting(e).setName(`Confirm ${s}`).setHeading(),e.createEl("p",{text:`Are you sure you want to ${t} ${this.files.length} file${this.files.length!==1?"s":""}?`}),this.files.length>0){let l=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let c of this.files.slice(0,20))l.createEl("li").setText(c);this.files.length>20&&l.createEl("li",{text:`... and ${this.files.length-20} more file${this.files.length-20!==1?"s":""}`})}let a=e.createDiv();a.addClass("bases-cms-modal-button-container");let n=a.createEl("button");n.setText("Cancel"),n.addEventListener("click",()=>this.close());let r=a.createEl("button");r.setText("Confirm"),r.addClass("mod-cta"),r.addEventListener("click",()=>{this.onConfirm(),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};re();var pe=class{constructor(i,e,t,s,a,n){this.app=i;this.plugin=e;this.getSelectedFiles=t;this.clearSelection=s;this.refreshView=a;this.showToolbar=n;this.bulkOps=new I(i)}async handleSetDraft(i){let e=this.getSelectedFiles();e.length!==0&&(this.plugin.settings.confirmBulkOperations?new z(this.app,e,"draft",()=>{(async()=>(await this.bulkOps.setDraft(e,!0,i),this.refreshView()))()}).open():(await this.bulkOps.setDraft(e,!0,i),this.refreshView()))}async handlePublish(i){let e=this.getSelectedFiles();e.length!==0&&(this.plugin.settings.confirmBulkOperations?new z(this.app,e,"publish",()=>{(async()=>(await this.bulkOps.setDraft(e,!1,i),this.refreshView()))()}).open():(await this.bulkOps.setDraft(e,!1,i),this.refreshView()))}handleManageTags(){let i=this.getSelectedFiles();if(i.length===0)return;let e=new ie(this.app,i);e.onClose=()=>{this.showToolbar(),this.refreshView()},e.open()}handleSetProperty(){let i=this.getSelectedFiles();if(i.length===0)return;let e=new ne(this.app,i);e.onClose=()=>{this.showToolbar(),this.refreshView()},e.open()}handleRemoveProperty(){let i=this.getSelectedFiles();if(i.length===0)return;let e=new ae(this.app,i);e.onClose=()=>{this.showToolbar(),this.refreshView()},e.open()}async handleDelete(){let i=this.getSelectedFiles();if(i.length!==0)if(this.plugin.settings.confirmDeletions){let e=await oe(this.app,i,this.plugin.settings);new U(this.app,e,()=>{this.clearSelection(),this.refreshView()}).open()}else{let e=await oe(this.app,i,this.plugin.settings);await H(this.app,e),this.clearSelection(),this.refreshView()}}};var de=class{constructor(i,e,t,s,a,n,r,l){this.app=i;this.plugin=e;this.container=t;this.getSelectedFiles=s;this.clearSelection=a;this.refreshView=n;this.toolbarEl=null;this.countEl=null;this.resizeObserver=null;this.timeoutIds=[];this.selectAllCallback=r,this.settings=l,this.actions=new pe(this.app,this.plugin,this.getSelectedFiles,this.clearSelection,this.refreshView,()=>this.show()),this.createToolbar()}updateSettings(i){this.settings=i}getActions(){return this.actions}createToolbar(){this.toolbarEl=document.createElement("div"),this.toolbarEl.className="bases-toolbar bases-cms-bulk-toolbar bases-cms-bulk-toolbar-hidden",this.toolbarEl.__bulkToolbarInstance=this,this.createToolbarContent(),this.positionToolbar();let i=window.setTimeout(()=>this.positionToolbar(),100);this.timeoutIds.push(i)}positionToolbar(){if(!this.toolbarEl)return;let i=this.container.closest(".bases-header");if(!i){let t=this.container.parentElement;for(;t&&!i;){if(t.classList.contains("bases-header")){i=t;break}t=t.parentElement}}if(!i){let t=Array.from(document.querySelectorAll(".bases-header"));for(let s of t)if(s.contains(this.container)){i=s;break}}let e=this.container.closest(".view-content");if(e)this.toolbarEl.parentElement!==e?(this.toolbarEl.parentElement&&this.toolbarEl.remove(),e.insertBefore(this.toolbarEl,this.container)):this.toolbarEl.nextSibling!==this.container&&(this.toolbarEl.parentElement&&this.toolbarEl.remove(),e.insertBefore(this.toolbarEl,this.container));else if(i&&i.parentElement)this.toolbarEl.parentElement!==i.parentElement&&(this.toolbarEl.parentElement&&this.toolbarEl.remove(),i.parentElement.insertBefore(this.toolbarEl,i.nextSibling));else{let t=this.container.parentElement;t&&(this.toolbarEl.parentElement!==t||this.toolbarEl.nextSibling!==this.container)&&(this.toolbarEl.parentElement&&this.toolbarEl.remove(),t.insertBefore(this.toolbarEl,this.container))}}createToolbarContent(){if(!this.toolbarEl)return;let i=this.toolbarEl.createDiv("bases-cms-bulk-toolbar-left"),e=(a,n,r,l,c=!1)=>{let d=l.createDiv("bases-toolbar-item").createDiv("text-icon-button");c&&d.addClass("destructive"),d.setAttribute("tabindex","0");let f=d.createSpan("text-button-icon");return(0,Xe.setIcon)(f,a),d.createSpan("text-button-label").setText(n),d.addEventListener("click",r),d};this.plugin.settings.showToolbarSelectAll&&e("copy-check","Select all",()=>this.handleSelectAll(),i),this.plugin.settings.showToolbarClear&&e("square-x","Clear",()=>this.clearSelection(),i);let t=i.createDiv("bases-toolbar-item bases-cms-selected-count");this.countEl=t.createSpan("text-button-label"),this.countEl.setText("0 selected");let s=this.toolbarEl.createDiv("bases-cms-bulk-toolbar-right");this.plugin.settings.showToolbarPublish&&e("book-check","Publish",()=>{this.actions.handlePublish(this.settings)},s),this.plugin.settings.showToolbarDraft&&e("book-dashed","Draft",()=>{this.actions.handleSetDraft(this.settings)},s),this.plugin.settings.showToolbarTags&&e("tags","Tags",()=>this.actions.handleManageTags(),s),this.plugin.settings.showToolbarSet&&e("list-check","Set",()=>this.actions.handleSetProperty(),s),this.plugin.settings.showToolbarRemove&&e("list-x","Remove",()=>this.actions.handleRemoveProperty(),s),this.plugin.settings.showToolbarDelete&&e("trash-2","Delete",()=>{this.actions.handleDelete()},s,!0),this.setupResponsiveBehavior()}setupResponsiveBehavior(){if(!this.toolbarEl)return;let i=window.setTimeout(()=>{this.updateCollapsedState()},100);this.timeoutIds.push(i),this.toolbarEl&&(this.resizeObserver=new ResizeObserver(()=>{this.updateCollapsedState()}),this.resizeObserver.observe(this.toolbarEl));let e=this.container;if(e){let t=new ResizeObserver(()=>{let s=window.setTimeout(()=>{this.updateCollapsedState()},10);this.timeoutIds.push(s)});t.observe(e),this.containerObserver=t}}updateCollapsedState(){if(!this.toolbarEl)return;this.toolbarEl.offsetWidth<680?this.toolbarEl.addClass("collapsed"):this.toolbarEl.removeClass("collapsed")}updateCount(i){this.countEl&&this.countEl.setText(`${i} selected`)}handleSelectAll(){this.selectAllCallback&&this.selectAllCallback()}show(){if(this.toolbarEl||(console.warn("[Bases CMS] Toolbar element not found, recreating..."),this.createToolbar()),this.toolbarEl){this.positionToolbar(),this.toolbarEl.parentElement||(console.warn("[Bases CMS] Toolbar not in DOM, repositioning..."),this.positionToolbar()),this.toolbarEl.removeClass("bases-cms-bulk-toolbar-hidden"),this.toolbarEl.addClass("bases-cms-bulk-toolbar-visible"),this.toolbarEl.offsetHeight;let i=window.setTimeout(()=>{this.toolbarEl&&(this.toolbarEl.removeClass("bases-cms-bulk-toolbar-animating-out"),this.toolbarEl.addClass("bases-cms-bulk-toolbar-animating-in"))},10);this.timeoutIds.push(i)}else console.error("[Bases CMS] Failed to show toolbar - element is null")}hide(){if(this.toolbarEl){this.toolbarEl.removeClass("bases-cms-bulk-toolbar-animating-in"),this.toolbarEl.addClass("bases-cms-bulk-toolbar-animating-out");let i=window.setTimeout(()=>{this.toolbarEl&&(this.toolbarEl.removeClass("bases-cms-bulk-toolbar-visible"),this.toolbarEl.addClass("bases-cms-bulk-toolbar-hidden"))},200);this.timeoutIds.push(i)}}recreate(){let i=this.toolbarEl&&!this.toolbarEl.hasClass("bases-cms-bulk-toolbar-hidden"),e=0;if(this.countEl&&this.countEl.textContent){let t=this.countEl.textContent.match(/\d+/);t&&(e=parseInt(t[0],10))}this.destroy(),this.createToolbar(),i&&this.toolbarEl&&e>0&&(this.updateCount(e),this.show())}destroy(){this.timeoutIds.forEach(e=>window.clearTimeout(e)),this.timeoutIds=[],this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null);let i=this.containerObserver;i&&(i.disconnect(),this.containerObserver=void 0),this.toolbarEl&&(this.toolbarEl.remove(),this.toolbarEl=null)}};$();function Ye(o,i,e,t,s){let a=l=>{var w;let c=l.target,p=c.closest(".bases-toolbar-new-item-menu .text-icon-button, .bases-toolbar-new-item-menu");if(!p||c.closest(".bases-cms-bulk-toolbar, .bases-cms-container .card"))return;let d=o.workspace.activeLeaf,f=d==null?void 0:d.view,h=f?f.containerEl:null;if(!(f&&h&&(h===i||((w=p.closest(".workspace-leaf"))==null?void 0:w.contains(h)))))return;let v=D(e,t);v.customizeNewButton&&(l.preventDefault(),l.stopPropagation(),l.stopImmediatePropagation(),(async()=>{var m;let C=((m=v.newNoteLocation)==null?void 0:m.trim())||"";if(C===""){let y=o.vault.config,S=(y==null?void 0:y.newFileLocation)||"folder",E=(y==null?void 0:y.newFileFolderPath)||"";console.debug("[CMS View] Obsidian config:",{newFileLocation:S,newFileFolderPath:E});let k="Untitled.md";if(S==="folder"&&E)k=`${E}/Untitled.md`;else if(S==="current"){let T=o.workspace.getActiveFile();T&&T.parent&&(k=`${T.parent.path}/Untitled.md`)}else S==="root"&&(k="Untitled.md");console.debug("[CMS View] Creating file at:",k);let P=await o.vault.create(k,"");await o.workspace.openLinkText(P.path,"",!1);return}if(C==="/"||C.replace(/\//g,"")===""){let y=await o.vault.create("Untitled.md","");await o.workspace.openLinkText(y.path,"",!1);return}let g=C.replace(/^\/+|\/+$/g,""),b=o.vault.getAbstractFileByPath(g);if((!b||!("children"in b))&&(await o.vault.createFolder(g),b=o.vault.getAbstractFileByPath(g)),b&&"children"in b){let y=await o.vault.create(`${g}/Untitled.md`,"");await o.workspace.openLinkText(y.path,"",!1)}})())};document.addEventListener("click",a,!0);let n=new MutationObserver(()=>{document.querySelectorAll(".bases-toolbar-new-item-menu .text-icon-button, .bases-toolbar-new-item-menu").forEach(c=>{let p=c;p.__cmsIntercepted||(p.__cmsIntercepted=!0,c.addEventListener("click",a,!0))})});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelectorAll(".bases-toolbar-new-item-menu .text-icon-button, .bases-toolbar-new-item-menu").forEach(l=>{let c=l;c.__cmsIntercepted||(c.__cmsIntercepted=!0,l.addEventListener("click",a,!0))}),s(()=>{document.removeEventListener("click",a,!0),n.disconnect()})}var W=require("obsidian"),ue=class extends W.Modal{constructor(e,t,s,a,n){super(e);this.dontShowAgain=!1;this.config=t,this.pluginSettings=s,this.plugin=a,this.propertiesButton=n}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Properties in CMS Views"});let t=e.createDiv("properties-info-explanation");t.createEl("p",{text:"In CMS views, properties work differently than in standard Base views. Instead of toggling properties on/off with checkboxes, you configure which properties to display in the view settings."}),t.createEl("p",{text:"That being said, you can view all available properties and formulas. However, checking or unchecking properties in the dropdown won't affect what's displayed on cards in CMS views."}),e.createDiv("properties-info-special").createEl("p",{text:"Some properties have special hardcoded placements on cards, like title, image, draft status, and tags."});let a=e.createDiv("properties-info-howto");a.createEl("h3",{text:"How to Configure Properties"}),a.createEl("p",{text:"To configure which properties appear on cards:"}),a.createEl("p",{text:"Click the name of the view you'd like to edit, and select the right arrow/chevron icon to the configure view menu. Here's where you can adjust card size, image placement, and other properties to show."});let n=new W.Setting(e).setName("Don't show this message again").addToggle(r=>{r.setValue(this.dontShowAgain).onChange(l=>{this.dontShowAgain=l})});new W.Setting(e).addButton(r=>{r.setButtonText("I understand").setCta().onClick(async()=>{this.dontShowAgain&&(this.plugin.settings.showPropertiesInfoModal=!1,await this.plugin.saveSettings()),this.close(),setTimeout(()=>{this.propertiesButton&&(window.__cmsSkipPropertiesInterception=!0,this.propertiesButton.click(),setTimeout(()=>{delete window.__cmsSkipPropertiesInterception},50))},100)})})}onClose(){let{contentEl:e}=this;e.empty()}};function et(o,i,e,t,s,a){let n=p=>{var y;let d=p.target;if(window.__cmsSkipPropertiesInterception||!(i.classList.contains("bases-cms-container")||i.querySelector(".bases-cms-container")!==null||i.closest(".bases-cms-container")!==null))return;let h=d.closest('.bases-toolbar-properties-menu, .bases-toolbar-properties-menu .text-icon-button, .bases-toolbar-properties, .bases-toolbar-properties-item, [aria-label*="properties" i], [aria-label*="Properties" i]');if(!h){let S=d.closest(".text-icon-button, .bases-toolbar-item");if(S){let E=S.querySelector(".text-button-icon, svg");if(E){let k=E.querySelector("svg")||(E.tagName==="svg"?E:null);if(k){let P=k.getAttribute("data-lucide");P&&["list","layout-list","columns","layout-grid","sidebar"].includes(P)&&(h=S)}}}}if(!h){let S=d.closest(".bases-toolbar, .bases-header");if(S){let E=S.querySelector('.bases-toolbar-properties, [aria-label*="properties" i], [aria-label*="Properties" i]');E&&(E.contains(d)||d.closest(".bases-toolbar-item")===E)&&(h=E)}}if(!h||d.closest(".bases-cms-bulk-toolbar, .bases-cms-container .card, .modal"))return;let u=o.workspace.activeLeaf,v=u==null?void 0:u.view,w=v?v.containerEl:null;if(!(v&&w&&(w===i||((y=h==null?void 0:h.closest(".workspace-leaf"))==null?void 0:y.contains(w))))||!s.settings.showPropertiesInfoModal)return;p.preventDefault(),p.stopPropagation(),p.stopImmediatePropagation();let g=h.querySelector(".text-icon-button")||h,b=e;if(!b||typeof b.get!="function"){let S=o.workspace.activeLeaf,E=S==null?void 0:S.view;E!=null&&E.config&&typeof E.config.get=="function"&&(b=E.config)}new ue(o,b,t,s,g).open()};document.addEventListener("click",n,!0);let r=p=>{var f;if(p.classList.contains("bases-toolbar-properties-menu")||p.classList.contains("bases-toolbar-properties")||p.classList.contains("bases-toolbar-properties-item")||(f=p.getAttribute("aria-label"))!=null&&f.toLowerCase().includes("properties")||p.closest(".bases-toolbar-properties-menu"))return!0;let d=p.querySelector(".text-button-icon, svg");if(d){let h=d.querySelector("svg")||(d.tagName==="svg"?d:null);if(h){let u=h.getAttribute("data-lucide");if(u&&["list","layout-list","columns","layout-grid","sidebar"].includes(u))return!0}}return!1},l=new MutationObserver(()=>{document.querySelectorAll(".bases-toolbar-properties-menu, .bases-toolbar .text-icon-button, .bases-toolbar .bases-toolbar-item, .bases-toolbar-properties, .bases-toolbar-properties-item").forEach(d=>{if(r(d)){let f=d;f.__cmsPropertiesIntercepted||(f.__cmsPropertiesIntercepted=!0,d.addEventListener("click",n,!0))}})});l.observe(document.body,{childList:!0,subtree:!0}),document.querySelectorAll(".bases-toolbar-properties-menu, .bases-toolbar .text-icon-button, .bases-toolbar .bases-toolbar-item, .bases-toolbar-properties, .bases-toolbar-properties-item").forEach(p=>{if(r(p)){let d=p;d.__cmsPropertiesIntercepted||(d.__cmsPropertiesIntercepted=!0,p.addEventListener("click",n,!0))}}),a(()=>{document.removeEventListener("click",n,!0),l.disconnect()})}var tt=require("obsidian");$();var he=class{constructor(i,e,t,s){this.app=i;this.config=e;this.pluginSettings=t;this.onRefresh=s}async handlePropertyToggle(i,e,t){try{let s=this.app.vault.getAbstractFileByPath(i);if(!(s instanceof tt.TFile))return;let a=e.startsWith("note.")?e.substring(5):e,n=D(this.config,this.pluginSettings),r=n.showDraftStatus&&a==="draft",l=!1;if(r)if(n.draftStatusUseFilenamePrefix){let c=s.basename,p=c.startsWith("_"),f=s.path.split("/");if(t===!0){if(!p){let h=`_${c}${s.extension?`.${s.extension}`:""}`;f[f.length-1]=h;let u=f.join("/");await this.app.fileManager.renameFile(s,u),l=!0}}else if(p){let h=c.substring(1)+(s.extension?`.${s.extension}`:"");f[f.length-1]=h;let u=f.join("/");await this.app.fileManager.renameFile(s,u),l=!0}}else{let c=n.draftStatusProperty&&n.draftStatusProperty.trim()?n.draftStatusProperty.startsWith("note.")?n.draftStatusProperty.substring(5):n.draftStatusProperty:"draft";await this.app.fileManager.processFrontMatter(s,p=>{p[c]=t}),l=!0}else await this.app.fileManager.processFrontMatter(s,c=>{c[a]=t}),l=!0;l&&requestAnimationFrame(()=>{window.setTimeout(()=>{try{this.onRefresh()}catch(c){console.error("Error refreshing view after property toggle:",c)}},100)})}catch(s){console.error("Error toggling property:",s)}}};$();var ge=class{constructor(i,e,t,s,a,n){this.containerEl=i;this.app=e;this.config=t;this.pluginSettings=s;this.onLoadMore=a;this.registerCleanup=n;this.scrollListener=null;this.scrollThrottleTimeout=null;this.resizeObserver=null;this.windowResizeHandler=null;this.isLoading=!1;this.displayedCount=50;this.totalEntries=0;var l;let r=(l=this.app.isMobile)!=null?l:!1;this.displayedCount=r?25:50}setDisplayedCount(i){this.displayedCount=i}getDisplayedCount(){return this.displayedCount}setIsLoading(i){this.isLoading=i}setupInfiniteScroll(i){this.totalEntries=i,this.scrollListener&&(this.containerEl.removeEventListener("scroll",this.scrollListener),this.scrollListener=null),!(this.displayedCount>=i)&&(this.scrollListener=()=>{var c;if(this.scrollThrottleTimeout!==null||this.isLoading)return;let e=this.containerEl.scrollTop,t=this.containerEl.scrollHeight,s=this.containerEl.clientHeight,a=t-(e+s),r=((c=this.app.isMobile)!=null?c:!1)?1:2,l=s*r;if(a<l&&this.displayedCount<i){this.isLoading=!0;let p=50;this.displayedCount=Math.min(this.displayedCount+p,i),this.onLoadMore()}this.scrollThrottleTimeout=window.setTimeout(()=>{this.scrollThrottleTimeout=null},100)},this.containerEl.addEventListener("scroll",this.scrollListener),this.registerCleanup(()=>{this.scrollListener&&this.containerEl.removeEventListener("scroll",this.scrollListener),this.scrollThrottleTimeout!==null&&window.clearTimeout(this.scrollThrottleTimeout)}))}setupResizeObserver(){if(this.resizeObserver)return;let i=()=>{if(!this.config||typeof this.config.get!="function")return;let e=D(this.config,this.pluginSettings),t=e.cardSize;this.containerEl.style.setProperty("--card-min-width",`${t}px`),this.containerEl.style.setProperty("--dynamic-views-image-aspect-ratio",String(e.imageAspectRatio))};this.resizeObserver=new ResizeObserver(i),this.resizeObserver.observe(this.containerEl),i()}updateGridLayout(i){this.containerEl.style.setProperty("--card-min-width",`${i.cardSize}px`),this.containerEl.style.setProperty("--dynamic-views-image-aspect-ratio",String(i.imageAspectRatio))}cleanup(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.windowResizeHandler&&(window.removeEventListener("resize",this.windowResizeHandler),this.windowResizeHandler=null),this.scrollListener&&(this.containerEl.removeEventListener("scroll",this.scrollListener),this.scrollListener=null),this.scrollThrottleTimeout!==null&&(window.clearTimeout(this.scrollThrottleTimeout),this.scrollThrottleTimeout=null)}};var me=class{constructor(i,e,t,s,a,n,r,l){this.containerEl=i;this.plugin=e;this.config=t;this.controller=s;this.data=a;this.selectedFiles=n;this.onSelectionCleared=r;this.registerCleanup=l;this.mutationObserver=null;this.backupInterval=null;this.currentBaseIdentifier=null}setup(i){let e=()=>{this.mutationObserver||(this.mutationObserver=new MutationObserver(l=>{if(this.selectedFiles.size!==0){for(let c of l)if(c.type==="childList"&&c.removedNodes.length>0){let p=!1;for(let f of this.selectedFiles)if(this.containerEl.querySelector(`[data-path="${f}"]`)){p=!0;break}let d=this.containerEl.querySelectorAll(".card[data-path]");if(!p||d.length===0){this.selectedFiles.clear(),this.onSelectionCleared();break}}}}),this.containerEl&&this.mutationObserver.observe(this.containerEl,{childList:!0,subtree:!0}))},t=()=>{this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null,this.selectedFiles.size>0&&this.selectedFiles.clear(),this.onSelectionCleared())},s=()=>{var l,c,p,d;try{if((l=this.config)!=null&&l.getName)return this.config.getName();if((c=this.config)!=null&&c.name)return String(this.config.name);if(this.controller){if((p=this.controller)!=null&&p.getBaseName)return this.controller.getBaseName();if((d=this.controller)!=null&&d.baseName)return String(this.controller.baseName)}if(this.data&&this.data.baseName)return String(this.data.baseName)}catch(f){}return null},a=()=>{if(this.selectedFiles.size===0){this.backupInterval!==null&&(window.clearInterval(this.backupInterval),this.backupInterval=null);return}let l=s();if(this.currentBaseIdentifier!==null&&l!==null&&this.currentBaseIdentifier!==l){this.selectedFiles.clear(),this.onSelectionCleared(),t(),this.backupInterval!==null&&(window.clearInterval(this.backupInterval),this.backupInterval=null);return}this.containerEl.querySelectorAll(".card[data-path]").length===0&&(this.selectedFiles.clear(),this.onSelectionCleared())},n=i.bind(this),r=(l,c)=>{n(l,c),this.selectedFiles.size>0?(this.currentBaseIdentifier===null&&(this.currentBaseIdentifier=s()),e(),this.backupInterval===null&&(this.backupInterval=this.plugin.registerInterval(window.setInterval(a,500)))):(this.currentBaseIdentifier=null,t(),this.backupInterval!==null&&(window.clearInterval(this.backupInterval),this.backupInterval=null))};return this.registerCleanup(()=>{t(),this.backupInterval!==null&&(window.clearInterval(this.backupInterval),this.backupInterval=null)}),r}cleanup(){this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null),this.backupInterval!==null&&(window.clearInterval(this.backupInterval),this.backupInterval=null)}};var xe="bases-cms",fe=class extends q.BasesView{constructor(e,t,s){super(e);this.type=xe;this.selectedFiles=new Set;this.snippets={};this.images={};this.hasImageAvailable={};this.updateLayoutRef={current:null};this.propertyObservers=[];this.bulkToolbar=null;this.isRefreshingWithSelection=!1;this.containerEl=t,this.plugin=s,this.cardRenderer=new te(this.app,this.plugin,this.propertyObservers,this.updateLayoutRef,void 0,e),this.containerEl.addClass("bases-cms"),this.containerEl.addClass("bases-cms-container"),this.propertyToggleHandler=new he(this.app,this.config,this.plugin.settings,()=>this.onDataUpdated()),this.scrollLayoutManager=new ge(this.containerEl,this.app,this.config,this.plugin.settings,()=>this.onDataUpdated(),n=>this.register(n)),this.viewSwitchListener=new me(this.containerEl,this.plugin,this.config,this.controller,this.data,this.selectedFiles,()=>this.updateSelectionUI(),n=>this.register(n)),Ye(this.app,this.containerEl,this.config,this.plugin.settings,n=>this.register(n)),et(this.app,this.containerEl,this.config,this.plugin.settings,this.plugin,n=>this.register(n));let a=this.handleSelectionChange.bind(this);this.handleSelectionChange=this.viewSwitchListener.setup(a)}onDataUpdated(){let e=this.app.workspace.activeLeaf,t=e==null?void 0:e.view;if(t&&this.selectedFiles.size>0&&t!==this){if(!(this.containerEl&&this.containerEl.isConnected&&this.containerEl.offsetParent!==null)){this.selectedFiles.clear(),this.updateSelectionUI();return}let n=t.containerEl;if(!n||!n.contains(this.containerEl)){this.selectedFiles.clear(),this.updateSelectionUI();return}}if(!(this.containerEl&&this.containerEl.isConnected&&this.containerEl.offsetParent!==null)&&this.selectedFiles.size>0){this.selectedFiles.clear(),this.updateSelectionUI();return}(async()=>{var C;let a=this.data.groupedData,n=this.data.data,r=D(this.config,this.plugin.settings);r.fallbackToEmbeds||(this.images={},this.hasImageAvailable={}),this.cardRenderer.basesConfig=this.config,this.scrollLayoutManager.updateGridLayout(r);let l=this.containerEl.scrollTop,c=this.getSortMethod(),p=a.map(g=>({group:g,entries:[...g.entries]})),d=[],f=this.scrollLayoutManager.getDisplayedCount();for(let g of p){if(f<=0)break;let b=Math.min(g.entries.length,f);d.push(...g.entries.slice(0,b)),f-=b}let h=[];if(r.imageFormat!=="none"){let g=d.filter(m=>!(m.file.path in this.images)).map(m=>{let y=this.app.vault.getAbstractFileByPath(m.file.path);if(!(y instanceof q.TFile))return null;let S=ye(m,r.imageProperty);return{path:m.file.path,file:y,imagePropertyValues:S}}).filter(m=>m!==null),b=n.filter(m=>!(m.file.path in this.images)&&!d.some(y=>y.file.path===m.file.path)).map(m=>{let y=this.app.vault.getAbstractFileByPath(m.file.path);if(!(y instanceof q.TFile))return null;let S=ye(m,r.imageProperty);return{path:m.file.path,file:y,imagePropertyValues:S}}).filter(m=>m!==null);if(g.length>0&&h.push(Te(g,r.fallbackToEmbeds,this.app,this.images,this.hasImageAvailable).then(()=>{requestAnimationFrame(()=>{g.forEach(m=>{m.path in this.images&&this.updateCardImage(m.path,this.images[m.path])})})})),b.length>0&&h.push(Te(b,r.fallbackToEmbeds,this.app,this.images,this.hasImageAvailable)),r.fallbackToEmbeds){let y=[...g,...b].filter(S=>{let E=S.imagePropertyValues&&Array.isArray(S.imagePropertyValues)&&S.imagePropertyValues.length>0;return!(S.path in this.images)&&!this.hasImageAvailable[S.path]&&!E});y.length>0&&h.push($e(y,this.app,this.images,this.hasImageAvailable).then(()=>{requestAnimationFrame(()=>{y.forEach(S=>{S.path in this.images&&this.updateCardImage(S.path,this.images[S.path])})})}))}}if(r.showTextPreview){let g=d.filter(b=>!(b.file.path in this.snippets)).map(b=>{let m=this.app.vault.getAbstractFileByPath(b.file.path);if(!(m instanceof q.TFile))return null;let y=M(b,r.descriptionProperty);return{path:b.file.path,file:m,descriptionData:y==null?void 0:y.data}}).filter(b=>b!==null);qe(g,r.fallbackToContent,!1,this.app,this.snippets).then(()=>{requestAnimationFrame(()=>{g.forEach(b=>{if(b.path in this.snippets&&this.snippets[b.path]){let m=this.containerEl.querySelector(`[data-path="${b.path}"]`);if(m){let y=m.__textPreviewEl;y&&(!y.textContent||y.textContent.trim().length===0)&&y.setText(this.snippets[b.path])}}})})})}let u=null;if(this.isRefreshingWithSelection&&this.bulkToolbar){let g=this.containerEl.querySelector(".bases-cms-bulk-toolbar");g instanceof HTMLElement&&(u=g,u.remove())}this.containerEl.empty(),this.propertyObservers.forEach(g=>g.disconnect()),this.propertyObservers=[];let v=this.containerEl.createDiv("bases-cms-grid"),w=0;for(let g of p){if(w>=this.scrollLayoutManager.getDisplayedCount())break;let b=Math.min(g.entries.length,this.scrollLayoutManager.getDisplayedCount()-w);if(b===0)continue;let m=g.entries.slice(0,b),y=v.createDiv("bases-cms-group");if(g.group.hasKey()){let k=y.createDiv("bases-cms-group-heading").createDiv("bases-cms-group-value"),P=((C=g.group.key)==null?void 0:C.toString())||"";k.setText(P)}let S=Be(m,r,c,!1,this.snippets,this.images,this.hasImageAvailable);for(let E=0;E<S.length;E++){let k=S[E],P=m[E];this.renderCard(y,k,P,w+E,r)}w+=b}l>0&&(this.containerEl.scrollTop=l),this.scrollLayoutManager.setupInfiniteScroll(n.length),this.scrollLayoutManager.setupResizeObserver(),u&&this.bulkToolbar&&(this.containerEl.appendChild(u),this.bulkToolbar.toolbarEl=u),this.isRefreshingWithSelection?(this.containerEl.querySelectorAll(".card").forEach(b=>{let m=b.getAttribute("data-path"),y=b.querySelector('input[type="checkbox"].selection-checkbox');if(m){let S=this.selectedFiles.has(m);S?b.addClass("selected"):b.removeClass("selected"),y&&(y.checked=S)}}),u&&this.bulkToolbar&&(this.bulkToolbar.show(),this.bulkToolbar.updateCount(this.selectedFiles.size))):this.updateSelectionUI(),this.scrollLayoutManager.setIsLoading(!1)})()}getDirectDeleteHandler(e){return async()=>{let{prepareDeletionPreview:t,executeSmartDeletion:s}=await Promise.resolve().then(()=>(re(),Je)),{DeletionPreviewModal:a}=await Promise.resolve().then(()=>(Pe(),Ze));if(this.plugin.settings.confirmDeletions){let n=await t(this.app,[e],this.plugin.settings);new a(this.app,n,()=>{this.onDataUpdated()}).open()}else{let n=await t(this.app,[e],this.plugin.settings);await s(this.app,n),this.onDataUpdated()}}}renderCard(e,t,s,a,n){let r=this.selectedFiles.has(t.path);return this.cardRenderer.renderCard(e,t,s,n,this,r,(l,c)=>{this.handleSelectionChange(l,c)},(l,c,p)=>{this.handlePropertyToggle(l,c,p)},{handleDelete:this.getDirectDeleteHandler(t.path)})}updateCardImage(e,t){var r;let s=this.containerEl.querySelector(`.card[data-path="${e}"]`);if(!s)return;let a=Array.isArray(t)?t[0]:t;if(!a)return;let n=s.querySelector(".image-embed");if(!n){let l=s.querySelector(".card-cover-placeholder, .card-thumbnail-placeholder");if(l){let c=l.querySelector(".card-status-badge"),p=l.classList.contains("card-cover-placeholder")?"card-cover":"card-thumbnail",d=(r=l.parentElement)==null?void 0:r.createDiv(p);d&&(n=d.createDiv("image-embed"),c&&d.appendChild(c),l.remove())}}n&&((async()=>{let l=await X(a,this.plugin.settings.forceStaticGifImages);n.style.backgroundImage=`url("${l}")`})(),n.style.backgroundImage=`url("${a}")`,n.style.backgroundSize="cover",n.style.backgroundPosition="center center",n.style.backgroundRepeat="no-repeat")}getSortMethod(){let e=this.config.getSort();if(e&&e.length>0){let t=e[0],s=t.property,a=t.direction.toLowerCase();if(s.includes("ctime"))return`ctime-${a}`;if(s.includes("mtime"))return`mtime-${a}`}return"mtime-desc"}handleSelectionChange(e,t){if(t?this.selectedFiles.add(e):this.selectedFiles.delete(e),this.updateSelectionUI(),this.selectedFiles.size===0&&this.bulkToolbar){this.bulkToolbar.hide();let s=this.containerEl.querySelector(".bases-cms-bulk-toolbar");s instanceof HTMLElement&&(s.removeClass("bases-cms-bulk-toolbar-visible"),s.addClass("bases-cms-bulk-toolbar-hidden"))}}async handlePropertyToggle(e,t,s){await this.propertyToggleHandler.handlePropertyToggle(e,t,s)}selectAll(){this.containerEl.querySelectorAll(".bases-cms-card").forEach(t=>{let s=t.getAttribute("data-path");s&&this.selectedFiles.add(s)}),this.updateSelectionUI()}deselectAll(){this.selectedFiles.clear(),this.updateSelectionUI()}refreshToolbar(){if(this.bulkToolbar){let e=this.selectedFiles.size;this.bulkToolbar.recreate(),e>0&&this.bulkToolbar.updateCount(e)}}updateSelectionUI(){if(this.containerEl.querySelectorAll(".card").forEach(t=>{let s=t.getAttribute("data-path"),a=t.querySelector('input[type="checkbox"].selection-checkbox');if(s){let n=this.selectedFiles.has(s);n?t.addClass("selected"):t.removeClass("selected"),a&&(a.checked=n)}}),this.selectedFiles.size>0){if(document.querySelectorAll(".bases-cms-bulk-toolbar").forEach(s=>{let a=s.__bulkToolbarInstance;(!a||a!==this.bulkToolbar)&&s.remove()}),this.bulkToolbar){let s=D(this.config,this.plugin.settings);this.bulkToolbar.updateSettings(s)}else{let s=D(this.config,this.plugin.settings);this.bulkToolbar=new de(this.app,this.plugin,this.containerEl,()=>Array.from(this.selectedFiles),()=>{this.selectedFiles.clear(),this.updateSelectionUI()},()=>{let a=Array.from(this.selectedFiles);this.isRefreshingWithSelection=!0,this.bulkToolbar&&a.length>0&&this.bulkToolbar.show(),this.onDataUpdated(),window.setTimeout(()=>{a.forEach(n=>{this.app.vault.getAbstractFileByPath(n)&&this.selectedFiles.add(n)}),this.isRefreshingWithSelection=!1,this.updateSelectionUI(),this.selectedFiles.size>0&&this.bulkToolbar&&(this.bulkToolbar.show(),this.bulkToolbar.updateCount(this.selectedFiles.size)),window.setTimeout(()=>{this.selectedFiles.size>0&&this.bulkToolbar&&(this.bulkToolbar.show(),this.bulkToolbar.updateCount(this.selectedFiles.size))},100)},250)},()=>{this.selectAll()},s)}this.bulkToolbar.updateCount(this.selectedFiles.size),this.bulkToolbar.show()}else if(this.bulkToolbar&&!this.isRefreshingWithSelection){this.bulkToolbar.hide();let t=this.containerEl.querySelector(".bases-cms-bulk-toolbar");t instanceof HTMLElement&&(t.removeClass("bases-cms-bulk-toolbar-visible"),t.addClass("bases-cms-bulk-toolbar-hidden"))}}onClose(){this.scrollLayoutManager.cleanup(),this.viewSwitchListener.cleanup(),this.propertyObservers.forEach(s=>s.disconnect()),this.propertyObservers=[],this.bulkToolbar&&this.bulkToolbar.destroy(),this.selectedFiles.clear(),document.querySelectorAll(".bases-cms-bulk-toolbar").forEach(s=>s.remove());let t=this.plugin;t&&typeof t.removeView=="function"&&t.removeView(this)}async onNew(){let e=D(this.config,this.plugin.settings);if(e.customizeNewButton&&e.newNoteLocation&&e.newNoteLocation.trim()!=="")try{let t=e.newNoteLocation.trim().replace(/^\/+|\/+$/g,""),s=this.app.vault.getAbstractFileByPath(t);if((!s||!("children"in s))&&(await this.app.vault.createFolder(t),s=this.app.vault.getAbstractFileByPath(t)),s&&"children"in s){let a=await this.app.vault.create(`${t}/Untitled.md`,"");return await this.app.workspace.openLinkText(a.path,"",!1),!0}}catch(t){console.error("[CMS View] Error creating new note:",t)}return!1}};function De(o,i=5){try{let e=o;if(typeof e.registerBasesView=="function")e.registerBasesView(xe,{name:"CMS",icon:o.settings.useHomeIcon?"lucide-home":"lucide-blocks",factory:(t,s)=>{let a=new fe(t,s,o),n=o;return n.activeViews&&n.activeViews.add(a),a},options:xt()});else if(i>0){let t=o,s=t.registrationTimeout;s!=null&&window.clearTimeout(s),t.registrationTimeout=window.setTimeout(()=>{t.registrationTimeout=null,De(o,i-1)},200)}else console.warn("Bases CMS: registerBasesView not available. Is Bases plugin installed?")}catch(e){console.error("Bases CMS: Error registering view:",e)}}function xt(){let{getCMSViewOptions:o}=($(),Fe(Le));return o}var be=class extends st.Plugin{constructor(){super(...arguments);this.activeViews=new Set;this.registrationTimeout=null}async onload(){await this.loadSettings(),this.addSettingTab(new Z(this.app,this)),De(this)}onunload(){this.registrationTimeout!==null&&(window.clearTimeout(this.registrationTimeout),this.registrationTimeout=null),this.activeViews.clear()}async loadSettings(){this.settings=Object.assign({},Me,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}refreshAllToolbars(){let e=[];this.activeViews.forEach(t=>{let s=t.containerEl;(!s||!s.parentElement)&&e.push(t)}),e.forEach(t=>this.activeViews.delete(t)),this.activeViews.forEach(t=>{t&&typeof t.refreshToolbar=="function"&&t.refreshToolbar()})}removeView(e){this.activeViews.delete(e)}};
