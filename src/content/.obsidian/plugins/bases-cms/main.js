/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var ke=Object.defineProperty;var ct=Object.getOwnPropertyDescriptor;var dt=Object.getOwnPropertyNames;var ut=Object.prototype.hasOwnProperty;var J=(r,s)=>()=>(r&&(s=r(r=0)),s);var Z=(r,s)=>{for(var e in s)ke(r,e,{get:s[e],enumerable:!0})},ht=(r,s,e,i)=>{if(s&&typeof s=="object"||typeof s=="function")for(let t of dt(s))!ut.call(r,t)&&t!==e&&ke(r,t,{get:()=>s[t],enumerable:!(i=ct(s,t))||i.enumerable});return r};var Oe=r=>ht(ke({},"__esModule",{value:!0}),r);var Ue={};Z(Ue,{getCMSViewOptions:()=>yt,readCMSSettings:()=>F});function F(r,s){var i,t,n,o,a,p,l,c,u,h,w,g,f,m,T,S,y,d,C,v,b;let e=k=>{var P;return(P=r==null?void 0:r.get)==null?void 0:P.call(r,k)};return{titleProperty:e("titleProperty")||"",descriptionProperty:e("descriptionProperty")||"",imageProperty:e("imageProperty")||"",showTitle:(i=e("showTitle"))!=null?i:!0,showDate:(t=e("showDate"))!=null?t:!1,dateProperty:e("dateProperty")||"",dateIncludeTime:(n=e("dateIncludeTime"))!=null?n:!1,showTextPreview:(o=e("showTextPreview"))!=null?o:!0,fallbackToContent:(a=e("fallbackToContent"))!=null?a:!0,fallbackToEmbeds:(()=>{let k=e("fallbackToEmbeds");return k==="always"||k==="if-empty"||k==="never"?k:k===!1?"never":"if-empty"})(),propertyDisplay1:e("propertyDisplay1")||"",propertyDisplay2:e("propertyDisplay2")||"",propertyDisplay3:e("propertyDisplay3")||"",propertyDisplay4:e("propertyDisplay4")||"",propertyDisplay5:e("propertyDisplay5")||"",propertyDisplay6:e("propertyDisplay6")||"",propertyDisplay7:e("propertyDisplay7")||"",propertyDisplay8:e("propertyDisplay8")||"",propertyDisplay9:e("propertyDisplay9")||"",propertyDisplay10:e("propertyDisplay10")||"",propertyDisplay11:e("propertyDisplay11")||"",propertyDisplay12:e("propertyDisplay12")||"",propertyDisplay13:e("propertyDisplay13")||"",propertyDisplay14:e("propertyDisplay14")||"",propertyLayout12SideBySide:(p=e("propertyLayout12SideBySide"))!=null?p:!1,propertyLayout34SideBySide:(l=e("propertyLayout34SideBySide"))!=null?l:!1,propertyLayout56SideBySide:(c=e("propertyLayout56SideBySide"))!=null?c:!1,propertyLayout78SideBySide:(u=e("propertyLayout78SideBySide"))!=null?u:!1,propertyLayout910SideBySide:(h=e("propertyLayout910SideBySide"))!=null?h:!1,propertyLayout1112SideBySide:(w=e("propertyLayout1112SideBySide"))!=null?w:!1,propertyLayout1314SideBySide:(g=e("propertyLayout1314SideBySide"))!=null?g:!1,propertyGroup1Position:e("propertyGroup1Position")||"bottom",propertyGroup2Position:e("propertyGroup2Position")||"bottom",propertyGroup3Position:e("propertyGroup3Position")||"bottom",propertyGroup4Position:e("propertyGroup4Position")||"bottom",propertyGroup5Position:e("propertyGroup5Position")||"bottom",propertyGroup6Position:e("propertyGroup6Position")||"bottom",propertyGroup7Position:e("propertyGroup7Position")||"bottom",imageFormat:e("imageFormat")||"thumbnail",imagePosition:e("imagePosition")||"right",propertyLabels:e("propertyLabels")||"hide",showDraftStatus:(f=e("showDraftStatus"))!=null?f:!1,draftStatusProperty:e("draftStatusProperty")||"",draftStatusReverse:(m=e("draftStatusReverse"))!=null?m:!1,draftStatusUseFilenamePrefix:(T=e("draftStatusUseFilenamePrefix"))!=null?T:!1,showTags:(S=e("showTags"))!=null?S:!1,tagsProperty:e("tagsProperty")||"",maxTagsToShow:(y=e("maxTagsToShow"))!=null?y:3,customizeNewButton:(d=e("customizeNewButton"))!=null?d:!1,newNoteLocation:e("newNoteLocation")||"",hideQuickEditIcon:(C=e("hideQuickEditIcon"))!=null?C:!1,cardSize:(v=e("cardSize"))!=null?v:250,imageAspectRatio:(b=e("imageAspectRatio"))!=null?b:.55}}function yt(){return[{type:"slider",displayName:"Card size",key:"cardSize",min:50,max:800,step:10,default:250},{type:"group",displayName:"Title",items:[{type:"toggle",displayName:"Show title",key:"showTitle",default:!0},{type:"property",displayName:"Title property",key:"titleProperty",placeholder:"Select property",default:""}]},{type:"group",displayName:"Text preview",items:[{type:"toggle",displayName:"Show text preview",key:"showTextPreview",default:!0},{type:"property",displayName:"Text preview property",key:"descriptionProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Use note content if text preview property unavailable",key:"fallbackToContent",default:!0}]},{type:"group",displayName:"Image",items:[{type:"dropdown",displayName:"Image format",key:"imageFormat",options:{none:"No image",thumbnail:"Thumbnail",cover:"Cover"},default:"thumbnail"},{type:"property",displayName:"Image property",key:"imageProperty",placeholder:"Select property",default:""},{type:"dropdown",displayName:"Show image embeds",key:"fallbackToEmbeds",options:{always:"Always","if-empty":"If image property missing or empty",never:"Never"},default:"if-empty"},{type:"slider",displayName:"Image aspect ratio",key:"imageAspectRatio",min:.1,max:2,step:.05,default:.55,showWhen:{key:"imageFormat",value:"cover"}}]},{type:"group",displayName:"Date",items:[{type:"toggle",displayName:"Show date",key:"showDate",default:!1},{type:"property",displayName:"Date property",key:"dateProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Include time",description:"When enabled, displays both date and time using your system locale settings",key:"dateIncludeTime",default:!1}]},{type:"group",displayName:"Draft status",items:[{type:"toggle",displayName:"Show draft status",key:"showDraftStatus",default:!1},{type:"property",displayName:"Draft status property",key:"draftStatusProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Reverse logic",key:"draftStatusReverse",default:!1},{type:"toggle",displayName:"Filename underscore prefix as draft indicator",key:"draftStatusUseFilenamePrefix",default:!1}]},{type:"group",displayName:"Tags",items:[{type:"toggle",displayName:"Show tags",key:"showTags",default:!1},{type:"property",displayName:"Tags property",key:"tagsProperty",placeholder:"Select property",default:""},{type:"slider",displayName:"Maximum tags to show",key:"maxTagsToShow",min:1,max:50,step:1,default:3,showWhen:{key:"showTags",value:!0}}]},{type:"group",displayName:"Properties",items:[{type:"dropdown",displayName:"Show property labels",key:"propertyLabels",options:{hide:"Hide",inline:"Inline",above:"On top"},default:"hide"}]},{type:"group",displayName:"Property group 1",items:[{type:"property",displayName:"First property",key:"propertyDisplay1",placeholder:"Select property",default:""},{type:"property",displayName:"Second property",key:"propertyDisplay2",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show side-by-side",key:"propertyLayout12SideBySide",default:!1},{type:"dropdown",displayName:"Position",key:"propertyGroup1Position",options:{top:"Top",bottom:"Bottom"},default:"bottom"}]},{type:"group",displayName:"Property group 2",items:[{type:"property",displayName:"Third property",key:"propertyDisplay3",placeholder:"Select property",default:""},{type:"property",displayName:"Fourth property",key:"propertyDisplay4",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show side-by-side",key:"propertyLayout34SideBySide",default:!1},{type:"dropdown",displayName:"Position",key:"propertyGroup2Position",options:{top:"Top",bottom:"Bottom"},default:"bottom"}]},{type:"group",displayName:"Property group 3",items:[{type:"property",displayName:"First property",key:"propertyDisplay5",placeholder:"Select property",default:""},{type:"property",displayName:"Second property",key:"propertyDisplay6",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show side-by-side",key:"propertyLayout56SideBySide",default:!1},{type:"dropdown",displayName:"Position",key:"propertyGroup3Position",options:{top:"Top",bottom:"Bottom"},default:"bottom"}]},{type:"group",displayName:"Property group 4",items:[{type:"property",displayName:"First property",key:"propertyDisplay7",placeholder:"Select property",default:""},{type:"property",displayName:"Second property",key:"propertyDisplay8",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show side-by-side",key:"propertyLayout78SideBySide",default:!1},{type:"dropdown",displayName:"Position",key:"propertyGroup4Position",options:{top:"Top",bottom:"Bottom"},default:"bottom"}]},{type:"group",displayName:"Property group 5",items:[{type:"property",displayName:"First property",key:"propertyDisplay9",placeholder:"Select property",default:""},{type:"property",displayName:"Second property",key:"propertyDisplay10",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show side-by-side",key:"propertyLayout910SideBySide",default:!1},{type:"dropdown",displayName:"Position",key:"propertyGroup5Position",options:{top:"Top",bottom:"Bottom"},default:"bottom"}]},{type:"group",displayName:"Property group 6",items:[{type:"property",displayName:"First property",key:"propertyDisplay11",placeholder:"Select property",default:""},{type:"property",displayName:"Second property",key:"propertyDisplay12",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show side-by-side",key:"propertyLayout1112SideBySide",default:!1},{type:"dropdown",displayName:"Position",key:"propertyGroup6Position",options:{top:"Top",bottom:"Bottom"},default:"bottom"}]},{type:"group",displayName:"Property group 7",items:[{type:"property",displayName:"First property",key:"propertyDisplay13",placeholder:"Select property",default:""},{type:"property",displayName:"Second property",key:"propertyDisplay14",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show side-by-side",key:"propertyLayout1314SideBySide",default:!1},{type:"dropdown",displayName:"Position",key:"propertyGroup7Position",options:{top:"Top",bottom:"Bottom"},default:"bottom"}]},{type:"group",displayName:"Behavior",items:[{type:"toggle",displayName:"Open new notes directly",description:"Skip the Bases modal and create notes directly (like the file explorer). When disabled, uses normal Bases behavior with the property popup.",key:"customizeNewButton",default:!1},{type:"text",displayName:"Location for new notes",description:'Folder path where new notes will be created. Use / for vault root, or specify a folder path. Works independently of "Open new notes directly".',key:"newNoteLocation",placeholder:"Simply use / for vault folder",default:""},{type:"toggle",displayName:"Hide quick edit icon",key:"hideQuickEditIcon",default:!1}]}]}var H=J(()=>{"use strict"});function Xe(r,s){var t;let e=[],i=r.vault.getAbstractFileByPath(s.path);if(i instanceof N.TFile){let n=r.metadataCache.getFileCache(i),o=(n==null?void 0:n.embeds)||[];for(let p of o){let l=r.metadataCache.getFirstLinkpathDest(p.link,s.path);l instanceof N.TFile&&e.push(l)}let a=n==null?void 0:n.frontmatter;if(a){let p=["image","imageOG","cover","thumbnail"],l=["avif","bmp","gif","jpeg","jpg","png","svg","webp"];for(let c of p){let u=a[c];if(!u)continue;let h=Array.isArray(u)?u:[u];for(let w of h){if(typeof w!="string")continue;let g=w.replace(/^!?\[\[([^\]]+)\]\]$/,"$1").trim();if(!g||g.startsWith("http://")||g.startsWith("https://"))continue;let f=r.metadataCache.getFirstLinkpathDest(g,s.path);if(!f&&g.startsWith("./")){let m=g.substring(2),T=(t=s.parent)!=null&&t.path?`${s.parent.path}/${m}`:m,S=r.vault.getAbstractFileByPath(T);S instanceof N.TFile&&(f=S)}if(!f){let m=r.vault.getAbstractFileByPath(g);m instanceof N.TFile&&(f=m)}f&&l.includes(f.extension)&&e.push(f)}}}}return e}function Ye(r,s){let e=[];for(let i of s.children)i instanceof N.TFile&&i.extension==="md"?e.push(...Xe(r,i)):i instanceof N.TFolder&&e.push(...Ye(r,i));return e}async function Mt(r,s,e,i){let t=r.vault.getMarkdownFiles().filter(p=>p.path!==e.path),n=s.path,o=s.name,a=s.basename;for(let p of t){if(i&&p.path.startsWith(i.path+"/"))continue;let l=await r.vault.read(p);if(l.includes(n)||l.includes(o)||l.includes(a)||l.includes(`![[${o}]]`)||l.includes(`[[${o}]]`)||l.includes(`(${o})`)||l.includes(`(${n})`))return!0}return!1}async function et(r,s,e){let i=[];i.push(...Xe(r,s)),e&&i.push(...Ye(r,e));let t=Array.from(new Set(i.map(o=>o.path))).map(o=>r.vault.getAbstractFileByPath(o)).filter(o=>o instanceof N.TFile),n=[];for(let o of t)await Mt(r,o,s,e)||n.push(o);return n}var N,tt=J(()=>{"use strict";N=require("obsidian")});var st={};Z(st,{executeSmartDeletion:()=>j,isFolderBasedContent:()=>it,prepareDeletionPreview:()=>ce,shouldDeleteParentFolder:()=>Le});function it(r,s){let e=s.deleteParentFolderFilename||"index";return r.basename===e&&r.parent!==null}function Le(r,s){return s.deleteParentFolder&&it(r,s)}async function ce(r,s,e){let i=[],t=[],n=[];for(let p of s){let l=r.vault.getAbstractFileByPath(p);if(l instanceof V.TFile){if(Le(l,e)){let c=l.parent;if(c&&!t.includes(c)){t.push(c);let u=c.children.filter(h=>h instanceof V.TFile);i.push(...u)}}else i.push(l);if(e.deleteUniqueAttachments){let c=Le(l,e)&&l.parent||void 0,u=await et(r,l,c);n.push(...u)}}}let o=Array.from(new Set(i.map(p=>p.path))).map(p=>r.vault.getAbstractFileByPath(p)).filter(p=>p instanceof V.TFile),a=Array.from(new Set(n.map(p=>p.path))).map(p=>r.vault.getAbstractFileByPath(p)).filter(p=>p instanceof V.TFile);return{filesToDelete:o,foldersToDelete:Array.from(new Set(t)),attachmentsToDelete:a}}async function j(r,s){let e=0,i=0;for(let t of s.filesToDelete)try{await r.fileManager.trashFile(t),e++}catch(n){console.error(`Error deleting file ${t.path}:`,n),i++}for(let t of s.attachmentsToDelete)try{await r.fileManager.trashFile(t),e++}catch(n){console.error(`Error deleting attachment ${t.path}:`,n),i++}for(let t of s.foldersToDelete)try{await r.fileManager.trashFile(t),e++}catch(n){console.error(`Error deleting folder ${t.path}:`,n),i++}i>0?new V.Notice(`Deleted ${e} items, ${i} errors occurred`):new V.Notice(`Successfully deleted ${e} item${e!==1?"s":""}`)}var V,de=J(()=>{"use strict";V=require("obsidian");tt()});var ot={};Z(ot,{DeletionPreviewModal:()=>Q});var ue,Q,Me=J(()=>{"use strict";ue=require("obsidian");de();Q=class extends ue.Modal{constructor(e,i,t){super(e);this.preview=i,this.onConfirm=t}onOpen(){let{contentEl:e}=this;if(e.empty(),new ue.Setting(e).setName("Confirm deletion").setHeading(),e.createEl("p",{text:"The following items will be deleted:",cls:"bases-cms-deletion-warning"}),this.preview.filesToDelete.length>0){e.createEl("h3",{text:`Files (${this.preview.filesToDelete.length})`});let o=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let a of this.preview.filesToDelete.slice(0,20))o.createEl("li").setText(a.path);this.preview.filesToDelete.length>20&&o.createEl("li",{text:`... and ${this.preview.filesToDelete.length-20} more files`})}if(this.preview.foldersToDelete.length>0){e.createEl("h3",{text:`Folders (${this.preview.foldersToDelete.length})`});let o=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let a of this.preview.foldersToDelete)o.createEl("li").setText(a.path)}if(this.preview.attachmentsToDelete.length>0){e.createEl("h3",{text:`Attachments (${this.preview.attachmentsToDelete.length})`});let o=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let a of this.preview.attachmentsToDelete.slice(0,20))o.createEl("li").setText(a.path);this.preview.attachmentsToDelete.length>20&&o.createEl("li",{text:`... and ${this.preview.attachmentsToDelete.length-20} more attachments`})}e.createEl("p",{text:"This action cannot be undone.",cls:"bases-cms-deletion-warning"});let i=e.createDiv();i.addClass("bases-cms-modal-button-container");let t=i.createEl("button");t.setText("Cancel"),t.addEventListener("click",()=>this.close());let n=i.createEl("button");n.setText("Delete"),n.addClass("mod-cta"),n.addClass("destructive"),n.addEventListener("click",()=>{(async()=>(await j(this.app,this.preview),this.onConfirm(),this.close()))()})}onClose(){let{contentEl:e}=this;e.empty()}}});var Nt={};Z(Nt,{default:()=>we});module.exports=Oe(Nt);var lt=require("obsidian");var D=require("obsidian");var Ve=require("obsidian"),X=class extends Ve.FuzzySuggestModal{constructor(e,i){super(e);this.onSelect=i}getItems(){let e=this.app.commands,i=new Map;if(e&&typeof e.listCommands=="function")try{let n=e.listCommands();for(let o of n)o&&o.id&&o.name&&!i.has(o.id)&&i.set(o.id,{id:o.id,name:o.name})}catch(n){console.warn("[Bases CMS] Error getting commands via listCommands():",n)}try{let n=e==null?void 0:e.commands;if(n&&typeof n=="object"){let o=Object.values(n);for(let a of o)a&&a.id&&a.name&&!i.has(a.id)&&i.set(a.id,{id:a.id,name:a.name})}}catch(n){console.warn("[Bases CMS] Error getting commands via registry:",n)}try{let n=e==null?void 0:e.commandRegistry;if(n&&typeof n=="object"){let o=Object.values(n);for(let a of o)a&&a.id&&a.name&&!i.has(a.id)&&i.set(a.id,{id:a.id,name:a.name})}}catch(n){console.warn("[Bases CMS] Error getting commands via internal registry:",n)}let t=Array.from(i.values());return t.sort((n,o)=>n.name.localeCompare(o.name)),t}getItemText(e){return e.name}onChooseItem(e,i){this.onSelect(e.id)}renderSuggestion(e,i){let t=e.item;i.createDiv({cls:"suggestion-title",text:t.name})}};var B=require("obsidian"),mt=()=>{if(B.requireApiVersion&&(0,B.requireApiVersion)("1.7.3")&&B.getIconIds)try{return(0,B.getIconIds)()}catch(r){console.warn("[Bases CMS] Error getting icon IDs from Obsidian:",r)}return["settings-2","settings","help-circle","info","star","heart","bookmark","home","search","bell","mail","user","users","folder","file","file-text","image","video","music","calendar","clock","edit","pencil","trash","copy","cut","paste","download","upload","save","share","link","external-link","lock","unlock","eye","eye-off","key","shield","check","x","plus","minus","arrow-left","arrow-right","arrow-up","arrow-down","chevron-left","chevron-right","chevron-up","chevron-down","menu","more-horizontal","more-vertical","grid","list","layout","columns","rows","maximize","minimize","zoom-in","zoom-out","refresh-cw","play","pause","stop","sun","moon","cloud","zap","wand-2","wand","wand-sparkles","palette","brush","sliders","power","wifi","bluetooth","monitor","laptop","smartphone","camera","mic","headphones","code","terminal","terminal-square","github","gitlab","git-branch","git-commit","database","server","cloud-download","cloud-upload","tag","tags","flag","pin","map-pin","compass","globe","rocket","car","bike","robot","apple","windows","linux","chrome","firefox","safari","credit-card","wallet","coins","book","book-open","award","trophy","badge","wrench","tool","package","box","archive","send","reply","forward","mail-open","tag-plus","tag-minus","flag-off","pin-off","map-pin-off","navigation","map","earth","plane","ship","anchor","helicopter","drone","android","keyhole","keys","fingerprint","scan","qr-code","barcode","receipt","piggy-bank","banknote","pencil-line","edit-2","edit-3"]},gt=mt().map(r=>({id:r,name:r.replace(/^lucide-/,"").replace(/-/g," ").replace(/(^\w{1})|(\s+\w{1})/g,s=>s.toUpperCase())})).sort((r,s)=>r.name.localeCompare(s.name)),Y=class extends B.FuzzySuggestModal{constructor(e,i){super(e);this.onSelect=i}getItems(){return gt}getItemText(e){return e.name}onChooseItem(e,i){this.onSelect(e.id)}renderSuggestion(e,i){let t=e.item;i.addClass("mod-complex"),i.createDiv({cls:"suggestion-content"}).createDiv({cls:"suggestion-title",text:t.name});let o=i.createDiv({cls:"suggestion-aux"});(0,B.setIcon)(o.createSpan({cls:"suggestion-flair"}),t.id)}};var ee=class extends D.PluginSettingTab{constructor(e,i){super(e,i);this.plugin=i}refreshActiveToolbars(){let e=this.plugin;e&&typeof e.refreshAllToolbars=="function"&&e.refreshAllToolbars()}display(){let{containerEl:e}=this;e.empty(),new D.Setting(e).setName("Confirm bulk operations").setDesc("Show confirmation dialogs before performing bulk operations.").addToggle(o=>o.setValue(this.plugin.settings.confirmBulkOperations).onChange(a=>{(async()=>(this.plugin.settings.confirmBulkOperations=a,await this.plugin.saveData(this.plugin.settings)))()})),new D.Setting(e).setName("Toolbar buttons").setHeading(),new D.Setting(e).setName("Show select all button").setDesc("Display the select all button in the CMS toolbar.").addToggle(o=>o.setValue(this.plugin.settings.showToolbarSelectAll).onChange(a=>{(async()=>(this.plugin.settings.showToolbarSelectAll=a,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new D.Setting(e).setName("Show clear button").setDesc("Display the clear selection button in the CMS toolbar.").addToggle(o=>o.setValue(this.plugin.settings.showToolbarClear).onChange(a=>{(async()=>(this.plugin.settings.showToolbarClear=a,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new D.Setting(e).setName("Show publish button").setDesc("Display the publish button in the CMS toolbar.").addToggle(o=>o.setValue(this.plugin.settings.showToolbarPublish).onChange(a=>{(async()=>(this.plugin.settings.showToolbarPublish=a,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new D.Setting(e).setName("Show draft button").setDesc("Display the draft button in the CMS toolbar.").addToggle(o=>o.setValue(this.plugin.settings.showToolbarDraft).onChange(a=>{(async()=>(this.plugin.settings.showToolbarDraft=a,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new D.Setting(e).setName("Show tags button").setDesc("Display the tags button in the CMS toolbar.").addToggle(o=>o.setValue(this.plugin.settings.showToolbarTags).onChange(a=>{(async()=>(this.plugin.settings.showToolbarTags=a,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new D.Setting(e).setName("Show set button").setDesc("Display the set property button in the CMS toolbar.").addToggle(o=>o.setValue(this.plugin.settings.showToolbarSet).onChange(a=>{(async()=>(this.plugin.settings.showToolbarSet=a,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new D.Setting(e).setName("Show remove button").setDesc("Display the remove property button in the CMS toolbar.").addToggle(o=>o.setValue(this.plugin.settings.showToolbarRemove).onChange(a=>{(async()=>(this.plugin.settings.showToolbarRemove=a,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new D.Setting(e).setName("Show delete button").setDesc("Display the delete button in the CMS toolbar.").addToggle(o=>o.setValue(this.plugin.settings.showToolbarDelete).onChange(a=>{(async()=>(this.plugin.settings.showToolbarDelete=a,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new D.Setting(e).setName("Deletions").setHeading(),new D.Setting(e).setName("Delete parent folder for specific file name").setDesc("When enabled, deleting a note will delete its parent folder and all its contents if the note file name matches the specified name.").addToggle(o=>o.setValue(this.plugin.settings.deleteParentFolder).onChange(a=>{(async()=>(this.plugin.settings.deleteParentFolder=a,await this.plugin.saveData(this.plugin.settings)))()})),new D.Setting(e).setName("Folder deletion file name").setDesc("File name that triggers parent folder deletion.").addText(o=>o.setPlaceholder("index").setValue(this.plugin.settings.deleteParentFolderFilename).onChange(a=>{(async()=>(this.plugin.settings.deleteParentFolderFilename=a,await this.plugin.saveData(this.plugin.settings)))()})).setDisabled(!this.plugin.settings.deleteParentFolder),new D.Setting(e).setName("Delete associated unique attachments").setDesc("When deleting a note, automatically delete attachments that are only used by that note. Attachments used by other notes will be preserved.").addToggle(o=>o.setValue(this.plugin.settings.deleteUniqueAttachments).onChange(a=>{(async()=>(this.plugin.settings.deleteUniqueAttachments=a,await this.plugin.saveData(this.plugin.settings)))()})),new D.Setting(e).setName("Confirm deletions").setDesc("Show confirmation dialog before deleting files.").addToggle(o=>o.setValue(this.plugin.settings.confirmDeletions).onChange(a=>{(async()=>(this.plugin.settings.confirmDeletions=a,await this.plugin.saveData(this.plugin.settings)))()})),new D.Setting(e).setName("Appearance").setHeading(),new D.Setting(e).setName("Use home icon for CMS view").setDesc("Use the home icon instead of blocks icon for the CMS view in the Bases view selector. Restart Obsidian for this change to take effect.").addToggle(o=>o.setValue(this.plugin.settings.useHomeIcon).onChange(a=>{(async()=>(this.plugin.settings.useHomeIcon=a,await this.plugin.saveData(this.plugin.settings)))()})),new D.Setting(e).setName("Force static image for animated GIFs").setDesc("When enabled, animated GIFs will display only the first frame when used as card covers or thumbnails.").addToggle(o=>o.setValue(this.plugin.settings.forceStaticGifImages).onChange(a=>{(async()=>{this.plugin.settings.forceStaticGifImages=a,await this.plugin.saveData(this.plugin.settings);let p=this.plugin;p.activeViews&&p.activeViews.forEach(l=>{l.onDataUpdated&&l.onDataUpdated()})})()})),new D.Setting(e).setName("Quick edit").setHeading();let i,t,n;new D.Setting(e).setName("Enable quick edit").setDesc("Show an icon on card titles that launches a command when clicked.").addToggle(o=>o.setValue(this.plugin.settings.enableQuickEdit).onChange(a=>{(async()=>(this.plugin.settings.enableQuickEdit=a,await this.plugin.saveData(this.plugin.settings),i&&i.settingEl.toggleClass("bases-cms-setting-hidden",!a),t&&t.settingEl.toggleClass("bases-cms-setting-hidden",!a),n&&n.settingEl.toggleClass("bases-cms-setting-hidden",!a)))()})),i=new D.Setting(e).setName("Quick edit command").setDesc("The command to execute when clicking the quick edit icon on a card title.").addButton(o=>{var p;let a=this.plugin.settings.quickEditCommandName||(this.plugin.settings.quickEditCommand?"Select command...":"No command selected");if(o.setButtonText(a).onClick(()=>{new X(this.app,c=>{(async()=>{let u=this.app.commands,h="";if(u){if(typeof u.listCommands=="function"){let g=u.listCommands().find(f=>f.id===c);g&&(h=g.name)}if(!h){let w=u.commands;w&&w[c]&&(h=w[c].name||"")}}this.plugin.settings.quickEditCommand=c,this.plugin.settings.quickEditCommandName=h,await this.plugin.saveData(this.plugin.settings),this.display()})()}).open()}),this.plugin.settings.quickEditCommand){let l=(p=o.buttonEl.parentElement)==null?void 0:p.createEl("button",{text:"Clear",attr:{style:"margin-left: 8px;"}});l==null||l.addEventListener("click",()=>{(async()=>(this.plugin.settings.quickEditCommand="",this.plugin.settings.quickEditCommandName="",await this.plugin.saveData(this.plugin.settings),this.display()))()})}}),i.settingEl.toggleClass("bases-cms-setting-hidden",!this.plugin.settings.enableQuickEdit),t=new D.Setting(e).setName("Quick edit icon").setDesc("Select the icon to display for the quick edit button on card titles.").addButton(o=>{let a=this.getIconName(this.plugin.settings.quickEditIcon||"pencil-line");o.setButtonText(a||"Select icon...").onClick(()=>{new Y(this.app,async l=>{this.plugin.settings.quickEditIcon=l,await this.plugin.saveData(this.plugin.settings),this.display()}).open()})}),t.settingEl.toggleClass("bases-cms-setting-hidden",!this.plugin.settings.enableQuickEdit),n=new D.Setting(e).setName("Attempt to open file and execute quick edit command").setDesc("For commands that don't have special handling, attempt to open the file and execute the command. Some commands may not work properly this way.").addToggle(o=>o.setValue(this.plugin.settings.quickEditOpenFile).onChange(a=>{(async()=>(this.plugin.settings.quickEditOpenFile=a,await this.plugin.saveData(this.plugin.settings)))()})),n.settingEl.toggleClass("bases-cms-setting-hidden",!this.plugin.settings.enableQuickEdit)}getIconName(e){return e?e.replace(/^lucide-/,"").split("-").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" "):""}};var Re={confirmBulkOperations:!0,deleteParentFolder:!1,deleteParentFolderFilename:"index",deleteUniqueAttachments:!1,confirmDeletions:!0,useHomeIcon:!1,enableQuickEdit:!1,quickEditCommand:"",quickEditCommandName:"",quickEditIcon:"pencil-line",quickEditOpenFile:!1,showToolbarSelectAll:!0,showToolbarClear:!0,showToolbarDraft:!0,showToolbarPublish:!0,showToolbarTags:!0,showToolbarSet:!0,showToolbarRemove:!0,showToolbarDelete:!0,forceStaticGifImages:!1};var z=require("obsidian");function L(r,s){if(!s||!s.trim())return null;let e=s.split(",").map(i=>i.trim()).filter(i=>i);for(let i of e){let t=r.getValue(i),n=t;if(n&&("date"in n&&n.date instanceof Date||"data"in n))return t}return null}function Te(r,s){if(!s||!s.trim())return[];let e=s.split(",")[0].trim();if(!e)return[];let i=r.getValue(e);if(!i||!("data"in i))return[];let t=i.data,n=[];if(Array.isArray(t)){for(let o of t)if(typeof o=="string"||typeof o=="number"){let a=String(o);if(a&&a.trim()){n.push(a);break}}}else if(t!=null&&t!==""&&(typeof t=="string"||typeof t=="number")){let o=String(t);o.trim()&&n.push(o)}return n}function $e(r,s,e,i){if(!r||r==="")return"";if(e){let t=e;if(typeof t.getDisplayName=="function")try{let n=t.getDisplayName(r);if(n&&typeof n=="string"&&n.trim()!=="")return n}catch(n){}}return r}function G(r){return document.body.classList.contains(r)}function _e(){let r=getComputedStyle(document.body).getPropertyValue("--bases-cms-list-separator");return(r.startsWith('"')&&r.endsWith('"')||r.startsWith("'")&&r.endsWith("'"))&&(r=r.slice(1,-1)),r||", "}function Ee(){let r=getComputedStyle(document.body).getPropertyValue("--bases-cms-empty-value-marker");return(r.startsWith('"')&&r.endsWith('"')||r.startsWith("'")&&r.endsWith("'"))&&(r=r.slice(1,-1)),r||"\u2014"}function Ce(){return G("bases-cms-hide-missing-properties")}function te(){return!!G("bases-cms-hide-empty-properties")}function q(){return G("bases-cms-tag-style-minimal")?"minimal":G("bases-cms-tag-style-theme")?"theme":"plain"}function U(){return G("bases-cms-show-tag-hash")}function Pe(r){if(r.length===0)return r;for(let s=1;s<=Math.floor(r.length/2);s++){let e=r.substring(0,s),i=Math.floor(r.length/s);if(i<2)continue;let t=!0;for(let o=1;o<i;o++)if(r.substring(o*s,(o+1)*s)!==e){t=!1;break}let n=r.length%s;if(n>0&&r.substring(i*s)!==e.substring(0,n)&&(t=!1),t)return e}return r}function ft(r,s,e,i,t,n,o){let a=r.file.basename||r.file.name,p=L(r,s.titleProperty),l=p==null?void 0:p.data,c=l!=null&&l!==""&&(typeof l=="string"||typeof l=="number")?String(l):a,u=r.file.path,h=u.split("/").slice(0,-1).join("/"),w=r.getValue("note.tags"),g=[];if(w&&w.data!=null){let k=w.data;g=(Array.isArray(k)?k.map(E=>E&&typeof E=="object"&&"data"in E?String(E.data):typeof E=="string"||typeof E=="number"?String(E):"").filter(E=>E):typeof k=="string"||typeof k=="number"?[String(k)]:[]).map(E=>E.replace(/^#/,""))}let f=r.getValue("file.tags"),m=[];if(f&&f.data!=null){let k=f.data;m=(Array.isArray(k)?k.map(E=>E&&typeof E=="object"&&E!==null&&"data"in E?String(E.data):typeof E=="string"||typeof E=="number"?String(E):"").filter(E=>typeof E=="string"&&E.length>0):typeof k=="string"||typeof k=="number"?[String(k)]:[]).map(E=>E.replace(/^#/,""))}let T=r.file.stat.ctime,S=r.file.stat.mtime,y=[];if(s.showTags&&s.tagsProperty){let k=L(r,s.tagsProperty);if(k&&k.data!=null){let P=k.data;Array.isArray(P)?y=P.map(E=>E&&typeof E=="object"&&"data"in E?String(E.data):typeof E=="string"||typeof E=="number"?String(E):"").filter(E=>typeof E=="string"&&E.length>0):(typeof P=="string"||typeof P=="number")&&(y=[String(P)])}}let d={path:u,name:a,title:c,tags:m,yamlTags:g,ctime:T,mtime:S,folderPath:h,snippet:t,imageUrl:n,hasImageAvailable:o||!1,displayTags:y.length>0?y:void 0},C=[s.propertyDisplay1,s.propertyDisplay2,s.propertyDisplay3,s.propertyDisplay4,s.propertyDisplay5,s.propertyDisplay6,s.propertyDisplay7,s.propertyDisplay8,s.propertyDisplay9,s.propertyDisplay10,s.propertyDisplay11,s.propertyDisplay12,s.propertyDisplay13,s.propertyDisplay14],v=new Set,b=C.map(k=>!k||k===""||v.has(k)?"":(v.add(k),k));return d.propertyName1=b[0]||void 0,d.propertyName2=b[1]||void 0,d.propertyName3=b[2]||void 0,d.propertyName4=b[3]||void 0,d.propertyName5=b[4]||void 0,d.propertyName6=b[5]||void 0,d.propertyName7=b[6]||void 0,d.propertyName8=b[7]||void 0,d.propertyName9=b[8]||void 0,d.propertyName10=b[9]||void 0,d.propertyName11=b[10]||void 0,d.propertyName12=b[11]||void 0,d.propertyName13=b[12]||void 0,d.propertyName14=b[13]||void 0,d.property1=b[0]?x(b[0],r,d,s):null,d.property2=b[1]?x(b[1],r,d,s):null,d.property3=b[2]?x(b[2],r,d,s):null,d.property4=b[3]?x(b[3],r,d,s):null,d.property5=b[4]?x(b[4],r,d,s):null,d.property6=b[5]?x(b[5],r,d,s):null,d.property7=b[6]?x(b[6],r,d,s):null,d.property8=b[7]?x(b[7],r,d,s):null,d.property9=b[8]?x(b[8],r,d,s):null,d.property10=b[9]?x(b[9],r,d,s):null,d.property11=b[10]?x(b[10],r,d,s):null,d.property12=b[11]?x(b[11],r,d,s):null,d.property13=b[12]?x(b[12],r,d,s):null,d.property14=b[13]?x(b[13],r,d,s):null,d}function qe(r,s,e,i,t,n,o){return r.map(a=>ft(a,s,e,i,t[a.file.path],n[a.file.path],o[a.file.path]))}function x(r,s,e,i){if(!r||r==="")return null;if(r==="file.path"||r==="file path")return e.folderPath||null;if(r==="tags"||r==="note.tags")return e.yamlTags.length>0?"tags":null;if(r==="file.tags"||r==="file tags")return e.tags.length>0?"tags":null;if(r==="file.ctime"||r==="created time")return new Date(e.ctime).toLocaleDateString();if(r==="file.mtime"||r==="modified time")return new Date(e.mtime).toLocaleDateString();let t=L(s,r);if(!t)return null;let n=t;if(!n)return null;if("date"in n&&n.date instanceof Date)return n.date.toLocaleDateString();let o=n.data;if(o==null)return null;if(o==="")return"";if(typeof o=="string"){let a=o.trim();return a.length===0?"":Pe(a)}if(Array.isArray(o)){if(o.length===0)return"";let a=new Set,p=[];for(let l of o){let c;if(l&&typeof l=="object"&&"data"in l){let h=l.data;h&&typeof h=="object"&&!Array.isArray(h)&&"data"in h?c=String(h.data):c=String(h)}else c=String(l);let u=c.trim();if(u&&u!==""){let h=Pe(u);h&&h!==""&&!a.has(h)&&(a.add(h),p.push(h))}}return p.length>0?p.join(_e()):null}if(typeof o=="string"){let a=o.trim();return a.length===0?null:Pe(a)}return typeof o=="number"||typeof o=="boolean"?String(o):null}H();var De=require("obsidian");function He(r){return/^https?:\/\//i.test(r)}function xe(r){return/\.(avif|bmp|gif|jpe?g|png|svg|webp)$/i.test(r)}function ze(r){return new Promise(s=>{let e=new Image;e.onload=()=>s(!0),e.onerror=()=>s(!1),setTimeout(()=>s(!1),5e3),e.src=r})}function bt(r){let s=r.match(/^!?\[\[([^\]|]+)(?:\|[^\]]*)?\]\]$/);return s?s[1].trim():r}async function We(r){let s=[],e=[];for(let o of r){let a=bt(o);a.length!==0&&(He(a)?(xe(a)||!a.includes("."))&&e.push(a):xe(a)&&s.push(a))}let i=e.map(o=>ze(o).then(a=>a?o:null)),n=(await Promise.all(i)).filter(o=>o!==null);return{internalPaths:s,externalUrls:n}}function Ge(r,s,e){let i=["avif","bmp","gif","jpeg","jpg","png","svg","webp"],t=[];for(let n of r){let o=e.metadataCache.getFirstLinkpathDest(n,s);if(!o&&n.startsWith("./")){let a=e.vault.getAbstractFileByPath(s);if(a&&a.parent){let p=n.substring(2),l=a.parent.path?`${a.parent.path}/${p}`:p,c=e.vault.getAbstractFileByPath(l);c instanceof De.TFile&&(o=c)}}if(!o){let a=e.vault.getAbstractFileByPath(n);a instanceof De.TFile&&(o=a)}if(o&&i.includes(o.extension)){let a=e.vault.getResourcePath(o);t.push(a)}}return t}async function Fe(r,s){let e=["avif","bmp","gif","jpeg","jpg","png","svg","webp"],i=s.metadataCache.getFileCache(r);if(!(i!=null&&i.embeds))return[];let t=[],n=[];for(let l of i.embeds){let c=l.link;if(He(c))(xe(c)||!c.includes("."))&&n.push(c);else{let u=s.metadataCache.getFirstLinkpathDest(c,r.path);if(u&&e.includes(u.extension)){let h=s.vault.getResourcePath(u);t.push(h)}}}let o=n.map(l=>ze(l).then(c=>c?l:null)),p=(await Promise.all(o)).filter(l=>l!==null);return[...t,...p]}function vt(r){return/\.gif(\?|#|$)/i.test(r)||/\.gif$/i.test(r)}async function ie(r,s){return!s||!vt(r)?r:new Promise(e=>{let i=new Image;i.crossOrigin="anonymous",i.onload=()=>{try{let t=document.createElement("canvas");t.width=i.width,t.height=i.height;let n=t.getContext("2d");if(n){n.drawImage(i,0,0);let o=t.toDataURL("image/png");e(o)}else e(r)}catch(t){console.warn("Failed to convert GIF to static image:",t),e(r)}},i.onerror=()=>{e(r)},setTimeout(()=>{e(r)},5e3),i.src=r})}var wt=[/`([^`]+)`/g,/\*\*\*((?:(?!\*\*\*).)+)\*\*\*/g,/___((?:(?!___).)+)___/g,/\*\*((?:(?!\*\*).)+)\*\*/g,/__((?:(?!__).)+)__/g,/\*((?:(?!\*).)+)\*/g,/_((?:(?!_).)+)_/g,/~~((?:(?!~~).)+)~~/g,/==((?:(?!==).)+)==/g,/\[([^\]]+)\]\([^)]+\)/g,/!\[\[[^\]]+\]\]/g,/\[\[[^\]|]+\|[^\]]+\]\]/g,/\[\[[^\]]+\]\]/g,/#[a-zA-Z0-9_\-/]+/g,/^[-*+]\s*\[[ xX]\]\s+/gm,/^(\d+\.\s*)\[[ xX]\]\s+/gm,/^(\d+\)\s*)\[[ xX]\]\s+/gm,/^[-*+]\s+/gm,/^#{1,6}\s+.+$/gm,/^\s*(?:[-_*])\s*(?:[-_*])\s*(?:[-_*])[\s\-_*]*$/gm,/^\s*\|.*\|.*$/gm,/\^\[[^\]]*?]/g,/\[\^[^\]]+]/g,/^\s*\[\^[^\]]+]:.*$/gm,/<([a-z][a-z0-9]*)\b[^>]*>(.*?)<\/\1>/gi,/<[^>]+>/g];function St(r){let s=new Map,e=0;return{text:r.replace(/\\(.)/g,(t,n)=>{let o=`\xA7\xA7ESCAPED${e}\xA7\xA7`;return s.set(o,n),e++,o}),map:s}}function kt(r,s){let e=r;return s.forEach((i,t)=>{e=e.split(t).join(i)}),e}function Tt(r){let s=r,e=!0;for(;e;){e=!1;let i=s.match(/^([`~]{3,})/m);if(!i)break;let t=i[1][0],n=i[1].length,o=i.index,a=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),p=new RegExp(`^${a}{${n}}\\s*$`,"m"),c=s.substring(o+i[1].length).match(p);if(c){let h=o+i[1].length+c.index+c[0].length;s=s.substring(0,o)+s.substring(h),e=!0}else{let u=s.indexOf(`
`,o);u===-1?s=s.substring(0,o):s=s.substring(0,o)+s.substring(u+1),e=!0}}return s}function Et(r){if(!r||r.trim().length===0)return"";r=r.replace(/^>\s*\[![\w-]+\][+-]?.*$/gm,""),r=r.replace(/^>\s?/gm,"");let{text:s,map:e}=St(r),i=Tt(s);return wt.forEach(t=>{i=i.replace(t,(n,...o)=>{if(n.match(/<[a-z][a-z0-9]*\b[^>]*>.*?<\//i))return o[1]||"";if(o.length>0&&o[0]!==void 0){for(let a=0;a<o.length-2;a++)if(typeof o[a]=="string")return o[a]}return""})}),i=kt(i,e),i}function Ct(r,s=!1,e,i){let t=r.replace(/^---[\s\S]*?---/,"").trim(),n=Et(t),o=n.indexOf(`
`),a=(o!==-1?n.substring(0,o):n).trim();(s||e&&a===e||i&&a===i)&&(n=o!==-1?n.substring(o+1).trim():"");let p=n.replace(/\^[a-zA-Z0-9-]+/g,"").split(/\s+/).filter(u=>u).join(" ").trim().replace(/\.{2,}/g,u=>u.replace(/\./g,"\u2024")),l=p.length>500,c=p.substring(0,500);return l&&(c+="\u2026"),c}async function je(r,s,e,i,t,n){if(e!=null&&(typeof e=="string"||typeof e=="number")&&String(e).trim().length>0)return String(e).trim();if(i.fallbackToContent){let a=await s.vault.cachedRead(r);return Ct(a,i.omitFirstLine,t,n)}return""}async function Pt(r,s,e,i,t,n,o){let a=i&&Array.isArray(i)&&i.length>0,p=t===!0||t==="always"||t==="if-empty"&&!a;if(!p&&r in n&&(delete n[r],delete o[r]),!(r in n&&!a&&p))try{let{internalPaths:l,externalUrls:c}=await We(i),u=[...Ge(l,r,e),...c];u.length===0&&!a&&p&&(u=await Fe(s,e)),u.length>0?(n[r]=u.length>1?u:u[0],o[r]=!0):a?(delete n[r],o[r]=!0):p||(delete n[r],delete o[r])}catch(l){console.error(`Failed to load image for ${r}:`,l)}}async function Ae(r,s,e,i,t){let n=r.filter(a=>{let p=a.imagePropertyValues&&Array.isArray(a.imagePropertyValues)&&a.imagePropertyValues.length>0;return!(a.path in i)||p}),o=50;for(let a=0;a<n.length;a+=o){let p=n.slice(a,a+o);await Promise.all(p.map(async l=>{await Pt(l.path,l.file,e,l.imagePropertyValues,s,i,t)}))}}async function Qe(r,s,e,i){await Promise.all(r.map(async t=>{if(!(t.path in e||i[t.path]))try{let n=await Fe(t.file,s);n.length>0&&(e[t.path]=n.length>1?n:n[0],i[t.path]=!0)}catch(n){console.error(`Failed to load embed images for ${t.path}:`,n)}}))}async function Ke(r,s,e,i,t){await Promise.all(r.map(async n=>{if(!(n.path in t))try{n.file.extension==="md"?t[n.path]=await je(n.file,i,n.descriptionData,{fallbackToContent:s,omitFirstLine:e},n.fileName,n.titleString):t[n.path]=""}catch(o){console.error(`Failed to load snippet for ${n.path}:`,o),t[n.path]=""}}))}var re=require("obsidian");function Dt(r,s){let e=null,i=!1;if(s.draftStatusUseFilenamePrefix&&r.file&&r.file.name)e=r.file.name.startsWith("_"),i=s.draftStatusReverse?!e:e;else if(s.draftStatusProperty){let t=L(r,s.draftStatusProperty);if(t){let n=t;n&&"data"in n&&typeof n.data=="boolean"&&(e=n.data,i=s.draftStatusReverse?!e:e)}}return{booleanValue:e,isDraft:i}}function se(r,s,e,i,t){if(!i.showDraftStatus)return;let{booleanValue:n,isDraft:o}=Dt(s,i);if(n!==null){let a=r.createDiv("card-status-badge");o?(a.addClass("status-draft"),a.appendText("Draft")):(a.addClass("status-published"),a.appendText("Published")),t&&(a.addClass("bases-cms-cursor-pointer"),a.addEventListener("click",p=>{p.stopPropagation(),t(e,"draft",!n)}))}}var A=require("obsidian");function xt(r,s){let e=new A.Modal(r);e.titleEl.setText("Rename file");let i=e.contentEl.createDiv();i.style.width="100%";let t=new A.TextComponent(i);t.setValue(s.basename),t.inputEl.style.width="100%",t.inputEl.style.boxSizing="border-box",t.inputEl.focus(),t.inputEl.select();let n=e.contentEl.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"Cancel"}).addEventListener("click",()=>e.close());let a=n.createEl("button",{text:"Rename",cls:"mod-cta"}),p=async()=>{let l=t.getValue().trim();if(!l||l===s.basename){e.close();return}let c=s.path.split("/");c[c.length-1]=l+(s.extension?`.${s.extension}`:"");let u=c.join("/");try{await r.fileManager.renameFile(s,u),e.close()}catch(h){console.error("[Bases CMS] Error renaming file:",h),e.close()}};a.addEventListener("click",()=>{p()}),t.inputEl.addEventListener("keydown",l=>{l.key==="Enter"?(l.preventDefault(),p()):l.key==="Escape"&&(l.preventDefault(),e.close())}),e.open()}function Ft(r){let s=r.toLowerCase();return r==="file-explorer:rename-file"||r==="rename-file"||r==="file:rename-file"||s.includes("rename")&&s.includes("file")&&!s.includes(":")}function At(r,s){let e=r.toLowerCase(),i=s.toLowerCase();return["add tag","add-tag","insert-template","insert-template","editor:","markdown:"].some(n=>e.includes(n)||i.includes(n))}function Je(r,s,e,i,t,n){if(!s.settings.enableQuickEdit||!s.settings.quickEditCommand||s.settings.quickEditCommand===""||n.hideQuickEditIcon)return;let o=e.createSpan("bases-cms-quick-edit-icon");o.addClass("bases-cms-cursor-default"),(0,A.setIcon)(o,s.settings.quickEditIcon||"pencil-line"),e.addEventListener("click",a=>{o.contains(a.target)&&(a.stopPropagation(),a.stopImmediatePropagation())},!0),i.addEventListener("click",a=>{(async()=>{var c,u,h,w;let p=a.target;if(!o.contains(p)&&!p.closest(".bases-cms-quick-edit-icon"))return;a.stopPropagation(),a.stopImmediatePropagation(),a.preventDefault();let l=r.vault.getAbstractFileByPath(t);if(l instanceof A.TFile){let g=s.settings.quickEditCommand,f=r.commands,m=(c=f==null?void 0:f.commands)==null?void 0:c[g],T=(m==null?void 0:m.name)||"",S=T.toLowerCase();if(Ft(g)||S.includes("rename")&&S.includes("file")){xt(r,l);return}if(At(g,T)&&!s.settings.quickEditOpenFile){new A.Notice(`The "${T}" command requires the file to be open in an editor. Enable "Attempt to open file and execute quick edit command" in settings to try anyway.`,5e3);return}let y=!1;try{let d=null,C=g;if(g.includes(":")){let v=g.split(":");d=v[0],C=v.slice(1).join(":")}else{let b=r.commands,k=(u=b==null?void 0:b.commands)==null?void 0:u[g];if(k){let P=k.plugin||k.sourcePlugin;P&&(d=((h=P.manifest)==null?void 0:h.id)||P.pluginId||null)}}if(d){let v=r.plugins,b=(w=v==null?void 0:v.plugins)==null?void 0:w[d];if(b){let k=C.split("-").map((P,E)=>E===0?P:P.charAt(0).toUpperCase()+P.slice(1)).join("")+"ByPath";if(b&&typeof b[k]=="function"){await b[k](t),y=!0;return}}}}catch(d){}if(!y){if(!s.settings.quickEditOpenFile){new A.Notice(`This command doesn't have special handling. Enable "Attempt to open file and execute quick edit command" in settings to try executing it.`,5e3);return}let d=r.workspace.getLeaf(!1);await d.openFile(l),r.workspace.setActiveLeaf(d,{focus:!0});let C=0,v=30,b=()=>{r.workspace.getActiveFile()===l&&(async()=>{var E,R;try{await((R=(E=r.commands)==null?void 0:E.executeCommandById)==null?void 0:R.call(E,s.settings.quickEditCommand))}catch(W){}})()},k=()=>{let P=d.view,E=P,R=r.workspace.getActiveFile();P&&"editor"in P&&E.editor&&R===l?requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{b()},200)})}):C<v&&(C++,setTimeout(k,50))};k()}}})()},!0),o.addEventListener("mousedown",a=>{a.stopPropagation(),a.stopImmediatePropagation(),a.preventDefault()},!0)}var oe=class{constructor(s,e,i){this.app=s;this.getBasesConfig=e;this.getBasesController=i}renderProperties(s,e,i,t,n,o){let a=[t.propertyDisplay1,t.propertyDisplay2,t.propertyDisplay3,t.propertyDisplay4,t.propertyDisplay5,t.propertyDisplay6,t.propertyDisplay7,t.propertyDisplay8,t.propertyDisplay9,t.propertyDisplay10,t.propertyDisplay11,t.propertyDisplay12,t.propertyDisplay13,t.propertyDisplay14],p=new Set,l=a.map(f=>!f||f===""||p.has(f)?"":(p.add(f),f)),c=l.map(f=>f?x(f,i,e,t):null),u=[{props:[l[0],l[1]],values:[c[0],c[1]],sideBySide:t.propertyLayout12SideBySide,position:t.propertyGroup1Position},{props:[l[2],l[3]],values:[c[2],c[3]],sideBySide:t.propertyLayout34SideBySide,position:t.propertyGroup2Position},{props:[l[4],l[5]],values:[c[4],c[5]],sideBySide:t.propertyLayout56SideBySide,position:t.propertyGroup3Position},{props:[l[6],l[7]],values:[c[6],c[7]],sideBySide:t.propertyLayout78SideBySide,position:t.propertyGroup4Position},{props:[l[8],l[9]],values:[c[8],c[9]],sideBySide:t.propertyLayout910SideBySide,position:t.propertyGroup5Position},{props:[l[10],l[11]],values:[c[10],c[11]],sideBySide:t.propertyLayout1112SideBySide,position:t.propertyGroup6Position},{props:[l[12],l[13]],values:[c[12],c[13]],sideBySide:t.propertyLayout1314SideBySide,position:t.propertyGroup7Position}],h=[],w=[];u.forEach((f,m)=>{(f.props[0]!==""||f.props[1]!=="")&&(f.position==="top"?h.push(f):w.push(f))});let g=(f,m)=>{if(!f||f==="")return!0;let T=m===null||m===""||typeof m=="string"&&m.trim()==="",S=!1;try{let y=i.file;if(y){let d=this.app.metadataCache.getFileCache(y);if(d&&d.frontmatter){let C=f.split(",").map(v=>v.trim()).filter(v=>v);for(let v of C)if(v.replace(/^(note|formula|file)\./,"")in d.frontmatter){S=!0;break}}}}catch(y){}return!!(Ce()&&!S||te()&&S&&T||te()&&T)};if((o==="top"||o===void 0)&&h.length>0){let f=s.createDiv("card-properties properties-top");h.forEach((m,T)=>{let S=m.props[0]&&!g(m.props[0],m.values[0]),y=m.props[1]&&!g(m.props[1],m.values[1]);if(!S&&!y)return;let d=f.createDiv(`property-row property-row-group-${T+1}`);m.sideBySide&&d.addClass("property-row-side-by-side");let C=d.createDiv("property-field property-field-1");S&&this.renderPropertyContent(C,m.props[0],m.values[0],e,i,t,n);let v=d.createDiv("property-field property-field-2");y&&this.renderPropertyContent(v,m.props[1],m.values[1],e,i,t,n)})}if((o==="bottom"||o===void 0)&&w.length>0){let f=s.createDiv("card-properties properties-bottom");w.forEach((m,T)=>{let S=m.props[0]&&!g(m.props[0],m.values[0]),y=m.props[1]&&!g(m.props[1],m.values[1]);if(!S&&!y)return;let d=f.createDiv(`property-row property-row-group-${T+1}`);m.sideBySide&&d.addClass("property-row-side-by-side");let C=d.createDiv("property-field property-field-1");S&&this.renderPropertyContent(C,m.props[0],m.values[0],e,i,t,n);let v=d.createDiv("property-field property-field-2");y&&this.renderPropertyContent(v,m.props[1],m.values[1],e,i,t,n)})}}renderPropertyContent(s,e,i,t,n,o,a){if(e===""||i===null&&Ce()||i===""&&te()||!i&&o.propertyLabels==="hide"||o.propertyLabels==="hide"&&((e==="tags"||e==="note.tags")&&t.yamlTags.length===0||(e==="file.tags"||e==="file tags")&&t.tags.length===0))return;let p=this.getBasesConfig?this.getBasesConfig():void 0,l=this.getBasesController?this.getBasesController():void 0,c=$e(e,this.app,p,l),u=c.toLowerCase()!==e.toLowerCase();if(o.propertyLabels==="above"){let g=s.createDiv("property-label");u&&g.addClass("property-label-custom"),g.textContent=c}let h=s.createDiv("property-content");if(o.propertyLabels==="inline"&&h.addClass("property-content-inline"),o.propertyLabels==="inline"){let g=h.createSpan("property-label-inline");g.textContent=c+": "}if(!i){let g=h.createSpan("property-empty-marker");g.textContent=Ee();return}if(e==="file.mtime"||e==="file.ctime"||e==="modified time"||e==="created time")h.createSpan().appendText(i);else if((e==="tags"||e==="note.tags")&&t.yamlTags.length>0){let g=h.createDiv("tags-wrapper"),f=q();f!=="plain"&&g.addClass(`tag-style-${f}`),t.yamlTags.forEach(m=>{g.createEl("a",{cls:"tag",text:U()?`#${m}`:m,href:"#"}).addEventListener("click",S=>{var d,C,v;S.preventDefault();let y=(C=(d=this.app.internalPlugins)==null?void 0:d.plugins)==null?void 0:C["global-search"];(v=y==null?void 0:y.instance)!=null&&v.openGlobalSearch&&y.instance.openGlobalSearch("tag:"+m)})})}else if((e==="file.tags"||e==="file tags")&&t.tags.length>0){let g=h.createDiv("tags-wrapper"),f=q();f!=="plain"&&g.addClass(`tag-style-${f}`),t.tags.forEach(m=>{g.createEl("a",{cls:"tag",text:U()?`#${m}`:m,href:"#"}).addEventListener("click",S=>{var d,C,v;S.preventDefault();let y=(C=(d=this.app.internalPlugins)==null?void 0:d.plugins)==null?void 0:C["global-search"];(v=y==null?void 0:y.instance)!=null&&v.openGlobalSearch&&y.instance.openGlobalSearch("tag:"+m)})})}else{let g=this.app.metadataCache,m=(typeof g.getAllPropertyInfos=="function"?g.getAllPropertyInfos():{})[e.toLowerCase()],T=n.getValue(e);if(((m==null?void 0:m.widget)==="checkbox"||T&&"data"in T&&typeof T.data=="boolean")&&a){let y=h.createEl("input",{type:"checkbox"});y.checked=T&&"data"in T?Boolean(T.data):!1,h.createSpan({text:c}),y.addEventListener("change",async d=>{d.stopPropagation();let C=y.checked;try{let v=e.startsWith("note.")?e.substring(5):e;await a(t.path,v,C)}catch(v){console.error("Error toggling property:",v),y.checked=!C}}),y.addEventListener("click",d=>{d.stopPropagation()})}else{let y=h.createDiv("text-wrapper");this.renderPropertyValueWithLinks(y,i,t.path,e)}}(!h.textContent||h.textContent.trim().length===0)&&h.remove()}renderPropertyValueWithLinks(s,e,i,t){if(!e){s.appendText(Ee());return}let n=e.trim();if((n.startsWith("http://")||n.startsWith("https://"))&&!n.includes(" ")){let u=s.createEl("a",{cls:"external-link",href:n});u.textContent=n,u.setAttr("target","_blank"),u.setAttr("rel","noopener"),u.addEventListener("click",h=>{h.stopPropagation()});return}if(t&&(t.toLowerCase().includes("image")||t.toLowerCase()==="cover"||t.toLowerCase()==="thumbnail")&&!n.includes(" ")&&!n.startsWith("http://")&&!n.startsWith("https://")&&(n.includes("/")||n.includes("\\")||n.match(/\.(png|jpg|jpeg|gif|svg|webp|mp4|mov|avi)$/i))){let u=s.createEl("a",{cls:"internal-link",href:n});u.textContent=n,u.addEventListener("click",h=>{h.stopPropagation(),h.preventDefault();let w=h.metaKey||h.ctrlKey;this.app.workspace.openLinkText(n,i,w)});return}let a=/\[\[([^\]]+)\]\]/g,p=/\[([^\]]+)\]\(([^)]+)\)/g,l=[];for(let u of e.matchAll(a))u.index!==void 0&&l.push({index:u.index,type:"wikilink",match:u});for(let u of e.matchAll(p))u.index!==void 0&&l.push({index:u.index,type:"markdown",match:u});l.sort((u,h)=>u.index-h.index);let c=0;for(let{index:u,type:h,match:w}of l){if(u>c&&s.appendText(e.substring(c,u)),h==="wikilink"){let f=w[1].split("|"),m=f[0].trim(),T=f.length>1?f[1].trim():m,S=s.createEl("a",{cls:"internal-link",href:m});S.textContent=T,S.addEventListener("click",y=>{y.stopPropagation(),y.preventDefault();let d=y.metaKey||y.ctrlKey;this.app.workspace.openLinkText(m,i,d)})}else if(h==="markdown"){let g=w[1],f=w[2];if(f.startsWith("http://")||f.startsWith("https://")){let m=s.createEl("a",{cls:"external-link",href:f});m.textContent=g,m.setAttr("target","_blank"),m.setAttr("rel","noopener"),m.addEventListener("click",T=>{T.stopPropagation()})}else{let m=s.createEl("a",{cls:"internal-link",href:f});m.textContent=g,m.addEventListener("click",T=>{T.stopPropagation(),T.preventDefault();let S=T.metaKey||T.ctrlKey;this.app.workspace.openLinkText(f,i,S)})}}c=u+w[0].length}c<e.length?s.appendText(e.substring(c)):l.length===0&&s.appendText(e)}};var ne=class{constructor(s,e,i,t,n,o){this.app=s;this.plugin=e;this.propertyObservers=i;this.updateLayoutRef=t;this.basesConfig=n,this.basesController=o,this.propertyRenderer=new oe(this.app,()=>this.basesConfig,()=>this.basesController)}renderCard(s,e,i,t,n,o,a,p,l){let c=s.createDiv("card bases-cms-card");t.imageFormat==="cover"?c.classList.add("image-format-cover"):t.imageFormat==="thumbnail"&&(c.classList.add("image-format-thumbnail"),c.classList.add(`thumbnail-${t.imagePosition}`)),c.setAttribute("data-path",e.path),c.setAttribute("data-href",e.path),c.addClass("bases-cms-cursor-pointer");let u=c.createDiv("bases-cms-select-checkbox"),h=u.createEl("input",{type:"checkbox",cls:"selection-checkbox"});if(h.checked=o,h.addEventListener("change",w=>{w.stopPropagation(),w.stopImmediatePropagation(),a(e.path,h.checked)}),h.addEventListener("click",w=>{w.stopPropagation(),w.stopImmediatePropagation()}),t.showDraftStatus&&t.imageFormat!=="cover"&&se(c,i,e.path,t,p),c.addEventListener("click",w=>{let g=w.target;if(g.closest(".bases-cms-quick-edit-icon")){w.stopPropagation(),w.stopImmediatePropagation(),w.preventDefault();return}if(u.contains(g)||g.tagName==="INPUT"||g.closest("input")||g.closest(".bases-cms-property")||g.closest(".card-status-badge"))return;let m=w.metaKey||w.ctrlKey;this.app.workspace.openLinkText(e.path,"",m)}),c.addEventListener("contextmenu",w=>{let g=w.target;if(u.contains(g)||g.tagName==="INPUT"||g.closest("input")||g.closest(".bases-cms-property")||g.closest(".card-status-badge")||g.closest(".bases-cms-quick-edit-icon"))return;let f=this.app.vault.getAbstractFileByPath(e.path);if(f&&f instanceof re.TFile){w.stopPropagation();let m=new re.Menu;h.checked?m.addItem(S=>{S.setTitle("Unselect"),S.setIcon("square"),S.onClick(()=>{a(e.path,!1)})}):m.addItem(S=>{S.setTitle("Select"),S.setIcon("copy-check"),S.onClick(()=>{a(e.path,!0)})}),m.addSeparator(),this.app.workspace.trigger("file-menu",m,f,"bases"),m.addSeparator(),m.addItem(S=>{S.setTitle("Delete"),S.setIcon("trash-2"),S.onClick(async()=>{l&&await l.handleDelete()})}),m.showAtMouseEvent(w),setTimeout(()=>{let S=document.querySelector(".menu");if(!S)return;let d=Array.from(S.querySelectorAll(".menu-item")).find(C=>{var b;return((b=C.textContent)==null?void 0:b.trim())==="Delete"});if(d){d.addClass("is-danger");let C=d.querySelector("svg");C&&(C.style.color="var(--text-error)",C.style.stroke="var(--text-error)");let v=d.querySelector(".menu-item-title");v&&(v.style.color="var(--text-error)")}},0)}}),t.showTitle){let w=c.createDiv("card-title");w.appendText(e.title),Je(this.app,this.plugin,w,c,e.path,t)}if(t.showDate&&t.dateProperty){let w=L(i,t.dateProperty);if(w){let g=w,f=null;if(g&&"date"in g&&g.date instanceof Date)f=g.date;else if(g&&"data"in g&&g.data){let m=g.data;if(m instanceof Date)f=m;else if(typeof m=="string"||typeof m=="number"){let T=new Date(m);isNaN(T.getTime())||(f=T)}}if(f){let m;if(t.dateIncludeTime){let S=f.toLocaleDateString(),y=f.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0});m=`${S}, ${y}`}else m=f.toLocaleDateString();c.createDiv("card-date").appendText(m)}}}if(this.propertyRenderer.renderProperties(c,e,i,t,p,"top"),t.showTextPreview||t.showTags&&e.displayTags&&e.displayTags.length>0||t.imageFormat!=="none"&&(e.imageUrl||e.hasImageAvailable)||t.imageFormat==="cover"){let w=c.createDiv("card-content");if(t.imageFormat==="thumbnail"){let g=w.createDiv("card-text-wrapper");if(t.showTextPreview){let f=g.createDiv("card-text-preview");e.snippet&&f.setText(e.snippet),c.__textPreviewEl=f,c.__cardPath=e.path}if(t.showTags&&e.displayTags&&e.displayTags.length>0){let f=g.createDiv("card-tags"),m=q();m!=="plain"&&f.addClass(`tag-style-${m}`);let T=t.maxTagsToShow,S=e.displayTags.slice(0,T),y=e.displayTags.length-T;S.forEach(d=>{f.createSpan("card-tag").appendText(U()?`#${d}`:d)}),y>0&&f.createSpan("card-tag-more").appendText(`+${y} more`)}}else{if(t.showTextPreview){let g=w.createDiv("card-text-preview");e.snippet&&g.setText(e.snippet),c.__textPreviewEl=g,c.__cardPath=e.path}if(t.showTags&&e.displayTags&&e.displayTags.length>0){let g=w.createDiv("card-tags"),f=q();f!=="plain"&&g.addClass(`tag-style-${f}`);let m=t.maxTagsToShow,T=e.displayTags.slice(0,m),S=e.displayTags.length-m;T.forEach(y=>{g.createSpan("card-tag").appendText(U()?`#${y}`:y)}),S>0&&g.createSpan("card-tag-more").appendText(`+${S} more`)}}if(t.imageFormat!=="none"&&e.imageUrl){let f=(Array.isArray(e.imageUrl)?e.imageUrl:[e.imageUrl]).filter(S=>S&&typeof S=="string"&&S.trim().length>0),m=t.imageFormat==="cover"?"card-cover":"card-thumbnail",T=w.createDiv(m);if(f.length>0){let S=T.createDiv("image-embed"),y=f[0];(async()=>{let d=await ie(y,this.plugin.settings.forceStaticGifImages);S.style.backgroundImage=`url("${d}")`})(),S.style.backgroundImage=`url("${y}")`,S.style.backgroundSize="cover",S.style.backgroundPosition="center center",S.style.backgroundRepeat="no-repeat",t.showDraftStatus&&t.imageFormat==="cover"&&se(T,i,e.path,t,p),this.propertyRenderer.renderProperties(c,e,i,t,p,"bottom");return}}else if(t.imageFormat==="cover"){let g=w.createDiv("card-cover-placeholder");se(g,i,e.path,t,p)}}this.propertyRenderer.renderProperties(c,e,i,t,p,"bottom")}};var nt=require("obsidian");var I=require("obsidian");async function Be(r,s,e,i){await r.fileManager.processFrontMatter(s,t=>{for(let[n,o]of e){if(n==="tags"&&!Object.prototype.hasOwnProperty.call(t,"tags")&&!Array.isArray(o.data)){t[n]=[o.data];continue}if(!t[n]||i){t[n]=o.data;continue}let a=o.type,p=t[n],l=Array.isArray(p)?"list":typeof p=="number"?"number":typeof p=="boolean"?"checkbox":"text";if(Bt(a,l)){if(t[n]===o.data||!o.data)continue;let c=Lt(t[n],o.data);t[n]=c;continue}else{t[n]=o.data;continue}}})}async function Ze(r,s,e){await r.fileManager.processFrontMatter(s,i=>{for(let t of e)i[t]=void 0})}function Bt(r,s){let e=["number","date","datetime","checkbox"];return!(e.includes(r)||e.includes(s))}function Lt(...r){let e=r.map(t=>Array.isArray(t)?t:[t]).flat();return[...new Set(e)]}var M=class{constructor(s){this.app=s}async setDraft(s,e,i){await this.batchProcessFiles(s,async t=>{if(i)if(i.draftStatusUseFilenamePrefix){let n=t.basename,o=n.startsWith("_"),p=t.path.split("/"),l=e;if(i.draftStatusReverse&&(l=!e),l===!0){if(!o){let c=`_${n}${t.extension?`.${t.extension}`:""}`;p[p.length-1]=c;let u=p.join("/");await this.app.fileManager.renameFile(t,u)}}else if(o){let c=n.substring(1)+(t.extension?`.${t.extension}`:"");p[p.length-1]=c;let u=p.join("/");await this.app.fileManager.renameFile(t,u)}}else{let n=i.draftStatusProperty&&i.draftStatusProperty.trim()?i.draftStatusProperty.startsWith("note.")?i.draftStatusProperty.substring(5):i.draftStatusProperty:"draft",o=e;i.draftStatusReverse&&(o=!e),await this.app.fileManager.processFrontMatter(t,a=>{a[n]=o})}else await this.app.fileManager.processFrontMatter(t,n=>{n.draft=e})}),new I.Notice(`Set ${s.length} file${s.length!==1?"s":""} to ${e?"draft":"published"}`)}async addTags(s,e){let i=new Map;i.set("tags",{type:"tags",data:e,overwrite:!1,delimiter:","}),await this.batchProcessFiles(s,async t=>{await Be(this.app,t,i,!1)}),new I.Notice(`Added tags to ${s.length} file${s.length!==1?"s":""}`)}async removeTags(s,e){await this.batchProcessFiles(s,async i=>{let t=this.app.metadataCache.getFileCache(i),n=t==null?void 0:t.frontmatter;if(n!=null&&n.tags){let a=(Array.isArray(n.tags)?n.tags:[n.tags]).filter(p=>!e.includes(p));await this.app.fileManager.processFrontMatter(i,p=>{a.length>0?p.tags=a:p.tags=void 0})}}),new I.Notice(`Removed tags from ${s.length} file${s.length!==1?"s":""}`)}async setProperty(s,e,i,t="text"){let n=e.startsWith("note.")?e.substring(5):e,o=new Map;o.set(n,{type:t,data:i,overwrite:!0,delimiter:","}),await this.batchProcessFiles(s,async a=>{await Be(this.app,a,o,!0)}),new I.Notice(`Set ${n} on ${s.length} file${s.length!==1?"s":""}`)}async removeProperty(s,e){let i=e.startsWith("note.")?e.substring(5):e;await this.batchProcessFiles(s,async t=>{await Ze(this.app,t,[i])}),new I.Notice(`Removed ${i} from ${s.length} file${s.length!==1?"s":""}`)}async batchProcessFiles(s,e){let i=0,t=s.length;for(let n of s){let o=this.app.vault.getAbstractFileByPath(n);if(o instanceof I.TFile)try{await e(o),i++}catch(a){console.error(`Error processing ${n}:`,a)}}i<t&&new I.Notice(`Processed ${i} of ${t} files`)}};var O=require("obsidian");var ae=class extends O.Modal{constructor(e,i){super(e);this.tagsToAdd="";this.tagsToRemove=new Set;this.files=i,this.bulkOps=new M(e)}onOpen(){let{contentEl:e}=this;e.empty(),new O.Setting(e).setName("Manage tags").setHeading(),e.createEl("p",{text:`Managing tags for ${this.files.length} file${this.files.length!==1?"s":""}`}),new O.Setting(e).setName("Add tags").setDesc("Enter tags to add (comma-separated).").addText(p=>{p.setPlaceholder("tag1, tag2, tag3").onChange(l=>{this.tagsToAdd=l})}),e.createEl("h3",{text:"Remove tags"});let i=e.createDiv(),t=new Set;for(let p of this.files){let l=this.app.vault.getAbstractFileByPath(p);if(l instanceof O.TFile){let c=this.app.metadataCache.getFileCache(l),u=c==null?void 0:c.frontmatter;u!=null&&u.tags&&(Array.isArray(u.tags)?u.tags:[u.tags]).forEach(w=>t.add(w))}}for(let p of Array.from(t).sort())new O.Setting(i).setName(p).addToggle(l=>{l.setValue(this.tagsToRemove.has(p)).onChange(c=>{c?this.tagsToRemove.add(p):this.tagsToRemove.delete(p)})});let n=e.createDiv();n.addClass("bases-cms-modal-button-container");let o=n.createEl("button");o.setText("Cancel"),o.addEventListener("click",()=>this.close());let a=n.createEl("button");a.setText("Apply"),a.addClass("mod-cta"),a.addEventListener("click",()=>{(async()=>(await this.applyChanges(),this.close()))()})}async applyChanges(){if(this.tagsToAdd.trim()){let e=this.tagsToAdd.split(",").map(i=>i.trim()).filter(i=>i.length>0);e.length>0&&await this.bulkOps.addTags(this.files,e)}this.tagsToRemove.size>0&&await this.bulkOps.removeTags(this.files,Array.from(this.tagsToRemove))}onClose(){let{contentEl:e}=this;e.empty()}};var $=require("obsidian");var le=class extends $.Modal{constructor(e,i){super(e);this.propertyName="";this.propertyValue="";this.propertyType="text";this.files=i,this.bulkOps=new M(e)}onOpen(){let{contentEl:e}=this;e.empty(),new $.Setting(e).setName("Set property").setHeading(),e.createEl("p",{text:`Setting property on ${this.files.length} file${this.files.length!==1?"s":""}`}),new $.Setting(e).setName("Property name").setDesc("Enter the property name to set.").addText(o=>{o.setPlaceholder("Enter name").onChange(a=>{this.propertyName=a})}),new $.Setting(e).setName("Property type").setDesc("Select the property type.").addDropdown(o=>{o.addOption("text","Text").addOption("number","Number").addOption("checkbox","Checkbox").addOption("date","Date").setValue(this.propertyType).onChange(a=>{this.propertyType=a})}),new $.Setting(e).setName("Property value").setDesc("Enter the property value.").addText(o=>{o.setPlaceholder("Enter value").onChange(a=>{this.propertyValue=a})});let i=e.createDiv();i.addClass("bases-cms-modal-button-container");let t=i.createEl("button");t.setText("Cancel"),t.addEventListener("click",()=>this.close());let n=i.createEl("button");n.setText("Apply"),n.addClass("mod-cta"),n.addEventListener("click",()=>{(async()=>this.propertyName&&this.propertyValue&&(await this.applyChanges(),this.close()))()})}async applyChanges(){let e=this.propertyValue;this.propertyType==="number"?e=Number(this.propertyValue):this.propertyType==="checkbox"?e=this.propertyValue.toLowerCase()==="true"||this.propertyValue==="1":this.propertyType==="date"&&(e=this.propertyValue),await this.bulkOps.setProperty(this.files,this.propertyName,e,this.propertyType)}onClose(){let{contentEl:e}=this;e.empty()}};var _=require("obsidian");var pe=class extends _.Modal{constructor(e,i){super(e);this.propertiesToRemove=new Set;this.files=i,this.bulkOps=new M(e)}onOpen(){let{contentEl:e}=this;e.empty(),new _.Setting(e).setName("Remove property").setHeading(),e.createEl("p",{text:`Removing properties from ${this.files.length} file${this.files.length!==1?"s":""}`});let i=new Set;for(let p of this.files){let l=this.app.vault.getAbstractFileByPath(p);if(l instanceof _.TFile){let c=this.app.metadataCache.getFileCache(l),u=c==null?void 0:c.frontmatter;if(u)for(let h in u)h!=="tags"&&h!=="title"&&i.add(h)}}let t=e.createDiv();for(let p of Array.from(i).sort())new _.Setting(t).setName(p).addToggle(l=>{l.setValue(this.propertiesToRemove.has(p)).onChange(c=>{c?this.propertiesToRemove.add(p):this.propertiesToRemove.delete(p)})});i.size===0&&e.createEl("p",{text:"No properties found in selected files."});let n=e.createDiv();n.addClass("bases-cms-modal-button-container");let o=n.createEl("button");o.setText("Cancel"),o.addEventListener("click",()=>this.close());let a=n.createEl("button");a.setText("Apply"),a.addClass("mod-cta"),a.addEventListener("click",()=>{(async()=>this.propertiesToRemove.size>0&&(await this.applyChanges(),this.close()))()})}async applyChanges(){for(let e of this.propertiesToRemove)await this.bulkOps.removeProperty(this.files,e)}onClose(){let{contentEl:e}=this;e.empty()}};Me();var he=require("obsidian"),K=class extends he.Modal{constructor(e,i,t,n){super(e);this.files=i,this.operation=t,this.onConfirm=n}onOpen(){let{contentEl:e}=this;e.empty();let i=this.operation==="draft"?"mark as draft":"mark as published",t=i.charAt(0).toUpperCase()+i.slice(1);if(new he.Setting(e).setName(`Confirm ${t}`).setHeading(),e.createEl("p",{text:`Are you sure you want to ${i} ${this.files.length} file${this.files.length!==1?"s":""}?`}),this.files.length>0){let p=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let l of this.files.slice(0,20))p.createEl("li").setText(l);this.files.length>20&&p.createEl("li",{text:`... and ${this.files.length-20} more file${this.files.length-20!==1?"s":""}`})}let n=e.createDiv();n.addClass("bases-cms-modal-button-container");let o=n.createEl("button");o.setText("Cancel"),o.addEventListener("click",()=>this.close());let a=n.createEl("button");a.setText("Confirm"),a.addClass("mod-cta"),a.addEventListener("click",()=>{this.onConfirm(),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};de();var me=class{constructor(s,e,i,t,n,o){this.app=s;this.plugin=e;this.getSelectedFiles=i;this.clearSelection=t;this.refreshView=n;this.showToolbar=o;this.bulkOps=new M(s)}async handleSetDraft(s){let e=this.getSelectedFiles();e.length!==0&&(this.plugin.settings.confirmBulkOperations?new K(this.app,e,"draft",()=>{(async()=>(await this.bulkOps.setDraft(e,!0,s),this.refreshView()))()}).open():(await this.bulkOps.setDraft(e,!0,s),this.refreshView()))}async handlePublish(s){let e=this.getSelectedFiles();e.length!==0&&(this.plugin.settings.confirmBulkOperations?new K(this.app,e,"publish",()=>{(async()=>(await this.bulkOps.setDraft(e,!1,s),this.refreshView()))()}).open():(await this.bulkOps.setDraft(e,!1,s),this.refreshView()))}handleManageTags(){let s=this.getSelectedFiles();if(s.length===0)return;let e=new ae(this.app,s);e.onClose=()=>{this.showToolbar(),this.refreshView()},e.open()}handleSetProperty(){let s=this.getSelectedFiles();if(s.length===0)return;let e=new le(this.app,s);e.onClose=()=>{this.showToolbar(),this.refreshView()},e.open()}handleRemoveProperty(){let s=this.getSelectedFiles();if(s.length===0)return;let e=new pe(this.app,s);e.onClose=()=>{this.showToolbar(),this.refreshView()},e.open()}async handleDelete(){let s=this.getSelectedFiles();if(s.length!==0)if(this.plugin.settings.confirmDeletions){let e=await ce(this.app,s,this.plugin.settings);new Q(this.app,e,()=>{this.clearSelection(),this.refreshView()}).open()}else{let e=await ce(this.app,s,this.plugin.settings);await j(this.app,e),this.clearSelection(),this.refreshView()}}};var ge=class{constructor(s,e,i,t,n,o,a,p){this.app=s;this.plugin=e;this.container=i;this.getSelectedFiles=t;this.clearSelection=n;this.refreshView=o;this.toolbarEl=null;this.countEl=null;this.resizeObserver=null;this.timeoutIds=[];this.selectAllCallback=a,this.settings=p,this.actions=new me(this.app,this.plugin,this.getSelectedFiles,this.clearSelection,this.refreshView,()=>this.show()),this.createToolbar()}updateSettings(s){this.settings=s}getActions(){return this.actions}createToolbar(){this.toolbarEl=document.createElement("div"),this.toolbarEl.className="bases-toolbar bases-cms-bulk-toolbar bases-cms-bulk-toolbar-hidden",this.toolbarEl.__bulkToolbarInstance=this,this.createToolbarContent(),this.positionToolbar();let s=window.setTimeout(()=>this.positionToolbar(),100);this.timeoutIds.push(s)}positionToolbar(){if(!this.toolbarEl)return;let s=this.container.closest(".bases-header");if(!s){let i=this.container.parentElement;for(;i&&!s;){if(i.classList.contains("bases-header")){s=i;break}i=i.parentElement}}if(!s){let i=Array.from(document.querySelectorAll(".bases-header"));for(let t of i)if(t.contains(this.container)){s=t;break}}let e=this.container.closest(".view-content");if(e)this.toolbarEl.parentElement!==e?(this.toolbarEl.parentElement&&this.toolbarEl.remove(),e.insertBefore(this.toolbarEl,this.container)):this.toolbarEl.nextSibling!==this.container&&(this.toolbarEl.parentElement&&this.toolbarEl.remove(),e.insertBefore(this.toolbarEl,this.container));else if(s&&s.parentElement)this.toolbarEl.parentElement!==s.parentElement&&(this.toolbarEl.parentElement&&this.toolbarEl.remove(),s.parentElement.insertBefore(this.toolbarEl,s.nextSibling));else{let i=this.container.parentElement;i&&(this.toolbarEl.parentElement!==i||this.toolbarEl.nextSibling!==this.container)&&(this.toolbarEl.parentElement&&this.toolbarEl.remove(),i.insertBefore(this.toolbarEl,this.container))}}createToolbarContent(){if(!this.toolbarEl)return;let s=this.toolbarEl.createDiv("bases-cms-bulk-toolbar-left"),e=(n,o,a,p,l=!1)=>{let u=p.createDiv("bases-toolbar-item").createDiv("text-icon-button");l&&u.addClass("destructive"),u.setAttribute("tabindex","0");let h=u.createSpan("text-button-icon");return(0,nt.setIcon)(h,n),u.createSpan("text-button-label").setText(o),u.addEventListener("click",a),u};this.plugin.settings.showToolbarSelectAll&&e("copy-check","Select all",()=>this.handleSelectAll(),s),this.plugin.settings.showToolbarClear&&e("square-x","Clear",()=>this.clearSelection(),s);let i=s.createDiv("bases-toolbar-item bases-cms-selected-count");this.countEl=i.createSpan("text-button-label"),this.countEl.setText("0 selected");let t=this.toolbarEl.createDiv("bases-cms-bulk-toolbar-right");this.plugin.settings.showToolbarPublish&&e("book-check","Publish",()=>{this.actions.handlePublish(this.settings)},t),this.plugin.settings.showToolbarDraft&&e("book-dashed","Draft",()=>{this.actions.handleSetDraft(this.settings)},t),this.plugin.settings.showToolbarTags&&e("tags","Tags",()=>this.actions.handleManageTags(),t),this.plugin.settings.showToolbarSet&&e("list-check","Set",()=>this.actions.handleSetProperty(),t),this.plugin.settings.showToolbarRemove&&e("list-x","Remove",()=>this.actions.handleRemoveProperty(),t),this.plugin.settings.showToolbarDelete&&e("trash-2","Delete",()=>{this.actions.handleDelete()},t,!0),this.setupResponsiveBehavior()}setupResponsiveBehavior(){if(!this.toolbarEl)return;let s=window.setTimeout(()=>{this.updateCollapsedState()},100);this.timeoutIds.push(s),this.toolbarEl&&(this.resizeObserver=new ResizeObserver(()=>{this.updateCollapsedState()}),this.resizeObserver.observe(this.toolbarEl));let e=this.container;if(e){let i=new ResizeObserver(()=>{let t=window.setTimeout(()=>{this.updateCollapsedState()},10);this.timeoutIds.push(t)});i.observe(e),this.containerObserver=i}}updateCollapsedState(){if(!this.toolbarEl)return;this.toolbarEl.offsetWidth<680?this.toolbarEl.addClass("collapsed"):this.toolbarEl.removeClass("collapsed")}updateCount(s){this.countEl&&this.countEl.setText(`${s} selected`)}handleSelectAll(){this.selectAllCallback&&this.selectAllCallback()}show(){if(this.toolbarEl||(console.warn("[Bases CMS] Toolbar element not found, recreating..."),this.createToolbar()),this.toolbarEl){this.positionToolbar(),this.toolbarEl.parentElement||(console.warn("[Bases CMS] Toolbar not in DOM, repositioning..."),this.positionToolbar()),this.toolbarEl.removeClass("bases-cms-bulk-toolbar-hidden"),this.toolbarEl.addClass("bases-cms-bulk-toolbar-visible"),this.toolbarEl.offsetHeight;let s=window.setTimeout(()=>{this.toolbarEl&&(this.toolbarEl.removeClass("bases-cms-bulk-toolbar-animating-out"),this.toolbarEl.addClass("bases-cms-bulk-toolbar-animating-in"))},10);this.timeoutIds.push(s)}else console.error("[Bases CMS] Failed to show toolbar - element is null")}hide(){if(this.toolbarEl){this.toolbarEl.removeClass("bases-cms-bulk-toolbar-animating-in"),this.toolbarEl.addClass("bases-cms-bulk-toolbar-animating-out");let s=window.setTimeout(()=>{this.toolbarEl&&(this.toolbarEl.removeClass("bases-cms-bulk-toolbar-visible"),this.toolbarEl.addClass("bases-cms-bulk-toolbar-hidden"))},200);this.timeoutIds.push(s)}}recreate(){let s=this.toolbarEl&&!this.toolbarEl.hasClass("bases-cms-bulk-toolbar-hidden"),e=0;if(this.countEl&&this.countEl.textContent){let i=this.countEl.textContent.match(/\d+/);i&&(e=parseInt(i[0],10))}this.destroy(),this.createToolbar(),s&&this.toolbarEl&&e>0&&(this.updateCount(e),this.show())}destroy(){this.timeoutIds.forEach(e=>window.clearTimeout(e)),this.timeoutIds=[],this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null);let s=this.containerObserver;s&&(s.disconnect(),this.containerObserver=void 0),this.toolbarEl&&(this.toolbarEl.remove(),this.toolbarEl=null)}};H();function rt(r,s,e,i,t){let n=p=>{let l=p.target;if(!l.closest('.bases-toolbar-new-item-menu, .bases-toolbar-new-item-menu .text-icon-button, [data-action="new-item"], button[aria-label*="new"], button[aria-label*="New"], .bases-toolbar button')||l.closest(".bases-cms-bulk-toolbar, .bases-cms-container .card"))return;let u=r.workspace.activeLeaf,h=u==null?void 0:u.view,w=h==null?void 0:h.containerEl;if(!((h==null?void 0:h.type)==="bases-cms"||(w==null?void 0:w.querySelector(".bases-cms-container"))!==null)||!(w&&(w===s||w.contains(s)||s.contains(w))))return;let m=s,T=m.__cmsView,S=(T==null?void 0:T.config)||m.__cmsConfig||e,y=F(S,i),d=y.newNoteLocation&&y.newNoteLocation.trim()!=="";(y.customizeNewButton||d)&&(p.preventDefault(),p.stopPropagation(),p.stopImmediatePropagation(),(async()=>{var k;let C=((k=y.newNoteLocation)==null?void 0:k.trim())||"";if(C===""&&!y.customizeNewButton){let P=r.vault.config,E=(P==null?void 0:P.newFileLocation)||"folder",R=(P==null?void 0:P.newFileFolderPath)||"",W="Untitled.md";if(E==="folder"&&R)W=`${R}/Untitled.md`;else if(E==="current"){let Se=r.workspace.getActiveFile();Se&&Se.parent&&(W=`${Se.parent.path}/Untitled.md`)}else E==="root"&&(W="Untitled.md");let pt=await r.vault.create(W,"");y.customizeNewButton&&await r.workspace.openLinkText(pt.path,"",!1);return}if(C==="/"||C.replace(/\//g,"")===""){let P=await r.vault.create("Untitled.md","");y.customizeNewButton&&await r.workspace.openLinkText(P.path,"",!1);return}let v=C.replace(/^\/+|\/+$/g,""),b=r.vault.getAbstractFileByPath(v);if((!b||!("children"in b))&&(await r.vault.createFolder(v),b=r.vault.getAbstractFileByPath(v)),b&&"children"in b){let P=await r.vault.create(`${v}/Untitled.md`,"");y.customizeNewButton&&await r.workspace.openLinkText(P.path,"",!1)}})().catch(C=>{console.error("[CMS] Error creating new note:",C)}))};document.addEventListener("click",n,!0);let o=new MutationObserver(()=>{document.querySelectorAll('.bases-toolbar-new-item-menu, .bases-toolbar-new-item-menu .text-icon-button, [data-action="new-item"]').forEach(l=>{let c=l;c.__cmsIntercepted||(c.__cmsIntercepted=!0,l.addEventListener("click",n,!0))})});o.observe(document.body,{childList:!0,subtree:!0}),document.querySelectorAll('.bases-toolbar-new-item-menu, .bases-toolbar-new-item-menu .text-icon-button, [data-action="new-item"]').forEach(p=>{let l=p;l.__cmsIntercepted||(l.__cmsIntercepted=!0,p.addEventListener("click",n,!0))}),t(()=>{document.removeEventListener("click",n,!0),o.disconnect()})}var at=require("obsidian");H();var fe=class{constructor(s,e,i,t){this.app=s;this.config=e;this.pluginSettings=i;this.onRefresh=t}async handlePropertyToggle(s,e,i){try{let t=this.app.vault.getAbstractFileByPath(s);if(!(t instanceof at.TFile))return;let n=e.startsWith("note.")?e.substring(5):e,o=F(this.config,this.pluginSettings),a=o.showDraftStatus&&n==="draft",p=!1;if(a)if(o.draftStatusUseFilenamePrefix){let l=t.basename,c=l.startsWith("_"),h=t.path.split("/");if(i===!0){if(!c){let w=`_${l}${t.extension?`.${t.extension}`:""}`;h[h.length-1]=w;let g=h.join("/");await this.app.fileManager.renameFile(t,g),p=!0}}else if(c){let w=l.substring(1)+(t.extension?`.${t.extension}`:"");h[h.length-1]=w;let g=h.join("/");await this.app.fileManager.renameFile(t,g),p=!0}}else{let l=o.draftStatusProperty&&o.draftStatusProperty.trim()?o.draftStatusProperty.startsWith("note.")?o.draftStatusProperty.substring(5):o.draftStatusProperty:"draft";await this.app.fileManager.processFrontMatter(t,c=>{c[l]=i}),p=!0}else await this.app.fileManager.processFrontMatter(t,l=>{l[n]=i}),p=!0;p&&requestAnimationFrame(()=>{window.setTimeout(()=>{try{this.onRefresh()}catch(l){console.error("Error refreshing view after property toggle:",l)}},100)})}catch(t){console.error("Error toggling property:",t)}}};H();var ye=class{constructor(s,e,i,t,n,o){this.containerEl=s;this.app=e;this.config=i;this.pluginSettings=t;this.onLoadMore=n;this.registerCleanup=o;this.scrollListener=null;this.scrollThrottleTimeout=null;this.resizeObserver=null;this.windowResizeHandler=null;this.isLoading=!1;this.displayedCount=50;this.totalEntries=0;var p;let a=(p=this.app.isMobile)!=null?p:!1;this.displayedCount=a?25:50}setDisplayedCount(s){this.displayedCount=s}getDisplayedCount(){return this.displayedCount}setIsLoading(s){this.isLoading=s}setupInfiniteScroll(s){this.totalEntries=s,this.scrollListener&&(this.containerEl.removeEventListener("scroll",this.scrollListener),this.scrollListener=null),!(this.displayedCount>=s)&&(this.scrollListener=()=>{var l;if(this.scrollThrottleTimeout!==null||this.isLoading)return;let e=this.containerEl.scrollTop,i=this.containerEl.scrollHeight,t=this.containerEl.clientHeight,n=i-(e+t),a=((l=this.app.isMobile)!=null?l:!1)?1:2,p=t*a;if(n<p&&this.displayedCount<s){this.isLoading=!0;let c=50;this.displayedCount=Math.min(this.displayedCount+c,s),this.onLoadMore()}this.scrollThrottleTimeout=window.setTimeout(()=>{this.scrollThrottleTimeout=null},100)},this.containerEl.addEventListener("scroll",this.scrollListener),this.registerCleanup(()=>{this.scrollListener&&this.containerEl.removeEventListener("scroll",this.scrollListener),this.scrollThrottleTimeout!==null&&window.clearTimeout(this.scrollThrottleTimeout)}))}setupResizeObserver(){if(this.resizeObserver)return;let s=()=>{if(!this.config||typeof this.config.get!="function")return;let e=F(this.config,this.pluginSettings),i=e.cardSize;this.containerEl.style.setProperty("--card-min-width",`${i}px`),this.containerEl.style.setProperty("--dynamic-views-image-aspect-ratio",String(e.imageAspectRatio))};this.resizeObserver=new ResizeObserver(s),this.resizeObserver.observe(this.containerEl),s()}updateGridLayout(s){this.containerEl.style.setProperty("--card-min-width",`${s.cardSize}px`),this.containerEl.style.setProperty("--dynamic-views-image-aspect-ratio",String(s.imageAspectRatio))}cleanup(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.windowResizeHandler&&(window.removeEventListener("resize",this.windowResizeHandler),this.windowResizeHandler=null),this.scrollListener&&(this.containerEl.removeEventListener("scroll",this.scrollListener),this.scrollListener=null),this.scrollThrottleTimeout!==null&&(window.clearTimeout(this.scrollThrottleTimeout),this.scrollThrottleTimeout=null)}};var be=class{constructor(s,e,i,t,n,o,a,p){this.containerEl=s;this.plugin=e;this.config=i;this.controller=t;this.data=n;this.selectedFiles=o;this.onSelectionCleared=a;this.registerCleanup=p;this.mutationObserver=null;this.backupInterval=null;this.currentBaseIdentifier=null}setup(s){let e=()=>{this.mutationObserver||(this.mutationObserver=new MutationObserver(p=>{if(this.selectedFiles.size!==0){for(let l of p)if(l.type==="childList"&&l.removedNodes.length>0){let c=!1;for(let h of this.selectedFiles)if(this.containerEl.querySelector(`[data-path="${h}"]`)){c=!0;break}let u=this.containerEl.querySelectorAll(".card[data-path]");if(!c||u.length===0){this.selectedFiles.clear(),this.onSelectionCleared();break}}}}),this.containerEl&&this.mutationObserver.observe(this.containerEl,{childList:!0,subtree:!0}))},i=()=>{this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null,this.selectedFiles.size>0&&this.selectedFiles.clear(),this.onSelectionCleared())},t=()=>{var p,l,c,u;try{if((p=this.config)!=null&&p.getName)return this.config.getName();if((l=this.config)!=null&&l.name)return String(this.config.name);if(this.controller){if((c=this.controller)!=null&&c.getBaseName)return this.controller.getBaseName();if((u=this.controller)!=null&&u.baseName)return String(this.controller.baseName)}if(this.data&&this.data.baseName)return String(this.data.baseName)}catch(h){}return null},n=()=>{if(this.selectedFiles.size===0){this.backupInterval!==null&&(window.clearInterval(this.backupInterval),this.backupInterval=null);return}let p=t();if(this.currentBaseIdentifier!==null&&p!==null&&this.currentBaseIdentifier!==p){this.selectedFiles.clear(),this.onSelectionCleared(),i(),this.backupInterval!==null&&(window.clearInterval(this.backupInterval),this.backupInterval=null);return}this.containerEl.querySelectorAll(".card[data-path]").length===0&&(this.selectedFiles.clear(),this.onSelectionCleared())},o=s.bind(this),a=(p,l)=>{o(p,l),this.selectedFiles.size>0?(this.currentBaseIdentifier===null&&(this.currentBaseIdentifier=t()),e(),this.backupInterval===null&&(this.backupInterval=this.plugin.registerInterval(window.setInterval(n,500)))):(this.currentBaseIdentifier=null,i(),this.backupInterval!==null&&(window.clearInterval(this.backupInterval),this.backupInterval=null))};return this.registerCleanup(()=>{i(),this.backupInterval!==null&&(window.clearInterval(this.backupInterval),this.backupInterval=null)}),a}cleanup(){this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null),this.backupInterval!==null&&(window.clearInterval(this.backupInterval),this.backupInterval=null)}};var Ie="bases-cms",ve=class extends z.BasesView{constructor(e,i,t){super(e);this.type=Ie;this.selectedFiles=new Set;this.snippets={};this.images={};this.hasImageAvailable={};this.updateLayoutRef={current:null};this.propertyObservers=[];this.bulkToolbar=null;this.isRefreshingWithSelection=!1;this.containerEl=i,this.plugin=t,this.cardRenderer=new ne(this.app,this.plugin,this.propertyObservers,this.updateLayoutRef,void 0,e),this.containerEl.addClass("bases-cms"),this.containerEl.addClass("bases-cms-container"),this.propertyToggleHandler=new fe(this.app,this.config,this.plugin.settings,()=>this.onDataUpdated()),this.scrollLayoutManager=new ye(this.containerEl,this.app,this.config,this.plugin.settings,()=>this.onDataUpdated(),o=>this.register(o)),this.viewSwitchListener=new be(this.containerEl,this.plugin,this.config,this.controller,this.data,this.selectedFiles,()=>this.updateSelectionUI(),o=>this.register(o));let n=this.handleSelectionChange.bind(this);this.handleSelectionChange=this.viewSwitchListener.setup(n)}onDataUpdated(){let e=this.app.workspace.activeLeaf,i=e==null?void 0:e.view;if(i&&this.selectedFiles.size>0&&i!==this){if(!(this.containerEl&&this.containerEl.isConnected&&this.containerEl.offsetParent!==null)){this.selectedFiles.clear(),this.updateSelectionUI();return}let o=i.containerEl;if(!o||!o.contains(this.containerEl)){this.selectedFiles.clear(),this.updateSelectionUI();return}}if(!(this.containerEl&&this.containerEl.isConnected&&this.containerEl.offsetParent!==null)&&this.selectedFiles.size>0){this.selectedFiles.clear(),this.updateSelectionUI();return}(async()=>{var S;let n=this.data.groupedData,o=this.data.data;if(this.config&&!this.containerEl.__cmsInterceptorSetup){this.containerEl.__cmsInterceptorSetup=!0;let y=this.containerEl;y.__cmsConfig=this.config,y.__cmsView=this,rt(this.app,this.containerEl,this.config,this.plugin.settings,d=>this.register(d))}let a=F(this.config,this.plugin.settings);a.fallbackToEmbeds===!0||a.fallbackToEmbeds==="always"||a.fallbackToEmbeds==="if-empty"&&!a.imageProperty||(this.images={},this.hasImageAvailable={}),this.cardRenderer.basesConfig=this.config,this.scrollLayoutManager.updateGridLayout(a);let l=this.containerEl.scrollTop,c=this.getSortMethod(),u=n.map(y=>({group:y,entries:[...y.entries]})),h=[],w=this.scrollLayoutManager.getDisplayedCount();for(let y of u){if(w<=0)break;let d=Math.min(y.entries.length,w);h.push(...y.entries.slice(0,d)),w-=d}let g=[];if(a.imageFormat!=="none"){let y=h.filter(v=>!(v.file.path in this.images)).map(v=>{let b=this.app.vault.getAbstractFileByPath(v.file.path);if(!(b instanceof z.TFile))return null;let k=Te(v,a.imageProperty);return{path:v.file.path,file:b,imagePropertyValues:k}}).filter(v=>v!==null),d=o.filter(v=>!(v.file.path in this.images)&&!h.some(b=>b.file.path===v.file.path)).map(v=>{let b=this.app.vault.getAbstractFileByPath(v.file.path);if(!(b instanceof z.TFile))return null;let k=Te(v,a.imageProperty);return{path:v.file.path,file:b,imagePropertyValues:k}}).filter(v=>v!==null);if(y.length>0&&g.push(Ae(y,a.fallbackToEmbeds,this.app,this.images,this.hasImageAvailable).then(()=>{requestAnimationFrame(()=>{y.forEach(v=>{v.path in this.images&&this.updateCardImage(v.path,this.images[v.path])})})})),d.length>0&&g.push(Ae(d,a.fallbackToEmbeds,this.app,this.images,this.hasImageAvailable)),a.fallbackToEmbeds===!0||a.fallbackToEmbeds==="always"||a.fallbackToEmbeds==="if-empty"&&!a.imageProperty){let b=[...y,...d].filter(k=>{let P=k.imagePropertyValues&&Array.isArray(k.imagePropertyValues)&&k.imagePropertyValues.length>0;return!(k.path in this.images)&&!this.hasImageAvailable[k.path]&&!P});b.length>0&&g.push(Qe(b,this.app,this.images,this.hasImageAvailable).then(()=>{requestAnimationFrame(()=>{b.forEach(k=>{k.path in this.images&&this.updateCardImage(k.path,this.images[k.path])})})}))}}if(a.showTextPreview){let y=h.filter(d=>!(d.file.path in this.snippets)).map(d=>{let C=this.app.vault.getAbstractFileByPath(d.file.path);if(!(C instanceof z.TFile))return null;let v=L(d,a.descriptionProperty);return{path:d.file.path,file:C,descriptionData:v==null?void 0:v.data}}).filter(d=>d!==null);Ke(y,a.fallbackToContent,!1,this.app,this.snippets).then(()=>{requestAnimationFrame(()=>{y.forEach(d=>{if(d.path in this.snippets&&this.snippets[d.path]){let C=this.containerEl.querySelector(`[data-path="${d.path}"]`);if(C){let v=C.__textPreviewEl;v&&(!v.textContent||v.textContent.trim().length===0)&&v.setText(this.snippets[d.path])}}})})})}let f=null;if(this.isRefreshingWithSelection&&this.bulkToolbar){let y=this.containerEl.querySelector(".bases-cms-bulk-toolbar");y instanceof HTMLElement&&(f=y,f.remove())}this.containerEl.empty(),this.propertyObservers.forEach(y=>y.disconnect()),this.propertyObservers=[];let m=this.containerEl.createDiv("bases-cms-grid"),T=0;for(let y of u){if(T>=this.scrollLayoutManager.getDisplayedCount())break;let d=Math.min(y.entries.length,this.scrollLayoutManager.getDisplayedCount()-T);if(d===0)continue;let C=y.entries.slice(0,d),v=m.createDiv("bases-cms-group");if(y.group.hasKey()){let P=v.createDiv("bases-cms-group-heading").createDiv("bases-cms-group-value"),E=((S=y.group.key)==null?void 0:S.toString())||"";P.setText(E)}let b=qe(C,a,c,!1,this.snippets,this.images,this.hasImageAvailable);for(let k=0;k<b.length;k++){let P=b[k],E=C[k];this.renderCard(v,P,E,T+k,a)}T+=d}l>0&&(this.containerEl.scrollTop=l),this.scrollLayoutManager.setupInfiniteScroll(o.length),this.scrollLayoutManager.setupResizeObserver(),f&&this.bulkToolbar&&(this.containerEl.appendChild(f),this.bulkToolbar.toolbarEl=f),this.isRefreshingWithSelection?(this.containerEl.querySelectorAll(".card").forEach(d=>{let C=d.getAttribute("data-path"),v=d.querySelector('input[type="checkbox"].selection-checkbox');if(C){let b=this.selectedFiles.has(C);b?d.addClass("selected"):d.removeClass("selected"),v&&(v.checked=b)}}),f&&this.bulkToolbar&&(this.bulkToolbar.show(),this.bulkToolbar.updateCount(this.selectedFiles.size))):this.updateSelectionUI(),this.scrollLayoutManager.setIsLoading(!1)})()}getDirectDeleteHandler(e){return async()=>{let{prepareDeletionPreview:i,executeSmartDeletion:t}=await Promise.resolve().then(()=>(de(),st)),{DeletionPreviewModal:n}=await Promise.resolve().then(()=>(Me(),ot));if(this.plugin.settings.confirmDeletions){let o=await i(this.app,[e],this.plugin.settings);new n(this.app,o,()=>{this.onDataUpdated()}).open()}else{let o=await i(this.app,[e],this.plugin.settings);await t(this.app,o),this.onDataUpdated()}}}renderCard(e,i,t,n,o){let a=this.selectedFiles.has(i.path);return this.cardRenderer.renderCard(e,i,t,o,this,a,(p,l)=>{this.handleSelectionChange(p,l)},(p,l,c)=>{this.handlePropertyToggle(p,l,c)},{handleDelete:this.getDirectDeleteHandler(i.path)})}updateCardImage(e,i){var a;let t=this.containerEl.querySelector(`.card[data-path="${e}"]`);if(!t)return;let n=Array.isArray(i)?i[0]:i;if(!n)return;let o=t.querySelector(".image-embed");if(!o){let p=t.querySelector(".card-cover-placeholder, .card-thumbnail-placeholder");if(p){let l=p.querySelector(".card-status-badge"),c=p.classList.contains("card-cover-placeholder")?"card-cover":"card-thumbnail",u=(a=p.parentElement)==null?void 0:a.createDiv(c);u&&(o=u.createDiv("image-embed"),l&&u.appendChild(l),p.remove())}}o&&((async()=>{let p=await ie(n,this.plugin.settings.forceStaticGifImages);o.style.backgroundImage=`url("${p}")`})(),o.style.backgroundImage=`url("${n}")`,o.style.backgroundSize="cover",o.style.backgroundPosition="center center",o.style.backgroundRepeat="no-repeat")}getSortMethod(){let e=this.config.getSort();if(e&&e.length>0){let i=e[0],t=i.property,n=i.direction.toLowerCase();if(t.includes("ctime"))return`ctime-${n}`;if(t.includes("mtime"))return`mtime-${n}`}return"mtime-desc"}handleSelectionChange(e,i){if(i?this.selectedFiles.add(e):this.selectedFiles.delete(e),this.updateSelectionUI(),this.selectedFiles.size===0&&this.bulkToolbar){this.bulkToolbar.hide();let t=this.containerEl.querySelector(".bases-cms-bulk-toolbar");t instanceof HTMLElement&&(t.removeClass("bases-cms-bulk-toolbar-visible"),t.addClass("bases-cms-bulk-toolbar-hidden"))}}async handlePropertyToggle(e,i,t){await this.propertyToggleHandler.handlePropertyToggle(e,i,t)}selectAll(){this.containerEl.querySelectorAll(".bases-cms-card").forEach(i=>{let t=i.getAttribute("data-path");t&&this.selectedFiles.add(t)}),this.updateSelectionUI()}deselectAll(){this.selectedFiles.clear(),this.updateSelectionUI()}refreshToolbar(){if(this.bulkToolbar){let e=this.selectedFiles.size;this.bulkToolbar.recreate(),e>0&&this.bulkToolbar.updateCount(e)}}updateSelectionUI(){if(this.containerEl.querySelectorAll(".card").forEach(i=>{let t=i.getAttribute("data-path"),n=i.querySelector('input[type="checkbox"].selection-checkbox');if(t){let o=this.selectedFiles.has(t);o?i.addClass("selected"):i.removeClass("selected"),n&&(n.checked=o)}}),this.selectedFiles.size>0){if(document.querySelectorAll(".bases-cms-bulk-toolbar").forEach(t=>{let n=t.__bulkToolbarInstance;(!n||n!==this.bulkToolbar)&&t.remove()}),this.bulkToolbar){let t=F(this.config,this.plugin.settings);this.bulkToolbar.updateSettings(t)}else{let t=F(this.config,this.plugin.settings);this.bulkToolbar=new ge(this.app,this.plugin,this.containerEl,()=>Array.from(this.selectedFiles),()=>{this.selectedFiles.clear(),this.updateSelectionUI()},()=>{let n=Array.from(this.selectedFiles);this.isRefreshingWithSelection=!0,this.bulkToolbar&&n.length>0&&this.bulkToolbar.show(),this.onDataUpdated(),window.setTimeout(()=>{n.forEach(o=>{this.app.vault.getAbstractFileByPath(o)&&this.selectedFiles.add(o)}),this.isRefreshingWithSelection=!1,this.updateSelectionUI(),this.selectedFiles.size>0&&this.bulkToolbar&&(this.bulkToolbar.show(),this.bulkToolbar.updateCount(this.selectedFiles.size)),window.setTimeout(()=>{this.selectedFiles.size>0&&this.bulkToolbar&&(this.bulkToolbar.show(),this.bulkToolbar.updateCount(this.selectedFiles.size))},100)},250)},()=>{this.selectAll()},t)}this.bulkToolbar.updateCount(this.selectedFiles.size),this.bulkToolbar.show()}else if(this.bulkToolbar&&!this.isRefreshingWithSelection){this.bulkToolbar.hide();let i=this.containerEl.querySelector(".bases-cms-bulk-toolbar");i instanceof HTMLElement&&(i.removeClass("bases-cms-bulk-toolbar-visible"),i.addClass("bases-cms-bulk-toolbar-hidden"))}}onClose(){this.scrollLayoutManager.cleanup(),this.viewSwitchListener.cleanup(),this.propertyObservers.forEach(t=>t.disconnect()),this.propertyObservers=[],this.bulkToolbar&&this.bulkToolbar.destroy(),this.selectedFiles.clear(),document.querySelectorAll(".bases-cms-bulk-toolbar").forEach(t=>t.remove());let i=this.plugin;i&&typeof i.removeView=="function"&&i.removeView(this)}async onNew(){var i;let e=F(this.config,this.plugin.settings);if(e.customizeNewButton)try{let t=((i=e.newNoteLocation)==null?void 0:i.trim())||"";if(t===""){let a=this.app.vault.config,p=(a==null?void 0:a.newFileLocation)||"folder",l=(a==null?void 0:a.newFileFolderPath)||"",c="Untitled.md";if(p==="folder"&&l)c=`${l}/Untitled.md`;else if(p==="current"){let h=this.app.workspace.getActiveFile();h&&h.parent&&(c=`${h.parent.path}/Untitled.md`)}else p==="root"&&(c="Untitled.md");let u=await this.app.vault.create(c,"");return await this.app.workspace.openLinkText(u.path,"",!1),!0}if(t==="/"||t.replace(/\//g,"")===""){let a=await this.app.vault.create("Untitled.md","");return await this.app.workspace.openLinkText(a.path,"",!1),!0}let n=t.replace(/^\/+|\/+$/g,""),o=this.app.vault.getAbstractFileByPath(n);if((!o||!("children"in o))&&(await this.app.vault.createFolder(n),o=this.app.vault.getAbstractFileByPath(n)),o&&"children"in o){let a=await this.app.vault.create(`${n}/Untitled.md`,"");return await this.app.workspace.openLinkText(a.path,"",!1),!0}}catch(t){console.error("[CMS View] Error creating new note:",t)}return!1}};function Ne(r,s=5){try{let e=r;if(typeof e.registerBasesView=="function")e.registerBasesView(Ie,{name:"CMS",icon:r.settings.useHomeIcon?"lucide-home":"lucide-blocks",factory:(i,t)=>{let n=new ve(i,t,r),o=r;return o.activeViews&&o.activeViews.add(n),n},options:It()});else if(s>0){let i=r,t=i.registrationTimeout;t!=null&&window.clearTimeout(t),i.registrationTimeout=window.setTimeout(()=>{i.registrationTimeout=null,Ne(r,s-1)},200)}else console.warn("Bases CMS: registerBasesView not available. Is Bases plugin installed?")}catch(e){console.error("Bases CMS: Error registering view:",e)}}function It(){let{getCMSViewOptions:r}=(H(),Oe(Ue));return r}var we=class extends lt.Plugin{constructor(){super(...arguments);this.activeViews=new Set;this.registrationTimeout=null}async onload(){await this.loadSettings(),this.addSettingTab(new ee(this.app,this)),Ne(this)}onunload(){this.registrationTimeout!==null&&(window.clearTimeout(this.registrationTimeout),this.registrationTimeout=null),this.activeViews.clear()}async loadSettings(){this.settings=Object.assign({},Re,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}refreshAllToolbars(){let e=[];this.activeViews.forEach(i=>{let t=i.containerEl;(!t||!t.parentElement)&&e.push(i)}),e.forEach(i=>this.activeViews.delete(i)),this.activeViews.forEach(i=>{i&&typeof i.refreshToolbar=="function"&&i.refreshToolbar()})}removeView(e){this.activeViews.delete(e)}};
