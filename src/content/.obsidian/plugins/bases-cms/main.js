/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var ue=Object.defineProperty;var Qe=Object.getOwnPropertyDescriptor;var Ke=Object.getOwnPropertyNames;var Xe=Object.prototype.hasOwnProperty;var Ye=(a,i)=>()=>(a&&(i=a(a=0)),i);var Te=(a,i)=>{for(var e in i)ue(a,e,{get:i[e],enumerable:!0})},Je=(a,i,e,s)=>{if(i&&typeof i=="object"||typeof i=="function")for(let t of Ke(i))!Xe.call(a,t)&&t!==e&&ue(a,t,{get:()=>i[t],enumerable:!(s=Qe(i,t))||s.enumerable});return a};var Ce=a=>Je(ue({},"__esModule",{value:!0}),a);var Fe={};Te(Fe,{getCMSViewOptions:()=>st,readCMSSettings:()=>D});function D(a,i){var e,s,t,o,n,r,l,c,p,h,m,S,w,T,k,C;return{titleProperty:a.get("titleProperty")||"",descriptionProperty:a.get("descriptionProperty")||"",imageProperty:a.get("imageProperty")||"",showTitle:(e=a.get("showTitle"))!=null?e:!0,showDate:(s=a.get("showDate"))!=null?s:!1,dateProperty:a.get("dateProperty")||"",showTextPreview:(t=a.get("showTextPreview"))!=null?t:!0,fallbackToContent:(o=a.get("fallbackToContent"))!=null?o:!0,fallbackToEmbeds:(n=a.get("fallbackToEmbeds"))!=null?n:!1,propertyDisplay1:a.get("propertyDisplay1")||"",propertyDisplay2:a.get("propertyDisplay2")||"",propertyDisplay3:a.get("propertyDisplay3")||"",propertyDisplay4:a.get("propertyDisplay4")||"",propertyLayout12SideBySide:(r=a.get("propertyLayout12SideBySide"))!=null?r:!1,propertyLayout34SideBySide:(l=a.get("propertyLayout34SideBySide"))!=null?l:!1,imageFormat:a.get("imageFormat")||"thumbnail",propertyLabels:a.get("propertyLabels")||"hide",showDraftStatus:(c=a.get("showDraftStatus"))!=null?c:!1,draftStatusProperty:a.get("draftStatusProperty")||"",draftStatusReverse:(p=a.get("draftStatusReverse"))!=null?p:!1,draftStatusUseFilenamePrefix:(h=a.get("draftStatusUseFilenamePrefix"))!=null?h:!1,showTags:(m=a.get("showTags"))!=null?m:!1,tagsProperty:a.get("tagsProperty")||"",maxTagsToShow:(S=a.get("maxTagsToShow"))!=null?S:3,customizeNewButton:(w=a.get("customizeNewButton"))!=null?w:!1,newNoteLocation:a.get("newNoteLocation")||"",hideQuickEditIcon:(T=a.get("hideQuickEditIcon"))!=null?T:!1,cardSize:(k=a.get("cardSize"))!=null?k:250,imageAspectRatio:(C=a.get("imageAspectRatio"))!=null?C:.55}}function st(){return[{type:"slider",displayName:"Card size",key:"cardSize",min:50,max:800,step:10,default:250},{type:"dropdown",displayName:"Card image",key:"imageFormat",options:{none:"No image",thumbnail:"Thumbnail",cover:"Cover"},default:"thumbnail"},{type:"slider",displayName:"Image aspect ratio",key:"imageAspectRatio",min:.1,max:2,step:.05,default:.55,showWhen:{key:"imageFormat",value:"cover"}},{type:"property",displayName:"Image property",key:"imageProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Use in-note images if image property unavailable",key:"fallbackToEmbeds",default:!1},{type:"toggle",displayName:"Show title",key:"showTitle",default:!0},{type:"property",displayName:"Title property",key:"titleProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show date",key:"showDate",default:!1},{type:"property",displayName:"Date property",key:"dateProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show draft status",key:"showDraftStatus",default:!1},{type:"property",displayName:"Draft status property",key:"draftStatusProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Reverse logic",key:"draftStatusReverse",default:!1},{type:"toggle",displayName:"Filename underscore prefix as draft indicator",key:"draftStatusUseFilenamePrefix",default:!1},{type:"toggle",displayName:"Show text preview",key:"showTextPreview",default:!0},{type:"property",displayName:"Text preview property",key:"descriptionProperty",placeholder:"Select property",default:""},{type:"toggle",displayName:"Use note content if text preview property unavailable",key:"fallbackToContent",default:!0},{type:"toggle",displayName:"Show tags",key:"showTags",default:!1},{type:"property",displayName:"Tags property",key:"tagsProperty",placeholder:"Select property",default:""},{type:"slider",displayName:"Maximum tags to show",key:"maxTagsToShow",min:1,max:50,step:1,default:3,showWhen:{key:"showTags",value:!0}},{type:"property",displayName:"First property",key:"propertyDisplay1",placeholder:"Select property",default:""},{type:"property",displayName:"Second property",key:"propertyDisplay2",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show first and second properties side by side",key:"propertyLayout12SideBySide",default:!1},{type:"property",displayName:"Third property",key:"propertyDisplay3",placeholder:"Select property",default:""},{type:"property",displayName:"Fourth property",key:"propertyDisplay4",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show third and fourth properties side by side",key:"propertyLayout34SideBySide",default:!1},{type:"dropdown",displayName:"Show property labels",key:"propertyLabels",options:{hide:"Hide",inline:"Inline",above:"On top"},default:"hide"},{type:"toggle",displayName:"Customize new button behavior",key:"customizeNewButton",default:!1},{type:"text",displayName:"Default location for new notes",key:"newNoteLocation",placeholder:"Simply use / for vault folder",default:""},{type:"toggle",displayName:"Hide quick edit icon",key:"hideQuickEditIcon",default:!1}]}var U=Ye(()=>{"use strict"});var St={};Te(St,{default:()=>de});module.exports=Ce(St);var Ge=require("obsidian");var x=require("obsidian");var ke=require("obsidian"),H=class extends ke.FuzzySuggestModal{constructor(e,s){super(e);this.onSelect=s}getItems(){let e=this.app.commands,s=new Map;if(e&&typeof e.listCommands=="function")try{let o=e.listCommands();for(let n of o)n&&n.id&&n.name&&!s.has(n.id)&&s.set(n.id,{id:n.id,name:n.name})}catch(o){console.warn("[Bases CMS] Error getting commands via listCommands():",o)}try{let o=e==null?void 0:e.commands;if(o&&typeof o=="object"){let n=Object.values(o);for(let r of n)r&&r.id&&r.name&&!s.has(r.id)&&s.set(r.id,{id:r.id,name:r.name})}}catch(o){console.warn("[Bases CMS] Error getting commands via registry:",o)}try{let o=e==null?void 0:e.commandRegistry;if(o&&typeof o=="object"){let n=Object.values(o);for(let r of n)r&&r.id&&r.name&&!s.has(r.id)&&s.set(r.id,{id:r.id,name:r.name})}}catch(o){console.warn("[Bases CMS] Error getting commands via internal registry:",o)}let t=Array.from(s.values());return t.sort((o,n)=>o.name.localeCompare(n.name)),t}getItemText(e){return e.name}onChooseItem(e,s){this.onSelect(e.id)}renderSuggestion(e,s){let t=e.item;s.createDiv({cls:"suggestion-title",text:t.name})}};var M=require("obsidian"),Ze=()=>{if(M.requireApiVersion&&(0,M.requireApiVersion)("1.7.3")&&M.getIconIds)try{return(0,M.getIconIds)()}catch(a){console.warn("[Bases CMS] Error getting icon IDs from Obsidian:",a)}return["settings-2","settings","help-circle","info","star","heart","bookmark","home","search","bell","mail","user","users","folder","file","file-text","image","video","music","calendar","clock","edit","pencil","trash","copy","cut","paste","download","upload","save","share","link","external-link","lock","unlock","eye","eye-off","key","shield","check","x","plus","minus","arrow-left","arrow-right","arrow-up","arrow-down","chevron-left","chevron-right","chevron-up","chevron-down","menu","more-horizontal","more-vertical","grid","list","layout","columns","rows","maximize","minimize","zoom-in","zoom-out","refresh-cw","play","pause","stop","sun","moon","cloud","zap","wand-2","wand","wand-sparkles","palette","brush","sliders","power","wifi","bluetooth","monitor","laptop","smartphone","camera","mic","headphones","code","terminal","terminal-square","github","gitlab","git-branch","git-commit","database","server","cloud-download","cloud-upload","tag","tags","flag","pin","map-pin","compass","globe","rocket","car","bike","robot","apple","windows","linux","chrome","firefox","safari","credit-card","wallet","coins","book","book-open","award","trophy","badge","wrench","tool","package","box","archive","send","reply","forward","mail-open","tag-plus","tag-minus","flag-off","pin-off","map-pin-off","navigation","map","earth","plane","ship","anchor","helicopter","drone","android","keyhole","keys","fingerprint","scan","qr-code","barcode","receipt","piggy-bank","banknote","pencil-line","edit-2","edit-3"]},et=Ze().map(a=>({id:a,name:a.replace(/^lucide-/,"").replace(/-/g," ").replace(/(^\w{1})|(\s+\w{1})/g,i=>i.toUpperCase())})).sort((a,i)=>a.name.localeCompare(i.name)),W=class extends M.FuzzySuggestModal{constructor(e,s){super(e);this.onSelect=s}getItems(){return et}getItemText(e){return e.name}onChooseItem(e,s){this.onSelect(e.id)}renderSuggestion(e,s){let t=e.item;s.addClass("mod-complex"),s.createDiv({cls:"suggestion-content"}).createDiv({cls:"suggestion-title",text:t.name});let n=s.createDiv({cls:"suggestion-aux"});(0,M.setIcon)(n.createSpan({cls:"suggestion-flair"}),t.id)}};var j=class extends x.PluginSettingTab{constructor(e,s){super(e,s);this.plugin=s}refreshActiveToolbars(){let e=this.plugin;e&&typeof e.refreshAllToolbars=="function"&&e.refreshAllToolbars()}display(){let{containerEl:e}=this;e.empty(),new x.Setting(e).setName("Confirm bulk operations").setDesc("Show confirmation dialogs before performing bulk operations.").addToggle(n=>n.setValue(this.plugin.settings.confirmBulkOperations).onChange(r=>{(async()=>(this.plugin.settings.confirmBulkOperations=r,await this.plugin.saveData(this.plugin.settings)))()})),new x.Setting(e).setName("Toolbar buttons").setHeading(),new x.Setting(e).setName("Show select all button").setDesc("Display the select all button in the CMS toolbar.").addToggle(n=>n.setValue(this.plugin.settings.showToolbarSelectAll).onChange(r=>{(async()=>(this.plugin.settings.showToolbarSelectAll=r,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new x.Setting(e).setName("Show clear button").setDesc("Display the clear selection button in the CMS toolbar.").addToggle(n=>n.setValue(this.plugin.settings.showToolbarClear).onChange(r=>{(async()=>(this.plugin.settings.showToolbarClear=r,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new x.Setting(e).setName("Show publish button").setDesc("Display the publish button in the CMS toolbar.").addToggle(n=>n.setValue(this.plugin.settings.showToolbarPublish).onChange(r=>{(async()=>(this.plugin.settings.showToolbarPublish=r,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new x.Setting(e).setName("Show draft button").setDesc("Display the draft button in the CMS toolbar.").addToggle(n=>n.setValue(this.plugin.settings.showToolbarDraft).onChange(r=>{(async()=>(this.plugin.settings.showToolbarDraft=r,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new x.Setting(e).setName("Show tags button").setDesc("Display the tags button in the CMS toolbar.").addToggle(n=>n.setValue(this.plugin.settings.showToolbarTags).onChange(r=>{(async()=>(this.plugin.settings.showToolbarTags=r,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new x.Setting(e).setName("Show set button").setDesc("Display the set property button in the CMS toolbar.").addToggle(n=>n.setValue(this.plugin.settings.showToolbarSet).onChange(r=>{(async()=>(this.plugin.settings.showToolbarSet=r,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new x.Setting(e).setName("Show remove button").setDesc("Display the remove property button in the CMS toolbar.").addToggle(n=>n.setValue(this.plugin.settings.showToolbarRemove).onChange(r=>{(async()=>(this.plugin.settings.showToolbarRemove=r,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new x.Setting(e).setName("Show delete button").setDesc("Display the delete button in the CMS toolbar.").addToggle(n=>n.setValue(this.plugin.settings.showToolbarDelete).onChange(r=>{(async()=>(this.plugin.settings.showToolbarDelete=r,await this.plugin.saveData(this.plugin.settings),this.refreshActiveToolbars()))()})),new x.Setting(e).setName("Deletions").setHeading(),new x.Setting(e).setName("Delete parent folder for specific file name").setDesc("When enabled, deleting a note will delete its parent folder and all its contents if the note file name matches the specified name.").addToggle(n=>n.setValue(this.plugin.settings.deleteParentFolder).onChange(r=>{(async()=>(this.plugin.settings.deleteParentFolder=r,await this.plugin.saveData(this.plugin.settings)))()})),new x.Setting(e).setName("Folder deletion file name").setDesc("File name that triggers parent folder deletion.").addText(n=>n.setPlaceholder("index").setValue(this.plugin.settings.deleteParentFolderFilename).onChange(r=>{(async()=>(this.plugin.settings.deleteParentFolderFilename=r,await this.plugin.saveData(this.plugin.settings)))()})).setDisabled(!this.plugin.settings.deleteParentFolder),new x.Setting(e).setName("Delete associated unique attachments").setDesc("When deleting a note, automatically delete attachments that are only used by that note. Attachments used by other notes will be preserved.").addToggle(n=>n.setValue(this.plugin.settings.deleteUniqueAttachments).onChange(r=>{(async()=>(this.plugin.settings.deleteUniqueAttachments=r,await this.plugin.saveData(this.plugin.settings)))()})),new x.Setting(e).setName("Confirm deletions").setDesc("Show confirmation dialog before deleting files.").addToggle(n=>n.setValue(this.plugin.settings.confirmDeletions).onChange(r=>{(async()=>(this.plugin.settings.confirmDeletions=r,await this.plugin.saveData(this.plugin.settings)))()})),new x.Setting(e).setName("Appearance").setHeading(),new x.Setting(e).setName("Use home icon for CMS view").setDesc("Use the home icon instead of blocks icon for the CMS view in the Bases view selector. Restart Obsidian for this change to take effect.").addToggle(n=>n.setValue(this.plugin.settings.useHomeIcon).onChange(r=>{(async()=>(this.plugin.settings.useHomeIcon=r,await this.plugin.saveData(this.plugin.settings)))()})),new x.Setting(e).setName("Force static image for animated GIFs").setDesc("When enabled, animated GIFs will display only the first frame when used as card covers or thumbnails.").addToggle(n=>n.setValue(this.plugin.settings.forceStaticGifImages).onChange(r=>{(async()=>{this.plugin.settings.forceStaticGifImages=r,await this.plugin.saveData(this.plugin.settings);let l=this.plugin;l.activeViews&&l.activeViews.forEach(c=>{c.onDataUpdated&&c.onDataUpdated()})})()})),new x.Setting(e).setName("Quick edit").setHeading();let s,t,o;new x.Setting(e).setName("Enable quick edit").setDesc("Show an icon on card titles that launches a command when clicked.").addToggle(n=>n.setValue(this.plugin.settings.enableQuickEdit).onChange(r=>{(async()=>(this.plugin.settings.enableQuickEdit=r,await this.plugin.saveData(this.plugin.settings),s&&s.settingEl.toggleClass("bases-cms-setting-hidden",!r),t&&t.settingEl.toggleClass("bases-cms-setting-hidden",!r),o&&o.settingEl.toggleClass("bases-cms-setting-hidden",!r)))()})),s=new x.Setting(e).setName("Quick edit command").setDesc("The command to execute when clicking the quick edit icon on a card title.").addButton(n=>{var l;let r=this.plugin.settings.quickEditCommandName||(this.plugin.settings.quickEditCommand?"Select command...":"No command selected");if(n.setButtonText(r).onClick(()=>{new H(this.app,p=>{(async()=>{let h=this.app.commands,m="";if(h){if(typeof h.listCommands=="function"){let w=h.listCommands().find(T=>T.id===p);w&&(m=w.name)}if(!m){let S=h.commands;S&&S[p]&&(m=S[p].name||"")}}this.plugin.settings.quickEditCommand=p,this.plugin.settings.quickEditCommandName=m,await this.plugin.saveData(this.plugin.settings),this.display()})()}).open()}),this.plugin.settings.quickEditCommand){let c=(l=n.buttonEl.parentElement)==null?void 0:l.createEl("button",{text:"Clear",attr:{style:"margin-left: 8px;"}});c==null||c.addEventListener("click",()=>{(async()=>(this.plugin.settings.quickEditCommand="",this.plugin.settings.quickEditCommandName="",await this.plugin.saveData(this.plugin.settings),this.display()))()})}}),s.settingEl.toggleClass("bases-cms-setting-hidden",!this.plugin.settings.enableQuickEdit),t=new x.Setting(e).setName("Quick edit icon").setDesc("Select the icon to display for the quick edit button on card titles.").addButton(n=>{let r=this.getIconName(this.plugin.settings.quickEditIcon||"pencil-line");n.setButtonText(r||"Select icon...").onClick(()=>{new W(this.app,async c=>{this.plugin.settings.quickEditIcon=c,await this.plugin.saveData(this.plugin.settings),this.display()}).open()})}),t.settingEl.toggleClass("bases-cms-setting-hidden",!this.plugin.settings.enableQuickEdit),o=new x.Setting(e).setName("Attempt to open file and execute quick edit command").setDesc("For commands that don't have special handling, attempt to open the file and execute the command. Some commands may not work properly this way.").addToggle(n=>n.setValue(this.plugin.settings.quickEditOpenFile).onChange(r=>{(async()=>(this.plugin.settings.quickEditOpenFile=r,await this.plugin.saveData(this.plugin.settings)))()})),o.settingEl.toggleClass("bases-cms-setting-hidden",!this.plugin.settings.enableQuickEdit)}getIconName(e){return e?e.replace(/^lucide-/,"").split("-").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "):""}};var Pe={confirmBulkOperations:!0,deleteParentFolder:!1,deleteParentFolderFilename:"index",deleteUniqueAttachments:!1,confirmDeletions:!0,useHomeIcon:!1,enableQuickEdit:!1,quickEditCommand:"",quickEditCommandName:"",quickEditIcon:"pencil-line",quickEditOpenFile:!1,showToolbarSelectAll:!0,showToolbarClear:!0,showToolbarDraft:!0,showToolbarPublish:!0,showToolbarTags:!0,showToolbarSet:!0,showToolbarRemove:!0,showToolbarDelete:!0,forceStaticGifImages:!1};var _=require("obsidian");function I(a,i){if(!i||!i.trim())return null;let e=i.split(",").map(s=>s.trim()).filter(s=>s);for(let s of e){let t=a.getValue(s),o=t;if(o&&("date"in o&&o.date instanceof Date||"data"in o))return t}return null}function ge(a,i){if(!i||!i.trim())return[];let e=i.split(",")[0].trim();if(!e)return[];let s=a.getValue(e);if(!s||!("data"in s))return[];let t=s.data,o=[];if(Array.isArray(t)){for(let n of t)if(typeof n=="string"||typeof n=="number"){let r=String(n);if(r&&r.trim()){o.push(r);break}}}else if(t!=null&&t!==""&&(typeof t=="string"||typeof t=="number")){let n=String(t);n.trim()&&o.push(n)}return o}function xe(a,i,e,s){if(!a||a==="")return"";if(e){let t=e;if(typeof t.getDisplayName=="function")try{let o=t.getDisplayName(a);if(o&&typeof o=="string"&&o.trim()!=="")return o}catch(o){}}return a}function tt(a,i,e,s,t,o,n){let r=a.file.basename||a.file.name,l=I(a,i.titleProperty),c=l==null?void 0:l.data,p=c!=null&&c!==""&&(typeof c=="string"||typeof c=="number")?String(c):r,h=a.file.path,m=h.split("/").slice(0,-1).join("/"),S=a.getValue("note.tags"),w=[];if(S&&S.data!=null){let y=S.data;w=(Array.isArray(y)?y.map(b=>b&&typeof b=="object"&&"data"in b?String(b.data):typeof b=="string"||typeof b=="number"?String(b):"").filter(b=>b):typeof y=="string"||typeof y=="number"?[String(y)]:[]).map(b=>b.replace(/^#/,""))}let T=a.getValue("file.tags"),k=[];if(T&&T.data!=null){let y=T.data;k=(Array.isArray(y)?y.map(b=>b&&typeof b=="object"&&b!==null&&"data"in b?String(b.data):typeof b=="string"||typeof b=="number"?String(b):"").filter(b=>typeof b=="string"&&b.length>0):typeof y=="string"||typeof y=="number"?[String(y)]:[]).map(b=>b.replace(/^#/,""))}let C=a.file.stat.ctime,E=a.file.stat.mtime,v=[];if(i.showTags&&i.tagsProperty){let y=I(a,i.tagsProperty);if(y&&y.data!=null){let P=y.data;Array.isArray(P)?v=P.map(b=>b&&typeof b=="object"&&"data"in b?String(b.data):typeof b=="string"||typeof b=="number"?String(b):"").filter(b=>typeof b=="string"&&b.length>0):(typeof P=="string"||typeof P=="number")&&(v=[String(P)])}}let g={path:h,name:r,title:p,tags:k,yamlTags:w,ctime:C,mtime:E,folderPath:m,snippet:t,imageUrl:o,hasImageAvailable:n||!1,displayTags:v.length>0?v:void 0},d=[i.propertyDisplay1,i.propertyDisplay2,i.propertyDisplay3,i.propertyDisplay4],u=new Set,f=d.map(y=>!y||y===""||u.has(y)?"":(u.add(y),y));return g.propertyName1=f[0]||void 0,g.propertyName2=f[1]||void 0,g.propertyName3=f[2]||void 0,g.propertyName4=f[3]||void 0,g.property1=f[0]?q(f[0],a,g,i):null,g.property2=f[1]?q(f[1],a,g,i):null,g.property3=f[2]?q(f[2],a,g,i):null,g.property4=f[3]?q(f[3],a,g,i):null,g}function De(a,i,e,s,t,o,n){return a.map(r=>tt(r,i,e,s,t[r.file.path],o[r.file.path],n[r.file.path]))}function q(a,i,e,s){if(!a||a==="")return null;if(a==="file.path"||a==="file path")return e.folderPath||null;if(a==="tags"||a==="note.tags")return e.yamlTags.length>0?"tags":null;if(a==="file.tags"||a==="file tags")return e.tags.length>0?"tags":null;if(a==="file.ctime"||a==="created time")return new Date(e.ctime).toLocaleDateString();if(a==="file.mtime"||a==="modified time")return new Date(e.mtime).toLocaleDateString();let t=I(i,a);if(!t)return null;let o=t;if(!o)return null;if("date"in o&&o.date instanceof Date)return o.date.toLocaleDateString();let n=o.data;return n==null||n===""?null:Array.isArray(n)?n.length===0?null:n.map(r=>r&&typeof r=="object"&&"data"in r?String(r.data):String(r)).filter(r=>r&&r.trim()!=="").join(", "):typeof n=="string"||typeof n=="number"||typeof n=="boolean"?String(n):null}U();var me=require("obsidian");function Ae(a){return/^https?:\/\//i.test(a)}function fe(a){return/\.(avif|bmp|gif|jpe?g|png|svg|webp)$/i.test(a)}function Me(a){return new Promise(i=>{let e=new Image;e.onload=()=>i(!0),e.onerror=()=>i(!1),setTimeout(()=>i(!1),5e3),e.src=a})}function it(a){let i=a.match(/^!?\[\[([^\]|]+)(?:\|[^\]]*)?\]\]$/);return i?i[1].trim():a}async function Ie(a){let i=[],e=[];for(let n of a){let r=it(n);r.length!==0&&(Ae(r)?(fe(r)||!r.includes("."))&&e.push(r):fe(r)&&i.push(r))}let s=e.map(n=>Me(n).then(r=>r?n:null)),o=(await Promise.all(s)).filter(n=>n!==null);return{internalPaths:i,externalUrls:o}}function Be(a,i,e){let s=["avif","bmp","gif","jpeg","jpg","png","svg","webp"],t=[];for(let o of a){let n=e.metadataCache.getFirstLinkpathDest(o,i);if(!n&&o.startsWith("./")){let r=e.vault.getAbstractFileByPath(i);if(r&&r.parent){let l=o.substring(2),c=r.parent.path?`${r.parent.path}/${l}`:l,p=e.vault.getAbstractFileByPath(c);p instanceof me.TFile&&(n=p)}}if(!n){let r=e.vault.getAbstractFileByPath(o);r instanceof me.TFile&&(n=r)}if(n&&s.includes(n.extension)){let r=e.vault.getResourcePath(n);t.push(r)}}return t}async function be(a,i){let e=["avif","bmp","gif","jpeg","jpg","png","svg","webp"],s=i.metadataCache.getFileCache(a);if(!(s!=null&&s.embeds))return[];let t=[],o=[];for(let c of s.embeds){let p=c.link;if(Ae(p))(fe(p)||!p.includes("."))&&o.push(p);else{let h=i.metadataCache.getFirstLinkpathDest(p,a.path);if(h&&e.includes(h.extension)){let m=i.vault.getResourcePath(h);t.push(m)}}}let n=o.map(c=>Me(c).then(p=>p?c:null)),l=(await Promise.all(n)).filter(c=>c!==null);return[...t,...l]}function nt(a){return/\.gif(\?|#|$)/i.test(a)||/\.gif$/i.test(a)}async function G(a,i){return!i||!nt(a)?a:new Promise(e=>{let s=new Image;s.crossOrigin="anonymous",s.onload=()=>{try{let t=document.createElement("canvas");t.width=s.width,t.height=s.height;let o=t.getContext("2d");if(o){o.drawImage(s,0,0);let n=t.toDataURL("image/png");e(n)}else e(a)}catch(t){console.warn("Failed to convert GIF to static image:",t),e(a)}},s.onerror=()=>{e(a)},setTimeout(()=>{e(a)},5e3),s.src=a})}var at=[/`([^`]+)`/g,/\*\*\*((?:(?!\*\*\*).)+)\*\*\*/g,/___((?:(?!___).)+)___/g,/\*\*((?:(?!\*\*).)+)\*\*/g,/__((?:(?!__).)+)__/g,/\*((?:(?!\*).)+)\*/g,/_((?:(?!_).)+)_/g,/~~((?:(?!~~).)+)~~/g,/==((?:(?!==).)+)==/g,/\[([^\]]+)\]\([^)]+\)/g,/!\[\[[^\]]+\]\]/g,/\[\[[^\]|]+\|[^\]]+\]\]/g,/\[\[[^\]]+\]\]/g,/#[a-zA-Z0-9_\-/]+/g,/^[-*+]\s*\[[ xX]\]\s+/gm,/^(\d+\.\s*)\[[ xX]\]\s+/gm,/^(\d+\)\s*)\[[ xX]\]\s+/gm,/^[-*+]\s+/gm,/^#{1,6}\s+.+$/gm,/^\s*(?:[-_*])\s*(?:[-_*])\s*(?:[-_*])[\s\-_*]*$/gm,/^\s*\|.*\|.*$/gm,/\^\[[^\]]*?]/g,/\[\^[^\]]+]/g,/^\s*\[\^[^\]]+]:.*$/gm,/<([a-z][a-z0-9]*)\b[^>]*>(.*?)<\/\1>/gi,/<[^>]+>/g];function ot(a){let i=new Map,e=0;return{text:a.replace(/\\(.)/g,(t,o)=>{let n=`\xA7\xA7ESCAPED${e}\xA7\xA7`;return i.set(n,o),e++,n}),map:i}}function rt(a,i){let e=a;return i.forEach((s,t)=>{e=e.split(t).join(s)}),e}function lt(a){let i=a,e=!0;for(;e;){e=!1;let s=i.match(/^([`~]{3,})/m);if(!s)break;let t=s[1][0],o=s[1].length,n=s.index,r=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),l=new RegExp(`^${r}{${o}}\\s*$`,"m"),p=i.substring(n+s[1].length).match(l);if(p){let m=n+s[1].length+p.index+p[0].length;i=i.substring(0,n)+i.substring(m),e=!0}else{let h=i.indexOf(`
`,n);h===-1?i=i.substring(0,n):i=i.substring(0,n)+i.substring(h+1),e=!0}}return i}function ct(a){if(!a||a.trim().length===0)return"";a=a.replace(/^>\s*\[![\w-]+\][+-]?.*$/gm,""),a=a.replace(/^>\s?/gm,"");let{text:i,map:e}=ot(a),s=lt(i);return at.forEach(t=>{s=s.replace(t,(o,...n)=>{if(o.match(/<[a-z][a-z0-9]*\b[^>]*>.*?<\//i))return n[1]||"";if(n.length>0&&n[0]!==void 0){for(let r=0;r<n.length-2;r++)if(typeof n[r]=="string")return n[r]}return""})}),s=rt(s,e),s}function pt(a,i=!1,e,s){let t=a.replace(/^---[\s\S]*?---/,"").trim(),o=ct(t),n=o.indexOf(`
`),r=(n!==-1?o.substring(0,n):o).trim();(i||e&&r===e||s&&r===s)&&(o=n!==-1?o.substring(n+1).trim():"");let l=o.replace(/\^[a-zA-Z0-9-]+/g,"").split(/\s+/).filter(h=>h).join(" ").trim().replace(/\.{2,}/g,h=>h.replace(/\./g,"\u2024")),c=l.length>500,p=l.substring(0,500);return c&&(p+="\u2026"),p}async function Le(a,i,e,s,t,o){if(e!=null&&(typeof e=="string"||typeof e=="number")&&String(e).trim().length>0)return String(e).trim();if(s.fallbackToContent){let r=await i.vault.cachedRead(a);return pt(r,s.omitFirstLine,t,o)}return""}async function dt(a,i,e,s,t,o,n){let r=s&&Array.isArray(s)&&s.length>0;if(!t&&a in o&&(delete o[a],delete n[a]),!(a in o&&!r&&t))try{let{internalPaths:l,externalUrls:c}=await Ie(s),p=[...Be(l,a,e),...c];p.length===0&&!r&&t&&(p=await be(i,e)),p.length>0?(o[a]=p.length>1?p:p[0],n[a]=!0):r?(delete o[a],n[a]=!0):t||(delete o[a],delete n[a])}catch(l){console.error(`Failed to load image for ${a}:`,l)}}async function ye(a,i,e,s,t){let o=a.filter(r=>{let l=r.imagePropertyValues&&Array.isArray(r.imagePropertyValues)&&r.imagePropertyValues.length>0;return!(r.path in s)||l}),n=50;for(let r=0;r<o.length;r+=n){let l=o.slice(r,r+n);await Promise.all(l.map(async c=>{await dt(c.path,c.file,e,c.imagePropertyValues,i,s,t)}))}}async function Oe(a,i,e,s){await Promise.all(a.map(async t=>{if(!(t.path in e||s[t.path]))try{let o=await be(t.file,i);o.length>0&&(e[t.path]=o.length>1?o:o[0],s[t.path]=!0)}catch(o){console.error(`Failed to load embed images for ${t.path}:`,o)}}))}async function Ne(a,i,e,s,t){await Promise.all(a.map(async o=>{if(!(o.path in t))try{o.file.extension==="md"?t[o.path]=await Le(o.file,s,o.descriptionData,{fallbackToContent:i,omitFirstLine:e},o.fileName,o.titleString):t[o.path]=""}catch(n){console.error(`Failed to load snippet for ${o.path}:`,n),t[o.path]=""}}))}var Y=require("obsidian");function ht(a,i){let e=null,s=!1;if(i.draftStatusUseFilenamePrefix&&a.file&&a.file.name)e=a.file.name.startsWith("_"),s=i.draftStatusReverse?!e:e;else if(i.draftStatusProperty){let t=I(a,i.draftStatusProperty);if(t){let o=t;o&&"data"in o&&typeof o.data=="boolean"&&(e=o.data,s=i.draftStatusReverse?!e:e)}}return{booleanValue:e,isDraft:s}}function Q(a,i,e,s,t){if(!s.showDraftStatus)return;let{booleanValue:o,isDraft:n}=ht(i,s);if(o!==null){let r=a.createDiv("card-status-badge");n?(r.addClass("status-draft"),r.appendText("Draft")):(r.addClass("status-published"),r.appendText("Published")),t&&(r.addClass("bases-cms-cursor-pointer"),r.addEventListener("click",l=>{l.stopPropagation(),t(e,"draft",!o)}))}}var A=require("obsidian");function ut(a,i){let e=new A.Modal(a);e.titleEl.setText("Rename file");let s=e.contentEl.createDiv();s.style.width="100%";let t=new A.TextComponent(s);t.setValue(i.basename),t.inputEl.style.width="100%",t.inputEl.style.boxSizing="border-box",t.inputEl.focus(),t.inputEl.select();let o=e.contentEl.createDiv({cls:"modal-button-container"});o.createEl("button",{text:"Cancel"}).addEventListener("click",()=>e.close());let r=o.createEl("button",{text:"Rename",cls:"mod-cta"}),l=async()=>{let c=t.getValue().trim();if(!c||c===i.basename){e.close();return}let p=i.path.split("/");p[p.length-1]=c+(i.extension?`.${i.extension}`:"");let h=p.join("/");try{await a.fileManager.renameFile(i,h),e.close()}catch(m){console.error("[Bases CMS] Error renaming file:",m),e.close()}};r.addEventListener("click",()=>{l()}),t.inputEl.addEventListener("keydown",c=>{c.key==="Enter"?(c.preventDefault(),l()):c.key==="Escape"&&(c.preventDefault(),e.close())}),e.open()}function gt(a){let i=a.toLowerCase();return a==="file-explorer:rename-file"||a==="rename-file"||a==="file:rename-file"||i.includes("rename")&&i.includes("file")&&!i.includes(":")}function mt(a,i){let e=a.toLowerCase(),s=i.toLowerCase();return["add tag","add-tag","insert-template","insert-template","editor:","markdown:"].some(o=>e.includes(o)||s.includes(o))}function Ve(a,i,e,s,t,o){if(!i.settings.enableQuickEdit||!i.settings.quickEditCommand||i.settings.quickEditCommand===""||o.hideQuickEditIcon)return;let n=e.createSpan("bases-cms-quick-edit-icon");n.addClass("bases-cms-cursor-default"),(0,A.setIcon)(n,i.settings.quickEditIcon||"pencil-line"),e.addEventListener("click",r=>{n.contains(r.target)&&(r.stopPropagation(),r.stopImmediatePropagation())},!0),s.addEventListener("click",r=>{(async()=>{var p,h,m,S;let l=r.target;if(!n.contains(l)&&!l.closest(".bases-cms-quick-edit-icon"))return;r.stopPropagation(),r.stopImmediatePropagation(),r.preventDefault();let c=a.vault.getAbstractFileByPath(t);if(c instanceof A.TFile){let w=i.settings.quickEditCommand,T=a.commands,k=(p=T==null?void 0:T.commands)==null?void 0:p[w],C=(k==null?void 0:k.name)||"",E=C.toLowerCase();if(gt(w)||E.includes("rename")&&E.includes("file")){ut(a,c);return}if(mt(w,C)&&!i.settings.quickEditOpenFile){new A.Notice(`The "${C}" command requires the file to be open in an editor. Enable "Attempt to open file and execute quick edit command" in settings to try anyway.`,5e3);return}let v=!1;try{let g=null,d=w;if(w.includes(":")){let u=w.split(":");g=u[0],d=u.slice(1).join(":")}else{let f=a.commands,y=(h=f==null?void 0:f.commands)==null?void 0:h[w];if(y){let P=y.plugin||y.sourcePlugin;P&&(g=((m=P.manifest)==null?void 0:m.id)||P.pluginId||null)}}if(g){let u=a.plugins,f=(S=u==null?void 0:u.plugins)==null?void 0:S[g];if(f){let y=d.split("-").map((P,b)=>b===0?P:P.charAt(0).toUpperCase()+P.slice(1)).join("")+"ByPath";if(f&&typeof f[y]=="function"){await f[y](t),v=!0;return}}}}catch(g){}if(!v){if(!i.settings.quickEditOpenFile){new A.Notice(`This command doesn't have special handling. Enable "Attempt to open file and execute quick edit command" in settings to try executing it.`,5e3);return}let g=a.workspace.getLeaf(!1);await g.openFile(c),a.workspace.setActiveLeaf(g,{focus:!0});let d=0,u=30,f=()=>{a.workspace.getActiveFile()===c&&(async()=>{var b,F;try{await((F=(b=a.commands)==null?void 0:b.executeCommandById)==null?void 0:F.call(b,i.settings.quickEditCommand))}catch(he){}})()},y=()=>{let P=g.view,b=P,F=a.workspace.getActiveFile();P&&"editor"in P&&b.editor&&F===c?requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{f()},200)})}):d<u&&(d++,setTimeout(y,50))};y()}}})()},!0),n.addEventListener("mousedown",r=>{r.stopPropagation(),r.stopImmediatePropagation(),r.preventDefault()},!0)}var Re=require("obsidian");var K=class{constructor(i,e,s){this.app=i;this.getBasesConfig=e;this.getBasesController=s}renderProperties(i,e,s,t,o){let n=[t.propertyDisplay1,t.propertyDisplay2,t.propertyDisplay3,t.propertyDisplay4],r=new Set,l=n.map(S=>!S||S===""||r.has(S)?"":(r.add(S),S)),c=l.map(S=>S?q(S,s,e,t):null),p=l[0]!==""||l[1]!=="",h=l[2]!==""||l[3]!=="";if(!p&&!h)return;let m=i.createDiv("card-properties properties-4field");if(p){let S=m.createDiv("property-row property-row-1");t.propertyLayout12SideBySide&&S.addClass("property-row-side-by-side");let w=S.createDiv("property-field property-field-1");l[0]&&this.renderPropertyContent(w,l[0],c[0],e,s,t,o);let T=S.createDiv("property-field property-field-2");l[1]&&this.renderPropertyContent(T,l[1],c[1],e,s,t,o)}if(h){let S=m.createDiv("property-row property-row-2");t.propertyLayout34SideBySide&&S.addClass("property-row-side-by-side");let w=S.createDiv("property-field property-field-3");l[2]&&this.renderPropertyContent(w,l[2],c[2],e,s,t,o);let T=S.createDiv("property-field property-field-4");l[3]&&this.renderPropertyContent(T,l[3],c[3],e,s,t,o)}}renderPropertyContent(i,e,s,t,o,n,r){if(e===""||!s&&n.propertyLabels==="hide"||n.propertyLabels==="hide"&&((e==="tags"||e==="note.tags")&&t.yamlTags.length===0||(e==="file.tags"||e==="file tags")&&t.tags.length===0||(e==="file.path"||e==="path"||e==="file path")&&t.folderPath.length===0))return;let l=this.getBasesConfig?this.getBasesConfig():void 0,c=this.getBasesController?this.getBasesController():void 0,p=xe(e,this.app,l,c),h=p.toLowerCase()!==e.toLowerCase();if(n.propertyLabels==="above"){let w=i.createDiv("property-label");h&&w.addClass("property-label-custom"),w.textContent=p}let m=i.createDiv("property-content");if(n.propertyLabels==="inline"){let w=m.createSpan("property-label-inline");w.textContent=p+": "}if(!s){m.appendText("\u2026");return}if(e==="file.mtime"||e==="file.ctime"||e==="modified time"||e==="created time")m.createSpan().appendText(s);else if((e==="tags"||e==="note.tags")&&t.yamlTags.length>0){let w=m.createDiv("tags-wrapper");t.yamlTags.forEach(T=>{w.createEl("a",{cls:"tag",text:T,href:"#"}).addEventListener("click",C=>{var v,g,d;C.preventDefault();let E=(g=(v=this.app.internalPlugins)==null?void 0:v.plugins)==null?void 0:g["global-search"];(d=E==null?void 0:E.instance)!=null&&d.openGlobalSearch&&E.instance.openGlobalSearch("tag:"+T)})})}else if((e==="file.tags"||e==="file tags")&&t.tags.length>0){let w=m.createDiv("tags-wrapper");t.tags.forEach(T=>{w.createEl("a",{cls:"tag",text:T,href:"#"}).addEventListener("click",C=>{var v,g,d;C.preventDefault();let E=(g=(v=this.app.internalPlugins)==null?void 0:v.plugins)==null?void 0:g["global-search"];(d=E==null?void 0:E.instance)!=null&&d.openGlobalSearch&&E.instance.openGlobalSearch("tag:"+T)})})}else if((e==="file.path"||e==="path"||e==="file path")&&t.path.length>0){let w=m.createDiv("path-wrapper"),T=t.path.split("/").filter(k=>k);T.forEach((k,C)=>{let E=w.createSpan(),v=C===T.length-1,g=v?"path-segment filename-segment":"path-segment file-path-segment";E.createSpan({cls:g,text:k}).addEventListener("click",u=>{if(u.stopPropagation(),v){let f=this.app.vault.getAbstractFileByPath(t.path);f instanceof Re.TFile&&this.app.workspace.getLeaf(!1).openFile(f)}}),C<T.length-1&&E.createSpan({cls:"path-separator",text:"/"})})}else{let w=this.app.metadataCache,k=(typeof w.getAllPropertyInfos=="function"?w.getAllPropertyInfos():{})[e.toLowerCase()],C=o.getValue(e);if(((k==null?void 0:k.widget)==="checkbox"||C&&"data"in C&&typeof C.data=="boolean")&&r){let v=m.createEl("input",{type:"checkbox"});v.checked=C&&"data"in C?Boolean(C.data):!1,m.createSpan({text:p}),v.addEventListener("change",async g=>{g.stopPropagation();let d=v.checked;try{let u=e.startsWith("note.")?e.substring(5):e;await r(t.path,u,d)}catch(u){console.error("Error toggling property:",u),v.checked=!d}}),v.addEventListener("click",g=>{g.stopPropagation()})}else m.createDiv("text-wrapper").appendText(s)}(!m.textContent||m.textContent.trim().length===0)&&m.remove()}};var X=class{constructor(i,e,s,t,o,n){this.app=i;this.plugin=e;this.propertyObservers=s;this.updateLayoutRef=t;this.basesConfig=o,this.basesController=n,this.propertyRenderer=new K(this.app,()=>this.basesConfig,()=>this.basesController)}renderCard(i,e,s,t,o,n,r,l){let c=i.createDiv("card bases-cms-card");t.imageFormat==="cover"?c.classList.add("image-format-cover"):t.imageFormat==="thumbnail"&&c.classList.add("image-format-thumbnail"),c.setAttribute("data-path",e.path),c.setAttribute("data-href",e.path),c.addClass("bases-cms-cursor-pointer");let p=c.createDiv("bases-cms-select-checkbox"),h=p.createEl("input",{type:"checkbox",cls:"selection-checkbox"});h.checked=n,h.addEventListener("change",d=>{d.stopPropagation(),d.stopImmediatePropagation(),r(e.path,h.checked)}),h.addEventListener("click",d=>{d.stopPropagation(),d.stopImmediatePropagation()}),t.showDraftStatus&&t.imageFormat!=="cover"&&Q(c,s,e.path,t,l);let m=null,S=0,w=0,T=0,k=!1,C=!1,E=d=>{let u=d.target;p.contains(u)||u.tagName==="INPUT"||u.closest("input")||u.closest(".bases-cms-property")||u.closest(".card-status-badge")||u.closest(".bases-cms-quick-edit-icon")||(S=Date.now(),w=d.touches[0].clientX,T=d.touches[0].clientY,k=!1,C=!1,m=window.setTimeout(()=>{k=!0,C=!0,r(e.path,!h.checked),navigator.vibrate&&navigator.vibrate(50)},500))},v=d=>{if(m&&d.touches[0]){let u=Math.abs(d.touches[0].clientX-w),f=Math.abs(d.touches[0].clientY-T);(u>10||f>10)&&m&&(clearTimeout(m),m=null)}},g=d=>{m&&(clearTimeout(m),m=null),k&&(C=!0)};if(c.addEventListener("touchstart",E,{passive:!0}),c.addEventListener("touchmove",v,{passive:!0}),c.addEventListener("touchend",g,{passive:!0}),c.addEventListener("click",d=>{if(C){d.preventDefault(),d.stopPropagation(),d.stopImmediatePropagation(),C=!1;return}let u=d.target;if(u.closest(".bases-cms-quick-edit-icon")){d.stopPropagation(),d.stopImmediatePropagation(),d.preventDefault();return}if(p.contains(u)||u.tagName==="INPUT"||u.closest("input")||u.closest(".bases-cms-property")||u.closest(".card-status-badge"))return;let y=d.metaKey||d.ctrlKey;this.app.workspace.openLinkText(e.path,"",y)}),c.addEventListener("contextmenu",d=>{let u=d.target;if(p.contains(u)||u.tagName==="INPUT"||u.closest("input")||u.closest(".bases-cms-property")||u.closest(".card-status-badge")||u.closest(".bases-cms-quick-edit-icon"))return;let f=this.app.vault.getAbstractFileByPath(e.path);if(f&&f instanceof Y.TFile){d.stopPropagation();let y=new Y.Menu;this.app.workspace.trigger("file-menu",y,f,"bases"),y.showAtMouseEvent(d)}}),t.showTitle){let d=c.createDiv("card-title");d.appendText(e.title),Ve(this.app,this.plugin,d,c,e.path,t)}if(t.showDate&&t.dateProperty){let d=I(s,t.dateProperty);if(d){let u=d,f="";if(u&&"date"in u&&u.date instanceof Date)f=u.date.toLocaleDateString();else if(u&&"data"in u&&u.data){let y=u.data;if(y instanceof Date)f=y.toLocaleDateString();else if(typeof y=="string"||typeof y=="number"){let P=new Date(y);isNaN(P.getTime())?f=String(y):f=P.toLocaleDateString()}}f&&c.createDiv("card-date").appendText(f)}}if(t.showTextPreview||t.showTags&&e.displayTags&&e.displayTags.length>0||t.imageFormat!=="none"&&(e.imageUrl||e.hasImageAvailable)||t.imageFormat==="cover"){let d=c.createDiv("card-content");if(t.imageFormat==="thumbnail"){let u=d.createDiv("card-text-wrapper");if(t.showTextPreview){let f=u.createDiv("card-text-preview");e.snippet&&f.setText(e.snippet),c.__textPreviewEl=f,c.__cardPath=e.path}if(t.showTags&&e.displayTags&&e.displayTags.length>0){let f=u.createDiv("card-tags"),y=t.maxTagsToShow,P=e.displayTags.slice(0,y),b=e.displayTags.length-y;P.forEach(F=>{f.createSpan("card-tag").appendText(F)}),b>0&&f.createSpan("card-tag-more").appendText(`+${b} more`)}}else{if(t.showTextPreview){let u=d.createDiv("card-text-preview");e.snippet&&u.setText(e.snippet),c.__textPreviewEl=u,c.__cardPath=e.path}if(t.showTags&&e.displayTags&&e.displayTags.length>0){let u=d.createDiv("card-tags"),f=t.maxTagsToShow,y=e.displayTags.slice(0,f),P=e.displayTags.length-f;y.forEach(b=>{u.createSpan("card-tag").appendText(b)}),P>0&&u.createSpan("card-tag-more").appendText(`+${P} more`)}}if(t.imageFormat!=="none"&&e.imageUrl){let f=(Array.isArray(e.imageUrl)?e.imageUrl:[e.imageUrl]).filter(b=>b&&typeof b=="string"&&b.trim().length>0),y=t.imageFormat==="cover"?"card-cover":"card-thumbnail",P=d.createDiv(y);if(f.length>0){let b=P.createDiv("image-embed"),F=f[0];(async()=>{let he=await G(F,this.plugin.settings.forceStaticGifImages);b.style.backgroundImage=`url("${he}")`})(),b.style.backgroundImage=`url("${F}")`,b.style.backgroundSize="cover",b.style.backgroundPosition="center center",b.style.backgroundRepeat="no-repeat",t.showDraftStatus&&t.imageFormat==="cover"&&Q(P,s,e.path,t,l),this.propertyRenderer.renderProperties(c,e,s,t,l);return}}else if(t.imageFormat==="cover"){let u=d.createDiv("card-cover-placeholder");Q(u,s,e.path,t,l)}}this.propertyRenderer.renderProperties(c,e,s,t,l)}};var He=require("obsidian");var L=require("obsidian");async function ve(a,i,e,s){await a.fileManager.processFrontMatter(i,t=>{for(let[o,n]of e){if(o==="tags"&&!Object.prototype.hasOwnProperty.call(t,"tags")&&!Array.isArray(n.data)){t[o]=[n.data];continue}if(!t[o]||s){t[o]=n.data;continue}let r=n.type,l=t[o],c=Array.isArray(l)?"list":typeof l=="number"?"number":typeof l=="boolean"?"checkbox":"text";if(ft(r,c)){if(t[o]===n.data||!n.data)continue;let p=bt(t[o],n.data);t[o]=p;continue}else{t[o]=n.data;continue}}})}async function $e(a,i,e){await a.fileManager.processFrontMatter(i,s=>{for(let t of e)s[t]=void 0})}function ft(a,i){let e=["number","date","datetime","checkbox"];return!(e.includes(a)||e.includes(i))}function bt(...a){let e=a.map(t=>Array.isArray(t)?t:[t]).flat();return[...new Set(e)]}var B=class{constructor(i){this.app=i}async setDraft(i,e,s){await this.batchProcessFiles(i,async t=>{if(s)if(s.draftStatusUseFilenamePrefix){let o=t.basename,n=o.startsWith("_"),l=t.path.split("/"),c=e;if(s.draftStatusReverse&&(c=!e),c===!0){if(!n){let p=`_${o}${t.extension?`.${t.extension}`:""}`;l[l.length-1]=p;let h=l.join("/");await this.app.fileManager.renameFile(t,h)}}else if(n){let p=o.substring(1)+(t.extension?`.${t.extension}`:"");l[l.length-1]=p;let h=l.join("/");await this.app.fileManager.renameFile(t,h)}}else{let o=s.draftStatusProperty&&s.draftStatusProperty.trim()?s.draftStatusProperty.startsWith("note.")?s.draftStatusProperty.substring(5):s.draftStatusProperty:"draft",n=e;s.draftStatusReverse&&(n=!e),await this.app.fileManager.processFrontMatter(t,r=>{r[o]=n})}else await this.app.fileManager.processFrontMatter(t,o=>{o.draft=e})}),new L.Notice(`Set ${i.length} file${i.length!==1?"s":""} to ${e?"draft":"published"}`)}async addTags(i,e){let s=new Map;s.set("tags",{type:"tags",data:e,overwrite:!1,delimiter:","}),await this.batchProcessFiles(i,async t=>{await ve(this.app,t,s,!1)}),new L.Notice(`Added tags to ${i.length} file${i.length!==1?"s":""}`)}async removeTags(i,e){await this.batchProcessFiles(i,async s=>{let t=this.app.metadataCache.getFileCache(s),o=t==null?void 0:t.frontmatter;if(o!=null&&o.tags){let r=(Array.isArray(o.tags)?o.tags:[o.tags]).filter(l=>!e.includes(l));await this.app.fileManager.processFrontMatter(s,l=>{r.length>0?l.tags=r:l.tags=void 0})}}),new L.Notice(`Removed tags from ${i.length} file${i.length!==1?"s":""}`)}async setProperty(i,e,s,t="text"){let o=e.startsWith("note.")?e.substring(5):e,n=new Map;n.set(o,{type:t,data:s,overwrite:!0,delimiter:","}),await this.batchProcessFiles(i,async r=>{await ve(this.app,r,n,!0)}),new L.Notice(`Set ${o} on ${i.length} file${i.length!==1?"s":""}`)}async removeProperty(i,e){let s=e.startsWith("note.")?e.substring(5):e;await this.batchProcessFiles(i,async t=>{await $e(this.app,t,[s])}),new L.Notice(`Removed ${s} from ${i.length} file${i.length!==1?"s":""}`)}async batchProcessFiles(i,e){let s=0,t=i.length;for(let o of i){let n=this.app.vault.getAbstractFileByPath(o);if(n instanceof L.TFile)try{await e(n),s++}catch(r){console.error(`Error processing ${o}:`,r)}}s<t&&new L.Notice(`Processed ${s} of ${t} files`)}};var N=require("obsidian");var J=class extends N.Modal{constructor(e,s){super(e);this.tagsToAdd="";this.tagsToRemove=new Set;this.files=s,this.bulkOps=new B(e)}onOpen(){let{contentEl:e}=this;e.empty(),new N.Setting(e).setName("Manage tags").setHeading(),e.createEl("p",{text:`Managing tags for ${this.files.length} file${this.files.length!==1?"s":""}`}),new N.Setting(e).setName("Add tags").setDesc("Enter tags to add (comma-separated).").addText(l=>{l.setPlaceholder("tag1, tag2, tag3").onChange(c=>{this.tagsToAdd=c})}),e.createEl("h3",{text:"Remove tags"});let s=e.createDiv(),t=new Set;for(let l of this.files){let c=this.app.vault.getAbstractFileByPath(l);if(c instanceof N.TFile){let p=this.app.metadataCache.getFileCache(c),h=p==null?void 0:p.frontmatter;h!=null&&h.tags&&(Array.isArray(h.tags)?h.tags:[h.tags]).forEach(S=>t.add(S))}}for(let l of Array.from(t).sort())new N.Setting(s).setName(l).addToggle(c=>{c.setValue(this.tagsToRemove.has(l)).onChange(p=>{p?this.tagsToRemove.add(l):this.tagsToRemove.delete(l)})});let o=e.createDiv();o.addClass("bases-cms-modal-button-container");let n=o.createEl("button");n.setText("Cancel"),n.addEventListener("click",()=>this.close());let r=o.createEl("button");r.setText("Apply"),r.addClass("mod-cta"),r.addEventListener("click",()=>{(async()=>(await this.applyChanges(),this.close()))()})}async applyChanges(){if(this.tagsToAdd.trim()){let e=this.tagsToAdd.split(",").map(s=>s.trim()).filter(s=>s.length>0);e.length>0&&await this.bulkOps.addTags(this.files,e)}this.tagsToRemove.size>0&&await this.bulkOps.removeTags(this.files,Array.from(this.tagsToRemove))}onClose(){let{contentEl:e}=this;e.empty()}};var R=require("obsidian");var Z=class extends R.Modal{constructor(e,s){super(e);this.propertyName="";this.propertyValue="";this.propertyType="text";this.files=s,this.bulkOps=new B(e)}onOpen(){let{contentEl:e}=this;e.empty(),new R.Setting(e).setName("Set property").setHeading(),e.createEl("p",{text:`Setting property on ${this.files.length} file${this.files.length!==1?"s":""}`}),new R.Setting(e).setName("Property name").setDesc("Enter the property name to set.").addText(n=>{n.setPlaceholder("Enter name").onChange(r=>{this.propertyName=r})}),new R.Setting(e).setName("Property type").setDesc("Select the property type.").addDropdown(n=>{n.addOption("text","Text").addOption("number","Number").addOption("checkbox","Checkbox").addOption("date","Date").setValue(this.propertyType).onChange(r=>{this.propertyType=r})}),new R.Setting(e).setName("Property value").setDesc("Enter the property value.").addText(n=>{n.setPlaceholder("Enter value").onChange(r=>{this.propertyValue=r})});let s=e.createDiv();s.addClass("bases-cms-modal-button-container");let t=s.createEl("button");t.setText("Cancel"),t.addEventListener("click",()=>this.close());let o=s.createEl("button");o.setText("Apply"),o.addClass("mod-cta"),o.addEventListener("click",()=>{(async()=>this.propertyName&&this.propertyValue&&(await this.applyChanges(),this.close()))()})}async applyChanges(){let e=this.propertyValue;this.propertyType==="number"?e=Number(this.propertyValue):this.propertyType==="checkbox"?e=this.propertyValue.toLowerCase()==="true"||this.propertyValue==="1":this.propertyType==="date"&&(e=this.propertyValue),await this.bulkOps.setProperty(this.files,this.propertyName,e,this.propertyType)}onClose(){let{contentEl:e}=this;e.empty()}};var $=require("obsidian");var ee=class extends $.Modal{constructor(e,s){super(e);this.propertiesToRemove=new Set;this.files=s,this.bulkOps=new B(e)}onOpen(){let{contentEl:e}=this;e.empty(),new $.Setting(e).setName("Remove property").setHeading(),e.createEl("p",{text:`Removing properties from ${this.files.length} file${this.files.length!==1?"s":""}`});let s=new Set;for(let l of this.files){let c=this.app.vault.getAbstractFileByPath(l);if(c instanceof $.TFile){let p=this.app.metadataCache.getFileCache(c),h=p==null?void 0:p.frontmatter;if(h)for(let m in h)m!=="tags"&&m!=="title"&&s.add(m)}}let t=e.createDiv();for(let l of Array.from(s).sort())new $.Setting(t).setName(l).addToggle(c=>{c.setValue(this.propertiesToRemove.has(l)).onChange(p=>{p?this.propertiesToRemove.add(l):this.propertiesToRemove.delete(l)})});s.size===0&&e.createEl("p",{text:"No properties found in selected files."});let o=e.createDiv();o.addClass("bases-cms-modal-button-container");let n=o.createEl("button");n.setText("Cancel"),n.addEventListener("click",()=>this.close());let r=o.createEl("button");r.setText("Apply"),r.addClass("mod-cta"),r.addEventListener("click",()=>{(async()=>this.propertiesToRemove.size>0&&(await this.applyChanges(),this.close()))()})}async applyChanges(){for(let e of this.propertiesToRemove)await this.bulkOps.removeProperty(this.files,e)}onClose(){let{contentEl:e}=this;e.empty()}};var ie=require("obsidian");var V=require("obsidian");var O=require("obsidian");function qe(a,i){var t;let e=[],s=a.vault.getAbstractFileByPath(i.path);if(s instanceof O.TFile){let o=a.metadataCache.getFileCache(s),n=(o==null?void 0:o.embeds)||[];for(let l of n){let c=a.metadataCache.getFirstLinkpathDest(l.link,i.path);c instanceof O.TFile&&e.push(c)}let r=o==null?void 0:o.frontmatter;if(r){let l=["image","imageOG","cover","thumbnail"],c=["avif","bmp","gif","jpeg","jpg","png","svg","webp"];for(let p of l){let h=r[p];if(!h)continue;let m=Array.isArray(h)?h:[h];for(let S of m){if(typeof S!="string")continue;let w=S.replace(/^!?\[\[([^\]]+)\]\]$/,"$1").trim();if(!w||w.startsWith("http://")||w.startsWith("https://"))continue;let T=a.metadataCache.getFirstLinkpathDest(w,i.path);if(!T&&w.startsWith("./")){let k=w.substring(2),C=(t=i.parent)!=null&&t.path?`${i.parent.path}/${k}`:k,E=a.vault.getAbstractFileByPath(C);E instanceof O.TFile&&(T=E)}if(!T){let k=a.vault.getAbstractFileByPath(w);k instanceof O.TFile&&(T=k)}T&&c.includes(T.extension)&&e.push(T)}}}}return e}function Ue(a,i){let e=[];for(let s of i.children)s instanceof O.TFile&&s.extension==="md"?e.push(...qe(a,s)):s instanceof O.TFolder&&e.push(...Ue(a,s));return e}async function yt(a,i,e,s){let t=a.vault.getMarkdownFiles().filter(l=>l.path!==e.path),o=i.path,n=i.name,r=i.basename;for(let l of t){if(s&&l.path.startsWith(s.path+"/"))continue;let c=await a.vault.read(l);if(c.includes(o)||c.includes(n)||c.includes(r)||c.includes(`![[${n}]]`)||c.includes(`[[${n}]]`)||c.includes(`(${n})`)||c.includes(`(${o})`))return!0}return!1}async function _e(a,i,e){let s=[];s.push(...qe(a,i)),e&&s.push(...Ue(a,e));let t=Array.from(new Set(s.map(n=>n.path))).map(n=>a.vault.getAbstractFileByPath(n)).filter(n=>n instanceof O.TFile),o=[];for(let n of t)await yt(a,n,i,e)||o.push(n);return o}function vt(a,i){let e=i.deleteParentFolderFilename||"index";return a.basename===e&&a.parent!==null}function ze(a,i){return i.deleteParentFolder&&vt(a,i)}async function we(a,i,e){let s=[],t=[],o=[];for(let l of i){let c=a.vault.getAbstractFileByPath(l);if(c instanceof V.TFile){if(ze(c,e)){let p=c.parent;if(p&&!t.includes(p)){t.push(p);let h=p.children.filter(m=>m instanceof V.TFile);s.push(...h)}}else s.push(c);if(e.deleteUniqueAttachments){let p=ze(c,e)&&c.parent||void 0,h=await _e(a,c,p);o.push(...h)}}}let n=Array.from(new Set(s.map(l=>l.path))).map(l=>a.vault.getAbstractFileByPath(l)).filter(l=>l instanceof V.TFile),r=Array.from(new Set(o.map(l=>l.path))).map(l=>a.vault.getAbstractFileByPath(l)).filter(l=>l instanceof V.TFile);return{filesToDelete:n,foldersToDelete:Array.from(new Set(t)),attachmentsToDelete:r}}async function te(a,i){let e=0,s=0;for(let t of i.filesToDelete)try{await a.fileManager.trashFile(t),e++}catch(o){console.error(`Error deleting file ${t.path}:`,o),s++}for(let t of i.attachmentsToDelete)try{await a.fileManager.trashFile(t),e++}catch(o){console.error(`Error deleting attachment ${t.path}:`,o),s++}for(let t of i.foldersToDelete)try{await a.fileManager.trashFile(t),e++}catch(o){console.error(`Error deleting folder ${t.path}:`,o),s++}s>0?new V.Notice(`Deleted ${e} items, ${s} errors occurred`):new V.Notice(`Successfully deleted ${e} item${e!==1?"s":""}`)}var se=class extends ie.Modal{constructor(e,s,t){super(e);this.preview=s,this.onConfirm=t}onOpen(){let{contentEl:e}=this;if(e.empty(),new ie.Setting(e).setName("Confirm deletion").setHeading(),e.createEl("p",{text:"The following items will be deleted:",cls:"bases-cms-deletion-warning"}),this.preview.filesToDelete.length>0){e.createEl("h3",{text:`Files (${this.preview.filesToDelete.length})`});let n=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let r of this.preview.filesToDelete.slice(0,20))n.createEl("li").setText(r.path);this.preview.filesToDelete.length>20&&n.createEl("li",{text:`... and ${this.preview.filesToDelete.length-20} more files`})}if(this.preview.foldersToDelete.length>0){e.createEl("h3",{text:`Folders (${this.preview.foldersToDelete.length})`});let n=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let r of this.preview.foldersToDelete)n.createEl("li").setText(r.path)}if(this.preview.attachmentsToDelete.length>0){e.createEl("h3",{text:`Attachments (${this.preview.attachmentsToDelete.length})`});let n=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let r of this.preview.attachmentsToDelete.slice(0,20))n.createEl("li").setText(r.path);this.preview.attachmentsToDelete.length>20&&n.createEl("li",{text:`... and ${this.preview.attachmentsToDelete.length-20} more attachments`})}e.createEl("p",{text:"This action cannot be undone.",cls:"bases-cms-deletion-warning"});let s=e.createDiv();s.addClass("bases-cms-modal-button-container");let t=s.createEl("button");t.setText("Cancel"),t.addEventListener("click",()=>this.close());let o=s.createEl("button");o.setText("Delete"),o.addClass("mod-cta"),o.addClass("destructive"),o.addEventListener("click",()=>{(async()=>(await te(this.app,this.preview),this.onConfirm(),this.close()))()})}onClose(){let{contentEl:e}=this;e.empty()}};var ne=require("obsidian"),z=class extends ne.Modal{constructor(e,s,t,o){super(e);this.files=s,this.operation=t,this.onConfirm=o}onOpen(){let{contentEl:e}=this;e.empty();let s=this.operation==="draft"?"mark as draft":"mark as published",t=s.charAt(0).toUpperCase()+s.slice(1);if(new ne.Setting(e).setName(`Confirm ${t}`).setHeading(),e.createEl("p",{text:`Are you sure you want to ${s} ${this.files.length} file${this.files.length!==1?"s":""}?`}),this.files.length>0){let l=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let c of this.files.slice(0,20))l.createEl("li").setText(c);this.files.length>20&&l.createEl("li",{text:`... and ${this.files.length-20} more file${this.files.length-20!==1?"s":""}`})}let o=e.createDiv();o.addClass("bases-cms-modal-button-container");let n=o.createEl("button");n.setText("Cancel"),n.addEventListener("click",()=>this.close());let r=o.createEl("button");r.setText("Confirm"),r.addClass("mod-cta"),r.addEventListener("click",()=>{this.onConfirm(),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};var ae=class{constructor(i,e,s,t,o,n){this.app=i;this.plugin=e;this.getSelectedFiles=s;this.clearSelection=t;this.refreshView=o;this.showToolbar=n;this.bulkOps=new B(i)}async handleSetDraft(i){let e=this.getSelectedFiles();e.length!==0&&(this.plugin.settings.confirmBulkOperations?new z(this.app,e,"draft",()=>{(async()=>(await this.bulkOps.setDraft(e,!0,i),this.refreshView()))()}).open():(await this.bulkOps.setDraft(e,!0,i),this.refreshView()))}async handlePublish(i){let e=this.getSelectedFiles();e.length!==0&&(this.plugin.settings.confirmBulkOperations?new z(this.app,e,"publish",()=>{(async()=>(await this.bulkOps.setDraft(e,!1,i),this.refreshView()))()}).open():(await this.bulkOps.setDraft(e,!1,i),this.refreshView()))}handleManageTags(){let i=this.getSelectedFiles();if(i.length===0)return;let e=new J(this.app,i);e.onClose=()=>{this.showToolbar(),this.refreshView()},e.open()}handleSetProperty(){let i=this.getSelectedFiles();if(i.length===0)return;let e=new Z(this.app,i);e.onClose=()=>{this.showToolbar(),this.refreshView()},e.open()}handleRemoveProperty(){let i=this.getSelectedFiles();if(i.length===0)return;let e=new ee(this.app,i);e.onClose=()=>{this.showToolbar(),this.refreshView()},e.open()}async handleDelete(){let i=this.getSelectedFiles();if(i.length!==0)if(this.plugin.settings.confirmDeletions){let e=await we(this.app,i,this.plugin.settings);new se(this.app,e,()=>{this.clearSelection(),this.refreshView()}).open()}else{let e=await we(this.app,i,this.plugin.settings);await te(this.app,e),this.clearSelection(),this.refreshView()}}};var oe=class{constructor(i,e,s,t,o,n,r,l){this.app=i;this.plugin=e;this.container=s;this.getSelectedFiles=t;this.clearSelection=o;this.refreshView=n;this.toolbarEl=null;this.countEl=null;this.resizeObserver=null;this.timeoutIds=[];this.selectAllCallback=r,this.settings=l,this.actions=new ae(this.app,this.plugin,this.getSelectedFiles,this.clearSelection,this.refreshView,()=>this.show()),this.createToolbar()}updateSettings(i){this.settings=i}createToolbar(){this.toolbarEl=document.createElement("div"),this.toolbarEl.className="bases-toolbar bases-cms-bulk-toolbar bases-cms-bulk-toolbar-hidden",this.toolbarEl.__bulkToolbarInstance=this,this.createToolbarContent(),this.positionToolbar();let i=window.setTimeout(()=>this.positionToolbar(),100);this.timeoutIds.push(i)}positionToolbar(){if(!this.toolbarEl)return;let i=this.container.closest(".bases-header");if(!i){let s=this.container.parentElement;for(;s&&!i;){if(s.classList.contains("bases-header")){i=s;break}s=s.parentElement}}if(!i){let s=Array.from(document.querySelectorAll(".bases-header"));for(let t of s)if(t.contains(this.container)){i=t;break}}let e=this.container.closest(".view-content");if(e)this.toolbarEl.parentElement!==e?(this.toolbarEl.parentElement&&this.toolbarEl.remove(),e.insertBefore(this.toolbarEl,this.container)):this.toolbarEl.nextSibling!==this.container&&(this.toolbarEl.parentElement&&this.toolbarEl.remove(),e.insertBefore(this.toolbarEl,this.container));else if(i&&i.parentElement)this.toolbarEl.parentElement!==i.parentElement&&(this.toolbarEl.parentElement&&this.toolbarEl.remove(),i.parentElement.insertBefore(this.toolbarEl,i.nextSibling));else{let s=this.container.parentElement;s&&(this.toolbarEl.parentElement!==s||this.toolbarEl.nextSibling!==this.container)&&(this.toolbarEl.parentElement&&this.toolbarEl.remove(),s.insertBefore(this.toolbarEl,this.container))}}createToolbarContent(){if(!this.toolbarEl)return;let i=this.toolbarEl.createDiv("bases-cms-bulk-toolbar-left"),e=(o,n,r,l,c=!1)=>{let h=l.createDiv("bases-toolbar-item").createDiv("text-icon-button");c&&h.addClass("destructive"),h.setAttribute("tabindex","0");let m=h.createSpan("text-button-icon");return(0,He.setIcon)(m,o),h.createSpan("text-button-label").setText(n),h.addEventListener("click",r),h};this.plugin.settings.showToolbarSelectAll&&e("copy-check","Select all",()=>this.handleSelectAll(),i),this.plugin.settings.showToolbarClear&&e("square-x","Clear",()=>this.clearSelection(),i);let s=i.createDiv("bases-toolbar-item bases-cms-selected-count");this.countEl=s.createSpan("text-button-label"),this.countEl.setText("0 items selected");let t=this.toolbarEl.createDiv("bases-cms-bulk-toolbar-right");this.plugin.settings.showToolbarPublish&&e("book-check","Publish",()=>{this.actions.handlePublish(this.settings)},t),this.plugin.settings.showToolbarDraft&&e("book-dashed","Draft",()=>{this.actions.handleSetDraft(this.settings)},t),this.plugin.settings.showToolbarTags&&e("tags","Tags",()=>this.actions.handleManageTags(),t),this.plugin.settings.showToolbarSet&&e("list-check","Set",()=>this.actions.handleSetProperty(),t),this.plugin.settings.showToolbarRemove&&e("list-x","Remove",()=>this.actions.handleRemoveProperty(),t),this.plugin.settings.showToolbarDelete&&e("trash-2","Delete",()=>{this.actions.handleDelete()},t,!0),this.setupResponsiveBehavior()}setupResponsiveBehavior(){if(!this.toolbarEl)return;let i=window.setTimeout(()=>{this.updateCollapsedState()},100);this.timeoutIds.push(i),this.toolbarEl&&(this.resizeObserver=new ResizeObserver(()=>{this.updateCollapsedState()}),this.resizeObserver.observe(this.toolbarEl));let e=this.container;if(e){let s=new ResizeObserver(()=>{let t=window.setTimeout(()=>{this.updateCollapsedState()},10);this.timeoutIds.push(t)});s.observe(e),this.containerObserver=s}}updateCollapsedState(){if(!this.toolbarEl)return;this.toolbarEl.offsetWidth<680?this.toolbarEl.addClass("collapsed"):this.toolbarEl.removeClass("collapsed")}updateCount(i){this.countEl&&this.countEl.setText(`${i} item${i!==1?"s":""} selected`)}handleSelectAll(){this.selectAllCallback&&this.selectAllCallback()}show(){if(this.toolbarEl||(console.warn("[Bases CMS] Toolbar element not found, recreating..."),this.createToolbar()),this.toolbarEl){this.positionToolbar(),this.toolbarEl.parentElement||(console.warn("[Bases CMS] Toolbar not in DOM, repositioning..."),this.positionToolbar()),this.toolbarEl.removeClass("bases-cms-bulk-toolbar-hidden"),this.toolbarEl.addClass("bases-cms-bulk-toolbar-visible"),this.toolbarEl.offsetHeight;let i=window.setTimeout(()=>{this.toolbarEl&&(this.toolbarEl.removeClass("bases-cms-bulk-toolbar-animating-out"),this.toolbarEl.addClass("bases-cms-bulk-toolbar-animating-in"))},10);this.timeoutIds.push(i)}else console.error("[Bases CMS] Failed to show toolbar - element is null")}hide(){if(this.toolbarEl){this.toolbarEl.removeClass("bases-cms-bulk-toolbar-animating-in"),this.toolbarEl.addClass("bases-cms-bulk-toolbar-animating-out");let i=window.setTimeout(()=>{this.toolbarEl&&(this.toolbarEl.removeClass("bases-cms-bulk-toolbar-visible"),this.toolbarEl.addClass("bases-cms-bulk-toolbar-hidden"))},200);this.timeoutIds.push(i)}}recreate(){let i=this.toolbarEl&&!this.toolbarEl.hasClass("bases-cms-bulk-toolbar-hidden"),e=0;if(this.countEl&&this.countEl.textContent){let s=this.countEl.textContent.match(/\d+/);s&&(e=parseInt(s[0],10))}this.destroy(),this.createToolbar(),i&&this.toolbarEl&&e>0&&(this.updateCount(e),this.show())}destroy(){this.timeoutIds.forEach(e=>window.clearTimeout(e)),this.timeoutIds=[],this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null);let i=this.containerObserver;i&&(i.disconnect(),this.containerObserver=void 0),this.toolbarEl&&(this.toolbarEl.remove(),this.toolbarEl=null)}};U();function We(a,i,e,s,t){let o=l=>{var k;let c=l.target,p=c.closest(".bases-toolbar-new-item-menu .text-icon-button, .bases-toolbar-new-item-menu");if(!p||c.closest(".bases-cms-bulk-toolbar, .bases-cms-container .card"))return;let h=a.workspace.activeLeaf,m=h==null?void 0:h.view,S=m?m.containerEl:null;if(!(m&&S&&(S===i||((k=p.closest(".workspace-leaf"))==null?void 0:k.contains(S)))))return;let T=D(e,s);T.customizeNewButton&&(l.preventDefault(),l.stopPropagation(),l.stopImmediatePropagation(),(async()=>{var g;let C=((g=T.newNoteLocation)==null?void 0:g.trim())||"";if(C===""){let d=a.vault.config,u=(d==null?void 0:d.newFileLocation)||"folder",f=(d==null?void 0:d.newFileFolderPath)||"";console.debug("[CMS View] Obsidian config:",{newFileLocation:u,newFileFolderPath:f});let y="Untitled.md";if(u==="folder"&&f)y=`${f}/Untitled.md`;else if(u==="current"){let b=a.workspace.getActiveFile();b&&b.parent&&(y=`${b.parent.path}/Untitled.md`)}else u==="root"&&(y="Untitled.md");console.debug("[CMS View] Creating file at:",y);let P=await a.vault.create(y,"");await a.workspace.openLinkText(P.path,"",!1);return}if(C==="/"||C.replace(/\//g,"")===""){let d=await a.vault.create("Untitled.md","");await a.workspace.openLinkText(d.path,"",!1);return}let E=C.replace(/^\/+|\/+$/g,""),v=a.vault.getAbstractFileByPath(E);if((!v||!("children"in v))&&(await a.vault.createFolder(E),v=a.vault.getAbstractFileByPath(E)),v&&"children"in v){let d=await a.vault.create(`${E}/Untitled.md`,"");await a.workspace.openLinkText(d.path,"",!1)}})())};document.addEventListener("click",o,!0);let n=new MutationObserver(()=>{document.querySelectorAll(".bases-toolbar-new-item-menu .text-icon-button, .bases-toolbar-new-item-menu").forEach(c=>{let p=c;p.__cmsIntercepted||(p.__cmsIntercepted=!0,c.addEventListener("click",o,!0))})});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelectorAll(".bases-toolbar-new-item-menu .text-icon-button, .bases-toolbar-new-item-menu").forEach(l=>{let c=l;c.__cmsIntercepted||(c.__cmsIntercepted=!0,l.addEventListener("click",o,!0))}),t(()=>{document.removeEventListener("click",o,!0),n.disconnect()})}var je=require("obsidian");U();var re=class{constructor(i,e,s,t){this.app=i;this.config=e;this.pluginSettings=s;this.onRefresh=t}async handlePropertyToggle(i,e,s){try{let t=this.app.vault.getAbstractFileByPath(i);if(!(t instanceof je.TFile))return;let o=e.startsWith("note.")?e.substring(5):e,n=D(this.config,this.pluginSettings),r=n.showDraftStatus&&o==="draft",l=!1;if(r)if(n.draftStatusUseFilenamePrefix){let c=t.basename,p=c.startsWith("_"),m=t.path.split("/");if(s===!0){if(!p){let S=`_${c}${t.extension?`.${t.extension}`:""}`;m[m.length-1]=S;let w=m.join("/");await this.app.fileManager.renameFile(t,w),l=!0}}else if(p){let S=c.substring(1)+(t.extension?`.${t.extension}`:"");m[m.length-1]=S;let w=m.join("/");await this.app.fileManager.renameFile(t,w),l=!0}}else{let c=n.draftStatusProperty&&n.draftStatusProperty.trim()?n.draftStatusProperty.startsWith("note.")?n.draftStatusProperty.substring(5):n.draftStatusProperty:"draft";await this.app.fileManager.processFrontMatter(t,p=>{p[c]=s}),l=!0}else await this.app.fileManager.processFrontMatter(t,c=>{c[o]=s}),l=!0;l&&requestAnimationFrame(()=>{window.setTimeout(()=>{try{this.onRefresh()}catch(c){console.error("Error refreshing view after property toggle:",c)}},100)})}catch(t){console.error("Error toggling property:",t)}}};U();var le=class{constructor(i,e,s,t,o,n){this.containerEl=i;this.app=e;this.config=s;this.pluginSettings=t;this.onLoadMore=o;this.registerCleanup=n;this.scrollListener=null;this.scrollThrottleTimeout=null;this.resizeObserver=null;this.windowResizeHandler=null;this.isLoading=!1;this.displayedCount=50;this.totalEntries=0;var l;let r=(l=this.app.isMobile)!=null?l:!1;this.displayedCount=r?25:50}setDisplayedCount(i){this.displayedCount=i}getDisplayedCount(){return this.displayedCount}setIsLoading(i){this.isLoading=i}setupInfiniteScroll(i){this.totalEntries=i,this.scrollListener&&(this.containerEl.removeEventListener("scroll",this.scrollListener),this.scrollListener=null),!(this.displayedCount>=i)&&(this.scrollListener=()=>{var c;if(this.scrollThrottleTimeout!==null||this.isLoading)return;let e=this.containerEl.scrollTop,s=this.containerEl.scrollHeight,t=this.containerEl.clientHeight,o=s-(e+t),r=((c=this.app.isMobile)!=null?c:!1)?1:2,l=t*r;if(o<l&&this.displayedCount<i){this.isLoading=!0;let p=50;this.displayedCount=Math.min(this.displayedCount+p,i),this.onLoadMore()}this.scrollThrottleTimeout=window.setTimeout(()=>{this.scrollThrottleTimeout=null},100)},this.containerEl.addEventListener("scroll",this.scrollListener),this.registerCleanup(()=>{this.scrollListener&&this.containerEl.removeEventListener("scroll",this.scrollListener),this.scrollThrottleTimeout!==null&&window.clearTimeout(this.scrollThrottleTimeout)}))}setupResizeObserver(){if(this.resizeObserver)return;let i=()=>{if(!this.config||typeof this.config.get!="function")return;let e=D(this.config,this.pluginSettings),s=e.cardSize;this.containerEl.style.setProperty("--card-min-width",`${s}px`),this.containerEl.style.setProperty("--dynamic-views-image-aspect-ratio",String(e.imageAspectRatio))};this.resizeObserver=new ResizeObserver(i),this.resizeObserver.observe(this.containerEl),i()}updateGridLayout(i){this.containerEl.style.setProperty("--card-min-width",`${i.cardSize}px`),this.containerEl.style.setProperty("--dynamic-views-image-aspect-ratio",String(i.imageAspectRatio))}cleanup(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.windowResizeHandler&&(window.removeEventListener("resize",this.windowResizeHandler),this.windowResizeHandler=null),this.scrollListener&&(this.containerEl.removeEventListener("scroll",this.scrollListener),this.scrollListener=null),this.scrollThrottleTimeout!==null&&(window.clearTimeout(this.scrollThrottleTimeout),this.scrollThrottleTimeout=null)}};var ce=class{constructor(i,e,s,t,o,n,r,l){this.containerEl=i;this.plugin=e;this.config=s;this.controller=t;this.data=o;this.selectedFiles=n;this.onSelectionCleared=r;this.registerCleanup=l;this.mutationObserver=null;this.backupInterval=null;this.currentBaseIdentifier=null}setup(i){let e=()=>{this.mutationObserver||(this.mutationObserver=new MutationObserver(l=>{if(this.selectedFiles.size!==0){for(let c of l)if(c.type==="childList"&&c.removedNodes.length>0){let p=!1;for(let m of this.selectedFiles)if(this.containerEl.querySelector(`[data-path="${m}"]`)){p=!0;break}let h=this.containerEl.querySelectorAll(".card[data-path]");if(!p||h.length===0){this.selectedFiles.clear(),this.onSelectionCleared();break}}}}),this.containerEl&&this.mutationObserver.observe(this.containerEl,{childList:!0,subtree:!0}))},s=()=>{this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null,this.selectedFiles.size>0&&this.selectedFiles.clear(),this.onSelectionCleared())},t=()=>{var l,c,p,h;try{if((l=this.config)!=null&&l.getName)return this.config.getName();if((c=this.config)!=null&&c.name)return String(this.config.name);if(this.controller){if((p=this.controller)!=null&&p.getBaseName)return this.controller.getBaseName();if((h=this.controller)!=null&&h.baseName)return String(this.controller.baseName)}if(this.data&&this.data.baseName)return String(this.data.baseName)}catch(m){}return null},o=()=>{if(this.selectedFiles.size===0){this.backupInterval!==null&&(window.clearInterval(this.backupInterval),this.backupInterval=null);return}let l=t();if(this.currentBaseIdentifier!==null&&l!==null&&this.currentBaseIdentifier!==l){this.selectedFiles.clear(),this.onSelectionCleared(),s(),this.backupInterval!==null&&(window.clearInterval(this.backupInterval),this.backupInterval=null);return}this.containerEl.querySelectorAll(".card[data-path]").length===0&&(this.selectedFiles.clear(),this.onSelectionCleared())},n=i.bind(this),r=(l,c)=>{n(l,c),this.selectedFiles.size>0?(this.currentBaseIdentifier===null&&(this.currentBaseIdentifier=t()),e(),this.backupInterval===null&&(this.backupInterval=this.plugin.registerInterval(window.setInterval(o,500)))):(this.currentBaseIdentifier=null,s(),this.backupInterval!==null&&(window.clearInterval(this.backupInterval),this.backupInterval=null))};return this.registerCleanup(()=>{s(),this.backupInterval!==null&&(window.clearInterval(this.backupInterval),this.backupInterval=null)}),r}cleanup(){this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null),this.backupInterval!==null&&(window.clearInterval(this.backupInterval),this.backupInterval=null)}};var Se="bases-cms",pe=class extends _.BasesView{constructor(e,s,t){super(e);this.type=Se;this.selectedFiles=new Set;this.snippets={};this.images={};this.hasImageAvailable={};this.updateLayoutRef={current:null};this.propertyObservers=[];this.bulkToolbar=null;this.isRefreshingWithSelection=!1;this.containerEl=s,this.plugin=t,this.cardRenderer=new X(this.app,this.plugin,this.propertyObservers,this.updateLayoutRef,void 0,e),this.containerEl.addClass("bases-cms"),this.containerEl.addClass("bases-cms-container"),this.propertyToggleHandler=new re(this.app,this.config,this.plugin.settings,()=>this.onDataUpdated()),this.scrollLayoutManager=new le(this.containerEl,this.app,this.config,this.plugin.settings,()=>this.onDataUpdated(),n=>this.register(n)),this.viewSwitchListener=new ce(this.containerEl,this.plugin,this.config,this.controller,this.data,this.selectedFiles,()=>this.updateSelectionUI(),n=>this.register(n)),We(this.app,this.containerEl,this.config,this.plugin.settings,n=>this.register(n));let o=this.handleSelectionChange.bind(this);this.handleSelectionChange=this.viewSwitchListener.setup(o)}onDataUpdated(){let e=this.app.workspace.activeLeaf,s=e==null?void 0:e.view;if(s&&this.selectedFiles.size>0&&s!==this){if(!(this.containerEl&&this.containerEl.isConnected&&this.containerEl.offsetParent!==null)){this.selectedFiles.clear(),this.updateSelectionUI();return}let n=s.containerEl;if(!n||!n.contains(this.containerEl)){this.selectedFiles.clear(),this.updateSelectionUI();return}}if(!(this.containerEl&&this.containerEl.isConnected&&this.containerEl.offsetParent!==null)&&this.selectedFiles.size>0){this.selectedFiles.clear(),this.updateSelectionUI();return}(async()=>{var C;let o=this.data.groupedData,n=this.data.data,r=D(this.config,this.plugin.settings);r.fallbackToEmbeds||(this.images={},this.hasImageAvailable={}),this.cardRenderer.basesConfig=this.config,this.scrollLayoutManager.updateGridLayout(r);let l=this.containerEl.scrollTop,c=this.getSortMethod(),p=o.map(E=>({group:E,entries:[...E.entries]})),h=[],m=this.scrollLayoutManager.getDisplayedCount();for(let E of p){if(m<=0)break;let v=Math.min(E.entries.length,m);h.push(...E.entries.slice(0,v)),m-=v}let S=[];if(r.imageFormat!=="none"){let E=h.filter(g=>!(g.file.path in this.images)).map(g=>{let d=this.app.vault.getAbstractFileByPath(g.file.path);if(!(d instanceof _.TFile))return null;let u=ge(g,r.imageProperty);return{path:g.file.path,file:d,imagePropertyValues:u}}).filter(g=>g!==null),v=n.filter(g=>!(g.file.path in this.images)&&!h.some(d=>d.file.path===g.file.path)).map(g=>{let d=this.app.vault.getAbstractFileByPath(g.file.path);if(!(d instanceof _.TFile))return null;let u=ge(g,r.imageProperty);return{path:g.file.path,file:d,imagePropertyValues:u}}).filter(g=>g!==null);if(E.length>0&&S.push(ye(E,r.fallbackToEmbeds,this.app,this.images,this.hasImageAvailable).then(()=>{requestAnimationFrame(()=>{E.forEach(g=>{g.path in this.images&&this.updateCardImage(g.path,this.images[g.path])})})})),v.length>0&&S.push(ye(v,r.fallbackToEmbeds,this.app,this.images,this.hasImageAvailable)),r.fallbackToEmbeds){let d=[...E,...v].filter(u=>{let f=u.imagePropertyValues&&Array.isArray(u.imagePropertyValues)&&u.imagePropertyValues.length>0;return!(u.path in this.images)&&!this.hasImageAvailable[u.path]&&!f});d.length>0&&S.push(Oe(d,this.app,this.images,this.hasImageAvailable).then(()=>{requestAnimationFrame(()=>{d.forEach(u=>{u.path in this.images&&this.updateCardImage(u.path,this.images[u.path])})})}))}}if(r.showTextPreview){let E=h.filter(v=>!(v.file.path in this.snippets)).map(v=>{let g=this.app.vault.getAbstractFileByPath(v.file.path);if(!(g instanceof _.TFile))return null;let d=I(v,r.descriptionProperty);return{path:v.file.path,file:g,descriptionData:d==null?void 0:d.data}}).filter(v=>v!==null);Ne(E,r.fallbackToContent,!1,this.app,this.snippets).then(()=>{requestAnimationFrame(()=>{E.forEach(v=>{if(v.path in this.snippets&&this.snippets[v.path]){let g=this.containerEl.querySelector(`[data-path="${v.path}"]`);if(g){let d=g.__textPreviewEl;d&&(!d.textContent||d.textContent.trim().length===0)&&d.setText(this.snippets[v.path])}}})})})}let w=null;if(this.isRefreshingWithSelection&&this.bulkToolbar){let E=this.containerEl.querySelector(".bases-cms-bulk-toolbar");E instanceof HTMLElement&&(w=E,w.remove())}this.containerEl.empty(),this.propertyObservers.forEach(E=>E.disconnect()),this.propertyObservers=[];let T=this.containerEl.createDiv("bases-cms-grid"),k=0;for(let E of p){if(k>=this.scrollLayoutManager.getDisplayedCount())break;let v=Math.min(E.entries.length,this.scrollLayoutManager.getDisplayedCount()-k);if(v===0)continue;let g=E.entries.slice(0,v),d=T.createDiv("bases-cms-group");if(E.group.hasKey()){let y=d.createDiv("bases-cms-group-heading").createDiv("bases-cms-group-value"),P=((C=E.group.key)==null?void 0:C.toString())||"";y.setText(P)}let u=De(g,r,c,!1,this.snippets,this.images,this.hasImageAvailable);for(let f=0;f<u.length;f++){let y=u[f],P=g[f];this.renderCard(d,y,P,k+f,r)}k+=v}l>0&&(this.containerEl.scrollTop=l),this.scrollLayoutManager.setupInfiniteScroll(n.length),this.scrollLayoutManager.setupResizeObserver(),w&&this.bulkToolbar&&(this.containerEl.appendChild(w),this.bulkToolbar.toolbarEl=w),this.isRefreshingWithSelection?(this.containerEl.querySelectorAll(".card").forEach(v=>{let g=v.getAttribute("data-path"),d=v.querySelector('input[type="checkbox"].selection-checkbox');if(g){let u=this.selectedFiles.has(g);u?v.addClass("selected"):v.removeClass("selected"),d&&(d.checked=u)}}),w&&this.bulkToolbar&&(this.bulkToolbar.show(),this.bulkToolbar.updateCount(this.selectedFiles.size))):this.updateSelectionUI(),this.scrollLayoutManager.setIsLoading(!1)})()}renderCard(e,s,t,o,n){let r=this.selectedFiles.has(s.path);return this.cardRenderer.renderCard(e,s,t,n,this,r,(l,c)=>{this.handleSelectionChange(l,c)},(l,c,p)=>{this.handlePropertyToggle(l,c,p)})}updateCardImage(e,s){var r;let t=this.containerEl.querySelector(`.card[data-path="${e}"]`);if(!t)return;let o=Array.isArray(s)?s[0]:s;if(!o)return;let n=t.querySelector(".image-embed");if(!n){let l=t.querySelector(".card-cover-placeholder, .card-thumbnail-placeholder");if(l){let c=l.querySelector(".card-status-badge"),p=l.classList.contains("card-cover-placeholder")?"card-cover":"card-thumbnail",h=(r=l.parentElement)==null?void 0:r.createDiv(p);h&&(n=h.createDiv("image-embed"),c&&h.appendChild(c),l.remove())}}n&&((async()=>{let l=await G(o,this.plugin.settings.forceStaticGifImages);n.style.backgroundImage=`url("${l}")`})(),n.style.backgroundImage=`url("${o}")`,n.style.backgroundSize="cover",n.style.backgroundPosition="center center",n.style.backgroundRepeat="no-repeat")}getSortMethod(){let e=this.config.getSort();if(e&&e.length>0){let s=e[0],t=s.property,o=s.direction.toLowerCase();if(t.includes("ctime"))return`ctime-${o}`;if(t.includes("mtime"))return`mtime-${o}`}return"mtime-desc"}handleSelectionChange(e,s){if(s?this.selectedFiles.add(e):this.selectedFiles.delete(e),this.updateSelectionUI(),this.selectedFiles.size===0&&this.bulkToolbar){this.bulkToolbar.hide();let t=this.containerEl.querySelector(".bases-cms-bulk-toolbar");t instanceof HTMLElement&&(t.removeClass("bases-cms-bulk-toolbar-visible"),t.addClass("bases-cms-bulk-toolbar-hidden"))}}async handlePropertyToggle(e,s,t){await this.propertyToggleHandler.handlePropertyToggle(e,s,t)}selectAll(){this.containerEl.querySelectorAll(".bases-cms-card").forEach(s=>{let t=s.getAttribute("data-path");t&&this.selectedFiles.add(t)}),this.updateSelectionUI()}deselectAll(){this.selectedFiles.clear(),this.updateSelectionUI()}refreshToolbar(){if(this.bulkToolbar){let e=this.selectedFiles.size;this.bulkToolbar.recreate(),e>0&&this.bulkToolbar.updateCount(e)}}updateSelectionUI(){if(this.containerEl.querySelectorAll(".card").forEach(s=>{let t=s.getAttribute("data-path"),o=s.querySelector('input[type="checkbox"].selection-checkbox');if(t){let n=this.selectedFiles.has(t);n?s.addClass("selected"):s.removeClass("selected"),o&&(o.checked=n)}}),this.selectedFiles.size>0){if(document.querySelectorAll(".bases-cms-bulk-toolbar").forEach(t=>{let o=t.__bulkToolbarInstance;(!o||o!==this.bulkToolbar)&&t.remove()}),this.bulkToolbar){let t=D(this.config,this.plugin.settings);this.bulkToolbar.updateSettings(t)}else{let t=D(this.config,this.plugin.settings);this.bulkToolbar=new oe(this.app,this.plugin,this.containerEl,()=>Array.from(this.selectedFiles),()=>{this.selectedFiles.clear(),this.updateSelectionUI()},()=>{let o=Array.from(this.selectedFiles);this.isRefreshingWithSelection=!0,this.bulkToolbar&&o.length>0&&this.bulkToolbar.show(),this.onDataUpdated(),window.setTimeout(()=>{o.forEach(n=>{this.app.vault.getAbstractFileByPath(n)&&this.selectedFiles.add(n)}),this.isRefreshingWithSelection=!1,this.updateSelectionUI(),this.selectedFiles.size>0&&this.bulkToolbar&&(this.bulkToolbar.show(),this.bulkToolbar.updateCount(this.selectedFiles.size)),window.setTimeout(()=>{this.selectedFiles.size>0&&this.bulkToolbar&&(this.bulkToolbar.show(),this.bulkToolbar.updateCount(this.selectedFiles.size))},100)},250)},()=>{this.selectAll()},t)}this.bulkToolbar.updateCount(this.selectedFiles.size),this.bulkToolbar.show()}else if(this.bulkToolbar&&!this.isRefreshingWithSelection){this.bulkToolbar.hide();let s=this.containerEl.querySelector(".bases-cms-bulk-toolbar");s instanceof HTMLElement&&(s.removeClass("bases-cms-bulk-toolbar-visible"),s.addClass("bases-cms-bulk-toolbar-hidden"))}}onClose(){this.scrollLayoutManager.cleanup(),this.viewSwitchListener.cleanup(),this.propertyObservers.forEach(t=>t.disconnect()),this.propertyObservers=[],this.bulkToolbar&&this.bulkToolbar.destroy(),this.selectedFiles.clear(),document.querySelectorAll(".bases-cms-bulk-toolbar").forEach(t=>t.remove());let s=this.plugin;s&&typeof s.removeView=="function"&&s.removeView(this)}async onNew(){let e=D(this.config,this.plugin.settings);if(e.customizeNewButton&&e.newNoteLocation&&e.newNoteLocation.trim()!=="")try{let s=e.newNoteLocation.trim().replace(/^\/+|\/+$/g,""),t=this.app.vault.getAbstractFileByPath(s);if((!t||!("children"in t))&&(await this.app.vault.createFolder(s),t=this.app.vault.getAbstractFileByPath(s)),t&&"children"in t){let o=await this.app.vault.create(`${s}/Untitled.md`,"");return await this.app.workspace.openLinkText(o.path,"",!1),!0}}catch(s){console.error("[CMS View] Error creating new note:",s)}return!1}};function Ee(a,i=5){try{let e=a;if(typeof e.registerBasesView=="function")e.registerBasesView(Se,{name:"CMS",icon:a.settings.useHomeIcon?"lucide-home":"lucide-blocks",factory:(s,t)=>{let o=new pe(s,t,a),n=a;return n.activeViews&&n.activeViews.add(o),o},options:wt()});else if(i>0){let s=a,t=s.registrationTimeout;t!=null&&window.clearTimeout(t),s.registrationTimeout=window.setTimeout(()=>{s.registrationTimeout=null,Ee(a,i-1)},200)}else console.warn("Bases CMS: registerBasesView not available. Is Bases plugin installed?")}catch(e){console.error("Bases CMS: Error registering view:",e)}}function wt(){let{getCMSViewOptions:a}=(U(),Ce(Fe));return a}var de=class extends Ge.Plugin{constructor(){super(...arguments);this.activeViews=new Set;this.registrationTimeout=null}async onload(){await this.loadSettings(),this.addSettingTab(new j(this.app,this)),Ee(this)}onunload(){this.registrationTimeout!==null&&(window.clearTimeout(this.registrationTimeout),this.registrationTimeout=null),this.activeViews.clear()}async loadSettings(){this.settings=Object.assign({},Pe,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}refreshAllToolbars(){let e=[];this.activeViews.forEach(s=>{let t=s.containerEl;(!t||!t.parentElement)&&e.push(s)}),e.forEach(s=>this.activeViews.delete(s)),this.activeViews.forEach(s=>{s&&typeof s.refreshToolbar=="function"&&s.refreshToolbar()})}removeView(e){this.activeViews.delete(e)}};
