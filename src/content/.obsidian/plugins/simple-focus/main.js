/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var g=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var k=(t,o)=>{for(var e in o)g(t,e,{get:o[e],enumerable:!0})},T=(t,o,e,s)=>{if(o&&typeof o=="object"||typeof o=="function")for(let i of A(o))!C.call(t,i)&&i!==e&&g(t,i,{get:()=>o[i],enumerable:!(s=y(o,i))||s.enumerable});return t};var M=t=>T(g({},"__esModule",{value:!0}),t);var G={};k(G,{SimpleFocusPlugin:()=>f,default:()=>H});module.exports=M(G);var I=require("obsidian");var O={focus:"Focus",enterFocus:"Enter focus",exitFocus:"Exit focus",toggleFocus:"Toggle focus",settings:"Simple Focus Settings",showRightClickMenu:"Show right-click menu option",showFileExplorerIcon:"Show file explorer icon",focusLevel:"Command focus level",focusLevelFile:"Current file only",focusLevelParent:"Parent folder",focusLevelGrandparent:"Grandparent folder",focusLevelGreatGrandparent:"Great grandparent folder",focusLevelCustom:"Specific folder",focusLevelDesc:"Determines what to focus when using the toggle command or file explorer icon. Right-click menu always focuses the clicked file/folder.",customFolderPath:"Custom folder path",customFolderPathDesc:"Enter a folder path (folder/subfolder). This folder will be focused regardless of which file is open."},v=O;var N={focus:"\u4E13\u6CE8",enterFocus:"\u4E13\u6CE8",exitFocus:"\u9000\u51FA\u4E13\u6CE8",toggleFocus:"\u5207\u6362\u4E13\u6CE8",settings:"\u7B80\u5355\u4E13\u6CE8\u8BBE\u7F6E",showRightClickMenu:"\u663E\u793A\u53F3\u952E\u83DC\u5355\u9009\u9879",showFileExplorerIcon:"\u663E\u793A\u6587\u4EF6\u6D4F\u89C8\u5668\u56FE\u6807",focusLevel:"\u547D\u4EE4\u4E13\u6CE8\u7EA7\u522B",focusLevelFile:"\u4EC5\u5F53\u524D\u6587\u4EF6",focusLevelParent:"\u7236\u6587\u4EF6\u5939",focusLevelGrandparent:"\u7956\u7236\u6587\u4EF6\u5939",focusLevelGreatGrandparent:"\u66FE\u7956\u7236\u6587\u4EF6\u5939",focusLevelCustom:"\u7279\u5B9A\u6587\u4EF6\u5939",focusLevelDesc:"\u786E\u5B9A\u4F7F\u7528\u5207\u6362\u547D\u4EE4\u6216\u6587\u4EF6\u6D4F\u89C8\u5668\u56FE\u6807\u65F6\u8981\u805A\u7126\u7684\u5185\u5BB9\u3002\u53F3\u952E\u83DC\u5355\u59CB\u7EC8\u805A\u7126\u5355\u51FB\u7684\u6587\u4EF6/\u6587\u4EF6\u5939\u3002",customFolderPath:"\u81EA\u5B9A\u4E49\u6587\u4EF6\u5939\u8DEF\u5F84",customFolderPathDesc:"\u8F93\u5165\u6587\u4EF6\u5939\u8DEF\u5F84\uFF08\u6587\u4EF6\u5939/\u5B50\u6587\u4EF6\u5939\uFF09\u3002\u65E0\u8BBA\u6253\u5F00\u54EA\u4E2A\u6587\u4EF6\uFF0C\u90FD\u4F1A\u805A\u7126\u6B64\u6587\u4EF6\u5939\u3002"},F=N;var D={en:v,zh:F},w=D;var x={showRightClickMenu:!0,showFileExplorerIcon:!0,focusLevel:"parent",customFolderPath:""},c="plugin-simple-focus-hidden";var a=require("obsidian"),p=class extends a.PluginSettingTab{constructor(e,s){super(e,s);this.plugin=s}display(){let{containerEl:e}=this;e.empty(),new a.Setting(e).setName(this.plugin.lang.showRightClickMenu).addToggle(i=>i.setValue(this.plugin.settings.showRightClickMenu).onChange(async r=>{this.plugin.settings.showRightClickMenu=r,await this.plugin.saveSettings()})),new a.Setting(e).setName(this.plugin.lang.showFileExplorerIcon).addToggle(i=>i.setValue(this.plugin.settings.showFileExplorerIcon).onChange(async r=>{this.plugin.settings.showFileExplorerIcon=r,await this.plugin.saveSettings(),this.plugin.updateFileExplorerIcon()}));let s=new a.Setting(e).setName(this.plugin.lang.focusLevel).setDesc(this.plugin.lang.focusLevelDesc).addDropdown(i=>i.addOption("file",this.plugin.lang.focusLevelFile).addOption("parent",this.plugin.lang.focusLevelParent).addOption("grandparent",this.plugin.lang.focusLevelGrandparent).addOption("greatgrandparent",this.plugin.lang.focusLevelGreatGrandparent).addOption("custom",this.plugin.lang.focusLevelCustom).setValue(this.plugin.settings.focusLevel).onChange(async r=>{this.plugin.settings.focusLevel=r,await this.plugin.saveSettings(),this.display()}));this.plugin.settings.focusLevel==="custom"&&new a.Setting(e).setName(this.plugin.lang.customFolderPath).setDesc(this.plugin.lang.customFolderPathDesc).addText(i=>i.setPlaceholder("folder/subfolder").setValue(this.plugin.settings.customFolderPath).onChange(async r=>{this.plugin.settings.customFolderPath=r,await this.plugin.saveSettings()}))}};function h(t,o,e){if(o==="custom")return e.customFolderPath||t;if(o==="file")return t;let s=t.split("/");return o==="parent"?s.length===1?t:s.slice(0,-1).join("/"):o==="grandparent"?s.length<=2?s[0]||t:s.slice(0,-2).join("/"):s.length<=3?s[0]||t:s.slice(0,-3).join("/")}function S(t){t.addCommand({id:"simple-focus-toggle",name:t.lang.toggleFocus,callback:()=>{if(t.isFocus)t.exitFocus();else if(t.settings.focusLevel==="custom")t.settings.customFolderPath&&t.enterFocus(t.settings.customFolderPath);else{let o=t.app.workspace.getActiveFile();if(o!=null&&o.path){let e=h(o.path,t.settings.focusLevel,t.settings);t.enterFocus(e)}}}}),t.settings.showRightClickMenu&&t.registerEvent(t.app.workspace.on("file-menu",(o,e)=>{t.settings.showRightClickMenu&&o.addItem(s=>{s.setTitle(t.isFocus?t.lang.exitFocus:t.lang.focus).setIcon(t.isFocus?"log-out":"focus").onClick(async()=>{t.toggleFocus(e==null?void 0:e.path)})})}))}function L(t){t.mutationObserver=new MutationObserver(e=>{var s,i;if(!(!t.isFocus||!t.focusedPath)){for(let r of e)for(let l of Array.from(r.addedNodes))if(l.nodeType===Node.ELEMENT_NODE){let n=l,P=(s=n.matches)!=null&&s.call(n,".tree-item")?[n]:((i=n.querySelectorAll)==null?void 0:i.call(n,".tree-item"))||[];for(let m of Array.from(P)){let E=m.querySelector("[data-path]");if(E){let u=E.getAttribute("data-path");u&&!u.startsWith(t.focusedPath)&&u!==t.focusedPath&&(u.startsWith(t.focusedPath+"/")||m.addClass(c))}}}}});let o=t.app.workspace.getLeavesOfType("file-explorer");if(o.length>0){let s=o[0].view.containerEl.querySelector(".nav-files-container");s&&t.mutationObserver.observe(s,{childList:!0,subtree:!0})}t.registerEvent(t.app.workspace.on("layout-change",()=>{if(t.mutationObserver){let e=t.app.workspace.getLeavesOfType("file-explorer");if(e.length>0){let i=e[0].view.containerEl.querySelector(".nav-files-container");i&&(t.mutationObserver.disconnect(),t.mutationObserver.observe(i,{childList:!0,subtree:!0}))}}}))}function b(t){let o=document.createElement("div");o.className="clickable-icon nav-action-button",o.setAttribute("aria-label",t.lang.toggleFocus);let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.setAttribute("class","svg-icon lucide-focus");let s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttribute("cx","12"),s.setAttribute("cy","12"),s.setAttribute("r","3"),e.appendChild(s);let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M3 7V5a2 2 0 0 1 2-2h2"),e.appendChild(i);let r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d","M17 3h2a2 2 0 0 1 2 2v2"),e.appendChild(r);let l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d","M21 17v2a2 2 0 0 1-2 2h-2"),e.appendChild(l);let n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","M7 21H5a2 2 0 0 1-2-2v-2"),e.appendChild(n),o.appendChild(e),o}function d(t,o){let s=Array.from(o.querySelectorAll(".clickable-icon.nav-action-button")).filter(r=>!r.classList.contains("cmdr")&&r!==t),i=Array.from(o.querySelectorAll(".cmdr"));i.length>0?o.insertBefore(t,i[0]):s.length>0?o.insertBefore(t,s[s.length-1].nextSibling):o.appendChild(t)}var f=class extends I.Plugin{constructor(e,s){super(e,s);let r=window.localStorage.getItem("language")==="zh"?"zh":"en";this.lang=w[r],this.isFocus=!1,this.focusedPath=null,this.fileExplorerIcon=null,this.mutationObserver=null}async onload(){await this.loadSettings(),this.addSettingTab(new p(this.app,this)),S(this),this.settings.showFileExplorerIcon&&this.addFileExplorerIcon(),L(this)}async loadSettings(){this.settings=Object.assign({},x,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}toggleFocus(e){this.isFocus?this.exitFocus():e&&this.enterFocus(e)}enterFocus(e){this.isFocus=!0,this.focusedPath=e,this.applyFocusHiding(e),this.updateFileExplorerIcon()}exitFocus(){this.isFocus=!1,this.focusedPath=null,document.querySelectorAll(`.${c}`).forEach(s=>{s.removeClass(c)}),this.updateFileExplorerIcon()}applyFocusHiding(e){document.querySelectorAll(`.tree-item:not(:has([data-path="${e}"]),:has([data-path^="${e}/"]))`).forEach(i=>{i.addClass(c)})}addFileExplorerIcon(){let e=()=>{let s=this.app.workspace.getLeavesOfType("file-explorer");if(s.length===0)return;let r=s[0].view.containerEl.querySelector(".nav-buttons-container");r&&(this.fileExplorerIcon&&r.contains(this.fileExplorerIcon)||(this.fileExplorerIcon&&this.fileExplorerIcon.remove(),this.fileExplorerIcon||(this.fileExplorerIcon=b(this),this.registerDomEvent(this.fileExplorerIcon,"click",()=>{if(this.isFocus)this.exitFocus();else if(this.settings.focusLevel==="custom")this.settings.customFolderPath&&this.enterFocus(this.settings.customFolderPath);else{let l=this.app.workspace.getActiveFile();if(l!=null&&l.path){let n=h(l.path,this.settings.focusLevel,this.settings);this.enterFocus(n)}}})),this.updateFileExplorerIcon(),d(this.fileExplorerIcon,r)))};e(),this.registerEvent(this.app.workspace.on("layout-change",()=>{this.settings.showFileExplorerIcon&&e()}))}updateFileExplorerIcon(){if(this.fileExplorerIcon){if(!this.settings.showFileExplorerIcon){this.fileExplorerIcon.parentElement&&this.fileExplorerIcon.remove();return}if(!this.fileExplorerIcon.parentElement){let e=this.app.workspace.getLeavesOfType("file-explorer");if(e.length>0){let i=e[0].view.containerEl.querySelector(".nav-buttons-container");i&&d(this.fileExplorerIcon,i)}}this.isFocus?this.fileExplorerIcon.addClass("is-active"):this.fileExplorerIcon.removeClass("is-active")}}onunload(){this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null),this.fileExplorerIcon&&(this.fileExplorerIcon.remove(),this.fileExplorerIcon=null)}},H=f;
