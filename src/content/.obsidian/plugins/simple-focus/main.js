/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var d=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var T=(e,s)=>{for(var t in s)d(e,t,{get:s[t],enumerable:!0})},M=(e,s,t,o)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of y(s))!C.call(e,i)&&i!==t&&d(e,i,{get:()=>s[i],enumerable:!(o=A(s,i))||o.enumerable});return e};var k=e=>M(d({},"__esModule",{value:!0}),e);var q={};T(q,{SimpleFocusPlugin:()=>f,default:()=>G});module.exports=k(q);var b=require("obsidian");var V={focus:"Focus",enterFocus:"Enter focus",exitFocus:"Exit focus",toggleFocus:"Toggle focus",settings:"Simple Focus Settings",showRightClickMenu:"Show right-click menu option",showFileExplorerIcon:"Show file explorer icon",focusLevel:"Command focus level",focusLevelFile:"Current file only",focusLevelParent:"Parent folder",focusLevelGrandparent:"Grandparent folder",focusLevelGreatGrandparent:"Great grandparent folder",focusLevelCustom:"Specific folder",focusLevelDesc:"Determines what to focus when using the toggle command or file explorer icon. Right-click menu always focuses the clicked file/folder.",customFolderPath:"Custom folder path",customFolderPathDesc:"Enter a folder path (folder/subfolder). This folder will be focused regardless of which file is open.",hideAncestorFolders:"Hide ancestral indents",hideAncestorFoldersDesc:"When enabled, hides parent folder indentation when focusing, making the focused folder appear at root level."},m=V;var O={focus:"\u4E13\u6CE8",enterFocus:"\u4E13\u6CE8",exitFocus:"\u9000\u51FA\u4E13\u6CE8",toggleFocus:"\u5207\u6362\u4E13\u6CE8",settings:"\u7B80\u5355\u4E13\u6CE8\u8BBE\u7F6E",showRightClickMenu:"\u663E\u793A\u53F3\u952E\u83DC\u5355\u9009\u9879",showFileExplorerIcon:"\u663E\u793A\u6587\u4EF6\u6D4F\u89C8\u5668\u56FE\u6807",focusLevel:"\u547D\u4EE4\u4E13\u6CE8\u7EA7\u522B",focusLevelFile:"\u4EC5\u5F53\u524D\u6587\u4EF6",focusLevelParent:"\u7236\u6587\u4EF6\u5939",focusLevelGrandparent:"\u7956\u7236\u6587\u4EF6\u5939",focusLevelGreatGrandparent:"\u66FE\u7956\u7236\u6587\u4EF6\u5939",focusLevelCustom:"\u7279\u5B9A\u6587\u4EF6\u5939",focusLevelDesc:"\u786E\u5B9A\u4F7F\u7528\u5207\u6362\u547D\u4EE4\u6216\u6587\u4EF6\u6D4F\u89C8\u5668\u56FE\u6807\u65F6\u8981\u805A\u7126\u7684\u5185\u5BB9\u3002\u53F3\u952E\u83DC\u5355\u59CB\u7EC8\u805A\u7126\u5355\u51FB\u7684\u6587\u4EF6/\u6587\u4EF6\u5939\u3002",customFolderPath:"\u81EA\u5B9A\u4E49\u6587\u4EF6\u5939\u8DEF\u5F84",customFolderPathDesc:"\u8F93\u5165\u6587\u4EF6\u5939\u8DEF\u5F84\uFF08\u6587\u4EF6\u5939/\u5B50\u6587\u4EF6\u5939\uFF09\u3002\u65E0\u8BBA\u6253\u5F00\u54EA\u4E2A\u6587\u4EF6\uFF0C\u90FD\u4F1A\u805A\u7126\u6B64\u6587\u4EF6\u5939\u3002",hideAncestorFolders:"\u9690\u85CF\u7956\u5148\u7F29\u8FDB",hideAncestorFoldersDesc:"\u542F\u7528\u540E\uFF0C\u805A\u7126\u65F6\u9690\u85CF\u7236\u6587\u4EF6\u5939\u7F29\u8FDB\uFF0C\u4F7F\u805A\u7126\u7684\u6587\u4EF6\u5939\u663E\u793A\u5728\u6839\u7EA7\u522B\u3002"},F=O;var D={en:m,zh:F},E=D;var w={showRightClickMenu:!0,showFileExplorerIcon:!0,focusLevel:"parent",customFolderPath:"",hideAncestorFolders:!1};var c=require("obsidian");function x(e,s){let t=Object.keys(s).map(o=>H(e,o,s[o]));return t.length===1?t[0]:function(){t.forEach(o=>o())}}function H(e,s,t){let o=e[s],i=e.hasOwnProperty(s),r=i?o:function(){return Object.getPrototypeOf(e)[s].apply(this,arguments)},n=t(r);return o&&Object.setPrototypeOf(n,o),Object.setPrototypeOf(l,n),e[s]=l,u;function l(...I){return n===r&&e[s]===l&&u(),n.apply(this,I)}function u(){e[s]===l&&(i?e[s]=r:delete e[s]),n!==r&&(n=r,Object.setPrototypeOf(l,o||Function))}}var v=!1;function P(e){let s=N(e);if(s){if(!v){let t=e.app.workspace.getLeaf(!0);e.register(x(Object.getPrototypeOf(s),{getSortedFolderItems(o){return function(i){let r=o.call(this,i);if(e.isFocus&&e.focusedPath){let n=e.focusedPath;r=r.filter(l=>{let u=l.file.path;return u===n||u.startsWith(n+"/")||n.startsWith(u+"/")?(l.info.hidden=!1,!0):(l.info.hidden=!0,!1)})}else r.forEach(n=>{n.info.hidden=!1});return r}}})),t.detach(),v=!0}s.fileExplorerPlusPatched=!0}}function N(e){var t;let s=(t=e.app.workspace.getLeavesOfType("file-explorer"))==null?void 0:t.first();return s==null?void 0:s.view}function a(e){return e.app.workspace.getLeavesOfType("file-explorer").map(t=>t.view)}var p=class extends c.PluginSettingTab{constructor(t,o){super(t,o);this.plugin=o}display(){let{containerEl:t}=this;t.empty(),new c.Setting(t).setName(this.plugin.lang.showRightClickMenu).addToggle(i=>i.setValue(this.plugin.settings.showRightClickMenu).onChange(async r=>{this.plugin.settings.showRightClickMenu=r,await this.plugin.saveSettings()})),new c.Setting(t).setName(this.plugin.lang.showFileExplorerIcon).addToggle(i=>i.setValue(this.plugin.settings.showFileExplorerIcon).onChange(async r=>{this.plugin.settings.showFileExplorerIcon=r,await this.plugin.saveSettings(),this.plugin.updateFileExplorerIcon()}));let o=new c.Setting(t).setName(this.plugin.lang.focusLevel).setDesc(this.plugin.lang.focusLevelDesc).addDropdown(i=>i.addOption("file",this.plugin.lang.focusLevelFile).addOption("parent",this.plugin.lang.focusLevelParent).addOption("grandparent",this.plugin.lang.focusLevelGrandparent).addOption("greatgrandparent",this.plugin.lang.focusLevelGreatGrandparent).addOption("custom",this.plugin.lang.focusLevelCustom).setValue(this.plugin.settings.focusLevel).onChange(async r=>{this.plugin.settings.focusLevel=r,await this.plugin.saveSettings(),this.plugin.isFocus&&a(this.plugin).forEach(l=>{l!=null&&l.requestSort&&l.requestSort()}),this.display()}));this.plugin.settings.focusLevel==="custom"&&new c.Setting(t).setName(this.plugin.lang.customFolderPath).setDesc(this.plugin.lang.customFolderPathDesc).addText(i=>i.setPlaceholder("folder/subfolder").setValue(this.plugin.settings.customFolderPath).onChange(async r=>{this.plugin.settings.customFolderPath=r,await this.plugin.saveSettings()}))}};function h(e,s,t){if(s==="custom")return t.customFolderPath||e;if(s==="file")return e;let o=e.split("/");return s==="parent"?o.length===1?e:o.slice(0,-1).join("/"):s==="grandparent"?o.length<=2?o[0]||e:o.slice(0,-2).join("/"):o.length<=3?o[0]||e:o.slice(0,-3).join("/")}function L(e){e.addCommand({id:"simple-focus-toggle",name:e.lang.toggleFocus,callback:()=>{if(e.isFocus)e.exitFocus();else if(e.settings.focusLevel==="custom")e.settings.customFolderPath&&e.enterFocus(e.settings.customFolderPath);else{let s=e.app.workspace.getActiveFile();if(s!=null&&s.path){let t=h(s.path,e.settings.focusLevel,e.settings);e.enterFocus(t)}}}}),e.settings.showRightClickMenu&&e.registerEvent(e.app.workspace.on("file-menu",(s,t)=>{e.settings.showRightClickMenu&&s.addItem(o=>{o.setTitle(e.isFocus?e.lang.exitFocus:e.lang.focus).setIcon(e.isFocus?"log-out":"focus").onClick(async()=>{e.toggleFocus(t==null?void 0:t.path)})})}))}function S(e){let s=document.createElement("div");s.className="clickable-icon nav-action-button",s.setAttribute("aria-label",e.lang.toggleFocus);let t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("width","24"),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round"),t.setAttribute("class","svg-icon lucide-focus");let o=document.createElementNS("http://www.w3.org/2000/svg","circle");o.setAttribute("cx","12"),o.setAttribute("cy","12"),o.setAttribute("r","3"),t.appendChild(o);let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M3 7V5a2 2 0 0 1 2-2h2"),t.appendChild(i);let r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d","M17 3h2a2 2 0 0 1 2 2v2"),t.appendChild(r);let n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M21 17v2a2 2 0 0 1-2 2h-2"),t.appendChild(n);let l=document.createElementNS("http://www.w3.org/2000/svg","path");return l.setAttribute("d","M7 21H5a2 2 0 0 1-2-2v-2"),t.appendChild(l),s.appendChild(t),s}function g(e,s){let o=Array.from(s.querySelectorAll(".clickable-icon.nav-action-button")).filter(r=>!r.classList.contains("cmdr")&&r!==e),i=Array.from(s.querySelectorAll(".cmdr"));i.length>0?s.insertBefore(e,i[0]):o.length>0?s.insertBefore(e,o[o.length-1].nextSibling):s.appendChild(e)}var f=class extends b.Plugin{constructor(t,o){super(t,o);let r=window.localStorage.getItem("language")==="zh"?"zh":"en";this.lang=E[r],this.isFocus=!1,this.focusedPath=null,this.fileExplorerIcon=null}async onload(){await this.loadSettings(),this.addSettingTab(new p(this.app,this)),L(this),this.settings.showFileExplorerIcon&&this.addFileExplorerIcon(),this.app.workspace.onLayoutReady(()=>{this.patchAllFileExplorers(),this.updateFocusModeClasses()}),this.app.workspace.on("layout-change",()=>{this.patchAllFileExplorers(),this.updateFocusModeClasses()})}async loadSettings(){this.settings=Object.assign({},w,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}toggleFocus(t){this.isFocus?this.exitFocus():t&&this.enterFocus(t)}enterFocus(t){this.isFocus=!0,this.focusedPath=t,this.updateFileExplorerIcon(),this.updateFocusModeClasses(),a(this).forEach(i=>{i!=null&&i.requestSort&&i.requestSort()})}patchAllFileExplorers(){P(this),a(this).forEach(o=>{o.fileExplorerPlusPatched=!0})}exitFocus(){this.isFocus=!1,this.focusedPath=null,this.updateFileExplorerIcon(),this.updateFocusModeClasses(),a(this).forEach(o=>{o!=null&&o.requestSort&&o.requestSort()})}updateFocusModeClasses(){a(this).forEach(o=>{let i=o.containerEl;this.isFocus?i.addClass("simple-focus-mode"):i.removeClass("simple-focus-mode")})}addFileExplorerIcon(){let t=()=>{let o=this.app.workspace.getLeavesOfType("file-explorer");if(o.length===0)return;let r=o[0].view.containerEl.querySelector(".nav-buttons-container");r&&(this.fileExplorerIcon&&r.contains(this.fileExplorerIcon)||(this.fileExplorerIcon&&this.fileExplorerIcon.remove(),this.fileExplorerIcon||(this.fileExplorerIcon=S(this),this.registerDomEvent(this.fileExplorerIcon,"click",()=>{if(this.isFocus)this.exitFocus();else if(this.settings.focusLevel==="custom")this.settings.customFolderPath&&this.enterFocus(this.settings.customFolderPath);else{let n=this.app.workspace.getActiveFile();if(n!=null&&n.path){let l=h(n.path,this.settings.focusLevel,this.settings);this.enterFocus(l)}}})),this.updateFileExplorerIcon(),g(this.fileExplorerIcon,r)))};t(),this.registerEvent(this.app.workspace.on("layout-change",()=>{this.settings.showFileExplorerIcon&&t()}))}updateFileExplorerIcon(){if(this.fileExplorerIcon){if(!this.settings.showFileExplorerIcon){this.fileExplorerIcon.parentElement&&this.fileExplorerIcon.remove();return}if(!this.fileExplorerIcon.parentElement){let t=this.app.workspace.getLeavesOfType("file-explorer");if(t.length>0){let i=t[0].view.containerEl.querySelector(".nav-buttons-container");i&&g(this.fileExplorerIcon,i)}}this.isFocus?this.fileExplorerIcon.addClass("is-active"):this.fileExplorerIcon.removeClass("is-active")}}onunload(){this.fileExplorerIcon&&(this.fileExplorerIcon.remove(),this.fileExplorerIcon=null)}},G=f;
