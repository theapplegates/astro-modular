/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var g=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var M=(e,o)=>{for(var t in o)g(e,t,{get:o[t],enumerable:!0})},k=(e,o,t,s)=>{if(o&&typeof o=="object"||typeof o=="function")for(let i of T(o))!C.call(e,i)&&i!==t&&g(e,i,{get:()=>o[i],enumerable:!(s=A(o,i))||s.enumerable});return e};var H=e=>k(g({},"__esModule",{value:!0}),e);var R={};M(R,{SimpleFocusPlugin:()=>f,default:()=>G});module.exports=H(R);var I=require("obsidian");var O={focus:"Focus",enterFocus:"Enter focus",exitFocus:"Exit focus",toggleFocus:"Toggle focus",settings:"Simple Focus Settings",showRightClickMenu:"Show right-click menu option",showFileExplorerIcon:"Show file explorer icon",focusLevel:"Command focus level",focusLevelFile:"Current file only",focusLevelParent:"Parent folder",focusLevelGrandparent:"Grandparent folder",focusLevelGreatGrandparent:"Great grandparent folder",focusLevelCustom:"Specific folder",focusLevelDesc:"Determines what to focus when using the toggle command or file explorer icon. Right-click menu always focuses the clicked file/folder.",customFolderPath:"Custom folder path",customFolderPathDesc:"Enter a folder path (folder/subfolder). This folder will be focused regardless of which file is open.",hideAncestorFolders:"Hide ancestral indents",hideAncestorFoldersDesc:"When enabled, hides parent folder indentation when focusing, making the focused folder appear at root level."},E=O;var D={focus:"\u4E13\u6CE8",enterFocus:"\u4E13\u6CE8",exitFocus:"\u9000\u51FA\u4E13\u6CE8",toggleFocus:"\u5207\u6362\u4E13\u6CE8",settings:"\u7B80\u5355\u4E13\u6CE8\u8BBE\u7F6E",showRightClickMenu:"\u663E\u793A\u53F3\u952E\u83DC\u5355\u9009\u9879",showFileExplorerIcon:"\u663E\u793A\u6587\u4EF6\u6D4F\u89C8\u5668\u56FE\u6807",focusLevel:"\u547D\u4EE4\u4E13\u6CE8\u7EA7\u522B",focusLevelFile:"\u4EC5\u5F53\u524D\u6587\u4EF6",focusLevelParent:"\u7236\u6587\u4EF6\u5939",focusLevelGrandparent:"\u7956\u7236\u6587\u4EF6\u5939",focusLevelGreatGrandparent:"\u66FE\u7956\u7236\u6587\u4EF6\u5939",focusLevelCustom:"\u7279\u5B9A\u6587\u4EF6\u5939",focusLevelDesc:"\u786E\u5B9A\u4F7F\u7528\u5207\u6362\u547D\u4EE4\u6216\u6587\u4EF6\u6D4F\u89C8\u5668\u56FE\u6807\u65F6\u8981\u805A\u7126\u7684\u5185\u5BB9\u3002\u53F3\u952E\u83DC\u5355\u59CB\u7EC8\u805A\u7126\u5355\u51FB\u7684\u6587\u4EF6/\u6587\u4EF6\u5939\u3002",customFolderPath:"\u81EA\u5B9A\u4E49\u6587\u4EF6\u5939\u8DEF\u5F84",customFolderPathDesc:"\u8F93\u5165\u6587\u4EF6\u5939\u8DEF\u5F84\uFF08\u6587\u4EF6\u5939/\u5B50\u6587\u4EF6\u5939\uFF09\u3002\u65E0\u8BBA\u6253\u5F00\u54EA\u4E2A\u6587\u4EF6\uFF0C\u90FD\u4F1A\u805A\u7126\u6B64\u6587\u4EF6\u5939\u3002",hideAncestorFolders:"\u9690\u85CF\u7956\u5148\u7F29\u8FDB",hideAncestorFoldersDesc:"\u542F\u7528\u540E\uFF0C\u805A\u7126\u65F6\u9690\u85CF\u7236\u6587\u4EF6\u5939\u7F29\u8FDB\uFF0C\u4F7F\u805A\u7126\u7684\u6587\u4EF6\u5939\u663E\u793A\u5728\u6839\u7EA7\u522B\u3002"},x=D;var q={en:E,zh:x},w=q;var v={showRightClickMenu:!0,showFileExplorerIcon:!0,focusLevel:"parent",customFolderPath:"",hideAncestorFolders:!1};var u=require("obsidian");function b(e,o){let t=Object.keys(o).map(s=>N(e,s,o[s]));return t.length===1?t[0]:function(){t.forEach(s=>s())}}function N(e,o,t){let s=e[o],i=e.hasOwnProperty(o),n=i?s:function(){return Object.getPrototypeOf(e)[o].apply(this,arguments)},l=t(n);return s&&Object.setPrototypeOf(l,s),Object.setPrototypeOf(r,l),e[o]=r,a;function r(...d){return l===n&&e[o]===r&&a(),l.apply(this,d)}function a(){e[o]===r&&(i?e[o]=n:delete e[o]),l!==n&&(l=n,Object.setPrototypeOf(r,s||Function))}}var P=!1;function L(e){let o=V(e);if(o){if(!P){let t=e.app.workspace.getLeaf(!0);e.register(b(Object.getPrototypeOf(o),{getSortedFolderItems(s){return function(i){let n=s.call(this,i);if(e.isFocus&&e.focusedPath){let l=e.focusedPath;n=n.filter(r=>{let a=r.file.path;return a===l||a.startsWith(l+"/")||l.startsWith(a+"/")?(r.info.hidden=!1,!0):(r.info.hidden=!0,!1)})}else n.forEach(l=>{l.info.hidden=!1});return n}}})),t.detach(),P=!0}o.fileExplorerPlusPatched=!0}}function V(e){var t;let o=(t=e.app.workspace.getLeavesOfType("file-explorer"))==null?void 0:t.first();return o==null?void 0:o.view}function c(e){return e.app.workspace.getLeavesOfType("file-explorer").map(t=>t.view)}var p=class extends u.PluginSettingTab{constructor(t,s){super(t,s);this.plugin=s}display(){let{containerEl:t}=this;t.empty(),new u.Setting(t).setName(this.plugin.lang.showRightClickMenu).addToggle(i=>i.setValue(this.plugin.settings.showRightClickMenu).onChange(async n=>{this.plugin.settings.showRightClickMenu=n,await this.plugin.saveSettings()})),new u.Setting(t).setName(this.plugin.lang.showFileExplorerIcon).addToggle(i=>i.setValue(this.plugin.settings.showFileExplorerIcon).onChange(async n=>{this.plugin.settings.showFileExplorerIcon=n,await this.plugin.saveSettings(),this.plugin.updateFileExplorerIcon()}));let s=new u.Setting(t).setName(this.plugin.lang.focusLevel).setDesc(this.plugin.lang.focusLevelDesc).addDropdown(i=>i.addOption("file",this.plugin.lang.focusLevelFile).addOption("parent",this.plugin.lang.focusLevelParent).addOption("grandparent",this.plugin.lang.focusLevelGrandparent).addOption("greatgrandparent",this.plugin.lang.focusLevelGreatGrandparent).addOption("custom",this.plugin.lang.focusLevelCustom).setValue(this.plugin.settings.focusLevel).onChange(async n=>{this.plugin.settings.focusLevel=n,await this.plugin.saveSettings(),this.plugin.isFocus&&c(this.plugin).forEach(r=>{r!=null&&r.requestSort&&r.requestSort()}),this.display()}));this.plugin.settings.focusLevel==="custom"&&new u.Setting(t).setName(this.plugin.lang.customFolderPath).setDesc(this.plugin.lang.customFolderPathDesc).addText(i=>i.setPlaceholder("folder/subfolder").setValue(this.plugin.settings.customFolderPath).onChange(async n=>{this.plugin.settings.customFolderPath=n,await this.plugin.saveSettings()}))}};function h(e,o,t){if(o==="custom")return t.customFolderPath||e;if(o==="file")return e;let s=e.split("/");return o==="parent"?s.length===1?e:s.slice(0,-1).join("/"):o==="grandparent"?s.length<=2?s[0]||e:s.slice(0,-2).join("/"):s.length<=3?s[0]||e:s.slice(0,-3).join("/")}function y(e){e.addCommand({id:"simple-focus-toggle",name:e.lang.toggleFocus,callback:()=>{if(e.isFocus)e.exitFocus();else if(e.settings.focusLevel==="custom")e.settings.customFolderPath&&e.enterFocus(e.settings.customFolderPath);else{let o=e.app.workspace.getActiveFile();if(o!=null&&o.path){let t=h(o.path,e.settings.focusLevel,e.settings);e.enterFocus(t)}}}}),e.settings.showRightClickMenu&&e.registerEvent(e.app.workspace.on("file-menu",(o,t)=>{e.settings.showRightClickMenu&&o.addItem(s=>{s.setTitle(e.isFocus?e.lang.exitFocus:e.lang.focus).setIcon(e.isFocus?"log-out":"focus").onClick(async()=>{e.toggleFocus(t==null?void 0:t.path)})})}))}function m(e){var l;let o=e.querySelector(".nav-buttons-container");if(o||(o=e.querySelector(".nav-header-button-container"),o))return o;let t=e.querySelectorAll(".nav-action-button");if(t.length>0){let a=t[0].parentElement;if(a&&(a.classList.contains("nav-buttons-container")||a.classList.contains("nav-header-button-container")||Array.from(a.children).some(d=>d.classList.contains("nav-action-button"))))return a}let s=e.querySelector(".view-header");if(s){let r=s.querySelector(".nav-buttons-container")||s.querySelector(".nav-header-button-container")||s.querySelector(".view-header-title-container");return r||s}let i=e.querySelector(".nav-files-container");if(i){let r=e.querySelector(".simple-focus-mobile-buttons");return r||(r=document.createElement("div"),r.className="nav-buttons-container simple-focus-mobile-buttons",r.style.display="flex",r.style.alignItems="center",r.style.gap="4px",r.style.padding="8px",r.style.borderBottom="1px solid var(--background-modifier-border)",(l=i.parentElement)==null||l.insertBefore(r,i)),r}let n=e.querySelector(".simple-focus-mobile-buttons");return n||(n=document.createElement("div"),n.className="nav-buttons-container simple-focus-mobile-buttons",n.style.display="flex",n.style.alignItems="center",n.style.gap="4px",n.style.padding="8px",n.style.borderBottom="1px solid var(--background-modifier-border)",e.insertBefore(n,e.firstChild)),n}function S(e){let o=document.createElement("div");o.className="clickable-icon nav-action-button",o.setAttribute("aria-label",e.lang.toggleFocus);let t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("width","24"),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round"),t.setAttribute("class","svg-icon lucide-focus");let s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttribute("cx","12"),s.setAttribute("cy","12"),s.setAttribute("r","3"),t.appendChild(s);let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M3 7V5a2 2 0 0 1 2-2h2"),t.appendChild(i);let n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M17 3h2a2 2 0 0 1 2 2v2"),t.appendChild(n);let l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d","M21 17v2a2 2 0 0 1-2 2h-2"),t.appendChild(l);let r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d","M7 21H5a2 2 0 0 1-2-2v-2"),t.appendChild(r),o.appendChild(t),o}function F(e,o){if(o.contains(e))return;let s=Array.from(o.querySelectorAll(".clickable-icon.nav-action-button")).filter(n=>!n.classList.contains("cmdr")&&n!==e),i=Array.from(o.querySelectorAll(".cmdr"));if(i.length>0)o.insertBefore(e,i[0]);else if(s.length>0){let n=s[s.length-1];n.nextSibling?o.insertBefore(e,n.nextSibling):o.appendChild(e)}else o.appendChild(e)}var f=class extends I.Plugin{constructor(t,s){super(t,s);let n=window.localStorage.getItem("language")==="zh"?"zh":"en";this.lang=w[n],this.isFocus=!1,this.focusedPath=null,this.fileExplorerIcon=null}async onload(){await this.loadSettings(),this.addSettingTab(new p(this.app,this)),y(this),this.settings.showFileExplorerIcon&&this.addFileExplorerIcon(),this.app.workspace.onLayoutReady(()=>{this.patchAllFileExplorers(),this.updateFocusModeClasses()}),this.app.workspace.on("layout-change",()=>{this.patchAllFileExplorers(),this.updateFocusModeClasses()})}async loadSettings(){this.settings=Object.assign({},v,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}toggleFocus(t){this.isFocus?this.exitFocus():t&&this.enterFocus(t)}enterFocus(t){this.isFocus=!0,this.focusedPath=t,this.updateFileExplorerIcon(),this.updateFocusModeClasses();let s=c(this);s.forEach(i=>{i!=null&&i.requestSort&&i.requestSort()}),setTimeout(()=>{s.forEach(i=>{this.refreshFileExplorerVisibility(i)})},0)}patchAllFileExplorers(){L(this),c(this).forEach(s=>{s.fileExplorerPlusPatched=!0})}exitFocus(){this.isFocus=!1,this.focusedPath=null,this.updateFileExplorerIcon(),this.updateFocusModeClasses();let t=c(this);t.forEach(s=>{s!=null&&s.requestSort&&s.requestSort()}),setTimeout(()=>{t.forEach(s=>{this.refreshFileExplorerVisibility(s)})},0)}refreshFileExplorerVisibility(t){t!=null&&t.fileItems&&Object.values(t.fileItems).forEach(s=>{if(!s||!s.el)return;let i=s.file.path,n=!0;if(this.isFocus&&this.focusedPath){let l=this.focusedPath;i===l||i.startsWith(l+"/")||l.startsWith(i+"/")?n=!0:n=!1}s.info&&(s.info.hidden=!n),n?(s.el.style.display="",s.el.removeAttribute("data-simple-focus-hidden")):(s.el.style.display="none",s.el.setAttribute("data-simple-focus-hidden","true"))})}updateFocusModeClasses(){c(this).forEach(s=>{let i=s.containerEl;this.isFocus?i.addClass("simple-focus-mode"):i.removeClass("simple-focus-mode")})}addFileExplorerIcon(){let t=()=>{if(this.isFocus)this.exitFocus();else if(this.settings.focusLevel==="custom")this.settings.customFolderPath&&this.enterFocus(this.settings.customFolderPath);else{let i=this.app.workspace.getActiveFile();if(i!=null&&i.path){let n=h(i.path,this.settings.focusLevel,this.settings);this.enterFocus(n)}}},s=()=>{let i=this.app.workspace.getLeavesOfType("file-explorer");if(i.length===0)return;let n=i[0].view.containerEl,l=m(n);if(l&&!(this.fileExplorerIcon&&l.contains(this.fileExplorerIcon))){if(this.fileExplorerIcon&&this.fileExplorerIcon.parentElement&&this.fileExplorerIcon.remove(),!this.fileExplorerIcon){this.fileExplorerIcon=S(this),this.fileExplorerIcon.style.touchAction="manipulation";let r=!1;this.registerDomEvent(this.fileExplorerIcon,"touchstart",a=>{r=!0,a.preventDefault(),a.stopPropagation(),t(),setTimeout(()=>{r=!1},300)}),this.registerDomEvent(this.fileExplorerIcon,"click",a=>{if(r){a.preventDefault(),a.stopPropagation();return}a.preventDefault(),a.stopPropagation(),t()})}this.updateFileExplorerIcon(),F(this.fileExplorerIcon,l)}};s(),this.registerEvent(this.app.workspace.on("layout-change",()=>{this.settings.showFileExplorerIcon&&s()}))}updateFileExplorerIcon(){if(this.fileExplorerIcon){if(!this.settings.showFileExplorerIcon){this.fileExplorerIcon.parentElement&&this.fileExplorerIcon.remove();return}if(!this.fileExplorerIcon.parentElement){let t=this.app.workspace.getLeavesOfType("file-explorer");if(t.length>0){let s=t[0].view.containerEl,i=m(s);i&&F(this.fileExplorerIcon,i)}}this.fileExplorerIcon.style.cursor&&this.fileExplorerIcon.style.removeProperty("cursor"),this.isFocus?this.fileExplorerIcon.addClass("is-active"):this.fileExplorerIcon.removeClass("is-active")}}onunload(){this.fileExplorerIcon&&(this.fileExplorerIcon.remove(),this.fileExplorerIcon=null)}},G=f;
