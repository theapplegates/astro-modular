/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var g=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var M=(e,s)=>{for(var t in s)g(e,t,{get:s[t],enumerable:!0})},k=(e,s,t,o)=>{if(s&&typeof s=="object"||typeof s=="function")for(let n of T(s))!C.call(e,n)&&n!==t&&g(e,n,{get:()=>s[n],enumerable:!(o=A(s,n))||o.enumerable});return e};var H=e=>k(g({},"__esModule",{value:!0}),e);var R={};M(R,{SimpleFocusPlugin:()=>f,default:()=>V});module.exports=H(R);var I=require("obsidian");var O={focus:"Focus",enterFocus:"Enter focus",exitFocus:"Exit focus",toggleFocus:"Toggle focus",settings:"Simple Focus Settings",showRightClickMenu:"Show right-click menu option",showFileExplorerIcon:"Show file explorer icon",focusLevel:"Command focus level",focusLevelFile:"Current file only",focusLevelParent:"Parent folder",focusLevelGrandparent:"Grandparent folder",focusLevelGreatGrandparent:"Great grandparent folder",focusLevelCustom:"Specific folder",focusLevelDesc:"Determines what to focus when using the toggle command or file explorer icon. Right-click menu always focuses the clicked file/folder.",customFolderPath:"Custom folder path",customFolderPathDesc:"Enter a folder path (folder/subfolder). This folder will be focused regardless of which file is open.",hideAncestorFolders:"Hide ancestral indents",hideAncestorFoldersDesc:"When enabled, hides parent folder indentation when focusing, making the focused folder appear at root level."},E=O;var D={focus:"\u4E13\u6CE8",enterFocus:"\u4E13\u6CE8",exitFocus:"\u9000\u51FA\u4E13\u6CE8",toggleFocus:"\u5207\u6362\u4E13\u6CE8",settings:"\u7B80\u5355\u4E13\u6CE8\u8BBE\u7F6E",showRightClickMenu:"\u663E\u793A\u53F3\u952E\u83DC\u5355\u9009\u9879",showFileExplorerIcon:"\u663E\u793A\u6587\u4EF6\u6D4F\u89C8\u5668\u56FE\u6807",focusLevel:"\u547D\u4EE4\u4E13\u6CE8\u7EA7\u522B",focusLevelFile:"\u4EC5\u5F53\u524D\u6587\u4EF6",focusLevelParent:"\u7236\u6587\u4EF6\u5939",focusLevelGrandparent:"\u7956\u7236\u6587\u4EF6\u5939",focusLevelGreatGrandparent:"\u66FE\u7956\u7236\u6587\u4EF6\u5939",focusLevelCustom:"\u7279\u5B9A\u6587\u4EF6\u5939",focusLevelDesc:"\u786E\u5B9A\u4F7F\u7528\u5207\u6362\u547D\u4EE4\u6216\u6587\u4EF6\u6D4F\u89C8\u5668\u56FE\u6807\u65F6\u8981\u805A\u7126\u7684\u5185\u5BB9\u3002\u53F3\u952E\u83DC\u5355\u59CB\u7EC8\u805A\u7126\u5355\u51FB\u7684\u6587\u4EF6/\u6587\u4EF6\u5939\u3002",customFolderPath:"\u81EA\u5B9A\u4E49\u6587\u4EF6\u5939\u8DEF\u5F84",customFolderPathDesc:"\u8F93\u5165\u6587\u4EF6\u5939\u8DEF\u5F84\uFF08\u6587\u4EF6\u5939/\u5B50\u6587\u4EF6\u5939\uFF09\u3002\u65E0\u8BBA\u6253\u5F00\u54EA\u4E2A\u6587\u4EF6\uFF0C\u90FD\u4F1A\u805A\u7126\u6B64\u6587\u4EF6\u5939\u3002",hideAncestorFolders:"\u9690\u85CF\u7956\u5148\u7F29\u8FDB",hideAncestorFoldersDesc:"\u542F\u7528\u540E\uFF0C\u805A\u7126\u65F6\u9690\u85CF\u7236\u6587\u4EF6\u5939\u7F29\u8FDB\uFF0C\u4F7F\u805A\u7126\u7684\u6587\u4EF6\u5939\u663E\u793A\u5728\u6839\u7EA7\u522B\u3002"},x=D;var q={en:E,zh:x},v=q;var w={showRightClickMenu:!0,showFileExplorerIcon:!0,focusLevel:"parent",customFolderPath:"",hideAncestorFolders:!1};var u=require("obsidian");function b(e,s){let t=Object.keys(s).map(o=>N(e,o,s[o]));return t.length===1?t[0]:function(){t.forEach(o=>o())}}function N(e,s,t){let o=e[s],n=e.hasOwnProperty(s),i=n?o:function(){return Object.getPrototypeOf(e)[s].apply(this,arguments)},l=t(i);return o&&Object.setPrototypeOf(l,o),Object.setPrototypeOf(r,l),e[s]=r,a;function r(...d){return l===i&&e[s]===r&&a(),l.apply(this,d)}function a(){e[s]===r&&(n?e[s]=i:delete e[s]),l!==i&&(l=i,Object.setPrototypeOf(r,o||Function))}}var L=!1;function P(e){let s=G(e);if(s){if(!L){let t=e.app.workspace.getLeaf(!0);e.register(b(Object.getPrototypeOf(s),{getSortedFolderItems(o){return function(n){let i=o.call(this,n);if(e.isFocus&&e.focusedPath){let l=e.focusedPath;i=i.filter(r=>{let a=r.file.path;return a===l||a.startsWith(l+"/")||l.startsWith(a+"/")?(r.info.hidden=!1,!0):(r.info.hidden=!0,!1)})}else i.forEach(l=>{l.info.hidden=!1});return i}}})),t.detach(),L=!0}s.fileExplorerPlusPatched=!0}}function G(e){var t;let s=(t=e.app.workspace.getLeavesOfType("file-explorer"))==null?void 0:t.first();return s==null?void 0:s.view}function c(e){return e.app.workspace.getLeavesOfType("file-explorer").map(t=>t.view)}var p=class extends u.PluginSettingTab{constructor(t,o){super(t,o);this.plugin=o}display(){let{containerEl:t}=this;t.empty(),new u.Setting(t).setName(this.plugin.lang.showRightClickMenu).addToggle(n=>n.setValue(this.plugin.settings.showRightClickMenu).onChange(async i=>{this.plugin.settings.showRightClickMenu=i,await this.plugin.saveSettings()})),new u.Setting(t).setName(this.plugin.lang.showFileExplorerIcon).addToggle(n=>n.setValue(this.plugin.settings.showFileExplorerIcon).onChange(async i=>{this.plugin.settings.showFileExplorerIcon=i,await this.plugin.saveSettings(),this.plugin.updateFileExplorerIcon()}));let o=new u.Setting(t).setName(this.plugin.lang.focusLevel).setDesc(this.plugin.lang.focusLevelDesc).addDropdown(n=>n.addOption("file",this.plugin.lang.focusLevelFile).addOption("parent",this.plugin.lang.focusLevelParent).addOption("grandparent",this.plugin.lang.focusLevelGrandparent).addOption("greatgrandparent",this.plugin.lang.focusLevelGreatGrandparent).addOption("custom",this.plugin.lang.focusLevelCustom).setValue(this.plugin.settings.focusLevel).onChange(async i=>{this.plugin.settings.focusLevel=i,await this.plugin.saveSettings(),this.plugin.isFocus&&c(this.plugin).forEach(r=>{r!=null&&r.requestSort&&r.requestSort()}),this.display()}));this.plugin.settings.focusLevel==="custom"&&new u.Setting(t).setName(this.plugin.lang.customFolderPath).setDesc(this.plugin.lang.customFolderPathDesc).addText(n=>n.setPlaceholder("folder/subfolder").setValue(this.plugin.settings.customFolderPath).onChange(async i=>{this.plugin.settings.customFolderPath=i,await this.plugin.saveSettings()}))}};function h(e,s,t){if(s==="custom")return t.customFolderPath||e;if(s==="file")return e;let o=e.split("/");return s==="parent"?o.length===1?e:o.slice(0,-1).join("/"):s==="grandparent"?o.length<=2?o[0]||e:o.slice(0,-2).join("/"):o.length<=3?o[0]||e:o.slice(0,-3).join("/")}function S(e){e.addCommand({id:"simple-focus-toggle",name:e.lang.toggleFocus,callback:()=>{if(e.isFocus)e.exitFocus();else if(e.settings.focusLevel==="custom")e.settings.customFolderPath&&e.enterFocus(e.settings.customFolderPath);else{let s=e.app.workspace.getActiveFile();if(s!=null&&s.path){let t=h(s.path,e.settings.focusLevel,e.settings);e.enterFocus(t)}}}}),e.settings.showRightClickMenu&&e.registerEvent(e.app.workspace.on("file-menu",(s,t)=>{e.settings.showRightClickMenu&&s.addItem(o=>{o.setTitle(e.isFocus?e.lang.exitFocus:e.lang.focus).setIcon(e.isFocus?"log-out":"focus").onClick(async()=>{e.toggleFocus(t==null?void 0:t.path)})})}))}function m(e){var l;let s=e.querySelector(".nav-buttons-container");if(s||(s=e.querySelector(".nav-header-button-container"),s))return s;let t=e.querySelectorAll(".nav-action-button");if(t.length>0){let a=t[0].parentElement;if(a&&(a.classList.contains("nav-buttons-container")||a.classList.contains("nav-header-button-container")||Array.from(a.children).some(d=>d.classList.contains("nav-action-button"))))return a}let o=e.querySelector(".view-header");if(o){let r=o.querySelector(".nav-buttons-container")||o.querySelector(".nav-header-button-container")||o.querySelector(".view-header-title-container");return r||o}let n=e.querySelector(".nav-files-container");if(n){let r=e.querySelector(".simple-focus-mobile-buttons");return r||(r=document.createElement("div"),r.className="nav-buttons-container simple-focus-mobile-buttons",r.style.display="flex",r.style.alignItems="center",r.style.gap="4px",r.style.padding="8px",r.style.borderBottom="1px solid var(--background-modifier-border)",(l=n.parentElement)==null||l.insertBefore(r,n)),r}let i=e.querySelector(".simple-focus-mobile-buttons");return i||(i=document.createElement("div"),i.className="nav-buttons-container simple-focus-mobile-buttons",i.style.display="flex",i.style.alignItems="center",i.style.gap="4px",i.style.padding="8px",i.style.borderBottom="1px solid var(--background-modifier-border)",e.insertBefore(i,e.firstChild)),i}function y(e){let s=document.createElement("div");s.className="clickable-icon nav-action-button",s.setAttribute("aria-label",e.lang.toggleFocus);let t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("width","24"),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round"),t.setAttribute("class","svg-icon lucide-focus");let o=document.createElementNS("http://www.w3.org/2000/svg","circle");o.setAttribute("cx","12"),o.setAttribute("cy","12"),o.setAttribute("r","3"),t.appendChild(o);let n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M3 7V5a2 2 0 0 1 2-2h2"),t.appendChild(n);let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M17 3h2a2 2 0 0 1 2 2v2"),t.appendChild(i);let l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d","M21 17v2a2 2 0 0 1-2 2h-2"),t.appendChild(l);let r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d","M7 21H5a2 2 0 0 1-2-2v-2"),t.appendChild(r),s.appendChild(t),s}function F(e,s){if(s.contains(e))return;let o=Array.from(s.querySelectorAll(".clickable-icon.nav-action-button")).filter(i=>!i.classList.contains("cmdr")&&i!==e),n=Array.from(s.querySelectorAll(".cmdr"));if(n.length>0)s.insertBefore(e,n[0]);else if(o.length>0){let i=o[o.length-1];i.nextSibling?s.insertBefore(e,i.nextSibling):s.appendChild(e)}else s.appendChild(e)}var f=class extends I.Plugin{constructor(t,o){super(t,o);let i=window.localStorage.getItem("language")==="zh"?"zh":"en";this.lang=v[i],this.isFocus=!1,this.focusedPath=null,this.fileExplorerIcon=null}async onload(){await this.loadSettings(),this.addSettingTab(new p(this.app,this)),S(this),this.settings.showFileExplorerIcon&&this.addFileExplorerIcon(),this.app.workspace.onLayoutReady(()=>{this.patchAllFileExplorers(),this.updateFocusModeClasses()}),this.app.workspace.on("layout-change",()=>{this.patchAllFileExplorers(),this.updateFocusModeClasses()})}async loadSettings(){this.settings=Object.assign({},w,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}toggleFocus(t){this.isFocus?this.exitFocus():t&&this.enterFocus(t)}enterFocus(t){this.isFocus=!0,this.focusedPath=t,this.updateFileExplorerIcon(),this.updateFocusModeClasses(),c(this).forEach(n=>{n!=null&&n.requestSort&&n.requestSort()})}patchAllFileExplorers(){P(this),c(this).forEach(o=>{o.fileExplorerPlusPatched=!0})}exitFocus(){this.isFocus=!1,this.focusedPath=null,this.updateFileExplorerIcon(),this.updateFocusModeClasses(),c(this).forEach(o=>{o!=null&&o.requestSort&&o.requestSort()})}updateFocusModeClasses(){c(this).forEach(o=>{let n=o.containerEl;this.isFocus?n.addClass("simple-focus-mode"):n.removeClass("simple-focus-mode")})}addFileExplorerIcon(){let t=()=>{if(this.isFocus)this.exitFocus();else if(this.settings.focusLevel==="custom")this.settings.customFolderPath&&this.enterFocus(this.settings.customFolderPath);else{let n=this.app.workspace.getActiveFile();if(n!=null&&n.path){let i=h(n.path,this.settings.focusLevel,this.settings);this.enterFocus(i)}}},o=()=>{let n=this.app.workspace.getLeavesOfType("file-explorer");if(n.length===0)return;let i=n[0].view.containerEl,l=m(i);if(l&&!(this.fileExplorerIcon&&l.contains(this.fileExplorerIcon))){if(this.fileExplorerIcon&&this.fileExplorerIcon.parentElement&&this.fileExplorerIcon.remove(),!this.fileExplorerIcon){this.fileExplorerIcon=y(this),this.fileExplorerIcon.style.cursor="pointer",this.fileExplorerIcon.style.touchAction="manipulation";let r=!1;this.registerDomEvent(this.fileExplorerIcon,"touchstart",a=>{r=!0,a.preventDefault(),a.stopPropagation(),t(),setTimeout(()=>{r=!1},300)}),this.registerDomEvent(this.fileExplorerIcon,"click",a=>{if(r){a.preventDefault(),a.stopPropagation();return}a.preventDefault(),a.stopPropagation(),t()})}this.updateFileExplorerIcon(),F(this.fileExplorerIcon,l)}};o(),this.registerEvent(this.app.workspace.on("layout-change",()=>{this.settings.showFileExplorerIcon&&o()}))}updateFileExplorerIcon(){if(this.fileExplorerIcon){if(!this.settings.showFileExplorerIcon){this.fileExplorerIcon.parentElement&&this.fileExplorerIcon.remove();return}if(!this.fileExplorerIcon.parentElement){let t=this.app.workspace.getLeavesOfType("file-explorer");if(t.length>0){let o=t[0].view.containerEl,n=m(o);n&&F(this.fileExplorerIcon,n)}}this.isFocus?this.fileExplorerIcon.addClass("is-active"):this.fileExplorerIcon.removeClass("is-active")}}onunload(){this.fileExplorerIcon&&(this.fileExplorerIcon.remove(),this.fileExplorerIcon=null)}},V=f;
