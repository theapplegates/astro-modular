/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var dr=Object.create;var me=Object.defineProperty;var ur=Object.getOwnPropertyDescriptor;var hr=Object.getOwnPropertyNames;var gr=Object.getPrototypeOf,mr=Object.prototype.hasOwnProperty;var yr=(e,t)=>{for(var r in t)me(e,r,{get:t[r],enumerable:!0})},ht=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of hr(t))!mr.call(e,n)&&n!==r&&me(e,n,{get:()=>t[n],enumerable:!(i=ur(t,n))||i.enumerable});return e};var W=(e,t,r)=>(r=e!=null?dr(gr(e)):{},ht(t||!e||!e.__esModule?me(r,"default",{value:e,enumerable:!0}):r,e)),vr=e=>ht(me({},"__esModule",{value:!0}),e);var Wi={};yr(Wi,{default:()=>Ke});module.exports=vr(Wi);var cr=require("obsidian");var gt={projectRoot:"",configFilePath:"",contentTypes:[],frontmatterProperties:{},preset:"vanilla",enableWYSIWYG:!1,enabledPlugins:[],disabledPlugins:[],theme:"",basesCMSConfig:{views:[]},astroComposerConfig:{customContentTypes:[],defaultTemplate:"",configFilePath:"",terminalProjectRootPath:""},seoConfig:{titleProperty:"title",descriptionProperty:void 0,scanDirectories:"",useFilenameAsTitle:!1,useFilenameAsSlug:!0},commanderConfig:{pageHeaderCommands:[]},propertyOverFileName:{propertyKey:"title"},imageInserter:{valueFormat:"[[attachments/{image-url}]]",insertFormat:"[[attachments/{image-url}]]"},runWizardOnStartup:!0,wizardCompleted:!1};var ge=require("obsidian");var sr=require("obsidian");var S=class{constructor(t,r,i,n,a,o){this.app=t,this.containerEl=r,this.state=i,this.onNext=n,this.onBack=a,this.onCancel=o}};var ye=class extends S{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Welcome to Vault CMS Setup"}),t.createEl("p",{text:"This wizard will help you configure your Vault CMS setup. We'll guide you through:"});let r=t.createEl("ul");r.createEl("li",{text:"Detecting your Astro project structure"}),r.createEl("li",{text:"Identifying your content types"}),r.createEl("li",{text:"Mapping frontmatter properties"}),r.createEl("li",{text:"Configuring plugins and themes"}),r.createEl("li",{text:"Setting up Bases CMS views"}),r.createEl("li",{text:"Configuring Astro Composer and SEO plugins"}),t.createEl("p",{text:'Click "Next" to begin the setup process.'})}validate(){return!0}getTitle(){return"Welcome"}getDescription(){return"Introduction to Vault CMS setup"}};var V=require("obsidian"),F=W(require("path")),X=W(require("fs"));var E=W(require("path")),H=W(require("fs")),ve=class{constructor(t){this.app=t}async detectProject(){let r=this.app.vault.adapter,i=r.basePath||r.path;if(!i)return null;let n=await this.searchUpwardForConfig(i);if(!n)return null;let a=this.detectVaultLocation(i,n.projectRoot);return{projectRoot:n.projectRoot,configFilePath:n.configFilePath,vaultLocation:a}}async searchUpwardForConfig(t){let r=["astro.config.mjs","astro.config.ts","astro.config.js","astro.config.mts","astro.config.cjs"],i="src/config.ts",n=E.resolve(t),a=E.parse(n).root;for(;n!==a;){for(let l of r){let c=E.join(n,l);try{if(H.existsSync(c)&&H.statSync(c).isFile())return{projectRoot:n,configFilePath:c}}catch(p){}}let o=E.join(n,i);try{H.existsSync(o)&&H.statSync(o).isFile()}catch(l){}let s=E.dirname(n);if(s===n)break;n=s}for(n=E.resolve(t);n!==a;){let o=E.join(n,i);try{if(H.existsSync(o)&&H.statSync(o).isFile())return{projectRoot:n,configFilePath:o}}catch(l){}let s=E.dirname(n);if(s===n)break;n=s}return null}detectVaultLocation(t,r){let i=E.normalize(t),n=E.normalize(r);if(!i.startsWith(n))return"root";let o=E.relative(n,i).split(E.sep).filter(c=>c.length>0),s=o.findIndex(c=>c.toLowerCase()==="content");if(s>0){let c=s-1;if(c>=0&&o[c].toLowerCase()==="src")return"content"}let l=o.findIndex(c=>c.toLowerCase()==="src");return l>=0&&l<o.length-1&&o[l+1].toLowerCase()==="content"?"nested-content":"root"}};var Ce=class extends S{constructor(r,i,n,a,o,s){super(r,i,n,a,o,s);this.detected=!1;this.projectRootDisplay=null;this.configFileDisplay=null;this.projectDetector=new ve(r)}async display(){var n,a;let{containerEl:r}=this;r.empty();let i=((n=this.state.projectDetection)==null?void 0:n.projectRoot)&&((a=this.state.projectDetection)==null?void 0:a.configFilePath);if(i)this.detected=!0;else{r.createEl("h2",{text:"Project Detection"}),r.createEl("p",{text:"Detecting your Astro project structure..."});let o=await this.projectDetector.detectProject();if(o){let s=this.toRelativePath(o.projectRoot),l=this.toRelativePath(o.configFilePath);this.state.projectDetection={projectRoot:s,configFilePath:l,vaultLocation:o.vaultLocation},this.detected=!0}else this.detected=!1}if(this.state.projectDetection&&(this.detected||i)){await new Promise(l=>setTimeout(l,500)),r.empty(),r.createEl("h2",{text:"Project Detected"}),r.createEl("p",{text:'Project structure detected successfully. You can modify the paths below if needed, then click "Next" to continue.'});let o=new V.Setting(r).setName("Project Root").setDesc("Select the folder containing your Astro project root");this.projectRootDisplay=o.descEl.createDiv({text:this.state.projectDetection.projectRoot||"No folder selected",cls:"vault-cms-path-display"}),this.projectRootDisplay.style.color="var(--text-normal)",o.addButton(l=>l.setButtonText("Browse...").setCta().onClick(async()=>{let c=await this.selectFolder();c&&(this.state.projectDetection.projectRoot=c,this.projectRootDisplay&&(this.projectRootDisplay.textContent=c,this.projectRootDisplay.style.color="var(--text-normal)"),this.detected=!1)}));let s=new V.Setting(r).setName("Config File").setDesc("Select your Astro config file (astro.config.mjs, astro.config.js, src/config.ts, etc.)");this.configFileDisplay=s.descEl.createDiv({text:this.state.projectDetection.configFilePath||"No file selected",cls:"vault-cms-path-display"}),this.configFileDisplay.style.color="var(--text-normal)",s.addButton(l=>l.setButtonText("Browse...").setCta().onClick(async()=>{var d;let c=((d=this.state.projectDetection)==null?void 0:d.projectRoot)||this.getVaultPath(),p=await this.selectConfigFile(c);p&&(this.state.projectDetection.configFilePath=p,this.configFileDisplay&&(this.configFileDisplay.textContent=p,this.configFileDisplay.style.color="var(--text-normal)"),this.detected=!1)}))}else{r.empty(),r.createEl("h2",{text:"Project Detection Failed"}),r.createEl("p",{text:"Could not detect Astro project structure. Please select your Astro project root and config file manually."}),this.state.projectDetection||(this.state.projectDetection={projectRoot:"",configFilePath:"",vaultLocation:"root"});let o=new V.Setting(r).setName("Project Root").setDesc("Select the folder containing your Astro project root");this.projectRootDisplay=o.descEl.createDiv({text:this.state.projectDetection.projectRoot||"No folder selected",cls:"vault-cms-path-display"}),this.state.projectDetection.projectRoot?this.projectRootDisplay.style.color="var(--text-normal)":this.projectRootDisplay.style.color="var(--text-muted)",o.addButton(l=>l.setButtonText("Browse...").setCta().onClick(async()=>{let c=await this.selectFolder();c&&(this.state.projectDetection.projectRoot=c,this.projectRootDisplay&&(this.projectRootDisplay.textContent=c,this.projectRootDisplay.style.color="var(--text-normal)"))}));let s=new V.Setting(r).setName("Config File").setDesc("Select your Astro config file (astro.config.mjs, astro.config.js, src/config.ts, etc.)");this.configFileDisplay=s.descEl.createDiv({text:this.state.projectDetection.configFilePath||"No file selected",cls:"vault-cms-path-display"}),this.state.projectDetection.configFilePath?this.configFileDisplay.style.color="var(--text-normal)":this.configFileDisplay.style.color="var(--text-muted)",s.addButton(l=>l.setButtonText("Browse...").setCta().onClick(async()=>{var d;let c=((d=this.state.projectDetection)==null?void 0:d.projectRoot)||this.getVaultPath(),p=await this.selectConfigFile(c);p&&(this.state.projectDetection.configFilePath=p,this.configFileDisplay&&(this.configFileDisplay.textContent=p,this.configFileDisplay.style.color="var(--text-normal)"))}))}}async selectFolder(){var r,i,n;try{let a=null;try{let c=require("@electron/remote");a=c==null?void 0:c.dialog}catch(c){}if(!a)try{let c=((r=window.require)==null?void 0:r.call(window,"electron"))||require("electron");a=(i=c==null?void 0:c.remote)==null?void 0:i.dialog}catch(c){}if(!a)try{let c=require("electron");a=c==null?void 0:c.dialog}catch(c){}if(!a||typeof a.showOpenDialogSync!="function")throw new Error("Electron dialog API not available");let o=this.getVaultPath(),s=((n=this.state.projectDetection)==null?void 0:n.projectRoot)||o;s&&!F.isAbsolute(s)&&(s=F.resolve(o,s));let l=a.showOpenDialogSync({title:"Select Astro Project Root Folder",defaultPath:s,properties:["openDirectory"]});if(l&&l.length>0){let c=F.normalize(l[0]);return this.toRelativePath(c)}}catch(a){console.error("Error opening folder picker:",a),new V.Notice("Unable to open folder picker. Please ensure you are using Obsidian on desktop.")}return null}async selectConfigFile(r){var i,n,a;try{let o=null;try{let p=require("@electron/remote");o=p==null?void 0:p.dialog}catch(p){}if(!o)try{let p=((i=window.require)==null?void 0:i.call(window,"electron"))||require("electron");o=(n=p==null?void 0:p.remote)==null?void 0:n.dialog}catch(p){}if(!o)try{let p=require("electron");o=p==null?void 0:p.dialog}catch(p){}if(!o||typeof o.showOpenDialogSync!="function")throw new Error("Electron dialog API not available");let s=this.getVaultPath(),l=r||s;if(!r&&((a=this.state.projectDetection)!=null&&a.configFilePath)){let p=this.state.projectDetection.configFilePath;F.isAbsolute(p)?l=F.dirname(p):l=F.dirname(F.resolve(s,p))}else r&&!F.isAbsolute(r)?(l=F.resolve(s,r),F.extname(l)&&(l=F.dirname(l))):r&&F.isAbsolute(r)&&(F.extname(r)?l=F.dirname(r):l=r);let c=o.showOpenDialogSync({title:"Select Astro Config File",defaultPath:l,filters:[{name:"Astro Config Files",extensions:["ts","mjs","js","mts","cjs"]},{name:"All Files",extensions:["*"]}],properties:["openFile"]});if(c&&c.length>0){let p=F.normalize(c[0]);return this.toRelativePath(p)}}catch(o){console.error("Error opening file picker:",o),new V.Notice("Unable to open file picker. Please ensure you are using Obsidian on desktop.")}return null}getVaultPath(){let r=this.app.vault.adapter,i=r.basePath||r.path;return i?F.resolve(i):process.cwd()}toRelativePath(r){let i=this.app.vault.adapter,n=i.basePath||i.path;if(!n)return r;let a=F.normalize(n),o=F.normalize(r);if(o.startsWith(a)){let s=o.slice(a.length);return s.startsWith(F.sep)?s.slice(1):s}try{return F.relative(a,o).split(F.sep).join("/")}catch(s){return r}}validate(){var n,a;if(this.detected)return!0;let r=(n=this.state.projectDetection)==null?void 0:n.projectRoot,i=(a=this.state.projectDetection)==null?void 0:a.configFilePath;if(!r||!i)return!1;try{let o=this.getVaultPath(),s=F.isAbsolute(r)?r:F.join(o,r),l=F.isAbsolute(i)?i:F.join(o,i);return!(!X.existsSync(s)||!X.statSync(s).isDirectory()||!X.existsSync(l)||!X.statSync(l).isFile())}catch(o){return!1}}getTitle(){return"Project Detection"}getDescription(){return"Detect Astro project structure"}};var O=require("obsidian"),te=W(require("path"));var Z=require("obsidian"),_=W(require("path")),be=W(require("fs")),Pe=class{constructor(t){this.app=t}async detectContentTypes(t){let r=await this.findContentDirectory(t);if(!r)return this.detectContentTypesFromVaultRoot();let i=[],n=this.getTopLevelFolders(r);for(let a of n){let o=this.detectContentType(a);o&&i.push(o)}return i}async findContentDirectory(t){if(!t||!t.projectRoot)return null;let r=this.app.vault,i=r.adapter,n=i.basePath||i.path;if(!n)return null;let a;_.isAbsolute(t.projectRoot)?a=t.projectRoot:a=_.resolve(n,t.projectRoot);let o=_.join(a,"src","content");if(!be.existsSync(o)||!be.statSync(o).isDirectory())return null;let s=r.getRoot();if(!(s instanceof Z.TFolder))return null;let l=_.normalize(n),c=_.normalize(o);if(c.startsWith(l)){let d=_.relative(l,c).split(_.sep).filter(u=>u.length>0);if(d.length===0)return s;let f=s;for(let u of d){if(!f.children)return null;let h=f.children.find(g=>g instanceof Z.TFolder&&g.name===u);if(!(h instanceof Z.TFolder))return null;f=h}return f}return null}detectContentTypesFromVaultRoot(){let r=this.app.vault.getRoot();if(!(r instanceof Z.TFolder))return[];let i=[],n=this.getTopLevelFolders(r);for(let a of n){let o=this.detectContentType(a);o&&i.push(o)}return i}getTopLevelFolders(t){let r=[];if(!t.children)return r;for(let i of t.children)i instanceof Z.TFolder&&!i.name.startsWith(".")&&i.name!=="bases"&&i.name!=="_bases"&&i.name!=="node_modules"&&i.name!==".obsidian"&&r.push(i);return r}detectContentType(t){let r=t.name.toLowerCase(),i;return r==="posts"||r==="post"||r==="blog"?i="Posts":r==="pages"||r==="page"?i="Pages":i=this.capitalizeFirst(t.name),{id:`content-type-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:i,folder:t.name,fileOrganization:"file",enabled:!0,indexFileName:"index"}}capitalizeFirst(t){return t.charAt(0).toUpperCase()+t.slice(1)}};var Je=require("obsidian"),K=W(require("path"));var B=W(require("path")),$=class{constructor(t){this.app=t}getFolderPathFromVaultRoot(t,r){if(!r||!r.projectRoot)return t;let i=this.app.vault.adapter,n=i.basePath||i.path;if(!n)return t;let a=B.isAbsolute(r.projectRoot)?r.projectRoot:B.resolve(n,r.projectRoot),o=B.join(a,"src","content",t),s=B.normalize(n),l=B.normalize(o);return l.startsWith(s)?B.relative(s,l).split(B.sep).join("/"):t}getFolderPathFromProjectRoot(t){return`src/content/${t}`}getAstroComposerFolderPath(t,r){return this.getFolderPathFromVaultRoot(t,r)}getBasesCMSFolderPath(t,r){return this.getFolderPathFromVaultRoot(t,r)}};var ee=class{constructor(t){this.app=t,this.pathResolver=new $(t)}async configureAstroComposer(t,r,i,n,a,o){this.frontmatterProperties=r,this.contentTypes=t;let s={customContentTypes:[],defaultTemplate:"",configFilePath:this.relativePath(n),terminalProjectRootPath:this.relativePath(i)},l=t.find(f=>f.name==="Posts"&&f.enabled),c=t.find(f=>f.name==="Pages"&&f.enabled);if(l){let f=r[l.id];s.postsFolder=this.pathResolver.getAstroComposerFolderPath(l.folder,o),s.postsCreationMode=l.fileOrganization,s.postsIndexFileName=l.indexFileName||"index",s.defaultTemplate=(f==null?void 0:f.template)||this.generateTemplate(f,!0)}if(c){let f=r[c.id];s.enablePages=!0,s.pagesFolder=this.pathResolver.getAstroComposerFolderPath(c.folder,o),s.pagesCreationMode=c.fileOrganization,s.pagesIndexFileName=c.indexFileName||"index",s.pageTemplate=(f==null?void 0:f.template)||this.generateTemplate(f,!1)}let p=a?t.find(f=>f.id===a&&f.enabled):null,d=t.filter(f=>f.enabled&&(!a||f.id!==a));if(p){let f=r[p.id],u=p.linkBasePath;(u===void 0||u==="")&&(u=`/${p.folder}/`);let h=this.pathResolver.getAstroComposerFolderPath(p.folder,o);s.customContentTypes.push({id:p.id,name:p.name,folder:h,template:(f==null?void 0:f.template)||this.generateTemplate(f,p.name==="Posts"||p.name==="Pages"),enabled:!0,linkBasePath:u,creationMode:p.fileOrganization,indexFileName:p.indexFileName||"index"})}for(let f of d){let u=r[f.id],h=f.linkBasePath;(h===void 0||h==="")&&(h=`/${f.folder}/`);let g=this.pathResolver.getAstroComposerFolderPath(f.folder,o);s.customContentTypes.push({id:f.id,name:f.name,folder:g,template:(u==null?void 0:u.template)||this.generateTemplate(u,f.name==="Posts"||f.name==="Pages"),enabled:!0,linkBasePath:h,creationMode:f.fileOrganization,indexFileName:f.indexFileName||"index"})}return s}generateTemplate(t,r){if(t!=null&&t.template)return t.template;if(!t)return`---
title: "{{title}}"
---
`;let i=`---
`;return i+=`${t.titleProperty}: "{{title}}"
`,r&&(i+=`${t.dateProperty}: {{date}}
`),t.descriptionProperty&&(i+=`${t.descriptionProperty}: ""
`),i+=`tags: []
`,i+=`draft: true
`,i+=`---
`,i}getCreationModeFromAttachmentHandling(t){return t==="same-folder"?"folder":"file"}relativePath(t){if(!K.isAbsolute(t))return t;let r=this.app.vault.adapter,i=r.basePath||r.path;if(!i)return t;let n=K.normalize(i),a=K.normalize(t);if(a.startsWith(n)){let o=a.slice(n.length);return o.startsWith(K.sep)?o.slice(1):o}return t}async saveConfig(t){var r,i;try{let n=this.app.plugins,a=(r=n==null?void 0:n.plugins)==null?void 0:r["astro-composer"];if(!a){console.warn("AstroComposerConfig: Astro Composer plugin not found, using fallback file method"),await this.saveConfigFallback(t);return}if(!a.settings){console.warn("AstroComposerConfig: Astro Composer plugin settings not available, using fallback file method"),await this.saveConfigFallback(t);return}let o=a.settings;t.defaultTemplate&&(o.defaultTemplate=t.defaultTemplate),t.pageTemplate&&(o.pageTemplate=t.pageTemplate),t.postsFolder&&(o.postsFolder=t.postsFolder),t.postsCreationMode&&(o.creationMode=t.postsCreationMode),t.postsIndexFileName&&(o.indexFileName=t.postsIndexFileName),t.enablePages!==void 0&&(o.enablePages=t.enablePages),t.pagesFolder&&(o.pagesFolder=t.pagesFolder),t.pagesCreationMode&&(o.pagesCreationMode=t.pagesCreationMode),t.pagesIndexFileName&&(o.pagesIndexFileName=t.pagesIndexFileName),t.configFilePath&&(o.configFilePath=t.configFilePath),t.terminalProjectRootPath&&(o.terminalProjectRootPath=t.terminalProjectRootPath),Array.isArray(o.contentTypes)||(o.contentTypes=[]);for(let s of t.customContentTypes){let l=(i=this.contentTypes)==null?void 0:i.find(f=>f.id===s.id),c=l&&this.frontmatterProperties?this.frontmatterProperties[l.id]:void 0,p=(c==null?void 0:c.hasDraftStatus)===!0&&!(c!=null&&c.draftProperty),d=o.contentTypes.findIndex(f=>f.name===s.name&&f.folder===s.folder);d>=0?o.contentTypes[d]={...o.contentTypes[d],name:s.name,folder:s.folder,linkBasePath:s.linkBasePath,template:s.template,enabled:s.enabled,creationMode:s.creationMode,indexFileName:s.indexFileName,enableUnderscorePrefix:p}:o.contentTypes.push({id:s.id,name:s.name,folder:s.folder,linkBasePath:s.linkBasePath,template:s.template,enabled:s.enabled,creationMode:s.creationMode,indexFileName:s.indexFileName,ignoreSubfolders:!1,enableUnderscorePrefix:p})}o.customContentTypes=this.mergeCustomContentTypes(o.customContentTypes||[],t.customContentTypes||[]),typeof a.saveSettings=="function"?(await a.saveSettings(),console.log("AstroComposerConfig: Successfully saved via plugin.saveSettings()")):(console.warn("AstroComposerConfig: Plugin saveSettings not available, using fallback"),await this.saveConfigFallback(t))}catch(n){console.error("Failed to save Astro Composer config via plugin method:",n),await this.saveConfigFallback(t)}}async saveConfigFallback(t){var o;let r="astro-composer",i=`.obsidian/plugins/${r}/data.json`,n={},a=this.app.vault.getAbstractFileByPath(i);if(a&&a instanceof Je.TFile)try{n=JSON.parse(await this.app.vault.read(a))}catch(s){console.warn("Failed to parse existing Astro Composer data.json, starting fresh:",s),n={}}t.defaultTemplate&&(n.defaultTemplate=t.defaultTemplate),t.pageTemplate&&(n.pageTemplate=t.pageTemplate),t.postsFolder&&(n.postsFolder=t.postsFolder),t.postsCreationMode&&(n.creationMode=t.postsCreationMode),t.postsIndexFileName&&(n.indexFileName=t.postsIndexFileName),t.enablePages!==void 0&&(n.enablePages=t.enablePages),t.pagesFolder&&(n.pagesFolder=t.pagesFolder),t.pagesCreationMode&&(n.pagesCreationMode=t.pagesCreationMode),t.pagesIndexFileName&&(n.pagesIndexFileName=t.pagesIndexFileName),t.configFilePath&&(n.configFilePath=t.configFilePath),t.terminalProjectRootPath&&(n.terminalProjectRootPath=t.terminalProjectRootPath),Array.isArray(n.contentTypes)||(n.contentTypes=[]);for(let s of t.customContentTypes){let l=(o=this.contentTypes)==null?void 0:o.find(f=>f.id===s.id),c=l&&this.frontmatterProperties?this.frontmatterProperties[l.id]:void 0,p=(c==null?void 0:c.hasDraftStatus)===!0&&!(c!=null&&c.draftProperty),d=n.contentTypes.findIndex(f=>f.name===s.name&&f.folder===s.folder);d>=0?n.contentTypes[d]={...n.contentTypes[d],name:s.name,folder:s.folder,linkBasePath:s.linkBasePath,template:s.template,enabled:s.enabled,creationMode:s.creationMode,indexFileName:s.indexFileName,enableUnderscorePrefix:p}:n.contentTypes.push({id:s.id,name:s.name,folder:s.folder,linkBasePath:s.linkBasePath,template:s.template,enabled:s.enabled,creationMode:s.creationMode,indexFileName:s.indexFileName,ignoreSubfolders:!1,enableUnderscorePrefix:p})}if(n.customContentTypes=this.mergeCustomContentTypes(n.customContentTypes||[],t.customContentTypes||[]),a&&a instanceof Je.TFile)await this.app.vault.modify(a,JSON.stringify(n,null,2));else{let s=`.obsidian/plugins/${r}`;this.app.vault.getAbstractFileByPath(s)||await this.app.vault.createFolder(s),await this.app.vault.create(i,JSON.stringify(n,null,2))}}mergeCustomContentTypes(t,r){let i=[...t];for(let n of r){let a=i.findIndex(o=>o.id===n.id);a>=0?i[a]={...i[a],...n}:i.push(n)}return i}};var Qe=class extends O.AbstractInputSuggest{constructor(r,i,n){super(r,i);this.inputEl=i,this.mode=n}getSuggestions(r){let i=[],n=r.toLowerCase();if(this.mode==="subfolder"){"attachments".toLowerCase().includes(n)&&i.push("attachments");let a=this.app.vault.getAllLoadedFiles(),o=new Set;for(let s of a)if(s instanceof O.TFolder){let l=s.name;l.toLowerCase().includes(n)&&l!=="attachments"&&o.add(l)}i.push(...Array.from(o).slice(0,10))}else{let a=this.app.vault.getAllLoadedFiles(),o=new Set;for(let s of a)if(s instanceof O.TFolder){let l=s.path;l.toLowerCase().includes(n)&&o.add(l)}i.push(...Array.from(o).slice(0,10))}return i}renderSuggestion(r,i){i.setText(r)}selectSuggestion(r){this.inputEl.value=r,this.inputEl.trigger("input"),this.close()}},xe=class extends S{constructor(r,i,n,a,o,s){super(r,i,n,a,o,s);this.detected=!1;this.contentTypeDetector=new Pe(r),this.astroComposerConfigurator=new ee(r)}async importFromAstroComposer(){var r;try{let i=this.app.plugins;if(console.log("ContentTypeStep: Checking plugins API:",!!i),i){let c=(r=i.plugins)==null?void 0:r["astro-composer"];if(console.log("ContentTypeStep: Astro Composer plugin found:",!!c),c&&(console.log("ContentTypeStep: Plugin settings available:",!!c.settings),console.log("ContentTypeStep: Plugin settings keys:",c.settings?Object.keys(c.settings):"none"),c.settings)){let p=c.settings.contentTypes;if(console.log("ContentTypeStep: contentTypes from plugin:",p?`Array with ${p.length} items`:"not found"),Array.isArray(p)&&p.length>0)return console.log("ContentTypeStep: Importing",p.length,"content types from Astro Composer (via plugin API)"),p.map(f=>({id:f.id||`content-type-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:f.name||this.capitalizeFirst(f.folder),folder:f.folder,fileOrganization:f.creationMode==="folder"?"folder":"file",indexFileName:f.indexFileName||"index",linkBasePath:f.linkBasePath,enabled:f.enabled!==!1}))}}let n=".obsidian/plugins/astro-composer/data.json";console.log("ContentTypeStep: Trying to read file:",n);let a=this.app.vault.getAbstractFileByPath(n);if(console.log("ContentTypeStep: File found:",!!a,a?`Type: ${a.constructor.name}`:"not found"),!a||!(a instanceof O.TFile)){let c=[".obsidian/plugins/astro-composer/data.json","obsidian/plugins/astro-composer/data.json",".obsidian/plugins/astro-composer/data.json"];for(let p of c){let d=this.app.vault.getAbstractFileByPath(p);if(d&&d instanceof O.TFile){console.log("ContentTypeStep: Found file at alternative path:",p);let f=await this.app.vault.read(d),u=JSON.parse(f);if(u.contentTypes&&Array.isArray(u.contentTypes))return console.log("ContentTypeStep: Importing",u.contentTypes.length,"content types from Astro Composer (via file at",p,")"),u.contentTypes.map(g=>({id:g.id||`content-type-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:g.name||this.capitalizeFirst(g.folder),folder:g.folder,fileOrganization:g.creationMode==="folder"?"folder":"file",indexFileName:g.indexFileName||"index",linkBasePath:g.linkBasePath,enabled:g.enabled!==!1}))}}return console.log("ContentTypeStep: No Astro Composer data.json found, will scan folders"),[]}let o=await this.app.vault.read(a),s=JSON.parse(o);return!s.contentTypes||!Array.isArray(s.contentTypes)?(console.log("ContentTypeStep: Astro Composer data.json has no contentTypes array. Data keys:",Object.keys(s)),[]):(console.log("ContentTypeStep: Importing",s.contentTypes.length,"content types from Astro Composer (via file)"),s.contentTypes.map(c=>({id:c.id||`content-type-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:c.name||this.capitalizeFirst(c.folder),folder:c.folder,fileOrganization:c.creationMode==="folder"?"folder":"file",indexFileName:c.indexFileName||"index",linkBasePath:c.linkBasePath,enabled:c.enabled!==!1})))}catch(i){return console.error("ContentTypeStep: Failed to import from Astro Composer:",i),[]}}async display(){let{containerEl:r}=this,i=r.querySelector(".content-type-step-content");if(i?i.empty():(r.empty(),i=r.createDiv({cls:"content-type-step-content"})),i.createEl("h2",{text:"Content Types"}),i.createEl("p",{text:"Detecting content types in your vault..."}),!this.detected){let a=this.state.contentTypes||[],o=new Map(a.map(y=>[y.folder,y])),s=await this.importFromAstroComposer(),l=await this.contentTypeDetector.detectContentTypes(this.state.projectDetection),c=new Set(s.map(y=>y.folder)),p=l.filter(y=>!c.has(y.folder)),d=[...s,...p],f=new Map(d.map(y=>[y.folder,y])),u=[],h=new Set,g=new Set([...a.map(y=>y.folder),...d.map(y=>y.folder)]);for(let y of g){if(h.has(y))continue;let x=o.get(y),P=f.get(y);x?P?u.push({...x,folder:x.folder,name:x.name||P.name}):u.push(x):P&&u.push(P),h.add(y)}u.sort((y,x)=>y.name.localeCompare(x.name)),this.state.contentTypes=u,this.detected=!0}if(i.empty(),i.createEl("h2",{text:"Content Types"}),i.createEl("p",{text:"Select and configure your content types:"}),i.createEl("h3",{text:"Attachment Handling",cls:"vault-cms-section-header"}),i.createEl("p",{text:"How should attachments be stored globally?",cls:"vault-cms-section-desc"}),new O.Setting(i).setName("How are attachments handled?").setDesc("Choose how attachments are stored for all content types").addDropdown(a=>a.addOption("same-folder","Same folder as current file").addOption("specified-folder","In the specified folder").addOption("subfolder","In subfolder under current folder").setValue(this.state.attachmentHandlingMode||"subfolder").onChange(o=>{this.state.attachmentHandlingMode=o,o==="same-folder"&&(this.state.attachmentFolderName=void 0),this.display()})),this.state.attachmentHandlingMode==="specified-folder"||this.state.attachmentHandlingMode==="subfolder"){let a=this.state.attachmentHandlingMode==="specified-folder"?'Enter the exact path to the folder for attachments (e.g., "attachments" or "images/attachments"). Leave blank to use "attachments" as default.':'Enter the name of the subfolder for attachments (e.g., "attachments"). Leave blank to use "attachments" as default.';new O.Setting(i).setName("Attachment Folder").setDesc(a).addText(s=>{s.setPlaceholder("attachments").setValue(this.state.attachmentFolderName||"").onChange(l=>{this.state.attachmentFolderName=l||void 0}),this.state.attachmentHandlingMode!=="same-folder"&&new Qe(this.app,s.inputEl,this.state.attachmentHandlingMode)})}i.createEl("hr",{cls:"vault-cms-divider"}),i.createEl("h3",{text:"Content Types",cls:"vault-cms-section-header"});for(let a of this.state.contentTypes){let o=new O.Setting(i).setName(a.name).setDesc(`Folder: ${a.folder}`).addToggle(l=>l.setValue(a.enabled).onChange(c=>{a.enabled=c}));new O.Setting(i).setName(`${a.name} - File Organization`).setDesc("Choose how content is organized for this content type").addDropdown(l=>l.addOption("file","File-based").addOption("folder","Folder-based").setValue(a.fileOrganization||"file").onChange(c=>{a.fileOrganization=c,this.display()})),a.fileOrganization==="folder"&&new O.Setting(i).setName(`${a.name} - Index File Name`).setDesc("Name of the index file in folder-based organization").addText(l=>l.setValue(a.indexFileName||"index").onChange(c=>{a.indexFileName=c||"index"}));let s=`/${a.folder}/`;new O.Setting(i).setName(`${a.name} - Link Base Path`).setDesc(`URL path for this content type (e.g., "/posts/" or "/" for root). Leave blank to use default: ${s}`).addText(l=>l.setPlaceholder(s).setValue(a.linkBasePath||"").onChange(c=>{a.linkBasePath=c||void 0}))}let n=i.createEl("button",{text:"Add Additional Content Type",cls:"mod-cta"});n.style.marginTop="20px",n.style.marginBottom="30px",n.addEventListener("click",async()=>{let a=await this.selectContentTypeFolder();if(a){let o=te.basename(a),s={id:`content-type-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:this.capitalizeFirst(o),folder:o,fileOrganization:"file",enabled:!1,indexFileName:"index"};this.state.contentTypes.push(s),this.display()}})}async selectContentTypeFolder(){var r,i;try{let n=null;try{let s=require("@electron/remote");n=s==null?void 0:s.dialog}catch(s){}if(!n)try{let s=((r=window.require)==null?void 0:r.call(window,"electron"))||require("electron");n=(i=s==null?void 0:s.remote)==null?void 0:i.dialog}catch(s){}if(!n)try{let s=require("electron");n=s==null?void 0:s.dialog}catch(s){}if(!n||typeof n.showOpenDialogSync!="function")throw new Error("Electron dialog API not available");let a=this.getVaultPath(),o=n.showOpenDialogSync({title:"Select Content Type Folder",defaultPath:a,properties:["openDirectory"]});if(o&&o.length>0)return te.normalize(o[0])}catch(n){console.error("Error opening folder picker:",n),new O.Notice("Unable to open folder picker. Please ensure you are using Obsidian on desktop.")}return null}getVaultPath(){let r=this.app.vault.adapter,i=r.basePath||r.path;return i?te.resolve(i):process.cwd()}capitalizeFirst(r){return r.charAt(0).toUpperCase()+r.slice(1)}validate(){return this.state.contentTypes.some(r=>r.enabled)}getTitle(){return"Content Types"}getDescription(){return"Configure content types"}};var mt=require("obsidian");var Fe=class extends S{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Default Content Type"}),t.createEl("p",{text:"Select which content type should be used as the default. This will:"});let r=t.createEl("ul");r.createEl("li",{text:"Set as the default Bases CMS view"}),r.createEl("li",{text:`Configure Obsidian's "Default location for new notes" to that folder`});let i=this.state.contentTypes.filter(a=>a.enabled);if(i.length===0){t.createEl("p",{text:"No enabled content types found. Please go back and enable at least one content type."});return}(!this.state.defaultContentTypeId||i.findIndex(a=>a.id===this.state.defaultContentTypeId)===-1)&&(this.state.defaultContentTypeId=i[0].id);let n=this.state.defaultContentTypeId;new mt.Setting(t).setName("Default Content Type").setDesc("Choose the default content type for new notes").addDropdown(a=>{i.forEach(o=>{a.addOption(o.id,o.name)}),a.setValue(n),a.onChange(o=>{this.state.defaultContentTypeId=o})})}validate(){return!!this.state.defaultContentTypeId}getTitle(){return"Default Content Type"}getDescription(){return"Select default content type"}};var N=require("obsidian");var ae=require("obsidian");function kt(e){return typeof e=="undefined"||e===null}function Cr(e){return typeof e=="object"&&e!==null}function Pr(e){return Array.isArray(e)?e:kt(e)?[]:[e]}function br(e,t){var r,i,n,a;if(t)for(a=Object.keys(t),r=0,i=a.length;r<i;r+=1)n=a[r],e[n]=t[n];return e}function xr(e,t){var r="",i;for(i=0;i<t;i+=1)r+=e;return r}function Fr(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var wr=kt,Sr=Cr,Tr=Pr,Ar=xr,Er=Fr,Dr=br,D={isNothing:wr,isObject:Sr,toArray:Tr,repeat:Ar,isNegativeZero:Er,extend:Dr};function It(e,t){var r="",i=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(r+='in "'+e.mark.name+'" '),r+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!t&&e.mark.snippet&&(r+=`

`+e.mark.snippet),i+" "+r):i}function ce(e,t){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=t,this.message=It(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}ce.prototype=Object.create(Error.prototype);ce.prototype.constructor=ce;ce.prototype.toString=function(t){return this.name+": "+It(this,t)};var M=ce;function Xe(e,t,r,i,n){var a="",o="",s=Math.floor(n/2)-1;return i-t>s&&(a=" ... ",t=i-s+a.length),r-i>s&&(o=" ...",r=i+s-o.length),{str:a+e.slice(t,r).replace(/\t/g,"\u2192")+o,pos:i-t+a.length}}function Ze(e,t){return D.repeat(" ",t-e.length)+e}function Nr(e,t){if(t=Object.create(t||null),!e.buffer)return null;t.maxLength||(t.maxLength=79),typeof t.indent!="number"&&(t.indent=1),typeof t.linesBefore!="number"&&(t.linesBefore=3),typeof t.linesAfter!="number"&&(t.linesAfter=2);for(var r=/\r?\n|\r|\0/g,i=[0],n=[],a,o=-1;a=r.exec(e.buffer);)n.push(a.index),i.push(a.index+a[0].length),e.position<=a.index&&o<0&&(o=i.length-2);o<0&&(o=i.length-1);var s="",l,c,p=Math.min(e.line+t.linesAfter,n.length).toString().length,d=t.maxLength-(t.indent+p+3);for(l=1;l<=t.linesBefore&&!(o-l<0);l++)c=Xe(e.buffer,i[o-l],n[o-l],e.position-(i[o]-i[o-l]),d),s=D.repeat(" ",t.indent)+Ze((e.line-l+1).toString(),p)+" | "+c.str+`
`+s;for(c=Xe(e.buffer,i[o],n[o],e.position,d),s+=D.repeat(" ",t.indent)+Ze((e.line+1).toString(),p)+" | "+c.str+`
`,s+=D.repeat("-",t.indent+p+3+c.pos)+`^
`,l=1;l<=t.linesAfter&&!(o+l>=n.length);l++)c=Xe(e.buffer,i[o+l],n[o+l],e.position-(i[o]-i[o+l]),d),s+=D.repeat(" ",t.indent)+Ze((e.line+l+1).toString(),p)+" | "+c.str+`
`;return s.replace(/\n$/,"")}var Or=Nr,kr=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],Ir=["scalar","sequence","mapping"];function jr(e){var t={};return e!==null&&Object.keys(e).forEach(function(r){e[r].forEach(function(i){t[String(i)]=r})}),t}function Mr(e,t){if(t=t||{},Object.keys(t).forEach(function(r){if(kr.indexOf(r)===-1)throw new M('Unknown option "'+r+'" is met in definition of "'+e+'" YAML type.')}),this.options=t,this.tag=e,this.kind=t.kind||null,this.resolve=t.resolve||function(){return!0},this.construct=t.construct||function(r){return r},this.instanceOf=t.instanceOf||null,this.predicate=t.predicate||null,this.represent=t.represent||null,this.representName=t.representName||null,this.defaultStyle=t.defaultStyle||null,this.multi=t.multi||!1,this.styleAliases=jr(t.styleAliases||null),Ir.indexOf(this.kind)===-1)throw new M('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var I=Mr;function yt(e,t){var r=[];return e[t].forEach(function(i){var n=r.length;r.forEach(function(a,o){a.tag===i.tag&&a.kind===i.kind&&a.multi===i.multi&&(n=o)}),r[n]=i}),r}function Rr(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},t,r;function i(n){n.multi?(e.multi[n.kind].push(n),e.multi.fallback.push(n)):e[n.kind][n.tag]=e.fallback[n.tag]=n}for(t=0,r=arguments.length;t<r;t+=1)arguments[t].forEach(i);return e}function tt(e){return this.extend(e)}tt.prototype.extend=function(t){var r=[],i=[];if(t instanceof I)i.push(t);else if(Array.isArray(t))i=i.concat(t);else if(t&&(Array.isArray(t.implicit)||Array.isArray(t.explicit)))t.implicit&&(r=r.concat(t.implicit)),t.explicit&&(i=i.concat(t.explicit));else throw new M("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");r.forEach(function(a){if(!(a instanceof I))throw new M("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(a.loadKind&&a.loadKind!=="scalar")throw new M("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(a.multi)throw new M("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),i.forEach(function(a){if(!(a instanceof I))throw new M("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var n=Object.create(tt.prototype);return n.implicit=(this.implicit||[]).concat(r),n.explicit=(this.explicit||[]).concat(i),n.compiledImplicit=yt(n,"implicit"),n.compiledExplicit=yt(n,"explicit"),n.compiledTypeMap=Rr(n.compiledImplicit,n.compiledExplicit),n};var Lr=tt,_r=new I("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),Br=new I("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),$r=new I("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),zr=new Lr({explicit:[_r,Br,$r]});function Wr(e){if(e===null)return!0;var t=e.length;return t===1&&e==="~"||t===4&&(e==="null"||e==="Null"||e==="NULL")}function Yr(){return null}function Hr(e){return e===null}var Vr=new I("tag:yaml.org,2002:null",{kind:"scalar",resolve:Wr,construct:Yr,predicate:Hr,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function Ur(e){if(e===null)return!1;var t=e.length;return t===4&&(e==="true"||e==="True"||e==="TRUE")||t===5&&(e==="false"||e==="False"||e==="FALSE")}function Gr(e){return e==="true"||e==="True"||e==="TRUE"}function qr(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var Kr=new I("tag:yaml.org,2002:bool",{kind:"scalar",resolve:Ur,construct:Gr,predicate:qr,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function Jr(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function Qr(e){return 48<=e&&e<=55}function Xr(e){return 48<=e&&e<=57}function Zr(e){if(e===null)return!1;var t=e.length,r=0,i=!1,n;if(!t)return!1;if(n=e[r],(n==="-"||n==="+")&&(n=e[++r]),n==="0"){if(r+1===t)return!0;if(n=e[++r],n==="b"){for(r++;r<t;r++)if(n=e[r],n!=="_"){if(n!=="0"&&n!=="1")return!1;i=!0}return i&&n!=="_"}if(n==="x"){for(r++;r<t;r++)if(n=e[r],n!=="_"){if(!Jr(e.charCodeAt(r)))return!1;i=!0}return i&&n!=="_"}if(n==="o"){for(r++;r<t;r++)if(n=e[r],n!=="_"){if(!Qr(e.charCodeAt(r)))return!1;i=!0}return i&&n!=="_"}}if(n==="_")return!1;for(;r<t;r++)if(n=e[r],n!=="_"){if(!Xr(e.charCodeAt(r)))return!1;i=!0}return!(!i||n==="_")}function en(e){var t=e,r=1,i;if(t.indexOf("_")!==-1&&(t=t.replace(/_/g,"")),i=t[0],(i==="-"||i==="+")&&(i==="-"&&(r=-1),t=t.slice(1),i=t[0]),t==="0")return 0;if(i==="0"){if(t[1]==="b")return r*parseInt(t.slice(2),2);if(t[1]==="x")return r*parseInt(t.slice(2),16);if(t[1]==="o")return r*parseInt(t.slice(2),8)}return r*parseInt(t,10)}function tn(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!D.isNegativeZero(e)}var rn=new I("tag:yaml.org,2002:int",{kind:"scalar",resolve:Zr,construct:en,predicate:tn,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),nn=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function on(e){return!(e===null||!nn.test(e)||e[e.length-1]==="_")}function an(e){var t,r;return t=e.replace(/_/g,"").toLowerCase(),r=t[0]==="-"?-1:1,"+-".indexOf(t[0])>=0&&(t=t.slice(1)),t===".inf"?r===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t===".nan"?NaN:r*parseFloat(t,10)}var sn=/^[-+]?[0-9]+e/;function ln(e,t){var r;if(isNaN(e))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(D.isNegativeZero(e))return"-0.0";return r=e.toString(10),sn.test(r)?r.replace("e",".e"):r}function cn(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||D.isNegativeZero(e))}var pn=new I("tag:yaml.org,2002:float",{kind:"scalar",resolve:on,construct:an,predicate:cn,represent:ln,defaultStyle:"lowercase"}),fn=zr.extend({implicit:[Vr,Kr,rn,pn]}),dn=fn,jt=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Mt=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function un(e){return e===null?!1:jt.exec(e)!==null||Mt.exec(e)!==null}function hn(e){var t,r,i,n,a,o,s,l=0,c=null,p,d,f;if(t=jt.exec(e),t===null&&(t=Mt.exec(e)),t===null)throw new Error("Date resolve error");if(r=+t[1],i=+t[2]-1,n=+t[3],!t[4])return new Date(Date.UTC(r,i,n));if(a=+t[4],o=+t[5],s=+t[6],t[7]){for(l=t[7].slice(0,3);l.length<3;)l+="0";l=+l}return t[9]&&(p=+t[10],d=+(t[11]||0),c=(p*60+d)*6e4,t[9]==="-"&&(c=-c)),f=new Date(Date.UTC(r,i,n,a,o,s,l)),c&&f.setTime(f.getTime()-c),f}function gn(e){return e.toISOString()}var mn=new I("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:un,construct:hn,instanceOf:Date,represent:gn});function yn(e){return e==="<<"||e===null}var vn=new I("tag:yaml.org,2002:merge",{kind:"scalar",resolve:yn}),at=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function Cn(e){if(e===null)return!1;var t,r,i=0,n=e.length,a=at;for(r=0;r<n;r++)if(t=a.indexOf(e.charAt(r)),!(t>64)){if(t<0)return!1;i+=6}return i%8===0}function Pn(e){var t,r,i=e.replace(/[\r\n=]/g,""),n=i.length,a=at,o=0,s=[];for(t=0;t<n;t++)t%4===0&&t&&(s.push(o>>16&255),s.push(o>>8&255),s.push(o&255)),o=o<<6|a.indexOf(i.charAt(t));return r=n%4*6,r===0?(s.push(o>>16&255),s.push(o>>8&255),s.push(o&255)):r===18?(s.push(o>>10&255),s.push(o>>2&255)):r===12&&s.push(o>>4&255),new Uint8Array(s)}function bn(e){var t="",r=0,i,n,a=e.length,o=at;for(i=0;i<a;i++)i%3===0&&i&&(t+=o[r>>18&63],t+=o[r>>12&63],t+=o[r>>6&63],t+=o[r&63]),r=(r<<8)+e[i];return n=a%3,n===0?(t+=o[r>>18&63],t+=o[r>>12&63],t+=o[r>>6&63],t+=o[r&63]):n===2?(t+=o[r>>10&63],t+=o[r>>4&63],t+=o[r<<2&63],t+=o[64]):n===1&&(t+=o[r>>2&63],t+=o[r<<4&63],t+=o[64],t+=o[64]),t}function xn(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var Fn=new I("tag:yaml.org,2002:binary",{kind:"scalar",resolve:Cn,construct:Pn,predicate:xn,represent:bn}),wn=Object.prototype.hasOwnProperty,Sn=Object.prototype.toString;function Tn(e){if(e===null)return!0;var t=[],r,i,n,a,o,s=e;for(r=0,i=s.length;r<i;r+=1){if(n=s[r],o=!1,Sn.call(n)!=="[object Object]")return!1;for(a in n)if(wn.call(n,a))if(!o)o=!0;else return!1;if(!o)return!1;if(t.indexOf(a)===-1)t.push(a);else return!1}return!0}function An(e){return e!==null?e:[]}var En=new I("tag:yaml.org,2002:omap",{kind:"sequence",resolve:Tn,construct:An}),Dn=Object.prototype.toString;function Nn(e){if(e===null)return!0;var t,r,i,n,a,o=e;for(a=new Array(o.length),t=0,r=o.length;t<r;t+=1){if(i=o[t],Dn.call(i)!=="[object Object]"||(n=Object.keys(i),n.length!==1))return!1;a[t]=[n[0],i[n[0]]]}return!0}function On(e){if(e===null)return[];var t,r,i,n,a,o=e;for(a=new Array(o.length),t=0,r=o.length;t<r;t+=1)i=o[t],n=Object.keys(i),a[t]=[n[0],i[n[0]]];return a}var kn=new I("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:Nn,construct:On}),In=Object.prototype.hasOwnProperty;function jn(e){if(e===null)return!0;var t,r=e;for(t in r)if(In.call(r,t)&&r[t]!==null)return!1;return!0}function Mn(e){return e!==null?e:{}}var Rn=new I("tag:yaml.org,2002:set",{kind:"mapping",resolve:jn,construct:Mn}),Rt=dn.extend({implicit:[mn,vn],explicit:[Fn,En,kn,Rn]}),G=Object.prototype.hasOwnProperty,we=1,Lt=2,_t=3,Se=4,et=1,Ln=2,vt=3,_n=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Bn=/[\x85\u2028\u2029]/,$n=/[,\[\]\{\}]/,Bt=/^(?:!|!!|![a-z\-]+!)$/i,$t=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function Ct(e){return Object.prototype.toString.call(e)}function z(e){return e===10||e===13}function Q(e){return e===9||e===32}function R(e){return e===9||e===32||e===10||e===13}function ne(e){return e===44||e===91||e===93||e===123||e===125}function zn(e){var t;return 48<=e&&e<=57?e-48:(t=e|32,97<=t&&t<=102?t-97+10:-1)}function Wn(e){return e===120?2:e===117?4:e===85?8:0}function Yn(e){return 48<=e&&e<=57?e-48:-1}function Pt(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"\x85":e===95?"\xA0":e===76?"\u2028":e===80?"\u2029":""}function Hn(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}function zt(e,t,r){t==="__proto__"?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,writable:!0,value:r}):e[t]=r}var Wt=new Array(256),Yt=new Array(256);for(J=0;J<256;J++)Wt[J]=Pt(J)?1:0,Yt[J]=Pt(J);var J;function Vn(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||Rt,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function Ht(e,t){var r={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return r.snippet=Or(r),new M(t,r)}function v(e,t){throw Ht(e,t)}function Te(e,t){e.onWarning&&e.onWarning.call(null,Ht(e,t))}var bt={YAML:function(t,r,i){var n,a,o;t.version!==null&&v(t,"duplication of %YAML directive"),i.length!==1&&v(t,"YAML directive accepts exactly one argument"),n=/^([0-9]+)\.([0-9]+)$/.exec(i[0]),n===null&&v(t,"ill-formed argument of the YAML directive"),a=parseInt(n[1],10),o=parseInt(n[2],10),a!==1&&v(t,"unacceptable YAML version of the document"),t.version=i[0],t.checkLineBreaks=o<2,o!==1&&o!==2&&Te(t,"unsupported YAML version of the document")},TAG:function(t,r,i){var n,a;i.length!==2&&v(t,"TAG directive accepts exactly two arguments"),n=i[0],a=i[1],Bt.test(n)||v(t,"ill-formed tag handle (first argument) of the TAG directive"),G.call(t.tagMap,n)&&v(t,'there is a previously declared suffix for "'+n+'" tag handle'),$t.test(a)||v(t,"ill-formed tag prefix (second argument) of the TAG directive");try{a=decodeURIComponent(a)}catch(o){v(t,"tag prefix is malformed: "+a)}t.tagMap[n]=a}};function U(e,t,r,i){var n,a,o,s;if(t<r){if(s=e.input.slice(t,r),i)for(n=0,a=s.length;n<a;n+=1)o=s.charCodeAt(n),o===9||32<=o&&o<=1114111||v(e,"expected valid JSON character");else _n.test(s)&&v(e,"the stream contains non-printable characters");e.result+=s}}function xt(e,t,r,i){var n,a,o,s;for(D.isObject(r)||v(e,"cannot merge mappings; the provided source object is unacceptable"),n=Object.keys(r),o=0,s=n.length;o<s;o+=1)a=n[o],G.call(t,a)||(zt(t,a,r[a]),i[a]=!0)}function ie(e,t,r,i,n,a,o,s,l){var c,p;if(Array.isArray(n))for(n=Array.prototype.slice.call(n),c=0,p=n.length;c<p;c+=1)Array.isArray(n[c])&&v(e,"nested arrays are not supported inside keys"),typeof n=="object"&&Ct(n[c])==="[object Object]"&&(n[c]="[object Object]");if(typeof n=="object"&&Ct(n)==="[object Object]"&&(n="[object Object]"),n=String(n),t===null&&(t={}),i==="tag:yaml.org,2002:merge")if(Array.isArray(a))for(c=0,p=a.length;c<p;c+=1)xt(e,t,a[c],r);else xt(e,t,a,r);else!e.json&&!G.call(r,n)&&G.call(t,n)&&(e.line=o||e.line,e.lineStart=s||e.lineStart,e.position=l||e.position,v(e,"duplicated mapping key")),zt(t,n,a),delete r[n];return t}function st(e){var t;t=e.input.charCodeAt(e.position),t===10?e.position++:t===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):v(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function A(e,t,r){for(var i=0,n=e.input.charCodeAt(e.position);n!==0;){for(;Q(n);)n===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),n=e.input.charCodeAt(++e.position);if(t&&n===35)do n=e.input.charCodeAt(++e.position);while(n!==10&&n!==13&&n!==0);if(z(n))for(st(e),n=e.input.charCodeAt(e.position),i++,e.lineIndent=0;n===32;)e.lineIndent++,n=e.input.charCodeAt(++e.position);else break}return r!==-1&&i!==0&&e.lineIndent<r&&Te(e,"deficient indentation"),i}function De(e){var t=e.position,r;return r=e.input.charCodeAt(t),!!((r===45||r===46)&&r===e.input.charCodeAt(t+1)&&r===e.input.charCodeAt(t+2)&&(t+=3,r=e.input.charCodeAt(t),r===0||R(r)))}function lt(e,t){t===1?e.result+=" ":t>1&&(e.result+=D.repeat(`
`,t-1))}function Un(e,t,r){var i,n,a,o,s,l,c,p,d=e.kind,f=e.result,u;if(u=e.input.charCodeAt(e.position),R(u)||ne(u)||u===35||u===38||u===42||u===33||u===124||u===62||u===39||u===34||u===37||u===64||u===96||(u===63||u===45)&&(n=e.input.charCodeAt(e.position+1),R(n)||r&&ne(n)))return!1;for(e.kind="scalar",e.result="",a=o=e.position,s=!1;u!==0;){if(u===58){if(n=e.input.charCodeAt(e.position+1),R(n)||r&&ne(n))break}else if(u===35){if(i=e.input.charCodeAt(e.position-1),R(i))break}else{if(e.position===e.lineStart&&De(e)||r&&ne(u))break;if(z(u))if(l=e.line,c=e.lineStart,p=e.lineIndent,A(e,!1,-1),e.lineIndent>=t){s=!0,u=e.input.charCodeAt(e.position);continue}else{e.position=o,e.line=l,e.lineStart=c,e.lineIndent=p;break}}s&&(U(e,a,o,!1),lt(e,e.line-l),a=o=e.position,s=!1),Q(u)||(o=e.position+1),u=e.input.charCodeAt(++e.position)}return U(e,a,o,!1),e.result?!0:(e.kind=d,e.result=f,!1)}function Gn(e,t){var r,i,n;if(r=e.input.charCodeAt(e.position),r!==39)return!1;for(e.kind="scalar",e.result="",e.position++,i=n=e.position;(r=e.input.charCodeAt(e.position))!==0;)if(r===39)if(U(e,i,e.position,!0),r=e.input.charCodeAt(++e.position),r===39)i=e.position,e.position++,n=e.position;else return!0;else z(r)?(U(e,i,n,!0),lt(e,A(e,!1,t)),i=n=e.position):e.position===e.lineStart&&De(e)?v(e,"unexpected end of the document within a single quoted scalar"):(e.position++,n=e.position);v(e,"unexpected end of the stream within a single quoted scalar")}function qn(e,t){var r,i,n,a,o,s;if(s=e.input.charCodeAt(e.position),s!==34)return!1;for(e.kind="scalar",e.result="",e.position++,r=i=e.position;(s=e.input.charCodeAt(e.position))!==0;){if(s===34)return U(e,r,e.position,!0),e.position++,!0;if(s===92){if(U(e,r,e.position,!0),s=e.input.charCodeAt(++e.position),z(s))A(e,!1,t);else if(s<256&&Wt[s])e.result+=Yt[s],e.position++;else if((o=Wn(s))>0){for(n=o,a=0;n>0;n--)s=e.input.charCodeAt(++e.position),(o=zn(s))>=0?a=(a<<4)+o:v(e,"expected hexadecimal character");e.result+=Hn(a),e.position++}else v(e,"unknown escape sequence");r=i=e.position}else z(s)?(U(e,r,i,!0),lt(e,A(e,!1,t)),r=i=e.position):e.position===e.lineStart&&De(e)?v(e,"unexpected end of the document within a double quoted scalar"):(e.position++,i=e.position)}v(e,"unexpected end of the stream within a double quoted scalar")}function Kn(e,t){var r=!0,i,n,a,o=e.tag,s,l=e.anchor,c,p,d,f,u,h=Object.create(null),g,y,x,P;if(P=e.input.charCodeAt(e.position),P===91)p=93,u=!1,s=[];else if(P===123)p=125,u=!0,s={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=s),P=e.input.charCodeAt(++e.position);P!==0;){if(A(e,!0,t),P=e.input.charCodeAt(e.position),P===p)return e.position++,e.tag=o,e.anchor=l,e.kind=u?"mapping":"sequence",e.result=s,!0;r?P===44&&v(e,"expected the node content, but found ','"):v(e,"missed comma between flow collection entries"),y=g=x=null,d=f=!1,P===63&&(c=e.input.charCodeAt(e.position+1),R(c)&&(d=f=!0,e.position++,A(e,!0,t))),i=e.line,n=e.lineStart,a=e.position,oe(e,t,we,!1,!0),y=e.tag,g=e.result,A(e,!0,t),P=e.input.charCodeAt(e.position),(f||e.line===i)&&P===58&&(d=!0,P=e.input.charCodeAt(++e.position),A(e,!0,t),oe(e,t,we,!1,!0),x=e.result),u?ie(e,s,h,y,g,x,i,n,a):d?s.push(ie(e,null,h,y,g,x,i,n,a)):s.push(g),A(e,!0,t),P=e.input.charCodeAt(e.position),P===44?(r=!0,P=e.input.charCodeAt(++e.position)):r=!1}v(e,"unexpected end of the stream within a flow collection")}function Jn(e,t){var r,i,n=et,a=!1,o=!1,s=t,l=0,c=!1,p,d;if(d=e.input.charCodeAt(e.position),d===124)i=!1;else if(d===62)i=!0;else return!1;for(e.kind="scalar",e.result="";d!==0;)if(d=e.input.charCodeAt(++e.position),d===43||d===45)et===n?n=d===43?vt:Ln:v(e,"repeat of a chomping mode identifier");else if((p=Yn(d))>=0)p===0?v(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):o?v(e,"repeat of an indentation width identifier"):(s=t+p-1,o=!0);else break;if(Q(d)){do d=e.input.charCodeAt(++e.position);while(Q(d));if(d===35)do d=e.input.charCodeAt(++e.position);while(!z(d)&&d!==0)}for(;d!==0;){for(st(e),e.lineIndent=0,d=e.input.charCodeAt(e.position);(!o||e.lineIndent<s)&&d===32;)e.lineIndent++,d=e.input.charCodeAt(++e.position);if(!o&&e.lineIndent>s&&(s=e.lineIndent),z(d)){l++;continue}if(e.lineIndent<s){n===vt?e.result+=D.repeat(`
`,a?1+l:l):n===et&&a&&(e.result+=`
`);break}for(i?Q(d)?(c=!0,e.result+=D.repeat(`
`,a?1+l:l)):c?(c=!1,e.result+=D.repeat(`
`,l+1)):l===0?a&&(e.result+=" "):e.result+=D.repeat(`
`,l):e.result+=D.repeat(`
`,a?1+l:l),a=!0,o=!0,l=0,r=e.position;!z(d)&&d!==0;)d=e.input.charCodeAt(++e.position);U(e,r,e.position,!1)}return!0}function Ft(e,t){var r,i=e.tag,n=e.anchor,a=[],o,s=!1,l;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=a),l=e.input.charCodeAt(e.position);l!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,v(e,"tab characters must not be used in indentation")),!(l!==45||(o=e.input.charCodeAt(e.position+1),!R(o))));){if(s=!0,e.position++,A(e,!0,-1)&&e.lineIndent<=t){a.push(null),l=e.input.charCodeAt(e.position);continue}if(r=e.line,oe(e,t,_t,!1,!0),a.push(e.result),A(e,!0,-1),l=e.input.charCodeAt(e.position),(e.line===r||e.lineIndent>t)&&l!==0)v(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break}return s?(e.tag=i,e.anchor=n,e.kind="sequence",e.result=a,!0):!1}function Qn(e,t,r){var i,n,a,o,s,l,c=e.tag,p=e.anchor,d={},f=Object.create(null),u=null,h=null,g=null,y=!1,x=!1,P;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=d),P=e.input.charCodeAt(e.position);P!==0;){if(!y&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,v(e,"tab characters must not be used in indentation")),i=e.input.charCodeAt(e.position+1),a=e.line,(P===63||P===58)&&R(i))P===63?(y&&(ie(e,d,f,u,h,null,o,s,l),u=h=g=null),x=!0,y=!0,n=!0):y?(y=!1,n=!0):v(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,P=i;else{if(o=e.line,s=e.lineStart,l=e.position,!oe(e,r,Lt,!1,!0))break;if(e.line===a){for(P=e.input.charCodeAt(e.position);Q(P);)P=e.input.charCodeAt(++e.position);if(P===58)P=e.input.charCodeAt(++e.position),R(P)||v(e,"a whitespace character is expected after the key-value separator within a block mapping"),y&&(ie(e,d,f,u,h,null,o,s,l),u=h=g=null),x=!0,y=!1,n=!1,u=e.tag,h=e.result;else if(x)v(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=c,e.anchor=p,!0}else if(x)v(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=c,e.anchor=p,!0}if((e.line===a||e.lineIndent>t)&&(y&&(o=e.line,s=e.lineStart,l=e.position),oe(e,t,Se,!0,n)&&(y?h=e.result:g=e.result),y||(ie(e,d,f,u,h,g,o,s,l),u=h=g=null),A(e,!0,-1),P=e.input.charCodeAt(e.position)),(e.line===a||e.lineIndent>t)&&P!==0)v(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return y&&ie(e,d,f,u,h,null,o,s,l),x&&(e.tag=c,e.anchor=p,e.kind="mapping",e.result=d),x}function Xn(e){var t,r=!1,i=!1,n,a,o;if(o=e.input.charCodeAt(e.position),o!==33)return!1;if(e.tag!==null&&v(e,"duplication of a tag property"),o=e.input.charCodeAt(++e.position),o===60?(r=!0,o=e.input.charCodeAt(++e.position)):o===33?(i=!0,n="!!",o=e.input.charCodeAt(++e.position)):n="!",t=e.position,r){do o=e.input.charCodeAt(++e.position);while(o!==0&&o!==62);e.position<e.length?(a=e.input.slice(t,e.position),o=e.input.charCodeAt(++e.position)):v(e,"unexpected end of the stream within a verbatim tag")}else{for(;o!==0&&!R(o);)o===33&&(i?v(e,"tag suffix cannot contain exclamation marks"):(n=e.input.slice(t-1,e.position+1),Bt.test(n)||v(e,"named tag handle cannot contain such characters"),i=!0,t=e.position+1)),o=e.input.charCodeAt(++e.position);a=e.input.slice(t,e.position),$n.test(a)&&v(e,"tag suffix cannot contain flow indicator characters")}a&&!$t.test(a)&&v(e,"tag name cannot contain such characters: "+a);try{a=decodeURIComponent(a)}catch(s){v(e,"tag name is malformed: "+a)}return r?e.tag=a:G.call(e.tagMap,n)?e.tag=e.tagMap[n]+a:n==="!"?e.tag="!"+a:n==="!!"?e.tag="tag:yaml.org,2002:"+a:v(e,'undeclared tag handle "'+n+'"'),!0}function Zn(e){var t,r;if(r=e.input.charCodeAt(e.position),r!==38)return!1;for(e.anchor!==null&&v(e,"duplication of an anchor property"),r=e.input.charCodeAt(++e.position),t=e.position;r!==0&&!R(r)&&!ne(r);)r=e.input.charCodeAt(++e.position);return e.position===t&&v(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}function ei(e){var t,r,i;if(i=e.input.charCodeAt(e.position),i!==42)return!1;for(i=e.input.charCodeAt(++e.position),t=e.position;i!==0&&!R(i)&&!ne(i);)i=e.input.charCodeAt(++e.position);return e.position===t&&v(e,"name of an alias node must contain at least one character"),r=e.input.slice(t,e.position),G.call(e.anchorMap,r)||v(e,'unidentified alias "'+r+'"'),e.result=e.anchorMap[r],A(e,!0,-1),!0}function oe(e,t,r,i,n){var a,o,s,l=1,c=!1,p=!1,d,f,u,h,g,y;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,a=o=s=Se===r||_t===r,i&&A(e,!0,-1)&&(c=!0,e.lineIndent>t?l=1:e.lineIndent===t?l=0:e.lineIndent<t&&(l=-1)),l===1)for(;Xn(e)||Zn(e);)A(e,!0,-1)?(c=!0,s=a,e.lineIndent>t?l=1:e.lineIndent===t?l=0:e.lineIndent<t&&(l=-1)):s=!1;if(s&&(s=c||n),(l===1||Se===r)&&(we===r||Lt===r?g=t:g=t+1,y=e.position-e.lineStart,l===1?s&&(Ft(e,y)||Qn(e,y,g))||Kn(e,g)?p=!0:(o&&Jn(e,g)||Gn(e,g)||qn(e,g)?p=!0:ei(e)?(p=!0,(e.tag!==null||e.anchor!==null)&&v(e,"alias node should not have any properties")):Un(e,g,we===r)&&(p=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):l===0&&(p=s&&Ft(e,y))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&v(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),d=0,f=e.implicitTypes.length;d<f;d+=1)if(h=e.implicitTypes[d],h.resolve(e.result)){e.result=h.construct(e.result),e.tag=h.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(G.call(e.typeMap[e.kind||"fallback"],e.tag))h=e.typeMap[e.kind||"fallback"][e.tag];else for(h=null,u=e.typeMap.multi[e.kind||"fallback"],d=0,f=u.length;d<f;d+=1)if(e.tag.slice(0,u[d].tag.length)===u[d].tag){h=u[d];break}h||v(e,"unknown tag !<"+e.tag+">"),e.result!==null&&h.kind!==e.kind&&v(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+h.kind+'", not "'+e.kind+'"'),h.resolve(e.result,e.tag)?(e.result=h.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):v(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||p}function ti(e){var t=e.position,r,i,n,a=!1,o;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(o=e.input.charCodeAt(e.position))!==0&&(A(e,!0,-1),o=e.input.charCodeAt(e.position),!(e.lineIndent>0||o!==37));){for(a=!0,o=e.input.charCodeAt(++e.position),r=e.position;o!==0&&!R(o);)o=e.input.charCodeAt(++e.position);for(i=e.input.slice(r,e.position),n=[],i.length<1&&v(e,"directive name must not be less than one character in length");o!==0;){for(;Q(o);)o=e.input.charCodeAt(++e.position);if(o===35){do o=e.input.charCodeAt(++e.position);while(o!==0&&!z(o));break}if(z(o))break;for(r=e.position;o!==0&&!R(o);)o=e.input.charCodeAt(++e.position);n.push(e.input.slice(r,e.position))}o!==0&&st(e),G.call(bt,i)?bt[i](e,i,n):Te(e,'unknown document directive "'+i+'"')}if(A(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,A(e,!0,-1)):a&&v(e,"directives end mark is expected"),oe(e,e.lineIndent-1,Se,!1,!0),A(e,!0,-1),e.checkLineBreaks&&Bn.test(e.input.slice(t,e.position))&&Te(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&De(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,A(e,!0,-1));return}if(e.position<e.length-1)v(e,"end of the stream or a document separator is expected");else return}function Vt(e,t){e=String(e),t=t||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var r=new Vn(e,t),i=e.indexOf("\0");for(i!==-1&&(r.position=i,v(r,"null byte is not allowed in input")),r.input+="\0";r.input.charCodeAt(r.position)===32;)r.lineIndent+=1,r.position+=1;for(;r.position<r.length-1;)ti(r);return r.documents}function ri(e,t,r){t!==null&&typeof t=="object"&&typeof r=="undefined"&&(r=t,t=null);var i=Vt(e,r);if(typeof t!="function")return i;for(var n=0,a=i.length;n<a;n+=1)t(i[n])}function ni(e,t){var r=Vt(e,t);if(r.length!==0){if(r.length===1)return r[0];throw new M("expected a single document in the stream, but found more")}}var ii=ri,oi=ni,Ut={loadAll:ii,load:oi},Gt=Object.prototype.toString,qt=Object.prototype.hasOwnProperty,ct=65279,ai=9,pe=10,si=13,li=32,ci=33,pi=34,rt=35,fi=37,di=38,ui=39,hi=42,Kt=44,gi=45,Ae=58,mi=61,yi=62,vi=63,Ci=64,Jt=91,Qt=93,Pi=96,Xt=123,bi=124,Zt=125,j={};j[0]="\\0";j[7]="\\a";j[8]="\\b";j[9]="\\t";j[10]="\\n";j[11]="\\v";j[12]="\\f";j[13]="\\r";j[27]="\\e";j[34]='\\"';j[92]="\\\\";j[133]="\\N";j[160]="\\_";j[8232]="\\L";j[8233]="\\P";var xi=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],Fi=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function wi(e,t){var r,i,n,a,o,s,l;if(t===null)return{};for(r={},i=Object.keys(t),n=0,a=i.length;n<a;n+=1)o=i[n],s=String(t[o]),o.slice(0,2)==="!!"&&(o="tag:yaml.org,2002:"+o.slice(2)),l=e.compiledTypeMap.fallback[o],l&&qt.call(l.styleAliases,s)&&(s=l.styleAliases[s]),r[o]=s;return r}function Si(e){var t,r,i;if(t=e.toString(16).toUpperCase(),e<=255)r="x",i=2;else if(e<=65535)r="u",i=4;else if(e<=4294967295)r="U",i=8;else throw new M("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+r+D.repeat("0",i-t.length)+t}var Ti=1,fe=2;function Ai(e){this.schema=e.schema||Rt,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=D.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=wi(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?fe:Ti,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function wt(e,t){for(var r=D.repeat(" ",t),i=0,n=-1,a="",o,s=e.length;i<s;)n=e.indexOf(`
`,i),n===-1?(o=e.slice(i),i=s):(o=e.slice(i,n+1),i=n+1),o.length&&o!==`
`&&(a+=r),a+=o;return a}function nt(e,t){return`
`+D.repeat(" ",e.indent*t)}function Ei(e,t){var r,i,n;for(r=0,i=e.implicitTypes.length;r<i;r+=1)if(n=e.implicitTypes[r],n.resolve(t))return!0;return!1}function Ee(e){return e===li||e===ai}function de(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==ct||65536<=e&&e<=1114111}function St(e){return de(e)&&e!==ct&&e!==si&&e!==pe}function Tt(e,t,r){var i=St(e),n=i&&!Ee(e);return(r?i:i&&e!==Kt&&e!==Jt&&e!==Qt&&e!==Xt&&e!==Zt)&&e!==rt&&!(t===Ae&&!n)||St(t)&&!Ee(t)&&e===rt||t===Ae&&n}function Di(e){return de(e)&&e!==ct&&!Ee(e)&&e!==gi&&e!==vi&&e!==Ae&&e!==Kt&&e!==Jt&&e!==Qt&&e!==Xt&&e!==Zt&&e!==rt&&e!==di&&e!==hi&&e!==ci&&e!==bi&&e!==mi&&e!==yi&&e!==ui&&e!==pi&&e!==fi&&e!==Ci&&e!==Pi}function Ni(e){return!Ee(e)&&e!==Ae}function le(e,t){var r=e.charCodeAt(t),i;return r>=55296&&r<=56319&&t+1<e.length&&(i=e.charCodeAt(t+1),i>=56320&&i<=57343)?(r-55296)*1024+i-56320+65536:r}function er(e){var t=/^\n* /;return t.test(e)}var tr=1,it=2,rr=3,nr=4,re=5;function Oi(e,t,r,i,n,a,o,s){var l,c=0,p=null,d=!1,f=!1,u=i!==-1,h=-1,g=Di(le(e,0))&&Ni(le(e,e.length-1));if(t||o)for(l=0;l<e.length;c>=65536?l+=2:l++){if(c=le(e,l),!de(c))return re;g=g&&Tt(c,p,s),p=c}else{for(l=0;l<e.length;c>=65536?l+=2:l++){if(c=le(e,l),c===pe)d=!0,u&&(f=f||l-h-1>i&&e[h+1]!==" ",h=l);else if(!de(c))return re;g=g&&Tt(c,p,s),p=c}f=f||u&&l-h-1>i&&e[h+1]!==" "}return!d&&!f?g&&!o&&!n(e)?tr:a===fe?re:it:r>9&&er(e)?re:o?a===fe?re:it:f?nr:rr}function ki(e,t,r,i,n){e.dump=function(){if(t.length===0)return e.quotingType===fe?'""':"''";if(!e.noCompatMode&&(xi.indexOf(t)!==-1||Fi.test(t)))return e.quotingType===fe?'"'+t+'"':"'"+t+"'";var a=e.indent*Math.max(1,r),o=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-a),s=i||e.flowLevel>-1&&r>=e.flowLevel;function l(c){return Ei(e,c)}switch(Oi(t,s,e.indent,o,l,e.quotingType,e.forceQuotes&&!i,n)){case tr:return t;case it:return"'"+t.replace(/'/g,"''")+"'";case rr:return"|"+At(t,e.indent)+Et(wt(t,a));case nr:return">"+At(t,e.indent)+Et(wt(Ii(t,o),a));case re:return'"'+ji(t)+'"';default:throw new M("impossible error: invalid scalar style")}}()}function At(e,t){var r=er(e)?String(t):"",i=e[e.length-1]===`
`,n=i&&(e[e.length-2]===`
`||e===`
`),a=n?"+":i?"":"-";return r+a+`
`}function Et(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function Ii(e,t){for(var r=/(\n+)([^\n]*)/g,i=function(){var c=e.indexOf(`
`);return c=c!==-1?c:e.length,r.lastIndex=c,Dt(e.slice(0,c),t)}(),n=e[0]===`
`||e[0]===" ",a,o;o=r.exec(e);){var s=o[1],l=o[2];a=l[0]===" ",i+=s+(!n&&!a&&l!==""?`
`:"")+Dt(l,t),n=a}return i}function Dt(e,t){if(e===""||e[0]===" ")return e;for(var r=/ [^ ]/g,i,n=0,a,o=0,s=0,l="";i=r.exec(e);)s=i.index,s-n>t&&(a=o>n?o:s,l+=`
`+e.slice(n,a),n=a+1),o=s;return l+=`
`,e.length-n>t&&o>n?l+=e.slice(n,o)+`
`+e.slice(o+1):l+=e.slice(n),l.slice(1)}function ji(e){for(var t="",r=0,i,n=0;n<e.length;r>=65536?n+=2:n++)r=le(e,n),i=j[r],!i&&de(r)?(t+=e[n],r>=65536&&(t+=e[n+1])):t+=i||Si(r);return t}function Mi(e,t,r){var i="",n=e.tag,a,o,s;for(a=0,o=r.length;a<o;a+=1)s=r[a],e.replacer&&(s=e.replacer.call(r,String(a),s)),(Y(e,t,s,!1,!1)||typeof s=="undefined"&&Y(e,t,null,!1,!1))&&(i!==""&&(i+=","+(e.condenseFlow?"":" ")),i+=e.dump);e.tag=n,e.dump="["+i+"]"}function Nt(e,t,r,i){var n="",a=e.tag,o,s,l;for(o=0,s=r.length;o<s;o+=1)l=r[o],e.replacer&&(l=e.replacer.call(r,String(o),l)),(Y(e,t+1,l,!0,!0,!1,!0)||typeof l=="undefined"&&Y(e,t+1,null,!0,!0,!1,!0))&&((!i||n!=="")&&(n+=nt(e,t)),e.dump&&pe===e.dump.charCodeAt(0)?n+="-":n+="- ",n+=e.dump);e.tag=a,e.dump=n||"[]"}function Ri(e,t,r){var i="",n=e.tag,a=Object.keys(r),o,s,l,c,p;for(o=0,s=a.length;o<s;o+=1)p="",i!==""&&(p+=", "),e.condenseFlow&&(p+='"'),l=a[o],c=r[l],e.replacer&&(c=e.replacer.call(r,l,c)),Y(e,t,l,!1,!1)&&(e.dump.length>1024&&(p+="? "),p+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),Y(e,t,c,!1,!1)&&(p+=e.dump,i+=p));e.tag=n,e.dump="{"+i+"}"}function Li(e,t,r,i){var n="",a=e.tag,o=Object.keys(r),s,l,c,p,d,f;if(e.sortKeys===!0)o.sort();else if(typeof e.sortKeys=="function")o.sort(e.sortKeys);else if(e.sortKeys)throw new M("sortKeys must be a boolean or a function");for(s=0,l=o.length;s<l;s+=1)f="",(!i||n!=="")&&(f+=nt(e,t)),c=o[s],p=r[c],e.replacer&&(p=e.replacer.call(r,c,p)),Y(e,t+1,c,!0,!0,!0)&&(d=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,d&&(e.dump&&pe===e.dump.charCodeAt(0)?f+="?":f+="? "),f+=e.dump,d&&(f+=nt(e,t)),Y(e,t+1,p,!0,d)&&(e.dump&&pe===e.dump.charCodeAt(0)?f+=":":f+=": ",f+=e.dump,n+=f));e.tag=a,e.dump=n||"{}"}function Ot(e,t,r){var i,n,a,o,s,l;for(n=r?e.explicitTypes:e.implicitTypes,a=0,o=n.length;a<o;a+=1)if(s=n[a],(s.instanceOf||s.predicate)&&(!s.instanceOf||typeof t=="object"&&t instanceof s.instanceOf)&&(!s.predicate||s.predicate(t))){if(r?s.multi&&s.representName?e.tag=s.representName(t):e.tag=s.tag:e.tag="?",s.represent){if(l=e.styleMap[s.tag]||s.defaultStyle,Gt.call(s.represent)==="[object Function]")i=s.represent(t,l);else if(qt.call(s.represent,l))i=s.represent[l](t,l);else throw new M("!<"+s.tag+'> tag resolver accepts not "'+l+'" style');e.dump=i}return!0}return!1}function Y(e,t,r,i,n,a,o){e.tag=null,e.dump=r,Ot(e,r,!1)||Ot(e,r,!0);var s=Gt.call(e.dump),l=i,c;i&&(i=e.flowLevel<0||e.flowLevel>t);var p=s==="[object Object]"||s==="[object Array]",d,f;if(p&&(d=e.duplicates.indexOf(r),f=d!==-1),(e.tag!==null&&e.tag!=="?"||f||e.indent!==2&&t>0)&&(n=!1),f&&e.usedDuplicates[d])e.dump="*ref_"+d;else{if(p&&f&&!e.usedDuplicates[d]&&(e.usedDuplicates[d]=!0),s==="[object Object]")i&&Object.keys(e.dump).length!==0?(Li(e,t,e.dump,n),f&&(e.dump="&ref_"+d+e.dump)):(Ri(e,t,e.dump),f&&(e.dump="&ref_"+d+" "+e.dump));else if(s==="[object Array]")i&&e.dump.length!==0?(e.noArrayIndent&&!o&&t>0?Nt(e,t-1,e.dump,n):Nt(e,t,e.dump,n),f&&(e.dump="&ref_"+d+e.dump)):(Mi(e,t,e.dump),f&&(e.dump="&ref_"+d+" "+e.dump));else if(s==="[object String]")e.tag!=="?"&&ki(e,e.dump,t,a,l);else{if(s==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new M("unacceptable kind of an object to dump "+s)}e.tag!==null&&e.tag!=="?"&&(c=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?c="!"+c:c.slice(0,18)==="tag:yaml.org,2002:"?c="!!"+c.slice(18):c="!<"+c+">",e.dump=c+" "+e.dump)}return!0}function _i(e,t){var r=[],i=[],n,a;for(ot(e,r,i),n=0,a=i.length;n<a;n+=1)t.duplicates.push(r[i[n]]);t.usedDuplicates=new Array(a)}function ot(e,t,r){var i,n,a;if(e!==null&&typeof e=="object")if(n=t.indexOf(e),n!==-1)r.indexOf(n)===-1&&r.push(n);else if(t.push(e),Array.isArray(e))for(n=0,a=e.length;n<a;n+=1)ot(e[n],t,r);else for(i=Object.keys(e),n=0,a=i.length;n<a;n+=1)ot(e[i[n]],t,r)}function Bi(e,t){t=t||{};var r=new Ai(t);r.noRefs||_i(e,r);var i=e;return r.replacer&&(i=r.replacer.call({"":i},"",i)),Y(r,0,i,!0,!0)?r.dump+`
`:""}var $i=Bi,zi={dump:$i};function pt(e,t){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+t+" instead, which is now safe by default.")}}var Ne=Ut.load,ho=Ut.loadAll,go=zi.dump;var mo=pt("safeLoad","load"),yo=pt("safeLoadAll","loadAll"),vo=pt("safeDump","dump");var Oe=class{constructor(t){this.app=t}async findExampleFile(t){let r=this.app.vault.getAbstractFileByPath(t);if(!r)return null;if(r instanceof ae.TFile&&r.extension==="md")return await this.parseFrontmatter(r);let i=this.getMarkdownFiles(r,!1);i.length===0&&r instanceof ae.TFolder&&(i=this.getMarkdownFiles(r,!0,1),i.length===0&&(i=this.getMarkdownFiles(r,!0,2)),i.length===0&&(i=this.getMarkdownFiles(r,!0)));for(let n of i){let a=await this.parseFrontmatter(n);if(a)return a}return null}getMarkdownFiles(t,r=!0,i,n=0){let a=[];if(!t.children||i!==void 0&&n>=i)return a;for(let o of t.children)o instanceof ae.TFile&&o.extension==="md"?a.push(o):r&&o instanceof ae.TFolder&&o.children&&a.push(...this.getMarkdownFiles(o,r,i,n+1));return a}async parseFrontmatter(t){try{let r=await this.app.vault.read(t),i=/^---\s*\n([\s\S]*?)\n---\s*\n/,n=r.match(i);if(!n)return null;let a=n[1],o=Ne(a);return!o||typeof o!="object"?null:{file:t.path,frontmatter:o,rawYaml:a}}catch(r){return null}}autoDetectDateProperty(t){let r=["date","pubDate","publishedDate","publishDate"];for(let i of r)if(t.hasOwnProperty(i))return i;return null}autoDetectDescriptionProperty(t){let r=["description","summary","excerpt","intro","snippet","blurb"];for(let i of r)if(t.hasOwnProperty(i))return i;return null}autoDetectTagsProperty(t){return t.hasOwnProperty("tags")?"tags":null}autoDetectDraftProperty(t){return t.hasOwnProperty("draft")?{property:"draft",logic:"true-draft"}:t.hasOwnProperty("published")?{property:"published",logic:"false-draft"}:null}autoDetectImageProperty(t){let r=["image","cover","coverImage","thumbnail","featuredImage"];for(let i of r)if(t.hasOwnProperty(i))return i;return null}};var ke=class extends S{constructor(r,i,n,a,o,s){super(r,i,n,a,o,s);this.examples={};this.frontmatterAnalyzer=new Oe(r)}async display(){let{containerEl:r}=this,i=r.querySelector(".frontmatter-step-content");i&&i.remove();let n=r.createDiv({cls:"frontmatter-step-content"});n.createEl("h2",{text:"Frontmatter Properties"}),n.createEl("p",{text:"Map frontmatter properties for each content type. We'll find example files to help you."});for(let a of this.state.contentTypes){if(!a.enabled)continue;let o=n.createDiv({cls:"content-type-settings"});if(!this.examples[a.id]){let C=new $(this.app).getFolderPathFromVaultRoot(a.folder,this.state.projectDetection),b=await this.frontmatterAnalyzer.findExampleFile(C);b&&(this.examples[a.id]=b)}let s=this.examples[a.id];if(o.createEl("h3",{text:a.name}),s){o.createEl("p",{text:`Example file: ${s.file}`});let m=o.createEl("pre",{text:s.rawYaml,cls:"frontmatter-example"});m.style.fontFamily="var(--font-monospace)",m.style.fontSize="0.85em",m.style.whiteSpace="pre-wrap",m.style.wordWrap="break-word",m.style.overflowWrap="break-word",m.style.maxWidth="100%",m.style.padding="10px",m.style.backgroundColor="var(--background-secondary)",m.style.borderRadius="4px",m.style.border="1px solid var(--background-modifier-border)";let C=this.frontmatterAnalyzer.autoDetectDateProperty(s.frontmatter),b=this.frontmatterAnalyzer.autoDetectDescriptionProperty(s.frontmatter)}if(!this.state.frontmatterProperties[a.id]){let m=s?this.frontmatterAnalyzer.autoDetectDraftProperty(s.frontmatter):null,C=s?this.frontmatterAnalyzer.autoDetectTagsProperty(s.frontmatter):null,b=s?this.frontmatterAnalyzer.autoDetectImageProperty(s.frontmatter):null,w=s?this.frontmatterAnalyzer.autoDetectDescriptionProperty(s.frontmatter):null,k=s&&s.frontmatter.hasOwnProperty("title")?"title":null,T=s?this.frontmatterAnalyzer.autoDetectDateProperty(s.frontmatter):null;this.state.frontmatterProperties[a.id]={titleProperty:k||void 0,dateProperty:T||void 0,descriptionProperty:w||void 0,tagsProperty:C||void 0,draftProperty:m==null?void 0:m.property,draftLogic:(m==null?void 0:m.property)==="published"?"false-draft":m?"true-draft":void 0,hasDraftStatus:!!(m!=null&&m.property),imageProperty:b||void 0}}let l=this.state.frontmatterProperties[a.id];new N.Setting(o).setName("Title Property").setDesc("The frontmatter property that contains the title (e.g., title, name, heading). Leave blank to use file name instead.").addText(m=>{let C="title";m.setPlaceholder(C).setValue(l.titleProperty||"").onChange(b=>{l.titleProperty=b.trim()||void 0})}),new N.Setting(o).setName("Date Property").setDesc("The frontmatter property that contains the date (e.g., date, pubDate, publishedDate, publishDate). Leave blank to use file created date instead.").addText(m=>{let C=s?this.frontmatterAnalyzer.autoDetectDateProperty(s.frontmatter):null;m.setPlaceholder(C||"date").setValue(l.dateProperty||"").onChange(b=>{l.dateProperty=b.trim()||void 0})});let c=new N.Setting(o).setName("Has Description/Summary?").setDesc("Does this content type have a description or summary field?"),p=null;c.addToggle(m=>m.setValue(!!l.descriptionProperty).onChange(C=>{C&&!l.descriptionProperty?(l.descriptionProperty=s&&this.frontmatterAnalyzer.autoDetectDescriptionProperty(s.frontmatter)||"description",p||(p=new N.Setting(o).setName("Description Property").setDesc("The frontmatter property that contains the description (e.g., description, summary, excerpt, intro, snippet, blurb)").addText(b=>b.setValue(l.descriptionProperty||"").onChange(w=>{l.descriptionProperty=w.trim()||void 0})),p.settingEl.remove(),c.settingEl.insertAdjacentElement("afterend",p.settingEl))):C||(l.descriptionProperty=void 0,p&&(p.settingEl.remove(),p=null))})),l.descriptionProperty&&(p=new N.Setting(o).setName("Description Property").setDesc("The frontmatter property that contains the description (e.g., description, summary, excerpt, intro, snippet, blurb)").addText(m=>m.setValue(l.descriptionProperty||"").onChange(C=>{l.descriptionProperty=C.trim()||void 0})),p.settingEl.remove(),c.settingEl.insertAdjacentElement("afterend",p.settingEl));let d=new N.Setting(o).setName("Has Tags?").setDesc("Does this content type have tags?"),f=null;d.addToggle(m=>m.setValue(!!l.tagsProperty).onChange(C=>{if(C&&!l.tagsProperty){let b=s?this.frontmatterAnalyzer.autoDetectTagsProperty(s.frontmatter):null;l.tagsProperty=b||"tags",f||(f=new N.Setting(o).setName("Tags Property").setDesc("The frontmatter property that contains tags (e.g., tags, tag, categories, category). Leave blank if not applicable.").addText(w=>{let k=s?this.frontmatterAnalyzer.autoDetectTagsProperty(s.frontmatter):null;w.setPlaceholder(k||"tags").setValue(l.tagsProperty||"").onChange(T=>{l.tagsProperty=T.trim()||void 0})}),f.settingEl.remove(),d.settingEl.insertAdjacentElement("afterend",f.settingEl))}else C||(l.tagsProperty=void 0,f&&(f.settingEl.remove(),f=null))})),l.tagsProperty&&(f=new N.Setting(o).setName("Tags Property").setDesc("The frontmatter property that contains tags (e.g., tags, tag, categories, category). Leave blank if not applicable.").addText(m=>{let C=s?this.frontmatterAnalyzer.autoDetectTagsProperty(s.frontmatter):null;m.setPlaceholder(C||"tags").setValue(l.tagsProperty||"").onChange(b=>{l.tagsProperty=b.trim()||void 0})}),f.settingEl.remove(),d.settingEl.insertAdjacentElement("afterend",f.settingEl));let u=new N.Setting(o).setName("Has Draft Status?").setDesc("Does this content type have draft status?"),h=null,g=null;l.hasDraftStatus===void 0&&(l.hasDraftStatus=!!l.draftProperty),u.addToggle(m=>{var C;return m.setValue((C=l.hasDraftStatus)!=null?C:!!l.draftProperty).onChange(b=>{if(l.hasDraftStatus=b,b&&!l.draftProperty){let w=s?this.frontmatterAnalyzer.autoDetectDraftProperty(s.frontmatter):null;l.draftProperty=(w==null?void 0:w.property)||"draft",(w==null?void 0:w.property)==="published"?l.draftLogic="false-draft":l.draftLogic="true-draft",h||(h=new N.Setting(o).setName("Draft Property").setDesc("The frontmatter property that contains draft status. Leave blank to use an underscore prefix instead.").addText(k=>{let T=s?this.frontmatterAnalyzer.autoDetectDraftProperty(s.frontmatter):null;k.setPlaceholder((T==null?void 0:T.property)||"draft").setValue(l.draftProperty||"").onChange(L=>{l.draftProperty=L.trim()||void 0,L==="published"?l.draftLogic="false-draft":L&&(l.draftLogic="true-draft"),L&&!g?(g=new N.Setting(o).setName("Draft Logic").setDesc("How draft status is represented").addDropdown(pr=>pr.addOption("true-draft","true = draft").addOption("false-draft","false = draft").setValue(l.draftLogic||"true-draft").onChange(fr=>{l.draftLogic=fr})),g.settingEl.remove(),h&&h.settingEl.insertAdjacentElement("afterend",g.settingEl)):!L&&g&&(g.settingEl.remove(),g=null)})}),h.settingEl.remove(),u.settingEl.insertAdjacentElement("afterend",h.settingEl)),l.draftProperty&&!g&&(g=new N.Setting(o).setName("Draft Logic").setDesc("How draft status is represented").addDropdown(k=>k.addOption("true-draft","true = draft").addOption("false-draft","false = draft").setValue(l.draftLogic||"true-draft").onChange(T=>{l.draftLogic=T})),g.settingEl.remove(),h&&h.settingEl.insertAdjacentElement("afterend",g.settingEl))}else b||(l.draftProperty=void 0,l.draftLogic=void 0,l.hasDraftStatus=!1,h&&(h.settingEl.remove(),h=null),g&&(g.settingEl.remove(),g=null))})}),l.hasDraftStatus&&(h=new N.Setting(o).setName("Draft Property").setDesc("The frontmatter property that contains draft status. Leave blank to use an underscore prefix instead.").addText(m=>{let C=s?this.frontmatterAnalyzer.autoDetectDraftProperty(s.frontmatter):null;m.setPlaceholder((C==null?void 0:C.property)||"draft").setValue(l.draftProperty||"").onChange(b=>{l.draftProperty=b.trim()||void 0,b==="published"?l.draftLogic="false-draft":b&&(l.draftLogic="true-draft"),b&&!g?(g=new N.Setting(o).setName("Draft Logic").setDesc("How draft status is represented").addDropdown(w=>w.addOption("true-draft","true = draft").addOption("false-draft","false = draft").setValue(l.draftLogic||"true-draft").onChange(k=>{l.draftLogic=k})),g.settingEl.remove(),h&&h.settingEl.insertAdjacentElement("afterend",g.settingEl)):!b&&g&&(g.settingEl.remove(),g=null)})}),h.settingEl.remove(),u.settingEl.insertAdjacentElement("afterend",h.settingEl),l.draftProperty&&(g=new N.Setting(o).setName("Draft Logic").setDesc("How draft status is represented").addDropdown(m=>m.addOption("true-draft","true = draft").addOption("false-draft","false = draft").setValue(l.draftLogic||"true-draft").onChange(C=>{l.draftLogic=C})),g.settingEl.remove(),h&&h.settingEl.insertAdjacentElement("afterend",g.settingEl)));let y=new N.Setting(o).setName("Has Image/Cover Property?").setDesc("Does this content type have an image or cover property? Used for Bases CMS cover images, Simple Banner, and Image Inserter."),x=null;if(y.addToggle(m=>m.setValue(!!l.imageProperty).onChange(C=>{if(C&&!l.imageProperty){let b=s?this.frontmatterAnalyzer.autoDetectImageProperty(s.frontmatter):null;l.imageProperty=b||"image",x||(x=new N.Setting(o).setName("Image Property").setDesc("The frontmatter property that contains the image/cover (e.g., image, cover, coverImage, thumbnail, featuredImage). Leave blank if not applicable.").addText(w=>{let k=s?this.frontmatterAnalyzer.autoDetectImageProperty(s.frontmatter):null;w.setPlaceholder(k||"image").setValue(l.imageProperty||"").onChange(T=>{l.imageProperty=T.trim()||void 0})}),x.settingEl.remove(),y.settingEl.insertAdjacentElement("afterend",x.settingEl))}else C||(l.imageProperty=void 0,x&&(x.settingEl.remove(),x=null))})),l.imageProperty&&(x=new N.Setting(o).setName("Image Property").setDesc("The frontmatter property that contains the image/cover (e.g., image, cover, coverImage, thumbnail, featuredImage). Leave blank if not applicable.").addText(m=>{let C=s?this.frontmatterAnalyzer.autoDetectImageProperty(s.frontmatter):null;m.setPlaceholder(C||"image").setValue(l.imageProperty||"").onChange(b=>{l.imageProperty=b.trim()||void 0})}),x.settingEl.remove(),y.settingEl.insertAdjacentElement("afterend",x.settingEl)),o.createEl("h4",{text:"Template"}),o.createEl("p",{text:'Edit the template that will be used when creating new files of this content type. Use {{title}} and {{date}} as variables. Note: {{title}} should be in quotes (e.g., title: "{{title}}"), while {{date}} should not be in quotes (e.g., date: {{date}}).'}),!l.template){let m=a.name==="Posts";l.template=this.generateDefaultTemplate(l,m,s)}let P=o.createEl("textarea",{cls:"template-editor",attr:{rows:"10",style:"width: 100%; font-family: monospace;",spellcheck:"false"}});P.value=l.template||"",P.addEventListener("input",m=>{let C=m.target;l.template=C.value})}}generateDefaultTemplate(r,i,n){let a=`---
`;if(n&&n.rawYaml){let o=n.rawYaml.split(`
`),s=new Set,l=!1;if(r.titleProperty){for(let c of o){let p=c.trim();if(!p||p.startsWith("#"))continue;let d=p.indexOf(":");if(d>0){let f=p.substring(0,d).trim();if(f===r.titleProperty){a+=`${r.titleProperty}: "{{title}}"
`,l=!0,s.add(f);continue}}}l||(a+=`${r.titleProperty}: "{{title}}"
`)}for(let c of o){let p=c.trim();if(!p||p.startsWith("#"))continue;let d=p.indexOf(":");if(d>0){let f=p.substring(0,d).trim();if(s.has(f)||f===r.titleProperty)continue;if(f===r.dateProperty&&r.dateProperty){a+=`${r.dateProperty}: {{date}}
`,s.add(f);continue}if(f===r.descriptionProperty){a+=`${r.descriptionProperty}: ""
`,s.add(f);continue}let u=n.frontmatter[f];u==null?a+=`${f}:
`:Array.isArray(u)?a+=`${f}: []
`:typeof u=="boolean"?a+=`${f}: ${u}
`:typeof u=="number"?a+=`${f}: ${u}
`:typeof u=="string"?/^\d{4}-\d{2}-\d{2}/.test(u)&&f.toLowerCase().includes("date")?a+=`${f}: {{date}}
`:a+=`${f}: ""
`:typeof u=="object"&&(Array.isArray(u)?a+=`${f}: []
`:a+=`${f}:
`),s.add(f)}}}else if(r.titleProperty&&(a+=`${r.titleProperty}: "{{title}}"
`),r.dateProperty&&(a+=`${r.dateProperty}: {{date}}
`),r.descriptionProperty&&(a+=`${r.descriptionProperty}: ""
`),r.tagsProperty&&(a+=`${r.tagsProperty}: []
`),r.draftProperty){let o=r.draftLogic==="false-draft"?"false":"true";a+=`${r.draftProperty}: ${o}
`}return a+=`---
`,a}validate(){return!0}getTitle(){return"Frontmatter Properties"}getDescription(){return"Map frontmatter properties"}};var or=require("obsidian");var Ie=class extends S{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"WYSIWYG Editing Toolbar"}),t.createEl("p",{text:"Do you want to use the WYSIWYG editing toolbar?"}),t.createEl("p",{text:"This enables a visual editing toolbar for formatting text. The toolbar can be toggled on/off via command."}),new or.Setting(t).setName("Enable WYSIWYG Toolbar").setDesc("Show the editing toolbar command in the page header").addToggle(r=>r.setValue(this.state.enableWYSIWYG).onChange(i=>{this.state.enableWYSIWYG=i}))}validate(){return!0}getTitle(){return"WYSIWYG Preference"}getDescription(){return"Configure editing toolbar preference"}};var je=class extends S{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Bases CMS Configuration"}),t.createEl("p",{text:"Bases CMS views will be automatically created for each enabled content type using your mapped frontmatter properties."});let r=this.state.contentTypes.filter(n=>n.enabled);if(r.length===0){t.createEl("p",{text:"No content types enabled. Please go back and enable at least one content type."});return}t.createEl("h3",{text:"Views to be created:"});let i=t.createEl("ul");for(let n of r){let a=this.state.frontmatterProperties[n.id];if(a){let o=[];a.titleProperty&&o.push(`title: ${a.titleProperty}`),a.dateProperty&&o.push(`date: ${a.dateProperty}`),a.descriptionProperty&&o.push(`description: ${a.descriptionProperty}`),a.tagsProperty&&o.push(`tags: ${a.tagsProperty}`),a.imageProperty&&o.push(`image: ${a.imageProperty}`),a.draftProperty&&o.push(`draft: ${a.draftProperty}`);let s=o.length>0?o.join(", "):"default properties";i.createEl("li",{text:`${n.name}: ${s}`})}}t.createEl("p",{text:"You can customize these views later in the Bases CMS settings."})}validate(){return this.state.contentTypes.some(t=>t.enabled)}getTitle(){return"Bases CMS Configuration"}getDescription(){return"Configure Bases CMS views"}};var Me=class extends S{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Astro Composer Configuration"}),t.createEl("p",{text:"Astro Composer will be configured with your content types and frontmatter properties."});let r=this.state.contentTypes.filter(n=>n.enabled);if(r.length===0){t.createEl("p",{text:"No content types enabled."});return}t.createEl("h3",{text:"Content types to configure:"});let i=t.createEl("ul");for(let n of r)if(this.state.frontmatterProperties[n.id]){let o=n.fileOrganization==="folder"?"folder-based":"file-based";i.createEl("li",{text:`${n.name} (${n.folder}): ${o}`})}this.state.projectDetection&&(this.state.projectDetection.projectRoot&&t.createEl("p",{text:`Project root: ${this.state.projectDetection.projectRoot}`}),this.state.projectDetection.configFilePath&&t.createEl("p",{text:`Config file: ${this.state.projectDetection.configFilePath}`}))}validate(){return!0}getTitle(){return"Astro Composer Configuration"}getDescription(){return"Configure Astro Composer"}};var ar=require("obsidian");var Re=class extends S{display(){var d;let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"SEO Plugin Configuration"}),t.createEl("p",{text:"SEO plugin will be configured using your mapped frontmatter properties."});let r=this.state.contentTypes.filter(f=>f.enabled),i=r[0],n=i?this.state.frontmatterProperties[i.id]:void 0,a=new Set,o=new Set;for(let f of r){let u=this.state.frontmatterProperties[f.id];u&&(u.titleProperty&&a.add(u.titleProperty),u.descriptionProperty&&o.add(u.descriptionProperty))}if(a.size>1||o.size>1){let f=t.createDiv({cls:"vault-cms-warning"});f.style.padding="10px",f.style.backgroundColor="var(--background-modifier-border)",f.style.borderLeft="3px solid var(--text-warning)",f.style.marginBottom="15px",f.createEl("p",{text:"\u26A0\uFE0F Warning: Different content types use different properties for title or description.",attr:{style:"margin: 0 0 5px 0; font-weight: bold;"}}),f.createEl("p",{text:"The SEO plugin will use the first content type's properties. You may need to manually configure SEO settings for other content types.",attr:{style:"margin: 0;"}})}if(n){t.createEl("h3",{text:"Configuration:"}),t.createEl("p",{text:`Title property: ${n.titleProperty||"(using filename)"}`}),n.descriptionProperty&&t.createEl("p",{text:`Description property: ${n.descriptionProperty}`});let f=r.map(u=>u.folder).join(", ");t.createEl("p",{text:`Scan directories: ${f}`})}let s=new $(this.app),l=this.state.contentTypes.filter(f=>f.enabled).map(f=>s.getFolderPathFromVaultRoot(f.folder,this.state.projectDetection)).join(","),c=(d=this.state.seoConfig)==null?void 0:d.scanDirectories,p=c&&c.trim()?c:l;(!this.state.seoConfig.scanDirectories||!this.state.seoConfig.scanDirectories.trim())&&(this.state.seoConfig.scanDirectories=p),new ar.Setting(t).setName("Scan Directories").setDesc("Comma-separated list of directories to scan (you can customize this)").addText(f=>f.setValue(p).onChange(u=>{this.state.seoConfig&&(this.state.seoConfig.scanDirectories=u)}))}validate(){return!0}getTitle(){return"SEO Configuration"}getDescription(){return"Configure SEO plugin"}};var ft=require("obsidian"),ue=require("obsidian");var se=class{constructor(t){this.app=t}async enablePlugin(t){let r=this.app.plugins;if(!r)return;let i=r.plugins[t];i&&!i.enabled&&await r.enablePlugin(t)}async disablePlugin(t){let r=this.app.plugins;if(!r)return;let i=r.plugins[t];i&&i.enabled&&await r.disablePlugin(t)}async setPluginStates(t,r){for(let i of r)await this.disablePlugin(i);for(let i of t)await this.enablePlugin(i)}getPresetPlugins(t){let r=["astro-composer","bases-cms","homepage","new-tab-default-page","seo","property-over-file-name","settings-search","statusbar-organizer","zenmode","cmdr","editing-toolbar","simple-focus","tag-wrangler"],i=["insert-unsplash-image","custom-save","title-only-tab","obsidian-paste-image-rename","obsidian42-brat","obsidian-hider","disable-tabs","obsidian-style-settings","mdx-as-md-obsidian"],n=["obsidian-oxygen","obsidian-style-settings"];return t==="vanilla"?{enabled:[...r,...i.filter(a=>!n.includes(a))],disabled:n}:t==="opinionated"?{enabled:[...r,...i],disabled:[]}:{enabled:[],disabled:[]}}};var Le=class extends S{constructor(r,i,n,a,o,s){super(r,i,n,a,o,s);this.pluginManager=new se(r)}display(){var c,p,d,f,u,h,g,y,x,P;let{containerEl:r}=this;r.empty(),r.createEl("h2",{text:"Plugin Configuration"}),r.createEl("p",{text:"Review and configure your installed plugins. Essential plugins are recommended for the core Vault CMS experience."});let i=[{id:"astro-composer",name:"Astro Composer",category:"essential"},{id:"bases-cms",name:"Bases CMS",category:"essential"},{id:"cmdr",name:"Commander",category:"essential"},{id:"new-tab-default-page",name:"Default New Tab Page",category:"essential"},{id:"editing-toolbar",name:"Editing Toolbar",category:"essential"},{id:"homepage",name:"Homepage",category:"essential"},{id:"obsidian-paste-image-rename",name:"Paste Image Rename",category:"essential"},{id:"property-over-file-name",name:"Property Over File Name",category:"essential"},{id:"seo",name:"SEO",category:"essential"},{id:"simple-focus",name:"Simple Focus",category:"essential"},{id:"statusbar-organizer",name:"Status Bar Organizer",category:"essential"},{id:"zenmode",name:"Zen Mode",category:"essential"},{id:"iconic",name:"Iconic",category:"nice-to-have"},{id:"settings-search",name:"Settings Search",category:"nice-to-have"},{id:"simple-banner",name:"Simple Banner",category:"nice-to-have"},{id:"tag-wrangler",name:"Tag Wrangler",category:"nice-to-have"},{id:"insert-unsplash-image",name:"Image Inserter",category:"nice-to-have"},{id:"paste-image-into-property",name:"Paste Image Into Property",category:"nice-to-have"}],n=this.app.plugins,a=n!=null&&n.plugins?Object.keys(n.plugins):[],o=["obsidian42-brat","astro-modular-settings","alias-file-name-history","folder-notes","disable-tabs","vault-cms"],s=i.filter(m=>m.category==="essential"&&a.includes(m.id)&&!o.includes(m.id)),l=i.filter(m=>m.category==="nice-to-have"&&a.includes(m.id)&&!o.includes(m.id));if(s.length>0){r.createEl("h3",{text:"Essential Plugins",cls:"vault-cms-section-header"}),r.createEl("p",{text:"These plugins are recommended for the core Vault CMS experience.",cls:"vault-cms-section-desc"});for(let m of s){let C=(c=n==null?void 0:n.plugins)==null?void 0:c[m.id],b=!!C,w=(u=(f=(d=(p=n==null?void 0:n.enabledPlugins)==null?void 0:p.has)==null?void 0:d.call(p,m.id))!=null?f:C==null?void 0:C.enabled)!=null?u:!1;console.log(`Plugin ${m.id}: installed=${b}, enabled=${w}`),b&&w?(this.state.enabledPlugins.includes(m.id)||this.state.enabledPlugins.push(m.id),this.state.disabledPlugins=this.state.disabledPlugins.filter(L=>L!==m.id)):b&&!w&&(this.state.enabledPlugins=this.state.enabledPlugins.filter(L=>L!==m.id),this.state.disabledPlugins.includes(m.id)||this.state.disabledPlugins.push(m.id));let T=new ft.Setting(r).setName(m.name).setDesc(b?w?"Installed and enabled":"Installed but disabled":"Not installed").controlEl.createDiv({cls:"vault-cms-plugin-status"});b&&w?((0,ue.setIcon)(T,"lucide-check-circle-2"),T.style.color="var(--text-success)"):((0,ue.setIcon)(T,"lucide-x-circle"),T.style.color="var(--text-error)")}}if(l.length>0){r.createEl("h3",{text:"Nice to Have Plugins",cls:"vault-cms-section-header"}),r.createEl("p",{text:"These plugins can be helpful depending on your theme's capabilities and workflow needs.",cls:"vault-cms-section-desc"});for(let m of l){let C=(h=n==null?void 0:n.plugins)==null?void 0:h[m.id],b=!!C,w=(P=(x=(y=(g=n==null?void 0:n.enabledPlugins)==null?void 0:g.has)==null?void 0:y.call(g,m.id))!=null?x:C==null?void 0:C.enabled)!=null?P:!1;console.log(`Plugin ${m.id}: installed=${b}, enabled=${w}`),b&&w?(this.state.enabledPlugins.includes(m.id)||this.state.enabledPlugins.push(m.id),this.state.disabledPlugins=this.state.disabledPlugins.filter(L=>L!==m.id)):b&&!w&&(this.state.enabledPlugins=this.state.enabledPlugins.filter(L=>L!==m.id),this.state.disabledPlugins.includes(m.id)||this.state.disabledPlugins.push(m.id));let T=new ft.Setting(r).setName(m.name).setDesc(b?w?"Installed and enabled":"Installed but disabled":"Not installed").controlEl.createDiv({cls:"vault-cms-plugin-status"});b&&w?((0,ue.setIcon)(T,"lucide-check-circle-2"),T.style.color="var(--text-success)"):((0,ue.setIcon)(T,"lucide-x-circle"),T.style.color="var(--text-error)")}}s.length===0&&l.length===0&&r.createEl("p",{text:"No Vault CMS plugins detected. Make sure you have installed the recommended plugins."})}validate(){return!0}getTitle(){return"Optional Plugins"}getDescription(){return"Configure optional plugins"}};var ut=require("obsidian");var _e=require("obsidian");var Be=class{constructor(t){this.app=t,this.pathResolver=new $(t)}async createOrUpdateBaseFile(t,r,i,n){let a="bases/Home.base";if(!this.app.vault.getAbstractFileByPath("bases"))try{await this.app.vault.createFolder("bases")}catch(u){(!u.message||!u.message.includes("already exists"))&&console.warn("BasesCMSConfig: Could not create bases folder:",u)}let s=this.app.vault.getAbstractFileByPath(a),l=null;if(s&&s instanceof _e.TFile)try{let u=await this.app.vault.read(s);l=Ne(u)}catch(u){console.error("BasesCMSConfig: Failed to parse existing base file:",u)}let c=t.filter(u=>u.enabled);console.log("BasesCMSConfig: Generating base content for",t.length,"content types"),console.log("BasesCMSConfig: Enabled content types:",c.map(u=>u.name));let p=this.generateBaseContent(t,r,i,l,n),d=p.match(/^\s*-\s+type:\s+bases-cms/gm),f=d?d.length:0;if(console.log("BasesCMSConfig: Generated",f,"views in base content"),s=this.app.vault.getAbstractFileByPath(a),s&&s instanceof _e.TFile){console.log("BasesCMSConfig: Modifying existing Home.base file");try{await this.app.vault.modify(s,p),console.log("BasesCMSConfig: Successfully modified Home.base file");return}catch(u){throw console.error("BasesCMSConfig: Failed to modify file:",u),u}}console.log("BasesCMSConfig: Creating new Home.base file");try{await this.app.vault.create(a,p),console.log("BasesCMSConfig: Successfully created Home.base file")}catch(u){if(u.message&&(u.message.includes("already exists")||u.message.includes("File already exists"))){console.log("BasesCMSConfig: File existed, attempting direct modify via path");try{let h=this.app.vault.adapter;if(h&&typeof h.write=="function")await h.write(a,p),console.log("BasesCMSConfig: Successfully wrote Home.base file via adapter");else{console.log("BasesCMSConfig: Adapter write not available, retrying getAbstractFileByPath");for(let g=0;g<10;g++){await new Promise(x=>setTimeout(x,200));let y=this.app.vault.getAbstractFileByPath(a);if(y&&y instanceof _e.TFile){await this.app.vault.modify(y,p),console.log(`BasesCMSConfig: Successfully modified Home.base file on retry ${g+1}`);return}}throw console.error("BasesCMSConfig: File exists but cannot be found after all retries"),new Error("File exists but cannot be accessed. Please try again or manually edit bases/Home.base")}}catch(h){throw console.error("BasesCMSConfig: Failed to write file via adapter:",h),h}}else throw console.error("BasesCMSConfig: Failed to create base file:",u),u}}generateBaseContent(t,r,i,n,a){var u;let o=[];if(n!=null&&n.formulas){o.push("formulas:");for(let[h,g]of Object.entries(n.formulas))if(typeof g=="string"){o.push(`  ${h}: |-`);let y=g.split(`
`);for(let x of y)o.push(`    ${x}`)}o.push("")}o.push("filters:"),o.push("  and:"),o.push('    - file.ext == "md"'),o.push("");let s=new Set;for(let h of t){let g=r[h.id];g&&(s.add(`note.${g.titleProperty}`),s.add(`note.${g.dateProperty}`),g.descriptionProperty&&s.add(`note.${g.descriptionProperty}`),g.tagsProperty&&s.add(`note.${g.tagsProperty}`),g.draftProperty&&s.add(`note.${g.draftProperty}`),g.imageProperty&&s.add(`note.${g.imageProperty}`))}if(s.add("note.title"),s.add("note.date"),s.add("note.pubDate"),s.add("note.draft"),s.add("file.name"),n!=null&&n.properties)for(let h of Object.keys(n.properties))h.startsWith("formula.")&&s.add(h);if(s.size>0){o.push("properties:");let h=(n==null?void 0:n.properties)||{};for(let g of Array.from(s).sort())if(o.push(`  ${g}:`),(u=h[g])!=null&&u.displayName)o.push(`    displayName: ${h[g].displayName}`);else{let y=g.replace("note.","").replace("file.","");o.push(`    displayName: ${this.capitalizeFirst(y)}`)}o.push("")}o.push("views:");let l=i?t.find(h=>h.id===i&&h.enabled):null,c=(n==null?void 0:n.views)||[],p=new Set(t.filter(h=>h.enabled).map(h=>h.name)),d=c.find(h=>h.name==="Guide"),f=c.filter(h=>h.name!=="All Content"&&h.name!=="Guide"&&!p.has(h.name));if(l){let h=r[l.id];if(h){let g=this.pathResolver.getBasesCMSFolderPath(l.folder,a);o.push("  - type: bases-cms"),o.push(`    name: ${l.name}`),o.push("    filters:"),o.push("      and:"),o.push(`        - file.folder.startsWith("${g}")`),o.push("    imageFormat: cover"),h.titleProperty?o.push(`    titleProperty: note.${h.titleProperty}`):o.push("    titleProperty: file.name"),h.dateProperty?o.push(`    dateProperty: note.${h.dateProperty}`):o.push("    dateProperty: file.ctime"),h.descriptionProperty&&o.push(`    descriptionProperty: note.${h.descriptionProperty}`),h.imageProperty&&o.push(`    imageProperty: note.${h.imageProperty}`),o.push(`    showTags: ${h.tagsProperty?"true":"false"}`),h.tagsProperty&&o.push(`    tagsProperty: note.${h.tagsProperty}`),o.push("    showDate: true"),o.push(`    showDraftStatus: ${h.draftProperty?"true":"false"}`),h.draftProperty&&o.push(`    draftStatusProperty: note.${h.draftProperty}`),o.push("    customizeNewButton: true"),o.push(`    newNoteLocation: "${g}"`),o.push("    fallbackToEmbeds: if-empty"),o.push("    propertyDisplay1: file.name"),o.push("    showTextPreview: true"),o.push("    propertyLabels: above"),o.push("    sort:"),o.push(`      - property: ${h.dateProperty?`note.${h.dateProperty}`:"file.ctime"}`),o.push("        direction: DESC")}}for(let h of t){if(!h.enabled||h.name==="All Content"||l&&h.id===l.id)continue;let g=r[h.id];if(!g)continue;let y=this.pathResolver.getBasesCMSFolderPath(h.folder,a);o.push("  - type: bases-cms"),o.push(`    name: ${h.name}`),o.push("    filters:"),o.push("      and:"),o.push(`        - file.folder.startsWith("${y}")`),o.push("    imageFormat: cover"),g.titleProperty?o.push(`    titleProperty: note.${g.titleProperty}`):o.push("    titleProperty: file.name"),g.dateProperty?o.push(`    dateProperty: note.${g.dateProperty}`):o.push("    dateProperty: file.ctime"),g.descriptionProperty&&o.push(`    descriptionProperty: note.${g.descriptionProperty}`),g.imageProperty&&o.push(`    imageProperty: note.${g.imageProperty}`),o.push(`    showTags: ${g.tagsProperty?"true":"false"}`),g.tagsProperty&&o.push(`    tagsProperty: note.${g.tagsProperty}`),o.push("    showDate: true"),o.push(`    showDraftStatus: ${g.draftProperty?"true":"false"}`),g.draftProperty&&o.push(`    draftStatusProperty: note.${g.draftProperty}`),o.push("    customizeNewButton: true"),o.push(`    newNoteLocation: "${y}"`),o.push("    fallbackToEmbeds: if-empty"),o.push("    propertyDisplay1: file.name"),o.push("    showTextPreview: true"),o.push("    propertyLabels: above"),o.push("    sort:"),o.push(`      - property: ${g.dateProperty?`note.${g.dateProperty}`:"file.ctime"}`),o.push("        direction: DESC")}for(let h of f)o.push(...this.serializeView(h));return d&&o.push(...this.serializeView(d)),o.join(`
`)}capitalizeFirst(t){return t.charAt(0).toUpperCase()+t.slice(1)}serializeView(t){let r=[];if(r.push("  - type: bases-cms"),r.push(`    name: ${t.name}`),t.filters&&(r.push("    filters:"),t.filters.and)){r.push("      and:");for(let n of t.filters.and)if(typeof n=="string")r.push(`        - ${n}`);else if(typeof n=="object")for(let[a,o]of Object.entries(n))r.push(`        - ${a}: ${typeof o=="string"?`"${o}"`:o}`)}if(t.groupBy&&(r.push("    groupBy:"),typeof t.groupBy=="object"&&(t.groupBy.property&&r.push(`      property: ${t.groupBy.property}`),t.groupBy.direction&&r.push(`      direction: ${t.groupBy.direction}`))),t.order){r.push("    order:");for(let n of t.order)r.push(`      - ${n}`)}if(t.sort){r.push("    sort:");for(let n of t.sort)typeof n=="object"&&n.property&&(r.push(`      - property: ${n.property}`),r.push(`        direction: ${n.direction||"ASC"}`))}let i=["type","name","filters","groupBy","order","sort"];for(let n of Object.keys(t)){if(i.includes(n)||t[n]===void 0)continue;let a=t[n];typeof a=="boolean"?r.push(`    ${n}: ${a}`):typeof a=="number"?r.push(`    ${n}: ${a}`):typeof a=="string"&&(n.includes("Property")&&(a.startsWith("note.")||a.startsWith("file."))?r.push(`    ${n}: ${a}`):n==="newNoteLocation"?r.push(`    ${n}: ${a}`):r.push(`    ${n}: "${a}"`))}return r}};var dt=require("obsidian");var $e=class{constructor(t){this.app=t,this.pathResolver=new $(t)}generateSEOConfig(t,r,i){let n=t.find(l=>l.enabled),a=n?r[n.id]:void 0,o=t.filter(l=>l.enabled).map(l=>this.pathResolver.getFolderPathFromVaultRoot(l.folder,i)).join(",");return{titleProperty:a!=null&&a.titleProperty&&a.titleProperty.trim()!==""?a.titleProperty:"title",descriptionProperty:a!=null&&a.descriptionProperty&&a.descriptionProperty.trim()!==""?a.descriptionProperty:void 0,scanDirectories:o,keywordProperty:void 0,useFilenameAsTitle:!1,useFilenameAsSlug:!0}}async saveConfig(t){var r;try{let i=this.app.plugins,n=(r=i==null?void 0:i.plugins)==null?void 0:r.seo;if(n&&n.settings){let a=n.settings;if(t.scanDirectories&&(a.scanDirectories=t.scanDirectories),t.titleProperty!==void 0&&(a.titleProperty=t.titleProperty),t.descriptionProperty!==void 0&&(a.descriptionProperty=t.descriptionProperty),typeof n.saveSettings=="function"){await n.saveSettings(),console.log("SEOConfig: Successfully saved via plugin.saveSettings()");return}}await this.saveConfigFallback(t)}catch(i){console.error("Failed to save SEO config via plugin method:",i),await this.saveConfigFallback(t)}}async saveConfigFallback(t){let r="seo",i=`.obsidian/plugins/${r}/data.json`;try{let n={},a=this.app.vault.getAbstractFileByPath(i);if(a&&a instanceof dt.TFile)try{n=JSON.parse(await this.app.vault.read(a))}catch(s){console.warn("Failed to parse existing SEO data.json, starting fresh:",s),n={}}let o={...n,scanDirectories:t.scanDirectories,...t.titleProperty!==void 0&&{titleProperty:t.titleProperty},...t.descriptionProperty!==void 0&&{descriptionProperty:t.descriptionProperty}};if(a&&a instanceof dt.TFile)await this.app.vault.modify(a,JSON.stringify(o,null,2)),console.log("SEOConfig: Successfully updated SEO plugin data.json (via file)");else{let s=`.obsidian/plugins/${r}`;this.app.vault.getAbstractFileByPath(s)||await this.app.vault.createFolder(s),await this.app.vault.create(i,JSON.stringify(o,null,2)),console.log("SEOConfig: Successfully created SEO plugin data.json (via file)")}}catch(n){throw console.error("Failed to save SEO config (fallback):",n),n}}};var he=require("obsidian"),ze=class{constructor(t){this.app=t}generateCommanderConfig(t){return{pageHeaderCommands:[]}}async toggleEditingToolbarCommand(t,r){var i,n,a;console.log(`CommanderConfig: toggleEditingToolbarCommand called with enable=${r}`);try{let o=t.plugins;if(!o){console.warn("CommanderConfig: Plugins API not available");return}let s=(i=o.plugins)==null?void 0:i["editing-toolbar"];if(!s){console.warn("CommanderConfig: Editing Toolbar plugin not found");return}if(console.log(`CommanderConfig: Editing Toolbar plugin found, enabled=${s.enabled}`),console.log("CommanderConfig: Plugin settings available:",!!s.settings),s.settings&&console.log("CommanderConfig: Current cMenuVisibility:",s.settings.cMenuVisibility),r&&!s.enabled?(console.log("CommanderConfig: Enabling editing-toolbar plugin"),await o.enablePlugin("editing-toolbar")):!r&&s.enabled&&(console.log("CommanderConfig: Disabling editing-toolbar plugin"),await o.disablePlugin("editing-toolbar")),s.settings&&typeof s.saveSettings=="function"){console.log("CommanderConfig: Using plugin.saveSettings() method");let l=s.settings.cMenuVisibility;if(s.settings.cMenuVisibility=r,console.log(`CommanderConfig: Set cMenuVisibility from ${l} to ${r}`),await s.saveSettings(),console.log("CommanderConfig: Successfully saved editing-toolbar via plugin.saveSettings()"),s.settings.cMenuVisibility===r?console.log(`CommanderConfig: Verified cMenuVisibility is now ${s.settings.cMenuVisibility}`):console.error(`CommanderConfig: ERROR - cMenuVisibility is ${s.settings.cMenuVisibility}, expected ${r}`),r){console.log("CommanderConfig: Waiting for settings to persist..."),await new Promise(c=>setTimeout(c,500)),typeof s.loadSettings=="function"&&(console.log("CommanderConfig: Reloading editing toolbar plugin settings"),await s.loadSettings()),typeof s.refresh=="function"&&(console.log("CommanderConfig: Refreshing editing toolbar plugin"),s.refresh()),console.log("CommanderConfig: Executing editing-toolbar:hide-show-menu command");try{for(let c=0;c<3;c++){let p=(a=(n=t.commands)==null?void 0:n.commands)==null?void 0:a["editing-toolbar:hide-show-menu"];console.log(`CommanderConfig: Command found (attempt ${c+1}):`,!!p),p?(setTimeout(()=>{t.commands.executeCommandById("editing-toolbar:hide-show-menu")},c*500),console.log(`CommanderConfig: Scheduled hide-show-menu command (attempt ${c+1})`)):console.warn(`CommanderConfig: Command editing-toolbar:hide-show-menu not found (attempt ${c+1})`)}}catch(c){console.error("CommanderConfig: Failed to execute editing toolbar show command:",c)}}return}else console.log("CommanderConfig: Plugin saveSettings not available, using fallback");await this.toggleEditingToolbarCommandFallback(t,r)}catch(o){console.error("CommanderConfig: Failed to toggle editing toolbar plugin:",o);try{await this.toggleEditingToolbarCommandFallback(t,r)}catch(s){console.error("CommanderConfig: Failed to toggle editing toolbar via fallback:",s)}}}async toggleEditingToolbarCommandFallback(t,r){var s;let i="editing-toolbar",n=`.obsidian/plugins/${i}/data.json`,a={},o=t.vault.getAbstractFileByPath(n);if(o&&o instanceof he.TFile)try{a=JSON.parse(await t.vault.read(o))}catch(l){console.warn("Failed to parse existing editing-toolbar data.json, starting fresh:",l),a={}}if(a.cMenuVisibility=r,o&&o instanceof he.TFile)await t.vault.modify(o,JSON.stringify(a,null,2)),console.log("CommanderConfig: Successfully saved editing-toolbar via file modify");else{let l=`.obsidian/plugins/${i}`;if(!t.vault.getAbstractFileByPath(l))try{await t.vault.createFolder(l)}catch(p){if(p.message&&!p.message.includes("already exists")&&!p.message.includes("File already exists")&&!p.message.includes("Folder already exists"))throw p}try{await t.vault.create(n,JSON.stringify(a,null,2)),console.log("CommanderConfig: Successfully created editing-toolbar data.json")}catch(p){if(p.message&&(p.message.includes("already exists")||p.message.includes("File already exists"))){let d=t.vault.getAbstractFileByPath(n);if(d&&d instanceof he.TFile)await t.vault.modify(d,JSON.stringify(a,null,2)),console.log("CommanderConfig: Successfully saved editing-toolbar via retry modify");else{await new Promise(u=>setTimeout(u,200));let f=t.vault.getAbstractFileByPath(n);if(f&&f instanceof he.TFile)await t.vault.modify(f,JSON.stringify(a,null,2)),console.log("CommanderConfig: Successfully saved editing-toolbar via delayed retry modify");else throw p}}else throw p}}if(r)try{await((s=t.commands)==null?void 0:s.executeCommandById("editing-toolbar:hide-show-menu"))}catch(l){console.warn("Failed to execute editing toolbar show command:",l)}}async saveConfig(t){let i=".obsidian/plugins/cmdr/data.json";try{let n=this.app.vault.getAbstractFileByPath(i);if(n){let a=JSON.parse(await this.app.vault.read(n)),o=a.pageHeader||[],s={id:"editing-toolbar:hide-show-menu",icon:"lucide-chevrons-up-down",name:"Toggle editing toolbar",mode:"desktop"},l=o.filter(p=>p.id!=="editing-toolbar:hide-show-menu");t.pageHeaderCommands.length>0&&l.push(s);let c={...a,pageHeader:l};await this.app.vault.modify(n,JSON.stringify(c,null,2))}}catch(n){console.error("Failed to save Commander config:",n)}}};var We=class{constructor(t){this.app=t}async saveConfig(t){let i=".obsidian/plugins/property-over-file-name/data.json";try{let n=this.app.vault.getAbstractFileByPath(i);if(n){let o={...JSON.parse(await this.app.vault.read(n)),...t};await this.app.vault.modify(n,JSON.stringify(o,null,2))}}catch(n){console.error("Failed to save Property Over File Name config:",n)}}};var Ye=require("obsidian"),He=class{constructor(t){this.app=t}async saveConfig(t,r){var a;let i="insert-unsplash-image",n=`.obsidian/plugins/${i}/data.json`;try{let o=this.app.plugins,s=(a=o==null?void 0:o.plugins)==null?void 0:a[i];if(s&&s.settings){let l=s.settings;if(l.frontmatter||(l.frontmatter={}),t.valueFormat&&(l.frontmatter.valueFormat=t.valueFormat),r&&(l.frontmatter.key=r),typeof s.saveSettings=="function"){await s.saveSettings(),console.log("ImageInserterConfig: Successfully saved via plugin.saveSettings()");return}}await this.saveConfigFallback(t,r)}catch(o){console.error("Failed to save Image Inserter config:",o);try{await this.saveConfigFallback(t,r)}catch(s){console.error("Failed to save Image Inserter config via fallback:",s)}}}async saveConfigFallback(t,r){let i="insert-unsplash-image",n=`.obsidian/plugins/${i}/data.json`,a={},o=this.app.vault.getAbstractFileByPath(n);if(o&&o instanceof Ye.TFile)try{a=JSON.parse(await this.app.vault.read(o))}catch(l){console.warn("Failed to parse existing Image Inserter data.json, starting fresh:",l),a={}}let s={...a};if(s.frontmatter||(s.frontmatter={}),t.valueFormat&&(s.frontmatter.valueFormat=t.valueFormat),r&&(s.frontmatter.key=r),o&&o instanceof Ye.TFile)await this.app.vault.modify(o,JSON.stringify(s,null,2));else{let l=`.obsidian/plugins/${i}`;if(!this.app.vault.getAbstractFileByPath(l))try{await this.app.vault.createFolder(l)}catch(p){if(!p.message||!p.message.includes("already exists")&&!p.message.includes("File already exists"))throw p}try{await this.app.vault.create(n,JSON.stringify(s,null,2))}catch(p){if(p.message&&(p.message.includes("already exists")||p.message.includes("File already exists"))){let d=this.app.vault.getAbstractFileByPath(n);if(d&&d instanceof Ye.TFile)await this.app.vault.modify(d,JSON.stringify(s,null,2));else throw p}else throw p}}}};var Ve=require("obsidian"),Ue=class{constructor(t){this.app=t}async saveConfig(t){var n;let r="simple-banner",i=`.obsidian/plugins/${r}/data.json`;try{let a=this.app.plugins,o=(n=a==null?void 0:a.plugins)==null?void 0:n[r];if(o&&o.settings&&(o.settings.properties||(o.settings.properties={}),o.settings.properties.image=t,typeof o.saveSettings=="function")){await o.saveSettings(),console.log("SimpleBannerConfig: Successfully saved via plugin.saveSettings()");return}await this.saveConfigFallback(t)}catch(a){console.error("Failed to save Simple Banner config:",a);try{await this.saveConfigFallback(t)}catch(o){console.error("Failed to save Simple Banner config via fallback:",o)}}}async saveConfigFallback(t){let r="simple-banner",i=`.obsidian/plugins/${r}/data.json`,n={},a=this.app.vault.getAbstractFileByPath(i);if(a&&a instanceof Ve.TFile)try{n=JSON.parse(await this.app.vault.read(a))}catch(o){console.warn("Failed to parse existing Simple Banner data.json, starting fresh:",o),n={}}if(n.properties||(n.properties={}),n.properties.image=t,a&&a instanceof Ve.TFile)await this.app.vault.modify(a,JSON.stringify(n,null,2));else{let o=`.obsidian/plugins/${r}`;if(!this.app.vault.getAbstractFileByPath(o))try{await this.app.vault.createFolder(o)}catch(l){if(!l.message||!l.message.includes("already exists")&&!l.message.includes("File already exists"))throw l}try{await this.app.vault.create(i,JSON.stringify(n,null,2))}catch(l){if(l.message&&(l.message.includes("already exists")||l.message.includes("File already exists"))){let c=this.app.vault.getAbstractFileByPath(i);if(c&&c instanceof Ve.TFile)await this.app.vault.modify(c,JSON.stringify(n,null,2));else throw l}else throw l}}}};var Ge=class extends S{constructor(r,i,n,a,o,s){super(r,i,n,a,o,s);this.applied=!1;this.pluginManager=new se(r),this.basesCMSConfigurator=new Be(r),this.astroComposerConfigurator=new ee(r),this.seoConfigurator=new $e(r),this.commanderConfigurator=new ze(r),this.propertyOverFileNameConfigurator=new We(r),this.imageInserterConfigurator=new He(r),this.simpleBannerConfigurator=new Ue(r)}display(){let{containerEl:r}=this;r.empty(),r.createEl("h2",{text:"Finalize Configuration"}),r.createEl("p",{text:'Review your configuration and click "Apply" to save all settings:'});let i=r.createEl("div",{cls:"finalize-summary"});i.createEl("h3",{text:"Summary"});let n=this.state.contentTypes.filter(p=>p.enabled);i.createEl("p",{text:`Content Types: ${n.length}`}),i.createEl("p",{text:`WYSIWYG Toolbar: ${this.state.enableWYSIWYG?"Enabled":"Disabled"}`});let a=n.length;i.createEl("p",{text:`Bases CMS Views: ${a} new view${a!==1?"s":""} to be created`});let o=n.map(p=>p.folder),s=o.length;i.createEl("p",{text:`SEO Scan Directories: ${s} director${s!==1?"ies":"y"} (${o.join(", ")})`});let l=r.createDiv();l.style.marginBottom="30px",l.createEl("button",{text:"Apply Configuration",cls:"mod-cta"}).addEventListener("click",async()=>{await this.applyConfiguration()})}async applyConfiguration(){if(!this.applied)try{if(console.log("FinalizeStep: Starting configuration application"),console.log("FinalizeStep: Enabled content types:",this.state.contentTypes.filter(s=>s.enabled).map(s=>s.name)),console.log("FinalizeStep: Configuring plugin states"),await this.pluginManager.setPluginStates(this.state.enabledPlugins,this.state.disabledPlugins),console.log("FinalizeStep: Configuring Bases CMS"),await this.basesCMSConfigurator.createOrUpdateBaseFile(this.state.contentTypes,this.state.frontmatterProperties,this.state.defaultContentTypeId,this.state.projectDetection),console.log("FinalizeStep: Bases CMS configuration complete"),this.state.projectDetection){let s=await this.astroComposerConfigurator.configureAstroComposer(this.state.contentTypes,this.state.frontmatterProperties,this.state.projectDetection.projectRoot,this.state.projectDetection.configFilePath,this.state.defaultContentTypeId,this.state.projectDetection);this.state.astroComposerConfig=s,await this.astroComposerConfigurator.saveConfig(s)}let r=this.seoConfigurator.generateSEOConfig(this.state.contentTypes,this.state.frontmatterProperties,this.state.projectDetection);this.state.seoConfig=r,await this.seoConfigurator.saveConfig(r),console.log(`FinalizeStep: Configuring editing toolbar, enableWYSIWYG=${this.state.enableWYSIWYG}`),await this.commanderConfigurator.toggleEditingToolbarCommand(this.app,this.state.enableWYSIWYG);let i=this.commanderConfigurator.generateCommanderConfig(this.state.enableWYSIWYG);this.state.commanderConfig=i,await this.commanderConfigurator.saveConfig(i);let n=this.state.contentTypes.find(s=>s.enabled),a=n?this.state.frontmatterProperties[n.id]:void 0;a&&a.titleProperty&&(this.state.propertyOverFileName.propertyKey=a.titleProperty,await this.propertyOverFileNameConfigurator.saveConfig(this.state.propertyOverFileName));let o=a==null?void 0:a.imageProperty;if(o&&this.state.enabledPlugins.includes("simple-banner")&&await this.simpleBannerConfigurator.saveConfig(o),o&&this.state.enabledPlugins.includes("insert-unsplash-image")){let s={...this.state.imageInserter};if(this.state.attachmentHandlingMode==="same-folder")s.valueFormat="[[{image-url}]]",s.insertFormat="[[{image-url}]]";else{let l=this.state.attachmentFolderName||"attachments";s.valueFormat=`[[${l}/{image-url}]]`,s.insertFormat=`[[${l}/{image-url}]]`}await this.imageInserterConfigurator.saveConfig(s,o)}if(this.state.defaultContentTypeId){let s=this.state.contentTypes.find(l=>l.id===this.state.defaultContentTypeId);if(s){console.log("FinalizeStep: Configuring Obsidian settings for default content type:",s.name);let l=this.app,c="./";if(this.state.attachmentHandlingMode==="same-folder"?c="./":this.state.attachmentHandlingMode==="subfolder"?c=`./${this.state.attachmentFolderName||"attachments"}`:this.state.attachmentHandlingMode==="specified-folder"&&(c=this.state.attachmentFolderName||"attachments"),l.setting&&typeof l.setting.set=="function")console.log("FinalizeStep: Using app.setting API"),await l.setting.set("newFileLocation","folder"),await l.setting.set("newFileFolderPath",s.folder),await l.setting.set("attachmentFolderPath",c),await l.setting.set("newLinkFormat","relative"),typeof l.setting.save=="function"&&(await l.setting.save(),console.log("FinalizeStep: Obsidian settings saved via app.setting.save()"));else{console.log("FinalizeStep: Using vault.config API");let p=this.app.vault.config;p?(p.newFileLocation="folder",p.newFileFolderPath=s.folder,p.attachmentFolderPath=c,p.newLinkFormat="relative",typeof this.app.vault.saveConfig=="function"?(await this.app.vault.saveConfig(),console.log("FinalizeStep: Obsidian settings saved via vault.saveConfig()")):console.error("FinalizeStep: vault.saveConfig() is not available")):console.error("FinalizeStep: vault.config is not available")}}}this.applied=!0,new ut.Notice("Configuration applied successfully!")}catch(r){console.error("Failed to apply configuration:",r),new ut.Notice("Failed to apply configuration. Please check the console for details.")}}validate(){return!0}getTitle(){return"Finalize"}getDescription(){return"Review and apply configuration"}};var q=class extends sr.Modal{constructor(r,i,n){var o,s,l,c,p,d,f,u,h,g,y,x,P,m,C,b,w,k;super(r);this.currentStepIndex=0;this.currentStepInstance=null;this.pluginInstance=n;let a=(i==null?void 0:i.projectDetection)||((o=n==null?void 0:n.settings)!=null&&o.projectRoot&&((s=n==null?void 0:n.settings)!=null&&s.configFilePath)?{projectRoot:n.settings.projectRoot,configFilePath:n.settings.configFilePath,vaultLocation:"content"}:void 0);this.state={currentStep:0,contentTypes:(i==null?void 0:i.contentTypes)||((l=n==null?void 0:n.settings)==null?void 0:l.contentTypes)||[],frontmatterProperties:(i==null?void 0:i.frontmatterProperties)||((c=n==null?void 0:n.settings)==null?void 0:c.frontmatterProperties)||{},projectDetection:a,defaultContentTypeId:(i==null?void 0:i.defaultContentTypeId)||((p=n==null?void 0:n.settings)==null?void 0:p.defaultContentTypeId),attachmentHandlingMode:(i==null?void 0:i.attachmentHandlingMode)||"subfolder",attachmentFolderName:i==null?void 0:i.attachmentFolderName,preset:(i==null?void 0:i.preset)||((d=n==null?void 0:n.settings)==null?void 0:d.preset)||"vanilla",enableWYSIWYG:(h=(u=i==null?void 0:i.enableWYSIWYG)!=null?u:(f=n==null?void 0:n.settings)==null?void 0:f.enableWYSIWYG)!=null?h:!1,enabledPlugins:(i==null?void 0:i.enabledPlugins)||((g=n==null?void 0:n.settings)==null?void 0:g.enabledPlugins)||[],disabledPlugins:(i==null?void 0:i.disabledPlugins)||((y=n==null?void 0:n.settings)==null?void 0:y.disabledPlugins)||[],theme:(i==null?void 0:i.theme)||((x=n==null?void 0:n.settings)==null?void 0:x.theme)||"",basesCMSConfig:(i==null?void 0:i.basesCMSConfig)||((P=n==null?void 0:n.settings)==null?void 0:P.basesCMSConfig)||{views:[]},astroComposerConfig:(i==null?void 0:i.astroComposerConfig)||((m=n==null?void 0:n.settings)==null?void 0:m.astroComposerConfig)||{customContentTypes:[],defaultTemplate:"",configFilePath:"",terminalProjectRootPath:""},seoConfig:(i==null?void 0:i.seoConfig)||((C=n==null?void 0:n.settings)==null?void 0:C.seoConfig)||{titleProperty:"title",scanDirectories:"",useFilenameAsTitle:!1,useFilenameAsSlug:!0},commanderConfig:(i==null?void 0:i.commanderConfig)||((b=n==null?void 0:n.settings)==null?void 0:b.commanderConfig)||{pageHeaderCommands:[]},propertyOverFileName:(i==null?void 0:i.propertyOverFileName)||((w=n==null?void 0:n.settings)==null?void 0:w.propertyOverFileName)||{propertyKey:"title"},imageInserter:(i==null?void 0:i.imageInserter)||((k=n==null?void 0:n.settings)==null?void 0:k.imageInserter)||{valueFormat:"[[attachments/{image-url}]]",insertFormat:"[[attachments/{image-url}]]"},...i},this.steps=[ye,Ce,xe,Fe,ke,Ie,je,Me,Re,Le,Ge]}onOpen(){let{contentEl:r}=this;r.empty(),this.displayCurrentStep().catch(i=>{console.error("Error displaying wizard step:",i)})}onClose(){let{contentEl:r}=this;r.empty()}async displayCurrentStep(){let{contentEl:r}=this;if(r.empty(),this.currentStepIndex>=this.steps.length){this.close();return}let i=this.steps[this.currentStepIndex],n=i.name||"Unknown";console.log(`SetupWizardModal: Displaying step ${this.currentStepIndex+1}/${this.steps.length}: ${n}`),this.currentStepInstance=new i(this.app,r,this.state,()=>this.nextStep(),()=>this.previousStep(),()=>this.close()),await this.currentStepInstance.display(),this.state.currentStep=this.currentStepIndex;let o=r.createDiv({cls:"wizard-footer"}).createDiv({cls:"wizard-buttons"});if(o.style.display="flex",o.style.gap="10px",this.currentStepIndex>0&&o.createEl("button",{text:"Previous",cls:"mod-button"}).addEventListener("click",async()=>{await this.previousStep()}),this.currentStepIndex<this.steps.length-1){o.createEl("button",{text:"Next",cls:"mod-button mod-cta"}).addEventListener("click",async()=>{this.currentStepInstance&&this.currentStepInstance.validate()&&(await this.saveCurrentStepState(),await this.nextStep())});let l=o.createEl("button",{text:"Skip",cls:"mod-button"});l.style.opacity="0.6",l.addEventListener("click",async()=>{await this.nextStep()})}else o.createEl("button",{text:"Complete Setup",cls:"mod-button mod-cta"}).addEventListener("click",async()=>{this.currentStepInstance&&this.currentStepInstance.validate()&&(await this.saveStateIfNeeded(),this.close())})}async nextStep(){this.currentStepIndex<this.steps.length-1?(this.currentStepIndex++,await this.displayCurrentStep()):(await this.saveStateIfNeeded(),this.close())}async saveCurrentStepState(){var r,i;try{this.saveCallback&&this.pluginInstance&&(this.pluginInstance.settings.projectRoot=((r=this.state.projectDetection)==null?void 0:r.projectRoot)||"",this.pluginInstance.settings.configFilePath=((i=this.state.projectDetection)==null?void 0:i.configFilePath)||"",this.pluginInstance.settings.contentTypes=this.state.contentTypes,this.pluginInstance.settings.frontmatterProperties=this.state.frontmatterProperties,this.pluginInstance.settings.defaultContentTypeId=this.state.defaultContentTypeId,this.pluginInstance.settings.preset=this.state.preset,this.pluginInstance.settings.enableWYSIWYG=this.state.enableWYSIWYG,this.pluginInstance.settings.enabledPlugins=this.state.enabledPlugins,this.pluginInstance.settings.disabledPlugins=this.state.disabledPlugins,this.pluginInstance.settings.theme=this.state.theme,this.pluginInstance.settings.basesCMSConfig=this.state.basesCMSConfig,this.pluginInstance.settings.astroComposerConfig=this.state.astroComposerConfig,this.pluginInstance.settings.seoConfig=this.state.seoConfig,this.pluginInstance.settings.commanderConfig=this.state.commanderConfig,this.pluginInstance.settings.propertyOverFileName=this.state.propertyOverFileName,this.pluginInstance.settings.imageInserter=this.state.imageInserter,await this.pluginInstance.saveSettings())}catch(n){console.error("Error saving current step state:",n)}}async previousStep(){this.currentStepIndex>0&&(this.currentStepIndex--,await this.displayCurrentStep())}getState(){return this.state}setSaveCallback(r){this.saveCallback=r}async saveStateIfNeeded(){this.saveCallback&&this.currentStepIndex===this.steps.length-1&&await this.saveCallback(this.state)}};var qe=class extends ge.PluginSettingTab{constructor(r,i){super(r,i);this.plugin=i}display(){let{containerEl:r}=this;r.empty(),new ge.Setting(r).setName("Open Setup Wizard").setDesc("Launch the setup wizard to configure Vault CMS").addButton(i=>i.setButtonText("Open Wizard").setCta().onClick(()=>{new q(this.app,this.plugin.settings,this.plugin).open()})),new ge.Setting(r).setName("Run Wizard on Startup").setDesc("Automatically open the wizard when the plugin loads").addToggle(i=>i.setValue(this.plugin.settings.runWizardOnStartup).onChange(async n=>{this.plugin.settings.runWizardOnStartup=n,await this.plugin.saveSettings()}))}};function lr(e){e.addCommand({id:"vault-cms-open-wizard",name:"Open Setup Wizard",callback:()=>{let t=new q(e.app,e.settings,e);t.setSaveCallback(async r=>{var i,n;e.settings.projectRoot=((i=r.projectDetection)==null?void 0:i.projectRoot)||"",e.settings.configFilePath=((n=r.projectDetection)==null?void 0:n.configFilePath)||"",e.settings.contentTypes=r.contentTypes,e.settings.frontmatterProperties=r.frontmatterProperties,e.settings.defaultContentTypeId=r.defaultContentTypeId,e.settings.preset=r.preset,e.settings.enableWYSIWYG=r.enableWYSIWYG,e.settings.enabledPlugins=r.enabledPlugins,e.settings.disabledPlugins=r.disabledPlugins,e.settings.theme=r.theme,e.settings.basesCMSConfig=r.basesCMSConfig,e.settings.astroComposerConfig=r.astroComposerConfig,e.settings.seoConfig=r.seoConfig,e.settings.commanderConfig=r.commanderConfig,e.settings.propertyOverFileName=r.propertyOverFileName,e.settings.imageInserter=r.imageInserter,e.settings.wizardCompleted=!0,await e.saveSettings()}),t.open()}})}var Ke=class extends cr.Plugin{async onload(){await this.loadSettings(),lr(this),this.addSettingTab(new qe(this.app,this)),this.settings.runWizardOnStartup&&this.app.workspace.onLayoutReady(()=>{this.startupTimeoutId=window.setTimeout(async()=>{if(await this.loadSettings(),this.settings.runWizardOnStartup){let r=new q(this.app,this.settings,this);r.setSaveCallback(async i=>{var n,a;this.settings.projectRoot=((n=i.projectDetection)==null?void 0:n.projectRoot)||"",this.settings.configFilePath=((a=i.projectDetection)==null?void 0:a.configFilePath)||"",this.settings.contentTypes=i.contentTypes,this.settings.frontmatterProperties=i.frontmatterProperties,this.settings.defaultContentTypeId=i.defaultContentTypeId,this.settings.preset=i.preset,this.settings.enableWYSIWYG=i.enableWYSIWYG,this.settings.enabledPlugins=i.enabledPlugins,this.settings.disabledPlugins=i.disabledPlugins,this.settings.theme=i.theme,this.settings.basesCMSConfig=i.basesCMSConfig,this.settings.astroComposerConfig=i.astroComposerConfig,this.settings.seoConfig=i.seoConfig,this.settings.commanderConfig=i.commanderConfig,this.settings.propertyOverFileName=i.propertyOverFileName,this.settings.imageInserter=i.imageInserter,this.settings.wizardCompleted=!0,await this.saveSettings()}),r.open()}},2e3)})}onunload(){this.startupTimeoutId&&window.clearTimeout(this.startupTimeoutId)}async loadSettings(){this.settings=Object.assign({},gt,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.1 https://github.com/nodeca/js-yaml @license MIT *)
*/
